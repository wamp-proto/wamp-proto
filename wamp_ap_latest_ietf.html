<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>WAMP Advanced Profile</title>
<meta content="Tobias Oberstein" name="author">
<meta content="xml2rfc 3.30.2" name="generator">
<meta content="WebSocket, WAMP, real-time, RPC, PubSub" name="keyword">
<meta content="WAMP" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.30.2
    Python 3.11.13
    ConfigArgParse 1.7.1
    google-i18n-address 3.1.1
    intervaltree 3.1.0
    Jinja2 3.1.6
    lxml 6.0.1
    platformdirs 4.4.0
    pycountry 24.6.1
    PyYAML 6.0.2
    requests 2.32.5
    setuptools 65.5.0
    wcwidth 0.2.13
    weasyprint 66.0
-->
<link href="wamp-ap.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necessary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

:root {
  --font-sans: 'Noto Sans', Arial, Helvetica, sans-serif;
  --font-serif: 'Noto Serif', 'Times', 'Times New Roman', serif;
  --font-mono: 'Roboto Mono', Courier, 'Courier New', monospace;
}

@viewport {
  zoom: 1.0;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: var(--font-sans);
  line-height: 1.6;
  scroll-behavior: smooth;
  overflow-wrap: break-word;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
@media print {
  svg {
    max-height: 850px;
    max-width: 660px;
  }
}
svg[font-family~="serif" i], svg [font-family~="serif" i] {
  font-family: var(--font-serif);
}
svg[font-family~="sans-serif" i], svg [font-family~="sans-serif" i] {
  font-family: var(--font-sans);
}
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  display: table;
  border: none;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.ulBare, li.ulBare {
  margin-left: 0em !important;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre {
  background-color: #f9f9f9;
  font-family: var(--font-mono);
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
blockquote > *:last-child {
  margin-bottom: 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}
.xref {
  overflow-wrap: normal;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
/* Fix PDF info block run off issue */
@media print {
  #identifiers dd {
    max-width: 100%;
  }
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.refSubseries {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: var(--font-sans);
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  .breakable pre {
    break-inside: auto;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The following is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
.sourcecode pre,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact information look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .artwork > pre,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: upper-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background slightly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr {
  break-inside: avoid;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: auto;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottom margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code, dt tt, dt code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the compact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > blockquote:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div.sourcecode:first-child,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
/* Make paragraph spacing inside <li> smaller than in body text, to fit better within the list */
li > p {
  margin-bottom: 0.5em
}
/* Don't let p margin spill out from inside list items */
li > p:last-of-type:only-child {
  margin-bottom: 0;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css">
</head>
<body class="xml2rfc">
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">WAMP-AP</td>
<td class="right">September 2025</td>
</tr></thead>
<tfoot><tr>
<td class="left">Oberstein</td>
<td class="center">Expires 20 March 2026</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">BiDirectional or Server-Initiated HTTP</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">WAMP</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2025-09-16" class="published">16 September 2025</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Experimental</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2026-03-20">20 March 2026</time></dd>
<dt class="label-authors">Author:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">T. Oberstein</div>
<div class="org">typedef int GmbH</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">WAMP Advanced Profile</h1>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 20 March 2026.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2025 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1"><a href="#section-1" class="auto internal xref">1</a>.  <a href="#name-wamp-advanced-profile" class="internal xref">WAMP Advanced Profile</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="auto internal xref">1.1</a>.  <a href="#name-feature-announcement" class="internal xref">Feature Announcement</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.2">
                <p id="section-toc.1-1.1.2.2.1"><a href="#section-1.2" class="auto internal xref">1.2</a>.  <a href="#name-additional-messages" class="internal xref">Additional Messages</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.2.2.1">
                    <p id="section-toc.1-1.1.2.2.2.1.1" class="keepWithNext"><a href="#section-1.2.1" class="auto internal xref">1.2.1</a>.  <a href="#name-challenge" class="internal xref">CHALLENGE</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.2.2.2">
                    <p id="section-toc.1-1.1.2.2.2.2.1" class="keepWithNext"><a href="#section-1.2.2" class="auto internal xref">1.2.2</a>.  <a href="#name-authenticate" class="internal xref">AUTHENTICATE</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.2.2.3">
                    <p id="section-toc.1-1.1.2.2.2.3.1"><a href="#section-1.2.3" class="auto internal xref">1.2.3</a>.  <a href="#name-cancel" class="internal xref">CANCEL</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.2.2.4">
                    <p id="section-toc.1-1.1.2.2.2.4.1"><a href="#section-1.2.4" class="auto internal xref">1.2.4</a>.  <a href="#name-interrupt" class="internal xref">INTERRUPT</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="auto internal xref">2</a>.  <a href="#name-meta-api" class="internal xref">Meta API</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1">
                <p id="section-toc.1-1.2.2.1.1"><a href="#section-2.1" class="auto internal xref">2.1</a>.  <a href="#name-session-meta-api" class="internal xref">Session Meta API</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1.2.1">
                    <p id="section-toc.1-1.2.2.1.2.1.1"><a href="#section-2.1.1" class="auto internal xref">2.1.1</a>.  <a href="#name-events" class="internal xref">Events</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1.2.2">
                    <p id="section-toc.1-1.2.2.1.2.2.1"><a href="#section-2.1.2" class="auto internal xref">2.1.2</a>.  <a href="#name-procedures" class="internal xref">Procedures</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2">
                <p id="section-toc.1-1.2.2.2.1"><a href="#section-2.2" class="auto internal xref">2.2</a>.  <a href="#name-registration-meta-api" class="internal xref">Registration Meta API</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2.2.1">
                    <p id="section-toc.1-1.2.2.2.2.1.1"><a href="#section-2.2.1" class="auto internal xref">2.2.1</a>.  <a href="#name-events-2" class="internal xref">Events</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2.2.2">
                    <p id="section-toc.1-1.2.2.2.2.2.1"><a href="#section-2.2.2" class="auto internal xref">2.2.2</a>.  <a href="#name-procedures-2" class="internal xref">Procedures</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.3">
                <p id="section-toc.1-1.2.2.3.1"><a href="#section-2.3" class="auto internal xref">2.3</a>.  <a href="#name-subscriptions-meta-api" class="internal xref">Subscriptions Meta API</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.3.2.1">
                    <p id="section-toc.1-1.2.2.3.2.1.1"><a href="#section-2.3.1" class="auto internal xref">2.3.1</a>.  <a href="#name-events-3" class="internal xref">Events</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.3.2.2">
                    <p id="section-toc.1-1.2.2.3.2.2.1"><a href="#section-2.3.2" class="auto internal xref">2.3.2</a>.  <a href="#name-procedures-3" class="internal xref">Procedures</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="auto internal xref">3</a>.  <a href="#name-advanced-rpc" class="internal xref">Advanced RPC</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="auto internal xref">3.1</a>.  <a href="#name-progressive-call-results" class="internal xref">Progressive Call Results</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="auto internal xref">3.2</a>.  <a href="#name-progressive-call-invocation" class="internal xref">Progressive Call Invocations</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3">
                <p id="section-toc.1-1.3.2.3.1"><a href="#section-3.3" class="auto internal xref">3.3</a>.  <a href="#name-call-timeouts" class="internal xref">Call Timeouts</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.4">
                <p id="section-toc.1-1.3.2.4.1"><a href="#section-3.4" class="auto internal xref">3.4</a>.  <a href="#name-call-canceling" class="internal xref">Call Canceling</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.5">
                <p id="section-toc.1-1.3.2.5.1"><a href="#section-3.5" class="auto internal xref">3.5</a>.  <a href="#name-call-re-routing" class="internal xref">Call Re-Routing</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.6">
                <p id="section-toc.1-1.3.2.6.1"><a href="#section-3.6" class="auto internal xref">3.6</a>.  <a href="#name-caller-identification" class="internal xref">Caller Identification</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.7">
                <p id="section-toc.1-1.3.2.7.1"><a href="#section-3.7" class="auto internal xref">3.7</a>.  <a href="#name-call-trust-levels" class="internal xref">Call Trust Levels</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.8">
                <p id="section-toc.1-1.3.2.8.1"><a href="#section-3.8" class="auto internal xref">3.8</a>.  <a href="#name-pattern-based-registrations" class="internal xref">Pattern-based Registrations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.8.2.1">
                    <p id="section-toc.1-1.3.2.8.2.1.1"><a href="#section-3.8.1" class="auto internal xref">3.8.1</a>.  <a href="#name-prefix-matching" class="internal xref">Prefix Matching</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.8.2.2">
                    <p id="section-toc.1-1.3.2.8.2.2.1"><a href="#section-3.8.2" class="auto internal xref">3.8.2</a>.  <a href="#name-wildcard-matching" class="internal xref">Wildcard Matching</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.8.2.3">
                    <p id="section-toc.1-1.3.2.8.2.3.1"><a href="#section-3.8.3" class="auto internal xref">3.8.3</a>.  <a href="#name-design-aspects" class="internal xref">Design Aspects</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.9">
                <p id="section-toc.1-1.3.2.9.1"><a href="#section-3.9" class="auto internal xref">3.9</a>.  <a href="#name-shared-registration" class="internal xref">Shared Registration</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.9.2.1">
                    <p id="section-toc.1-1.3.2.9.2.1.1"><a href="#section-3.9.1" class="auto internal xref">3.9.1</a>.  <a href="#name-load-balancing" class="internal xref">Load Balancing</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.9.2.2">
                    <p id="section-toc.1-1.3.2.9.2.2.1"><a href="#section-3.9.2" class="auto internal xref">3.9.2</a>.  <a href="#name-hot-stand-by" class="internal xref">Hot Stand-By</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.10">
                <p id="section-toc.1-1.3.2.10.1"><a href="#section-3.10" class="auto internal xref">3.10</a>. <a href="#name-sharded-registration" class="internal xref">Sharded Registration</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.10.2.1">
                    <p id="section-toc.1-1.3.2.10.2.1.1"><a href="#section-3.10.1" class="auto internal xref">3.10.1</a>.  <a href="#name-all-calls" class="internal xref">"All" Calls</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.10.2.2">
                    <p id="section-toc.1-1.3.2.10.2.2.1"><a href="#section-3.10.2" class="auto internal xref">3.10.2</a>.  <a href="#name-partitioned-calls" class="internal xref">"Partitioned" Calls</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.11">
                <p id="section-toc.1-1.3.2.11.1"><a href="#section-3.11" class="auto internal xref">3.11</a>. <a href="#name-registration-revocation" class="internal xref">Registration Revocation</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="auto internal xref">4</a>.  <a href="#name-advanced-pubsub" class="internal xref">Advanced PubSub</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="auto internal xref">4.1</a>.  <a href="#name-subscriber-black-and-whitel" class="internal xref">Subscriber Black- and Whitelisting</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="auto internal xref">4.2</a>.  <a href="#name-publisher-exclusion" class="internal xref">Publisher Exclusion</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3">
                <p id="section-toc.1-1.4.2.3.1"><a href="#section-4.3" class="auto internal xref">4.3</a>.  <a href="#name-publisher-identification" class="internal xref">Publisher Identification</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.4">
                <p id="section-toc.1-1.4.2.4.1"><a href="#section-4.4" class="auto internal xref">4.4</a>.  <a href="#name-publication-trust-levels" class="internal xref">Publication Trust Levels</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.5">
                <p id="section-toc.1-1.4.2.5.1"><a href="#section-4.5" class="auto internal xref">4.5</a>.  <a href="#name-pattern-based-subscription" class="internal xref">Pattern-based Subscription</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.5.2.1">
                    <p id="section-toc.1-1.4.2.5.2.1.1"><a href="#section-4.5.1" class="auto internal xref">4.5.1</a>.  <a href="#name-prefix-matching-2" class="internal xref">Prefix Matching</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.5.2.2">
                    <p id="section-toc.1-1.4.2.5.2.2.1"><a href="#section-4.5.2" class="auto internal xref">4.5.2</a>.  <a href="#name-wildcard-matching-2" class="internal xref">Wildcard Matching</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.5.2.3">
                    <p id="section-toc.1-1.4.2.5.2.3.1"><a href="#section-4.5.3" class="auto internal xref">4.5.3</a>.  <a href="#name-design-aspects-2" class="internal xref">Design Aspects</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.6">
                <p id="section-toc.1-1.4.2.6.1"><a href="#section-4.6" class="auto internal xref">4.6</a>.  <a href="#name-sharded-subscription" class="internal xref">Sharded Subscription</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.7">
                <p id="section-toc.1-1.4.2.7.1"><a href="#section-4.7" class="auto internal xref">4.7</a>.  <a href="#name-event-history" class="internal xref">Event History</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.8">
                <p id="section-toc.1-1.4.2.8.1"><a href="#section-4.8" class="auto internal xref">4.8</a>.  <a href="#name-event-retention" class="internal xref">Event Retention</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.9">
                <p id="section-toc.1-1.4.2.9.1"><a href="#section-4.9" class="auto internal xref">4.9</a>.  <a href="#name-subscription-revocation" class="internal xref">Subscription Revocation</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.10">
                <p id="section-toc.1-1.4.2.10.1"><a href="#section-4.10" class="auto internal xref">4.10</a>. <a href="#name-session-testament" class="internal xref">Session Testament</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="auto internal xref">5</a>.  <a href="#name-authentication-methods" class="internal xref">Authentication Methods</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="auto internal xref">5.1</a>.  <a href="#name-ticket-based-authentication" class="internal xref">Ticket-based Authentication</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="auto internal xref">5.2</a>.  <a href="#name-challenge-response-authenti" class="internal xref">Challenge Response Authentication</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.3">
                <p id="section-toc.1-1.5.2.3.1"><a href="#section-5.3" class="auto internal xref">5.3</a>.  <a href="#name-salted-challenge-response-a" class="internal xref">Salted Challenge Response Authentication</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.4">
                <p id="section-toc.1-1.5.2.4.1"><a href="#section-5.4" class="auto internal xref">5.4</a>.  <a href="#name-cryptosign-based-authentica" class="internal xref">Cryptosign-based Authentication</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.4.2.1">
                    <p id="section-toc.1-1.5.2.4.2.1.1"><a href="#section-5.4.1" class="auto internal xref">5.4.1</a>.  <a href="#name-client-authentication" class="internal xref">Client Authentication</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.4.2.2">
                    <p id="section-toc.1-1.5.2.4.2.2.1"><a href="#section-5.4.2" class="auto internal xref">5.4.2</a>.  <a href="#name-tls-channel-binding" class="internal xref">TLS Channel Binding</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.4.2.3">
                    <p id="section-toc.1-1.5.2.4.2.3.1"><a href="#section-5.4.3" class="auto internal xref">5.4.3</a>.  <a href="#name-router-authentication" class="internal xref">Router Authentication</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.4.2.4">
                    <p id="section-toc.1-1.5.2.4.2.4.1"><a href="#section-5.4.4" class="auto internal xref">5.4.4</a>.  <a href="#name-trustroots-and-certificates" class="internal xref">Trustroots and Certificates</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.4.2.5">
                    <p id="section-toc.1-1.5.2.4.2.5.1"><a href="#section-5.4.5" class="auto internal xref">5.4.5</a>.  <a href="#name-remote-attestation" class="internal xref">Remote Attestation</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.4.2.6">
                    <p id="section-toc.1-1.5.2.4.2.6.1"><a href="#section-5.4.6" class="auto internal xref">5.4.6</a>.  <a href="#name-example-message-exchanges" class="internal xref">Example Message Exchanges</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.5">
                <p id="section-toc.1-1.5.2.5.1"><a href="#section-5.5" class="auto internal xref">5.5</a>.  <a href="#name-dynamic-authentication-api" class="internal xref">Dynamic Authentication API</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.6">
                <p id="section-toc.1-1.5.2.6.1"><a href="#section-5.6" class="auto internal xref">5.6</a>.  <a href="#name-authorization" class="internal xref">Authorization</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="auto internal xref">6</a>.  <a href="#name-advanced-security-features" class="internal xref">Advanced Security Features</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="auto internal xref">6.1</a>.  <a href="#name-payload-passthru-mode" class="internal xref">Payload Passthru Mode</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2">
                <p id="section-toc.1-1.6.2.2.1"><a href="#section-6.2" class="auto internal xref">6.2</a>.  <a href="#name-payload-end-to-end-encrypti" class="internal xref">Payload End-to-End Encryption</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="auto internal xref">7</a>.  <a href="#name-advanced-transports-and-ser" class="internal xref">Advanced Transports and Serializers</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a href="#section-7.1" class="auto internal xref">7.1</a>.  <a href="#name-rawsocket-transport" class="internal xref">RawSocket Transport</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.2">
                <p id="section-toc.1-1.7.2.2.1"><a href="#section-7.2" class="auto internal xref">7.2</a>.  <a href="#name-message-batching" class="internal xref">Message Batching</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.3">
                <p id="section-toc.1-1.7.2.3.1"><a href="#section-7.3" class="auto internal xref">7.3</a>.  <a href="#name-http-longpoll-transport" class="internal xref">HTTP Longpoll Transport</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.4">
                <p id="section-toc.1-1.7.2.4.1"><a href="#section-7.4" class="auto internal xref">7.4</a>.  <a href="#name-binary-support-in-json" class="internal xref">Binary support in JSON</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.5">
                <p id="section-toc.1-1.7.2.5.1"><a href="#section-7.5" class="auto internal xref">7.5</a>.  <a href="#name-multiplexed-transport" class="internal xref">Multiplexed Transport</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="auto internal xref">8</a>.  <a href="#name-wamp-interfaces" class="internal xref">WAMP Interfaces</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1">
                <p id="section-toc.1-1.8.2.1.1"><a href="#section-8.1" class="auto internal xref">8.1</a>.  <a href="#name-wamp-idl" class="internal xref">WAMP IDL</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1.2.1">
                    <p id="section-toc.1-1.8.2.1.2.1.1"><a href="#section-8.1.1" class="auto internal xref">8.1.1</a>.  <a href="#name-application-payload-typing" class="internal xref">Application Payload Typing</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1.2.2">
                    <p id="section-toc.1-1.8.2.1.2.2.1"><a href="#section-8.1.2" class="auto internal xref">8.1.2</a>.  <a href="#name-wamp-idl-attributes" class="internal xref">WAMP IDL Attributes</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1.2.3">
                    <p id="section-toc.1-1.8.2.1.2.3.1"><a href="#section-8.1.3" class="auto internal xref">8.1.3</a>.  <a href="#name-wamp-service-declaration" class="internal xref">WAMP Service Declaration</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.2">
                <p id="section-toc.1-1.8.2.2.1"><a href="#section-8.2" class="auto internal xref">8.2</a>.  <a href="#name-interface-catalogs" class="internal xref">Interface Catalogs</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.2.2.1">
                    <p id="section-toc.1-1.8.2.2.2.1.1"><a href="#section-8.2.1" class="auto internal xref">8.2.1</a>.  <a href="#name-catalog-archive-file" class="internal xref">Catalog Archive File</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.2.2.2">
                    <p id="section-toc.1-1.8.2.2.2.2.1"><a href="#section-8.2.2" class="auto internal xref">8.2.2</a>.  <a href="#name-catalog-metadata" class="internal xref">Catalog Metadata</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.2.2.3">
                    <p id="section-toc.1-1.8.2.2.2.3.1"><a href="#section-8.2.3" class="auto internal xref">8.2.3</a>.  <a href="#name-catalog-sharing-and-publica" class="internal xref">Catalog Sharing and Publication</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.3">
                <p id="section-toc.1-1.8.2.3.1"><a href="#section-8.3" class="auto internal xref">8.3</a>.  <a href="#name-interface-reflection" class="internal xref">Interface Reflection</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="auto internal xref">9</a>.  <a href="#name-router-to-router-links" class="internal xref">Router-to-Router Links</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-10" class="auto internal xref">10</a>. <a href="#name-advanced-profile-uris" class="internal xref">Advanced Profile URIs</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.1">
                <p id="section-toc.1-1.10.2.1.1"><a href="#section-10.1" class="auto internal xref">10.1</a>.  <a href="#name-session-close" class="internal xref">Session Close</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.2">
                <p id="section-toc.1-1.10.2.2.1"><a href="#section-10.2" class="auto internal xref">10.2</a>.  <a href="#name-authentication" class="internal xref">Authentication</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.3">
                <p id="section-toc.1-1.10.2.3.1"><a href="#section-10.3" class="auto internal xref">10.3</a>.  <a href="#name-authorization-2" class="internal xref">Authorization</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.4">
                <p id="section-toc.1-1.10.2.4.1"><a href="#section-10.4" class="auto internal xref">10.4</a>.  <a href="#name-remote-procedure-calls" class="internal xref">Remote Procedure Calls</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.5">
                <p id="section-toc.1-1.10.2.5.1"><a href="#section-10.5" class="auto internal xref">10.5</a>.  <a href="#name-terminology" class="internal xref">Terminology</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.5.2.1">
                    <p id="section-toc.1-1.10.2.5.2.1.1"><a href="#section-10.5.1" class="auto internal xref">10.5.1</a>.  <a href="#name-fundamental" class="internal xref">Fundamental</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.5.2.2">
                    <p id="section-toc.1-1.10.2.5.2.2.1"><a href="#section-10.5.2" class="auto internal xref">10.5.2</a>.  <a href="#name-authentication-and-authoriz" class="internal xref">Authentication and Authorization (AA)</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.5.2.3">
                    <p id="section-toc.1-1.10.2.5.2.3.1"><a href="#section-10.5.3" class="auto internal xref">10.5.3</a>.  <a href="#name-remote-procedure-calls-2" class="internal xref">Remote Procedure Calls</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.5.2.4">
                    <p id="section-toc.1-1.10.2.5.2.4.1"><a href="#section-10.5.4" class="auto internal xref">10.5.4</a>.  <a href="#name-publish-and-subscribe" class="internal xref">Publish and Subscribe</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#section-11" class="auto internal xref">11</a>. <a href="#name-iana-considerations" class="internal xref">IANA Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#section-12" class="auto internal xref">12</a>. <a href="#name-conformance-requirements" class="internal xref">Conformance Requirements</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.1">
                <p id="section-toc.1-1.12.2.1.1"><a href="#section-12.1" class="auto internal xref">12.1</a>.  <a href="#name-terminology-and-other-conve" class="internal xref">Terminology and Other Conventions</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a href="#section-13" class="auto internal xref">13</a>. <a href="#name-contributors" class="internal xref">Contributors</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14">
            <p id="section-toc.1-1.14.1"><a href="#section-14" class="auto internal xref">14</a>. <a href="#name-normative-references" class="internal xref">Normative References</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.15">
            <p id="section-toc.1-1.15.1"><a href="#section-15" class="auto internal xref">15</a>. <a href="#name-informative-references" class="internal xref">Informative References</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.16">
            <p id="section-toc.1-1.16.1"><a href="#appendix-A" class="auto internal xref"></a><a href="#name-authors-address" class="internal xref">Author's Address</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="wamp-advanced-profile">
<section id="section-1">
      <h2 id="name-wamp-advanced-profile">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-wamp-advanced-profile" class="section-name selfRef">WAMP Advanced Profile</a>
      </h2>
<p id="section-1-1">While all implementations MUST implement the subset of the Basic Profile necessary for the particular set of WAMP roles they provide, they MAY implement any subset of features from the Advanced Profile. Implementers SHOULD implement the maximum of features possible considering the aims of an implementation.<a href="#section-1-1" class="pilcrow">¶</a></p>
<blockquote id="section-1-2">
        <p id="section-1-2.1">Note: Features listed here may be experimental or underspecced and yet unimplemented in any implementation. This part of the specification is very much a work in progress. An approximate status of each feature is given at the beginning of the feature section.<a href="#section-1-2.1" class="pilcrow">¶</a></p>
</blockquote>
<div id="feature-announcement">
<section id="section-1.1">
        <h3 id="name-feature-announcement">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-feature-announcement" class="section-name selfRef">Feature Announcement</a>
        </h3>
<p id="section-1.1-1">Support for advanced features must be announced by the peers which implement them. The following is a complete list of advanced features currently defined or proposed.<a href="#section-1.1-1" class="pilcrow">¶</a></p>
<p id="section-1.1-2"><strong>Advanced RPC Features</strong><a href="#section-1.1-2" class="pilcrow">¶</a></p>
<table class="left" id="table-1">
          <caption><a href="#table-1" class="selfRef">Table 1</a></caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">Feature</th>
              <th class="text-left" rowspan="1" colspan="1">Status</th>
              <th class="text-left" rowspan="1" colspan="1">Caller</th>
              <th class="text-left" rowspan="1" colspan="1">Dealer</th>
              <th class="text-left" rowspan="1" colspan="1">Callee</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">
                <a href="#rpc-progressive-call-results">Progressive Call Results</a>
</td>
              <td class="text-left" rowspan="1" colspan="1">stable</td>
              <td class="text-left" rowspan="1" colspan="1">X</td>
              <td class="text-left" rowspan="1" colspan="1">X</td>
              <td class="text-left" rowspan="1" colspan="1">X</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">
                <a href="#rpc-progressive-call-invocations">Progressive Call Invocations</a>
</td>
              <td class="text-left" rowspan="1" colspan="1">alpha</td>
              <td class="text-left" rowspan="1" colspan="1">X</td>
              <td class="text-left" rowspan="1" colspan="1">X</td>
              <td class="text-left" rowspan="1" colspan="1">X</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">
                <a href="#rpc-call-timeout">Call Timeout</a>
</td>
              <td class="text-left" rowspan="1" colspan="1">alpha</td>
              <td class="text-left" rowspan="1" colspan="1">X</td>
              <td class="text-left" rowspan="1" colspan="1">X</td>
              <td class="text-left" rowspan="1" colspan="1">X</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">
                <a href="#rpc-call-canceling">Call Canceling</a>
</td>
              <td class="text-left" rowspan="1" colspan="1">alpha</td>
              <td class="text-left" rowspan="1" colspan="1">X</td>
              <td class="text-left" rowspan="1" colspan="1">X</td>
              <td class="text-left" rowspan="1" colspan="1">X</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">
                <a href="#rpc-call-identification">Caller Identification</a>
</td>
              <td class="text-left" rowspan="1" colspan="1">stable</td>
              <td class="text-left" rowspan="1" colspan="1">X</td>
              <td class="text-left" rowspan="1" colspan="1">X</td>
              <td class="text-left" rowspan="1" colspan="1">X</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">
                <a href="#rpc-call-trust-levels">Call Trustlevels</a>
</td>
              <td class="text-left" rowspan="1" colspan="1">alpha</td>
              <td class="text-left" rowspan="1" colspan="1"></td>
              <td class="text-left" rowspan="1" colspan="1">X</td>
              <td class="text-left" rowspan="1" colspan="1">X</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">
                <a href="#rpc-reg-metapi">Registration Meta API</a>
</td>
              <td class="text-left" rowspan="1" colspan="1">beta</td>
              <td class="text-left" rowspan="1" colspan="1"></td>
              <td class="text-left" rowspan="1" colspan="1">X</td>
              <td class="text-left" rowspan="1" colspan="1"></td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">
                <a href="#rpc-pattern-reg">Pattern-based Registration</a>
</td>
              <td class="text-left" rowspan="1" colspan="1">stable</td>
              <td class="text-left" rowspan="1" colspan="1"></td>
              <td class="text-left" rowspan="1" colspan="1">X</td>
              <td class="text-left" rowspan="1" colspan="1">X</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">
                <a href="#rpc-shared-registration">Shared Registration</a>
</td>
              <td class="text-left" rowspan="1" colspan="1">beta</td>
              <td class="text-left" rowspan="1" colspan="1"></td>
              <td class="text-left" rowspan="1" colspan="1">X</td>
              <td class="text-left" rowspan="1" colspan="1">X</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">
                <a href="##rpc-sharded-registration">Sharded Registration</a>
</td>
              <td class="text-left" rowspan="1" colspan="1">alpha</td>
              <td class="text-left" rowspan="1" colspan="1"></td>
              <td class="text-left" rowspan="1" colspan="1">X</td>
              <td class="text-left" rowspan="1" colspan="1">X</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">
                <a href="#rpc-registration-revocation">Registration Revocation</a>
</td>
              <td class="text-left" rowspan="1" colspan="1">alpha</td>
              <td class="text-left" rowspan="1" colspan="1"></td>
              <td class="text-left" rowspan="1" colspan="1">X</td>
              <td class="text-left" rowspan="1" colspan="1">X</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">
                <a href="#interface-reflection">(Interface) Procedure Reflection</a>
</td>
              <td class="text-left" rowspan="1" colspan="1">sketch</td>
              <td class="text-left" rowspan="1" colspan="1"></td>
              <td class="text-left" rowspan="1" colspan="1">X</td>
              <td class="text-left" rowspan="1" colspan="1"></td>
            </tr>
          </tbody>
        </table>
<p id="section-1.1-4"><strong>Advanced PubSub Features</strong><a href="#section-1.1-4" class="pilcrow">¶</a></p>
<table class="left" id="table-2">
          <caption><a href="#table-2" class="selfRef">Table 2</a></caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">Feature</th>
              <th class="text-left" rowspan="1" colspan="1">Status</th>
              <th class="text-left" rowspan="1" colspan="1">Publisher</th>
              <th class="text-left" rowspan="1" colspan="1">Broker</th>
              <th class="text-left" rowspan="1" colspan="1">Subscriber</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">
                <a href="#pubsub-bw-listing">Subscriber Blackwhite Listing</a>
</td>
              <td class="text-left" rowspan="1" colspan="1">stable</td>
              <td class="text-left" rowspan="1" colspan="1">X</td>
              <td class="text-left" rowspan="1" colspan="1">X</td>
              <td class="text-left" rowspan="1" colspan="1"></td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">
                <a href="#pubsub-pub-exclusion">Publisher Exclusion</a>
</td>
              <td class="text-left" rowspan="1" colspan="1">stable</td>
              <td class="text-left" rowspan="1" colspan="1">X</td>
              <td class="text-left" rowspan="1" colspan="1">X</td>
              <td class="text-left" rowspan="1" colspan="1"></td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">
                <a href="#pubsub-pub-identification">Publisher Identification</a>
</td>
              <td class="text-left" rowspan="1" colspan="1">stable</td>
              <td class="text-left" rowspan="1" colspan="1">X</td>
              <td class="text-left" rowspan="1" colspan="1">X</td>
              <td class="text-left" rowspan="1" colspan="1">X</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">
                <a href="#pubsub-pub-trustlevels">Publication Trustlevels</a>
</td>
              <td class="text-left" rowspan="1" colspan="1">alpha</td>
              <td class="text-left" rowspan="1" colspan="1"></td>
              <td class="text-left" rowspan="1" colspan="1">X</td>
              <td class="text-left" rowspan="1" colspan="1">X</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">
                <a href="#pubsub-sub-metapi">Subscription Meta API</a>
</td>
              <td class="text-left" rowspan="1" colspan="1">beta</td>
              <td class="text-left" rowspan="1" colspan="1"></td>
              <td class="text-left" rowspan="1" colspan="1">X</td>
              <td class="text-left" rowspan="1" colspan="1"></td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">
                <a href="#pattern-based-subscription">Pattern-based Subscription</a>
</td>
              <td class="text-left" rowspan="1" colspan="1">stable</td>
              <td class="text-left" rowspan="1" colspan="1"></td>
              <td class="text-left" rowspan="1" colspan="1">X</td>
              <td class="text-left" rowspan="1" colspan="1">X</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">
                <a href="#pubsub-sharded-subscription">Sharded Subscription</a>
</td>
              <td class="text-left" rowspan="1" colspan="1">alpha</td>
              <td class="text-left" rowspan="1" colspan="1"></td>
              <td class="text-left" rowspan="1" colspan="1">X</td>
              <td class="text-left" rowspan="1" colspan="1">X</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">
                <a href="#pubsub-event-history">Event History</a>
</td>
              <td class="text-left" rowspan="1" colspan="1">beta</td>
              <td class="text-left" rowspan="1" colspan="1"></td>
              <td class="text-left" rowspan="1" colspan="1">X</td>
              <td class="text-left" rowspan="1" colspan="1"></td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">
                <a href="#interface-reflection">(Interface) Topic Reflection</a>
</td>
              <td class="text-left" rowspan="1" colspan="1">sketch</td>
              <td class="text-left" rowspan="1" colspan="1"></td>
              <td class="text-left" rowspan="1" colspan="1">X</td>
              <td class="text-left" rowspan="1" colspan="1"></td>
            </tr>
          </tbody>
        </table>
<p id="section-1.1-6"><strong>Other Advanced Features</strong><a href="#section-1.1-6" class="pilcrow">¶</a></p>
<table class="left" id="table-3">
          <caption><a href="#table-3" class="selfRef">Table 3</a></caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">Feature</th>
              <th class="text-left" rowspan="1" colspan="1">Status</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">
                <a href="#wampcra">Challenge-response Authentication</a>
</td>
              <td class="text-left" rowspan="1" colspan="1">stable</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">
                <a href="#ticketauth">Ticket authentication</a>
</td>
              <td class="text-left" rowspan="1" colspan="1">beta</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">
                <a href="#cryptosignauth">Cryptosign authentication</a>
</td>
              <td class="text-left" rowspan="1" colspan="1">beta</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">
                <a href="#rawsocket">RawSocket transport</a>
</td>
              <td class="text-left" rowspan="1" colspan="1">stable</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">
                <a href="#batchedwebsocket">Batched WebSocket transport</a>
</td>
              <td class="text-left" rowspan="1" colspan="1">sketch</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">
                <a href="#longpoll">HTTP Longpoll transport</a>
</td>
              <td class="text-left" rowspan="1" colspan="1">beta</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">
                <a href="#session-metapi">Session Meta API</a>
</td>
              <td class="text-left" rowspan="1" colspan="1">beta</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">
                <a href="#rpc-call-rerouting">Call Rerouting</a>
</td>
              <td class="text-left" rowspan="1" colspan="1">sketch</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">
                <a href="#payload-passthru-mode">Payload Passthru Mode</a>
</td>
              <td class="text-left" rowspan="1" colspan="1">sketch</td>
            </tr>
          </tbody>
        </table>
<p id="section-1.1-8">The status of the respective AP feature is marked as follows:<a href="#section-1.1-8" class="pilcrow">¶</a></p>
<table class="center" id="table-4">
          <caption><a href="#table-4" class="selfRef">Table 4</a></caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">Status</th>
              <th class="text-left" rowspan="1" colspan="1">Description</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">sketch</td>
              <td class="text-left" rowspan="1" colspan="1">There is a rough description of an itch to scratch, but the feature use case isn't clear, and there is no protocol proposal at all.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">alpha</td>
              <td class="text-left" rowspan="1" colspan="1">The feature use case is still fuzzy and/or the feature definition is unclear, but there is at least a protocol level proposal.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">beta</td>
              <td class="text-left" rowspan="1" colspan="1">The feature use case is clearly defined and the feature definition in the spec is sufficient to write a prototype implementation. The feature definition and details may still be incomplete and change.</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">stable</td>
              <td class="text-left" rowspan="1" colspan="1">The feature definition in the spec is complete and stable and the feature use case is field proven in real applications. There are multiple, interoperable implementations.</td>
            </tr>
          </tbody>
        </table>
</section>
</div>
<div id="additional-messages">
<section id="section-1.2">
        <h3 id="name-additional-messages">
<a href="#section-1.2" class="section-number selfRef">1.2. </a><a href="#name-additional-messages" class="section-name selfRef">Additional Messages</a>
        </h3>
<p id="section-1.2-1">The Advanced Profile defines additional WAMP-level messages which are explained in detail in separate sections. The following 4 additional message types MAY be used in the Advanced Profile and their direction between peer roles.
Here, "Tx" ("Rx") means the message is sent (received) by a peer of the respective role.<a href="#section-1.2-1" class="pilcrow">¶</a></p>
<table class="left" id="table-5">
          <caption><a href="#table-5" class="selfRef">Table 5</a></caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">Code</th>
              <th class="text-left" rowspan="1" colspan="1">Message</th>
              <th class="text-left" rowspan="1" colspan="1">Publisher</th>
              <th class="text-left" rowspan="1" colspan="1">Broker</th>
              <th class="text-left" rowspan="1" colspan="1">Subscriber</th>
              <th class="text-left" rowspan="1" colspan="1">Caller</th>
              <th class="text-left" rowspan="1" colspan="1">Dealer</th>
              <th class="text-left" rowspan="1" colspan="1">Callee</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">4</td>
              <td class="text-left" rowspan="1" colspan="1">
                <code>CHALLENGE</code>
</td>
              <td class="text-left" rowspan="1" colspan="1">Rx</td>
              <td class="text-left" rowspan="1" colspan="1">Tx</td>
              <td class="text-left" rowspan="1" colspan="1">Rx</td>
              <td class="text-left" rowspan="1" colspan="1">Rx</td>
              <td class="text-left" rowspan="1" colspan="1">Tx</td>
              <td class="text-left" rowspan="1" colspan="1">Rx</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">5</td>
              <td class="text-left" rowspan="1" colspan="1">
                <code>AUTHENTICATE</code>
</td>
              <td class="text-left" rowspan="1" colspan="1">Tx</td>
              <td class="text-left" rowspan="1" colspan="1">Rx</td>
              <td class="text-left" rowspan="1" colspan="1">Tx</td>
              <td class="text-left" rowspan="1" colspan="1">Tx</td>
              <td class="text-left" rowspan="1" colspan="1">Rx</td>
              <td class="text-left" rowspan="1" colspan="1">Tx</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">49</td>
              <td class="text-left" rowspan="1" colspan="1">
                <code>CANCEL</code>
</td>
              <td class="text-left" rowspan="1" colspan="1"></td>
              <td class="text-left" rowspan="1" colspan="1"></td>
              <td class="text-left" rowspan="1" colspan="1"></td>
              <td class="text-left" rowspan="1" colspan="1">Tx</td>
              <td class="text-left" rowspan="1" colspan="1">Rx</td>
              <td class="text-left" rowspan="1" colspan="1"></td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">69</td>
              <td class="text-left" rowspan="1" colspan="1">
                <code>INTERRUPT</code>
</td>
              <td class="text-left" rowspan="1" colspan="1"></td>
              <td class="text-left" rowspan="1" colspan="1"></td>
              <td class="text-left" rowspan="1" colspan="1"></td>
              <td class="text-left" rowspan="1" colspan="1"></td>
              <td class="text-left" rowspan="1" colspan="1">Tx</td>
              <td class="text-left" rowspan="1" colspan="1">Rx</td>
            </tr>
          </tbody>
        </table>
<div id="challenge">
<section id="section-1.2.1">
          <h4 id="name-challenge">
<a href="#section-1.2.1" class="section-number selfRef">1.2.1. </a><a href="#name-challenge" class="section-name selfRef">CHALLENGE</a>
          </h4>
<p id="section-1.2.1-1">The <code>CHALLENGE</code> message is used with certain Authentication Methods. During authenticated session establishment, a <strong>Router</strong> sends a challenge message.<a href="#section-1.2.1-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-1.2.1-2">
<pre>    [CHALLENGE, AuthMethod|string, Extra|dict]
</pre><a href="#section-1.2.1-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="authenticate">
<section id="section-1.2.2">
          <h4 id="name-authenticate">
<a href="#section-1.2.2" class="section-number selfRef">1.2.2. </a><a href="#name-authenticate" class="section-name selfRef">AUTHENTICATE</a>
          </h4>
<p id="section-1.2.2-1">The <code>AUTHENTICATE</code> message is used with certain Authentication Methods. A <strong>Client</strong> having received a challenge is expected to respond by sending a signature or token.<a href="#section-1.2.2-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-1.2.2-2">
<pre>    [AUTHENTICATE, Signature|string, Extra|dict]
</pre><a href="#section-1.2.2-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="cancel">
<section id="section-1.2.3">
          <h4 id="name-cancel">
<a href="#section-1.2.3" class="section-number selfRef">1.2.3. </a><a href="#name-cancel" class="section-name selfRef">CANCEL</a>
          </h4>
<p id="section-1.2.3-1">The <code>CANCEL</code> message is used with the Call Canceling advanced feature. A <em>Caller</em> can cancel an issued call actively by sending a cancel message to the <em>Dealer</em>.<a href="#section-1.2.3-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-1.2.3-2">
<pre>    [CANCEL, CALL.Request|id, Options|dict]
</pre><a href="#section-1.2.3-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="interrupt">
<section id="section-1.2.4">
          <h4 id="name-interrupt">
<a href="#section-1.2.4" class="section-number selfRef">1.2.4. </a><a href="#name-interrupt" class="section-name selfRef">INTERRUPT</a>
          </h4>
<p id="section-1.2.4-1">The <code>INTERRUPT</code> message is used with the Call Canceling advanced feature. Upon receiving a cancel for a pending call, a <em>Dealer</em> will issue an interrupt to the <em>Callee</em>.<a href="#section-1.2.4-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-1.2.4-2">
<pre>    [INTERRUPT, INVOCATION.Request|id, Options|dict]
</pre><a href="#section-1.2.4-2" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="meta-api">
<section id="section-2">
      <h2 id="name-meta-api">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-meta-api" class="section-name selfRef">Meta API</a>
      </h2>
<div id="session-metapi">
<section id="section-2.1">
        <h3 id="name-session-meta-api">
<a href="#section-2.1" class="section-number selfRef">2.1. </a><a href="#name-session-meta-api" class="section-name selfRef">Session Meta API</a>
        </h3>
<p id="section-2.1-1">WAMP enables the monitoring of when sessions join a realm on the router or when they leave it via <strong>Session Meta Events</strong>. It also allows retrieving information about currently connected sessions via <strong>Session Meta Procedures</strong>.<a href="#section-2.1-1" class="pilcrow">¶</a></p>
<p id="section-2.1-2">Meta events are created by the router itself. This means that the events, as well as the data received when calling a meta procedure, can be accorded the same trust level as the router.<a href="#section-2.1-2" class="pilcrow">¶</a></p>
<blockquote id="section-2.1-3">
          <p id="section-2.1-3.1">Note that an implementation that only supports a <em>Broker</em> or <em>Dealer</em> role, not both at the same time, essentially cannot offer the <strong>Session Meta API</strong>, as it requires both roles to support this feature.<a href="#section-2.1-3.1" class="pilcrow">¶</a></p>
</blockquote>
<p id="section-2.1-4">The following sections contain an informal, easy to digest description of the WAMP procedures and topics
available in (this part of) the WAMP Meta API.
A formal definition of the WAMP Meta API in terms of available WAMP procedures and topics including
precise and complete type definitions of the application payloads, that is procedure arguments and
results or event payloads is contained in<a href="#section-2.1-4" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-2.1-5.1">Compiled Binary Schema: <code>&lt;WAMP API Catalog&gt;/schema/wamp-meta.bfbs</code><a href="#section-2.1-5.1" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-2.1-5.2">FlatBuffers Schema Source: <code>&lt;WAMP API Catalog&gt;/src/wamp-meta.fbs</code><a href="#section-2.1-5.2" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-2.1-6">which uses FlatBuffers IDL to describe the API. The method of using FlatBuffers IDL and type definitions to formally define WAMP procedures and topics is detailed in section <a href="#wamp-idl">WAMP IDL</a>.<a href="#section-2.1-6" class="pilcrow">¶</a></p>
<p id="section-2.1-7"><strong>Feature Announcement</strong><a href="#section-2.1-7" class="pilcrow">¶</a></p>
<p id="section-2.1-8">Support for this feature MUST be announced by <strong>both</strong> <em>Dealers</em> and <em>Brokers</em> via:<a href="#section-2.1-8" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-2.1-9">
<pre>    HELLO.Details.roles.&lt;role&gt;.features.
        session_meta_api|bool := true
</pre><a href="#section-2.1-9" class="pilcrow">¶</a>
</div>
<p id="section-2.1-10">Here is a <code>WELCOME</code> message from a <em>Router</em> with support for both the <em>Broker</em> and <em>Dealer</em> role, and with support for <strong>Session Meta API</strong>:<a href="#section-2.1-10" class="pilcrow">¶</a></p>
<div class="lang-json sourcecode" id="section-2.1-11">
<pre>    [
        2,
        4580268554656113,
        {
            "authid":"OL3AeppwDLXiAAPbqm9IVhnw",
            "authrole": "anonymous",
            "authmethod": "anonymous",
            "roles": {
                "broker": {
                    "features": {
                        "session_meta_api": true
                    }
                },
                "dealer": {
                    "features": {
                        "session_meta_api": true
                    }
                }
            }
        }
    ]
</pre><a href="#section-2.1-11" class="pilcrow">¶</a>
</div>
<blockquote id="section-2.1-12">
          <p id="section-2.1-12.1">Note in particular that the feature is announced on both the <em>Broker</em> and the <em>Dealer</em> roles.<a href="#section-2.1-12.1" class="pilcrow">¶</a></p>
</blockquote>
<div id="events">
<section id="section-2.1.1">
          <h4 id="name-events">
<a href="#section-2.1.1" class="section-number selfRef">2.1.1. </a><a href="#name-events" class="section-name selfRef">Events</a>
          </h4>
<p id="section-2.1.1-1">A client can subscribe to the following session meta-events, which cover the lifecycle of a session:<a href="#section-2.1.1-1" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-2.1.1-2.1">
              <code>wamp.session.on_join</code>: Fired when a session joins a realm on the router.<a href="#section-2.1.1-2.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-2.1.1-2.2">
              <code>wamp.session.on_leave</code>: Fired when a session leaves a realm on the router or is disconnected.<a href="#section-2.1.1-2.2" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-2.1.1-3"><strong>Session Meta Events</strong> MUST be dispatched by the <em>Router</em> to the same realm as the WAMP session which triggered the event.<a href="#section-2.1.1-3" class="pilcrow">¶</a></p>
<div id="wamp-session-on-join">
<section id="section-2.1.1.1">
            <h5 id="name-wampsessionon_join">
<a href="#section-2.1.1.1" class="section-number selfRef">2.1.1.1. </a><a href="#name-wampsessionon_join" class="section-name selfRef">wamp.session.on_join</a>
            </h5>
<p id="section-2.1.1.1-1">Fired when a session joins a realm on the router. The event payload consists of a single positional argument <code>details|dict</code>:<a href="#section-2.1.1.1-1" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-2.1.1.1-2.1">
                <code>session|id</code> - The session ID of the session that joined<a href="#section-2.1.1.1-2.1" class="pilcrow">¶</a>
</li>
              <li class="compact" id="section-2.1.1.1-2.2">
                <code>authid|string</code> - The authentication ID of the session that joined<a href="#section-2.1.1.1-2.2" class="pilcrow">¶</a>
</li>
              <li class="compact" id="section-2.1.1.1-2.3">
                <code>authrole|string</code> - The authentication role of the session that joined<a href="#section-2.1.1.1-2.3" class="pilcrow">¶</a>
</li>
              <li class="compact" id="section-2.1.1.1-2.4">
                <code>authmethod|string</code> - The authentication method that was used for authentication the session that joined<a href="#section-2.1.1.1-2.4" class="pilcrow">¶</a>
</li>
              <li class="compact" id="section-2.1.1.1-2.5">
                <code>authprovider|string</code>- The provider that performed the authentication of the session that joined<a href="#section-2.1.1.1-2.5" class="pilcrow">¶</a>
</li>
              <li class="compact" id="section-2.1.1.1-2.6">
                <code>transport|dict</code> - Optional, implementation defined information about the WAMP transport the joined session is running over.<a href="#section-2.1.1.1-2.6" class="pilcrow">¶</a>
</li>
            </ul>
<blockquote id="section-2.1.1.1-3">
              <p id="section-2.1.1.1-3.1">See <strong>Authentication</strong> for a description of the <code>authid</code>, <code>authrole</code>, <code>authmethod</code> and <code>authprovider</code> properties.<a href="#section-2.1.1.1-3.1" class="pilcrow">¶</a></p>
</blockquote>
</section>
</div>
<div id="wamp-session-on-leave">
<section id="section-2.1.1.2">
            <h5 id="name-wampsessionon_leave">
<a href="#section-2.1.1.2" class="section-number selfRef">2.1.1.2. </a><a href="#name-wampsessionon_leave" class="section-name selfRef">wamp.session.on_leave</a>
            </h5>
<p id="section-2.1.1.2-1">Fired when a session leaves a realm on the router or is disconnected. The event payload consists of three positional arguments:<a href="#section-2.1.1.2-1" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-2.1.1.2-2.1">
                <code>session|id</code> - The session ID of the session that left<a href="#section-2.1.1.2-2.1" class="pilcrow">¶</a>
</li>
              <li class="compact" id="section-2.1.1.2-2.2">
                <code>authid</code>|string` - The authentication ID of the session that left<a href="#section-2.1.1.2-2.2" class="pilcrow">¶</a>
</li>
              <li class="compact" id="section-2.1.1.2-2.3">
                <code>authrole|string</code> - The authentication role of the session that left<a href="#section-2.1.1.2-2.3" class="pilcrow">¶</a>
</li>
            </ul>
</section>
</div>
</section>
</div>
<div id="procedures">
<section id="section-2.1.2">
          <h4 id="name-procedures">
<a href="#section-2.1.2" class="section-number selfRef">2.1.2. </a><a href="#name-procedures" class="section-name selfRef">Procedures</a>
          </h4>
<p id="section-2.1.2-1">A client can actively retrieve information about sessions, or forcefully close sessions, via the following meta-procedures:<a href="#section-2.1.2-1" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-2.1.2-2.1">
              <code>wamp.session.count</code>: Obtains the number of sessions currently attached to the realm.<a href="#section-2.1.2-2.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-2.1.2-2.2">
              <code>wamp.session.list</code>: Retrieves a list of the session IDs for all sessions currently attached to the realm.<a href="#section-2.1.2-2.2" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-2.1.2-2.3">
              <code>wamp.session.get</code>: Retrieves information on a specific session.<a href="#section-2.1.2-2.3" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-2.1.2-2.4">
              <code>wamp.session.kill</code>: Kill a single session identified by session ID.<a href="#section-2.1.2-2.4" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-2.1.2-2.5">
              <code>wamp.session.kill_by_authid</code>: Kill all currently connected sessions that have the specified authid.<a href="#section-2.1.2-2.5" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-2.1.2-2.6">
              <code>wamp.session.kill_by_authrole</code>: Kill all currently connected sessions that have the specified authrole.<a href="#section-2.1.2-2.6" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-2.1.2-2.7">
              <code>wamp.session.kill_all</code>: Kill all currently connected sessions in the caller's realm.<a href="#section-2.1.2-2.7" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-2.1.2-3">Session meta procedures MUST be registered by the <em>Router</em> on the same realm as the WAMP session about which information is retrieved.<a href="#section-2.1.2-3" class="pilcrow">¶</a></p>
<div id="wamp-session-count">
<section id="section-2.1.2.1">
            <h5 id="name-wampsessioncount">
<a href="#section-2.1.2.1" class="section-number selfRef">2.1.2.1. </a><a href="#name-wampsessioncount" class="section-name selfRef">wamp.session.count</a>
            </h5>
<p id="section-2.1.2.1-1">Obtains the number of sessions currently attached to the realm.<a href="#section-2.1.2.1-1" class="pilcrow">¶</a></p>
<p id="section-2.1.2.1-2"><strong>Positional arguments</strong><a href="#section-2.1.2.1-2" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="compact type-1" id="section-2.1.2.1-3">
<li id="section-2.1.2.1-3.1">
                <code>filter_authroles|list[string]</code> - Optional filter: if provided, only count sessions with an <code>authrole</code> from this list.<a href="#section-2.1.2.1-3.1" class="pilcrow">¶</a>
</li>
            </ol>
<p id="section-2.1.2.1-4"><strong>Positional results</strong><a href="#section-2.1.2.1-4" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="compact type-1" id="section-2.1.2.1-5">
<li id="section-2.1.2.1-5.1">
                <code>count|int</code> - The number of sessions currently attached to the realm.<a href="#section-2.1.2.1-5.1" class="pilcrow">¶</a>
</li>
            </ol>
</section>
</div>
<div id="wamp-session-list">
<section id="section-2.1.2.2">
            <h5 id="name-wampsessionlist">
<a href="#section-2.1.2.2" class="section-number selfRef">2.1.2.2. </a><a href="#name-wampsessionlist" class="section-name selfRef">wamp.session.list</a>
            </h5>
<p id="section-2.1.2.2-1">Retrieves a list of the session IDs for all sessions currently attached to the realm.<a href="#section-2.1.2.2-1" class="pilcrow">¶</a></p>
<p id="section-2.1.2.2-2"><strong>Positional arguments</strong><a href="#section-2.1.2.2-2" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="compact type-1" id="section-2.1.2.2-3">
<li id="section-2.1.2.2-3.1">
                <code>filter_authroles|list[string]</code> - Optional filter: if provided, only count sessions with an <code>authrole</code> from this list.<a href="#section-2.1.2.2-3.1" class="pilcrow">¶</a>
</li>
            </ol>
<p id="section-2.1.2.2-4"><strong>Positional results</strong><a href="#section-2.1.2.2-4" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="compact type-1" id="section-2.1.2.2-5">
<li id="section-2.1.2.2-5.1">
                <code>session_ids|list</code> - List of WAMP session IDs (order undefined).<a href="#section-2.1.2.2-5.1" class="pilcrow">¶</a>
</li>
            </ol>
</section>
</div>
<div id="wamp-session-get">
<section id="section-2.1.2.3">
            <h5 id="name-wampsessionget">
<a href="#section-2.1.2.3" class="section-number selfRef">2.1.2.3. </a><a href="#name-wampsessionget" class="section-name selfRef">wamp.session.get</a>
            </h5>
<p id="section-2.1.2.3-1">Retrieves information on a specific session.<a href="#section-2.1.2.3-1" class="pilcrow">¶</a></p>
<p id="section-2.1.2.3-2"><strong>Positional arguments</strong><a href="#section-2.1.2.3-2" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="compact type-1" id="section-2.1.2.3-3">
<li id="section-2.1.2.3-3.1">
                <code>session|id</code> - The session ID of the session to retrieve details for.<a href="#section-2.1.2.3-3.1" class="pilcrow">¶</a>
</li>
            </ol>
<p id="section-2.1.2.3-4"><strong>Positional results</strong><a href="#section-2.1.2.3-4" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="compact type-1" id="section-2.1.2.3-5">
<li id="section-2.1.2.3-5.1">
                <p id="section-2.1.2.3-5.1.1"><code>details|dict</code> - Information on a particular session:<a href="#section-2.1.2.3-5.1.1" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-2.1.2.3-5.1.2.1">
                    <code>session|id</code> - The session ID of the session that joined<a href="#section-2.1.2.3-5.1.2.1" class="pilcrow">¶</a>
</li>
                  <li class="compact" id="section-2.1.2.3-5.1.2.2">
                    <code>authid|string</code> - The authentication ID of the session that joined<a href="#section-2.1.2.3-5.1.2.2" class="pilcrow">¶</a>
</li>
                  <li class="compact" id="section-2.1.2.3-5.1.2.3">
                    <code>authrole|string</code> - The authentication role of the session that joined<a href="#section-2.1.2.3-5.1.2.3" class="pilcrow">¶</a>
</li>
                  <li class="compact" id="section-2.1.2.3-5.1.2.4">
                    <code>authmethod|string</code> - The authentication method that was used for authentication the session that joined<a href="#section-2.1.2.3-5.1.2.4" class="pilcrow">¶</a>
</li>
                  <li class="compact" id="section-2.1.2.3-5.1.2.5">
                    <code>authprovider|string</code>- The provider that performed the authentication of the session that joined<a href="#section-2.1.2.3-5.1.2.5" class="pilcrow">¶</a>
</li>
                  <li class="compact" id="section-2.1.2.3-5.1.2.6">
                    <code>transport|dict</code> - Optional, implementation defined information about the WAMP transport the joined session is running over.<a href="#section-2.1.2.3-5.1.2.6" class="pilcrow">¶</a>
</li>
                </ul>
</li>
            </ol>
<blockquote id="section-2.1.2.3-6">
              <p id="section-2.1.2.3-6.1">See <strong>Authentication</strong> for a description of the <code>authid</code>, <code>authrole</code>, <code>authmethod</code> and <code>authprovider</code> properties.<a href="#section-2.1.2.3-6.1" class="pilcrow">¶</a></p>
</blockquote>
<p id="section-2.1.2.3-7"><strong>Errors</strong><a href="#section-2.1.2.3-7" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-2.1.2.3-8.1">
                <code>wamp.error.no_such_session</code> - No session with the given ID exists on the router.<a href="#section-2.1.2.3-8.1" class="pilcrow">¶</a>
</li>
            </ul>
</section>
</div>
<div id="wamp-session-kill">
<section id="section-2.1.2.4">
            <h5 id="name-wampsessionkill">
<a href="#section-2.1.2.4" class="section-number selfRef">2.1.2.4. </a><a href="#name-wampsessionkill" class="section-name selfRef">wamp.session.kill</a>
            </h5>
<p id="section-2.1.2.4-1">Kill a single session identified by session ID.<a href="#section-2.1.2.4-1" class="pilcrow">¶</a></p>
<p id="section-2.1.2.4-2">The caller of this meta procedure may only specify session IDs other than its own session.  Specifying the caller's own session will result in a <code>wamp.error.no_such_session</code> since no <em>other</em> session with that ID exists.<a href="#section-2.1.2.4-2" class="pilcrow">¶</a></p>
<p id="section-2.1.2.4-3">The keyword arguments are optional, and if not provided the reason defaults to <code>wamp.close.killed</code> and the message is omitted from the <code>GOODBYE</code> sent to the closed session.<a href="#section-2.1.2.4-3" class="pilcrow">¶</a></p>
<p id="section-2.1.2.4-4"><strong>Positional arguments</strong><a href="#section-2.1.2.4-4" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="compact type-1" id="section-2.1.2.4-5">
<li id="section-2.1.2.4-5.1">
                <code>session|id</code> - The session ID of the session to close.<a href="#section-2.1.2.4-5.1" class="pilcrow">¶</a>
</li>
            </ol>
<p id="section-2.1.2.4-6"><strong>Keyword arguments</strong><a href="#section-2.1.2.4-6" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="compact type-1" id="section-2.1.2.4-7">
<li id="section-2.1.2.4-7.1">
                <code>reason|uri</code> - reason for closing session, sent to client in <code>GOODBYE.Reason</code>.<a href="#section-2.1.2.4-7.1" class="pilcrow">¶</a>
</li>
              <li id="section-2.1.2.4-7.2">
                <code>message|string</code> - additional information sent to client in <code>GOODBYE.Details</code> under the key "message".<a href="#section-2.1.2.4-7.2" class="pilcrow">¶</a>
</li>
            </ol>
<p id="section-2.1.2.4-8"><strong>Errors</strong><a href="#section-2.1.2.4-8" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-2.1.2.4-9.1">
                <code>wamp.error.no_such_session</code> - No session with the given ID exists on the router.<a href="#section-2.1.2.4-9.1" class="pilcrow">¶</a>
</li>
              <li class="compact" id="section-2.1.2.4-9.2">
                <code>wamp.error.invalid_uri</code> - A <code>reason</code> keyword argument has a value that is not a valid non-empty URI.<a href="#section-2.1.2.4-9.2" class="pilcrow">¶</a>
</li>
            </ul>
</section>
</div>
<div id="wamp-session-kill-by-authid">
<section id="section-2.1.2.5">
            <h5 id="name-wampsessionkill_by_authid">
<a href="#section-2.1.2.5" class="section-number selfRef">2.1.2.5. </a><a href="#name-wampsessionkill_by_authid" class="section-name selfRef">wamp.session.kill_by_authid</a>
            </h5>
<p id="section-2.1.2.5-1">Kill all currently connected sessions that have the specified <code>authid</code>.<a href="#section-2.1.2.5-1" class="pilcrow">¶</a></p>
<p id="section-2.1.2.5-2">If the caller's own session has the specified <code>authid</code>, the caller's session is excluded from the closed sessions.<a href="#section-2.1.2.5-2" class="pilcrow">¶</a></p>
<p id="section-2.1.2.5-3">The keyword arguments are optional, and if not provided the reason defaults to <code>wamp.close.killed</code> and the message is omitted from the <code>GOODBYE</code> sent to the closed session.<a href="#section-2.1.2.5-3" class="pilcrow">¶</a></p>
<p id="section-2.1.2.5-4"><strong>Positional arguments</strong><a href="#section-2.1.2.5-4" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="compact type-1" id="section-2.1.2.5-5">
<li id="section-2.1.2.5-5.1">
                <code>authid|string</code> - The authentication ID identifying sessions to close.<a href="#section-2.1.2.5-5.1" class="pilcrow">¶</a>
</li>
            </ol>
<p id="section-2.1.2.5-6"><strong>Keyword arguments</strong><a href="#section-2.1.2.5-6" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="compact type-1" id="section-2.1.2.5-7">
<li id="section-2.1.2.5-7.1">
                <code>reason|uri</code> - reason for closing sessions, sent to clients in <code>GOODBYE.Reason</code><a href="#section-2.1.2.5-7.1" class="pilcrow">¶</a>
</li>
              <li id="section-2.1.2.5-7.2">
                <code>message|string</code> - additional information sent to clients in <code>GOODBYE.Details</code> under the key "message".<a href="#section-2.1.2.5-7.2" class="pilcrow">¶</a>
</li>
            </ol>
<p id="section-2.1.2.5-8"><strong>Positional results</strong><a href="#section-2.1.2.5-8" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="compact type-1" id="section-2.1.2.5-9">
<li id="section-2.1.2.5-9.1">
                <code>sessions|list</code> - The list of WAMP session IDs of session that were killed.<a href="#section-2.1.2.5-9.1" class="pilcrow">¶</a>
</li>
            </ol>
<p id="section-2.1.2.5-10"><strong>Errors</strong><a href="#section-2.1.2.5-10" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-2.1.2.5-11.1">
                <code>wamp.error.invalid_uri</code> - A <code>reason</code> keyword argument has a value that is not a valid non-empty URI.<a href="#section-2.1.2.5-11.1" class="pilcrow">¶</a>
</li>
            </ul>
</section>
</div>
<div id="wamp-session-kill-by-authrole">
<section id="section-2.1.2.6">
            <h5 id="name-wampsessionkill_by_authrole">
<a href="#section-2.1.2.6" class="section-number selfRef">2.1.2.6. </a><a href="#name-wampsessionkill_by_authrole" class="section-name selfRef">wamp.session.kill_by_authrole</a>
            </h5>
<p id="section-2.1.2.6-1">Kill all currently connected sessions that have the specified <code>authrole</code>.<a href="#section-2.1.2.6-1" class="pilcrow">¶</a></p>
<p id="section-2.1.2.6-2">If the caller's own session has the specified <code>authrole</code>, the caller's session is excluded from the closed sessions.<a href="#section-2.1.2.6-2" class="pilcrow">¶</a></p>
<p id="section-2.1.2.6-3">The keyword arguments are optional, and if not provided the reason defaults to <code>wamp.close.killed</code> and the message is omitted from the <code>GOODBYE</code> sent to the closed session.<a href="#section-2.1.2.6-3" class="pilcrow">¶</a></p>
<p id="section-2.1.2.6-4"><strong>Positional arguments</strong><a href="#section-2.1.2.6-4" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="compact type-1" id="section-2.1.2.6-5">
<li id="section-2.1.2.6-5.1">
                <code>authrole|string</code> - The authentication role identifying sessions to close.<a href="#section-2.1.2.6-5.1" class="pilcrow">¶</a>
</li>
            </ol>
<p id="section-2.1.2.6-6"><strong>Keyword arguments</strong><a href="#section-2.1.2.6-6" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="compact type-1" id="section-2.1.2.6-7">
<li id="section-2.1.2.6-7.1">
                <code>reason|uri</code> - reason for closing sessions, sent to clients in <code>GOODBYE.Reason</code><a href="#section-2.1.2.6-7.1" class="pilcrow">¶</a>
</li>
              <li id="section-2.1.2.6-7.2">
                <code>message|string</code> - additional information sent to clients in <code>GOODBYE.Details</code> under the key "message".<a href="#section-2.1.2.6-7.2" class="pilcrow">¶</a>
</li>
            </ol>
<p id="section-2.1.2.6-8"><strong>Positional results</strong><a href="#section-2.1.2.6-8" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="compact type-1" id="section-2.1.2.6-9">
<li id="section-2.1.2.6-9.1">
                <code>count|int</code> - The number of sessions closed by this meta procedure.<a href="#section-2.1.2.6-9.1" class="pilcrow">¶</a>
</li>
            </ol>
<p id="section-2.1.2.6-10"><strong>Errors</strong><a href="#section-2.1.2.6-10" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-2.1.2.6-11.1">
                <code>wamp.error.invalid_uri</code> - A <code>reason</code> keyword argument has a value that is not a valid non-empty URI.<a href="#section-2.1.2.6-11.1" class="pilcrow">¶</a>
</li>
            </ul>
</section>
</div>
<div id="wamp-session-kill-all">
<section id="section-2.1.2.7">
            <h5 id="name-wampsessionkill_all">
<a href="#section-2.1.2.7" class="section-number selfRef">2.1.2.7. </a><a href="#name-wampsessionkill_all" class="section-name selfRef">wamp.session.kill_all</a>
            </h5>
<p id="section-2.1.2.7-1">Kill all currently connected sessions in the caller's realm.<a href="#section-2.1.2.7-1" class="pilcrow">¶</a></p>
<p id="section-2.1.2.7-2">The caller's own session is excluded from the closed sessions.  Closing all sessions in the realm will not generate session meta events or testament events, since no subscribers would remain to receive these events.<a href="#section-2.1.2.7-2" class="pilcrow">¶</a></p>
<p id="section-2.1.2.7-3">The keyword arguments are optional, and if not provided the reason defaults to <code>wamp.close.killed</code> and the message is omitted from the <code>GOODBYE</code> sent to the closed session.<a href="#section-2.1.2.7-3" class="pilcrow">¶</a></p>
<p id="section-2.1.2.7-4"><strong>Keyword arguments</strong><a href="#section-2.1.2.7-4" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="compact type-1" id="section-2.1.2.7-5">
<li id="section-2.1.2.7-5.1">
                <code>reason|uri</code> - reason for closing sessions, sent to clients in <code>GOODBYE.Reason</code><a href="#section-2.1.2.7-5.1" class="pilcrow">¶</a>
</li>
              <li id="section-2.1.2.7-5.2">
                <code>message|string</code> - additional information sent to clients in <code>GOODBYE.Details</code> under the key "message".<a href="#section-2.1.2.7-5.2" class="pilcrow">¶</a>
</li>
            </ol>
<p id="section-2.1.2.7-6"><strong>Positional results</strong><a href="#section-2.1.2.7-6" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="compact type-1" id="section-2.1.2.7-7">
<li id="section-2.1.2.7-7.1">
                <code>count|int</code> - The number of sessions closed by this meta procedure.<a href="#section-2.1.2.7-7.1" class="pilcrow">¶</a>
</li>
            </ol>
<p id="section-2.1.2.7-8"><strong>Errors</strong><a href="#section-2.1.2.7-8" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-2.1.2.7-9.1">
                <code>wamp.error.invalid_uri</code> - A <code>reason</code> keyword argument has a value that is not a valid non-empty URI.<a href="#section-2.1.2.7-9.1" class="pilcrow">¶</a>
</li>
            </ul>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="rpc-reg-metapi">
<section id="section-2.2">
        <h3 id="name-registration-meta-api">
<a href="#section-2.2" class="section-number selfRef">2.2. </a><a href="#name-registration-meta-api" class="section-name selfRef">Registration Meta API</a>
        </h3>
<p id="section-2.2-1"><strong>Registration Meta Events</strong> are fired when registrations are first created, when <em>Callees</em> are attached (removed) to (from) a registration, and when registrations are finally destroyed.<a href="#section-2.2-1" class="pilcrow">¶</a></p>
<p id="section-2.2-2">Furthermore, WAMP allows actively retrieving information about registrations via <strong>Registration Meta Procedures</strong>.<a href="#section-2.2-2" class="pilcrow">¶</a></p>
<p id="section-2.2-3">Meta-events are created by the router itself. This means that the events as well as the data received when calling a meta-procedure can be accorded the same trust level as the router.<a href="#section-2.2-3" class="pilcrow">¶</a></p>
<blockquote id="section-2.2-4">
          <p id="section-2.2-4.1">Note that an implementation that only supports a <em>Broker</em> or <em>Dealer</em> role, not both at the same time, essentially cannot offer the <strong>Registration Meta API</strong>, as it requires both roles to support this feature.<a href="#section-2.2-4.1" class="pilcrow">¶</a></p>
</blockquote>
<p id="section-2.2-5">The following sections contain an informal, easy to digest description of the WAMP procedures and topics available in (this part of) the WAMP Meta API.
A formal definition of the WAMP Meta API in terms of available WAMP procedures and topics including precise and complete type definitions of the application payloads, that is procedure arguments and results or event payloads is contained in:<a href="#section-2.2-5" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-2.2-6.1">Compiled Binary Schema: <code>&lt;WAMP API Catalog&gt;/schema/wamp-meta.bfbs</code><a href="#section-2.2-6.1" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-2.2-6.2">FlatBuffers Schema Source: <code>&lt;WAMP API Catalog&gt;/src/wamp-meta.fbs</code><a href="#section-2.2-6.2" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-2.2-7">which uses FlatBuffers IDL to describe the API. The method of using FlatBuffers IDL and type definitions to formally define WAMP procedures and topics is detailed in section <a href="#wamp-idl">WAMP IDL</a>.<a href="#section-2.2-7" class="pilcrow">¶</a></p>
<p id="section-2.2-8"><strong>Feature Announcement</strong><a href="#section-2.2-8" class="pilcrow">¶</a></p>
<p id="section-2.2-9">Support for this feature MUST be announced by a <em>Dealers</em> (<code>role := "dealer"</code>) via:<a href="#section-2.2-9" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-2.2-10">
<pre>    HELLO.Details.roles.&lt;role&gt;.features.
        registration_meta_api|bool := true
</pre><a href="#section-2.2-10" class="pilcrow">¶</a>
</div>
<p id="section-2.2-11">Here is a <code>WELCOME</code> message from a <em>Router</em> with support for both the <em>Broker</em> and <em>Dealer</em> role, and with support for <strong>Registration Meta API</strong>:<a href="#section-2.2-11" class="pilcrow">¶</a></p>
<div class="lang-json sourcecode" id="section-2.2-12">
<pre>    [
        2,
        4580268554656113,
        {
            "authid":"OL3AeppwDLXiAAPbqm9IVhnw",
            "authrole": "anonymous",
            "authmethod": "anonymous",
            "roles": {
                "broker": {
                    "features": {
                    }
                },
                "dealer": {
                    "features": {
                        "registration_meta_api": true
                    }
                }
            }
        }
    ]
</pre><a href="#section-2.2-12" class="pilcrow">¶</a>
</div>
<div id="events-1">
<section id="section-2.2.1">
          <h4 id="name-events-2">
<a href="#section-2.2.1" class="section-number selfRef">2.2.1. </a><a href="#name-events-2" class="section-name selfRef">Events</a>
          </h4>
<p id="section-2.2.1-1">A client can subscribe to the following registration meta-events, which cover the lifecycle of a registration:<a href="#section-2.2.1-1" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-2.2.1-2.1">
              <code>wamp.registration.on_create</code>: Fired when a registration is created through a registration request for a URI which was previously without a registration.<a href="#section-2.2.1-2.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-2.2.1-2.2">
              <code>wamp.registration.on_register</code>: Fired when a <em>Callee</em> session is added to a registration.<a href="#section-2.2.1-2.2" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-2.2.1-2.3">
              <code>wamp.registration.on_unregister</code>: Fired when a <em>Callee</em> session is removed from a registration.<a href="#section-2.2.1-2.3" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-2.2.1-2.4">
              <code>wamp.registration.on_delete</code>: Fired when a registration is deleted after the last <em>Callee</em> session attached to it has been removed.<a href="#section-2.2.1-2.4" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-2.2.1-3">A <code>wamp.registration.on_register</code> event MUST be fired subsequent to a <code>wamp.registration.on_create</code> event, since the first registration results in both the creation of the registration and the addition of a session.<a href="#section-2.2.1-3" class="pilcrow">¶</a></p>
<p id="section-2.2.1-4">Similarly, the <code>wamp.registration.on_delete</code> event MUST be preceded by a <code>wamp.registration.on_unregister</code> event.<a href="#section-2.2.1-4" class="pilcrow">¶</a></p>
<p id="section-2.2.1-5"><strong>Registration Meta Events</strong> MUST be dispatched by the router to the same realm as the WAMP session which triggered the event.<a href="#section-2.2.1-5" class="pilcrow">¶</a></p>
<div id="wamp-registration-on-create">
<section id="section-2.2.1.1">
            <h5 id="name-wampregistrationon_create">
<a href="#section-2.2.1.1" class="section-number selfRef">2.2.1.1. </a><a href="#name-wampregistrationon_create" class="section-name selfRef">wamp.registration.on_create</a>
            </h5>
<p id="section-2.2.1.1-1">Fired when a registration is created through a registration request for a URI which was previously without a registration. The event payload consists of positional arguments:<a href="#section-2.2.1.1-1" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-2.2.1.1-2.1">
                <code>session|id</code>: The session ID performing the registration request.<a href="#section-2.2.1.1-2.1" class="pilcrow">¶</a>
</li>
              <li class="compact" id="section-2.2.1.1-2.2">
                <code>RegistrationDetails|dict</code>: Information on the created registration.<a href="#section-2.2.1.1-2.2" class="pilcrow">¶</a>
</li>
            </ul>
<p id="section-2.2.1.1-3"><strong>Object Schemas</strong><a href="#section-2.2.1.1-3" class="pilcrow">¶</a></p>
<div class="lang-javascript sourcecode" id="section-2.2.1.1-4">
<pre>    RegistrationDetails :=
    {
        "id": registration|id,
        "created": time_created|iso_8601_string,
        "uri": procedure|uri,
        "match": match_policy|string,
        "invoke": invocation_policy|string
    }
</pre><a href="#section-2.2.1.1-4" class="pilcrow">¶</a>
</div>
<p id="section-2.2.1.1-5">See <a href="pattern-based-registration.md">Pattern-based Registrations</a> for a description of <code>match_policy</code>.<a href="#section-2.2.1.1-5" class="pilcrow">¶</a></p>
<blockquote id="section-2.2.1.1-6">
              <p id="section-2.2.1.1-6.1">NOTE: invocation_policy IS NOT YET DESCRIBED IN THE ADVANCED SPEC<a href="#section-2.2.1.1-6.1" class="pilcrow">¶</a></p>
</blockquote>
</section>
</div>
<div id="wamp-registration-on-register">
<section id="section-2.2.1.2">
            <h5 id="name-wampregistrationon_register">
<a href="#section-2.2.1.2" class="section-number selfRef">2.2.1.2. </a><a href="#name-wampregistrationon_register" class="section-name selfRef">wamp.registration.on_register</a>
            </h5>
<p id="section-2.2.1.2-1">Fired when a session is added to a registration. The event payload consists of positional arguments:<a href="#section-2.2.1.2-1" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-2.2.1.2-2.1">
                <code>session|id</code>: The ID of the session being added to a registration.<a href="#section-2.2.1.2-2.1" class="pilcrow">¶</a>
</li>
              <li class="compact" id="section-2.2.1.2-2.2">
                <code>registration|id</code>: The ID of the registration to which a session is being added.<a href="#section-2.2.1.2-2.2" class="pilcrow">¶</a>
</li>
            </ul>
</section>
</div>
<div id="wamp-registration-on-unregister">
<section id="section-2.2.1.3">
            <h5 id="name-wampregistrationon_unregist">
<a href="#section-2.2.1.3" class="section-number selfRef">2.2.1.3. </a><a href="#name-wampregistrationon_unregist" class="section-name selfRef">wamp.registration.on_unregister</a>
            </h5>
<p id="section-2.2.1.3-1">Fired when a session is removed from a subscription. The event payload consists of positional arguments:<a href="#section-2.2.1.3-1" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-2.2.1.3-2.1">
                <code>session|id</code>: The ID of the session being removed from a registration.<a href="#section-2.2.1.3-2.1" class="pilcrow">¶</a>
</li>
              <li class="compact" id="section-2.2.1.3-2.2">
                <code>registration|id</code>: The ID of the registration from which a session is being removed.<a href="#section-2.2.1.3-2.2" class="pilcrow">¶</a>
</li>
            </ul>
</section>
</div>
<div id="wamp-registration-on-delete">
<section id="section-2.2.1.4">
            <h5 id="name-wampregistrationon_delete">
<a href="#section-2.2.1.4" class="section-number selfRef">2.2.1.4. </a><a href="#name-wampregistrationon_delete" class="section-name selfRef">wamp.registration.on_delete</a>
            </h5>
<p id="section-2.2.1.4-1">Fired when a registration is deleted after the last session attached to it has been removed. The event payload consists of positional arguments:<a href="#section-2.2.1.4-1" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-2.2.1.4-2.1">
                <code>session|id</code>: The ID of the last session being removed from a registration.<a href="#section-2.2.1.4-2.1" class="pilcrow">¶</a>
</li>
              <li class="compact" id="section-2.2.1.4-2.2">
                <code>registration|id</code>: The ID of the registration being deleted.<a href="#section-2.2.1.4-2.2" class="pilcrow">¶</a>
</li>
            </ul>
</section>
</div>
</section>
</div>
<div id="procedures-1">
<section id="section-2.2.2">
          <h4 id="name-procedures-2">
<a href="#section-2.2.2" class="section-number selfRef">2.2.2. </a><a href="#name-procedures-2" class="section-name selfRef">Procedures</a>
          </h4>
<p id="section-2.2.2-1">A client can actively retrieve information about registrations via the following meta-procedures:<a href="#section-2.2.2-1" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-2.2.2-2.1">
              <code>wamp.registration.list</code>: Retrieves registration IDs listed according to match policies.<a href="#section-2.2.2-2.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-2.2.2-2.2">
              <code>wamp.registration.lookup</code>: Obtains the registration (if any) managing a procedure, according to some match policy.<a href="#section-2.2.2-2.2" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-2.2.2-2.3">
              <code>wamp.registration.match</code>: Obtains the registration best matching a given procedure URI.<a href="#section-2.2.2-2.3" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-2.2.2-2.4">
              <code>wamp.registration.get</code>: Retrieves information on a particular registration.<a href="#section-2.2.2-2.4" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-2.2.2-2.5">
              <code>wamp.registration.list_callees</code>: Retrieves a list of session IDs for sessions currently attached to the registration.<a href="#section-2.2.2-2.5" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-2.2.2-2.6">
              <code>wamp.registration.count_callees</code>: Obtains the number of sessions currently attached to the registration.<a href="#section-2.2.2-2.6" class="pilcrow">¶</a>
</li>
          </ul>
<div id="wamp-registration-list">
<section id="section-2.2.2.1">
            <h5 id="name-wampregistrationlist">
<a href="#section-2.2.2.1" class="section-number selfRef">2.2.2.1. </a><a href="#name-wampregistrationlist" class="section-name selfRef">wamp.registration.list</a>
            </h5>
<p id="section-2.2.2.1-1">Retrieves registration IDs listed according to match policies.<a href="#section-2.2.2.1-1" class="pilcrow">¶</a></p>
<p id="section-2.2.2.1-2"><strong>Arguments</strong><a href="#section-2.2.2.1-2" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-2.2.2.1-3.1">None<a href="#section-2.2.2.1-3.1" class="pilcrow">¶</a>
</li>
            </ul>
<p id="section-2.2.2.1-4"><strong>Results</strong><a href="#section-2.2.2.1-4" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-2.2.2.1-5.1">
                <code>RegistrationLists|dict</code>: A dictionary with a list of registration IDs for each match policy.<a href="#section-2.2.2.1-5.1" class="pilcrow">¶</a>
</li>
            </ul>
<p id="section-2.2.2.1-6"><strong>Object Schemas</strong><a href="#section-2.2.2.1-6" class="pilcrow">¶</a></p>
<div class="lang-javascript sourcecode" id="section-2.2.2.1-7">
<pre>    RegistrationLists :=
    {
        "exact": registration_ids|list,
        "prefix": registration_ids|list,
        "wildcard": registration_ids|list
    }
</pre><a href="#section-2.2.2.1-7" class="pilcrow">¶</a>
</div>
<p id="section-2.2.2.1-8">See <a href="pattern-based-registration.md">Pattern-based Registrations</a> for a description of match policies.<a href="#section-2.2.2.1-8" class="pilcrow">¶</a></p>
</section>
</div>
<div id="wamp-registration-lookup">
<section id="section-2.2.2.2">
            <h5 id="name-wampregistrationlookup">
<a href="#section-2.2.2.2" class="section-number selfRef">2.2.2.2. </a><a href="#name-wampregistrationlookup" class="section-name selfRef">wamp.registration.lookup</a>
            </h5>
<p id="section-2.2.2.2-1">Obtains the registration (if any) managing a procedure, according to some match policy.<a href="#section-2.2.2.2-1" class="pilcrow">¶</a></p>
<p id="section-2.2.2.2-2"><strong>Arguments</strong><a href="#section-2.2.2.2-2" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-2.2.2.2-3.1">
                <code>procedure|uri</code>: The procedure to lookup the registration for.<a href="#section-2.2.2.2-3.1" class="pilcrow">¶</a>
</li>
              <li class="compact" id="section-2.2.2.2-3.2">(Optional) <code>options|dict</code>: Same options as when registering a procedure.<a href="#section-2.2.2.2-3.2" class="pilcrow">¶</a>
</li>
            </ul>
<p id="section-2.2.2.2-4"><strong>Results</strong><a href="#section-2.2.2.2-4" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-2.2.2.2-5.1">(Nullable) <code>registration|id</code>: The ID of the registration managing the procedure, if found, or null.<a href="#section-2.2.2.2-5.1" class="pilcrow">¶</a>
</li>
            </ul>
</section>
</div>
<div id="wamp-registration-match">
<section id="section-2.2.2.3">
            <h5 id="name-wampregistrationmatch">
<a href="#section-2.2.2.3" class="section-number selfRef">2.2.2.3. </a><a href="#name-wampregistrationmatch" class="section-name selfRef">wamp.registration.match</a>
            </h5>
<p id="section-2.2.2.3-1">Obtains the registration best matching a given procedure URI.<a href="#section-2.2.2.3-1" class="pilcrow">¶</a></p>
<p id="section-2.2.2.3-2"><strong>Arguments</strong><a href="#section-2.2.2.3-2" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-2.2.2.3-3.1">
                <code>procedure|uri</code>: The procedure URI to match<a href="#section-2.2.2.3-3.1" class="pilcrow">¶</a>
</li>
            </ul>
<p id="section-2.2.2.3-4"><strong>Results</strong><a href="#section-2.2.2.3-4" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-2.2.2.3-5.1">(Nullable) <code>registration|id</code>: The ID of best matching registration, or null.<a href="#section-2.2.2.3-5.1" class="pilcrow">¶</a>
</li>
            </ul>
</section>
</div>
<div id="wamp-registration-get">
<section id="section-2.2.2.4">
            <h5 id="name-wampregistrationget">
<a href="#section-2.2.2.4" class="section-number selfRef">2.2.2.4. </a><a href="#name-wampregistrationget" class="section-name selfRef">wamp.registration.get</a>
            </h5>
<p id="section-2.2.2.4-1">Retrieves information on a particular registration.<a href="#section-2.2.2.4-1" class="pilcrow">¶</a></p>
<p id="section-2.2.2.4-2"><strong>Arguments</strong><a href="#section-2.2.2.4-2" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-2.2.2.4-3.1">
                <code>registration|id</code>: The ID of the registration to retrieve.<a href="#section-2.2.2.4-3.1" class="pilcrow">¶</a>
</li>
            </ul>
<p id="section-2.2.2.4-4"><strong>Results</strong><a href="#section-2.2.2.4-4" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-2.2.2.4-5.1">
                <code>RegistrationDetails|dict</code>: Details on the registration.<a href="#section-2.2.2.4-5.1" class="pilcrow">¶</a>
</li>
            </ul>
<p id="section-2.2.2.4-6"><strong>Error URIs</strong><a href="#section-2.2.2.4-6" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-2.2.2.4-7.1">
                <code>wamp.error.no_such_registration</code>: No registration with the given ID exists on the router.<a href="#section-2.2.2.4-7.1" class="pilcrow">¶</a>
</li>
            </ul>
<p id="section-2.2.2.4-8"><strong>Object Schemas</strong><a href="#section-2.2.2.4-8" class="pilcrow">¶</a></p>
<div class="lang-javascript sourcecode" id="section-2.2.2.4-9">
<pre>    RegistrationDetails :=
    {
        "id": registration|id,
        "created": time_created|iso_8601_string,
        "uri": procedure|uri,
        "match": match_policy|string,
        "invoke": invocation_policy|string
    }
</pre><a href="#section-2.2.2.4-9" class="pilcrow">¶</a>
</div>
<p id="section-2.2.2.4-10">See <a href="pattern-based-registration.md">Pattern-based Registrations</a> for a description of match policies.<a href="#section-2.2.2.4-10" class="pilcrow">¶</a></p>
<p id="section-2.2.2.4-11"><em>NOTE: invocation_policy IS NOT YET DESCRIBED IN THE ADVANCED SPEC</em><a href="#section-2.2.2.4-11" class="pilcrow">¶</a></p>
</section>
</div>
<div id="wamp-registration-list-callees">
<section id="section-2.2.2.5">
            <h5 id="name-wampregistrationlist_callee">
<a href="#section-2.2.2.5" class="section-number selfRef">2.2.2.5. </a><a href="#name-wampregistrationlist_callee" class="section-name selfRef">wamp.registration.list_callees</a>
            </h5>
<p id="section-2.2.2.5-1">Retrieves a list of session IDs for sessions currently attached to the registration.<a href="#section-2.2.2.5-1" class="pilcrow">¶</a></p>
<p id="section-2.2.2.5-2"><strong>Arguments</strong><a href="#section-2.2.2.5-2" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-2.2.2.5-3.1">
                <code>registration|id</code>: The ID of the registration to get callees for.<a href="#section-2.2.2.5-3.1" class="pilcrow">¶</a>
</li>
            </ul>
<p id="section-2.2.2.5-4"><strong>Results</strong><a href="#section-2.2.2.5-4" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-2.2.2.5-5.1">
                <code>callee_ids|list</code>: A list of WAMP session IDs of callees currently attached to the registration.<a href="#section-2.2.2.5-5.1" class="pilcrow">¶</a>
</li>
            </ul>
<p id="section-2.2.2.5-6"><strong>Error URIs</strong><a href="#section-2.2.2.5-6" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-2.2.2.5-7.1">
                <code>wamp.error.no_such_registration</code>: No registration with the given ID exists on the router.<a href="#section-2.2.2.5-7.1" class="pilcrow">¶</a>
</li>
            </ul>
</section>
</div>
<div id="wamp-registration-count-callees">
<section id="section-2.2.2.6">
            <h5 id="name-wampregistrationcount_calle">
<a href="#section-2.2.2.6" class="section-number selfRef">2.2.2.6. </a><a href="#name-wampregistrationcount_calle" class="section-name selfRef">wamp.registration.count_callees</a>
            </h5>
<p id="section-2.2.2.6-1">Obtains the number of sessions currently attached to a registration.<a href="#section-2.2.2.6-1" class="pilcrow">¶</a></p>
<p id="section-2.2.2.6-2"><strong>Arguments</strong><a href="#section-2.2.2.6-2" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-2.2.2.6-3.1">
                <code>registration|id</code>: The ID of the registration to get the number of callees for.<a href="#section-2.2.2.6-3.1" class="pilcrow">¶</a>
</li>
            </ul>
<p id="section-2.2.2.6-4"><strong>Results</strong><a href="#section-2.2.2.6-4" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-2.2.2.6-5.1">
                <code>count|int</code>: The number of callees currently attached to a registration.<a href="#section-2.2.2.6-5.1" class="pilcrow">¶</a>
</li>
            </ul>
<p id="section-2.2.2.6-6"><strong>Error URIs</strong><a href="#section-2.2.2.6-6" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-2.2.2.6-7.1">
                <code>wamp.error.no_such_registration</code>: No registration with the given ID exists on the router.<a href="#section-2.2.2.6-7.1" class="pilcrow">¶</a>
</li>
            </ul>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="pubsub-sub-metapi">
<section id="section-2.3">
        <h3 id="name-subscriptions-meta-api">
<a href="#section-2.3" class="section-number selfRef">2.3. </a><a href="#name-subscriptions-meta-api" class="section-name selfRef">Subscriptions Meta API</a>
        </h3>
<p id="section-2.3-1">Within an application, it may be desirable for a publisher to know whether a publication to a specific topic currently makes sense, i.e. whether there are any subscribers who would receive an event based on the publication. It may also be desirable to keep a current count of subscribers to a topic to then be able to filter out any subscribers who are not supposed to receive an event.<a href="#section-2.3-1" class="pilcrow">¶</a></p>
<p id="section-2.3-2">Subscription <em>meta-events</em> are fired when topics are first created, when clients subscribe/unsubscribe to them, and when topics are deleted. WAMP allows retrieving information about subscriptions via subscription <em>meta-procedures</em>.<a href="#section-2.3-2" class="pilcrow">¶</a></p>
<p id="section-2.3-3">Support for this feature MUST be announced by Brokers via<a href="#section-2.3-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-2.3-4">
<pre>    HELLO.Details.roles.broker.features.subscription_meta_api|
        bool := true
</pre><a href="#section-2.3-4" class="pilcrow">¶</a>
</div>
<p id="section-2.3-5">Meta-events are created by the router itself. This means that the events as well as the data received when calling a meta-procedure can be accorded the same trust level as the router.<a href="#section-2.3-5" class="pilcrow">¶</a></p>
<p id="section-2.3-6">The following sections contain an informal, easy to digest description of the WAMP procedures and topics
available in (this part of) the WAMP Meta API.
A formal definition of the WAMP Meta API in terms of available WAMP procedures and topics including
precise and complete type definitions of the application payloads, that is procedure arguments and
results or event payloads is contained in<a href="#section-2.3-6" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-2.3-7.1">Compiled Binary Schema: <code>&lt;WAMP API Catalog&gt;/schema/wamp-meta.bfbs</code><a href="#section-2.3-7.1" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-2.3-7.2">FlatBuffers Schema Source: <code>&lt;WAMP API Catalog&gt;/src/wamp-meta.fbs</code><a href="#section-2.3-7.2" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-2.3-8">which uses FlatBuffers IDL to describe the API. The method of using FlatBuffers IDL and type definitions to formally define WAMP procedures and topics is detailed in section <a href="#wamp-idl">WAMP IDL</a>.<a href="#section-2.3-8" class="pilcrow">¶</a></p>
<p id="section-2.3-9"><strong>Feature Announcement</strong><a href="#section-2.3-9" class="pilcrow">¶</a></p>
<p id="section-2.3-10">Support for this feature MUST be announced by a <em>Brokers</em> (<code>role := "nroker"</code>) via:<a href="#section-2.3-10" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-2.3-11">
<pre>    HELLO.Details.roles.&lt;role&gt;.features.
        subscription_meta_api|bool := true
</pre><a href="#section-2.3-11" class="pilcrow">¶</a>
</div>
<p id="section-2.3-12">Here is a <code>WELCOME</code> message from a <em>Router</em> with support for both the <em>Broker</em> and <em>Dealer</em> role, and with support for <strong>Subscription Meta API</strong>:<a href="#section-2.3-12" class="pilcrow">¶</a></p>
<div class="lang-json sourcecode" id="section-2.3-13">
<pre>    [
        2,
        4580268554656113,
        {
            "authid":"OL3AeppwDLXiAAPbqm9IVhnw",
            "authrole": "anonymous",
            "authmethod": "anonymous",
            "roles": {
                "broker": {
                    "features": {
                        "subscription_meta_api": true
                    }
                },
                "dealer": {
                    "features": {
                    }
                }
            }
        }
    ]
</pre><a href="#section-2.3-13" class="pilcrow">¶</a>
</div>
<div id="events-2">
<section id="section-2.3.1">
          <h4 id="name-events-3">
<a href="#section-2.3.1" class="section-number selfRef">2.3.1. </a><a href="#name-events-3" class="section-name selfRef">Events</a>
          </h4>
<p id="section-2.3.1-1">A client can subscribe to the following session meta-events, which cover the lifecycle of a subscription:<a href="#section-2.3.1-1" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-2.3.1-2.1">
              <code>wamp.subscription.on_create</code>: Fired when a subscription is created through a subscription request for a topic which was previously without subscribers.<a href="#section-2.3.1-2.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-2.3.1-2.2">
              <code>wamp.subscription.on_subscribe</code>: Fired when a session is added to a subscription.<a href="#section-2.3.1-2.2" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-2.3.1-2.3">
              <code>wamp.subscription.on_unsubscribe</code>: Fired when a session is removed from a subscription.<a href="#section-2.3.1-2.3" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-2.3.1-2.4">
              <code>wamp.subscription.on_delete</code>: Fired when a subscription is deleted after the last session attached to it has been removed.<a href="#section-2.3.1-2.4" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-2.3.1-3">A <code>wamp.subscription.on_subscribe</code> event MUST always be fired subsequent to a <code>wamp.subscription.on_create</code> event, since the first subscribe results in both the creation of the subscription and the addition of a session. Similarly, the <code>wamp.subscription.on_delete</code> event MUST always be preceded by a <code>wamp.subscription.on_unsubscribe</code> event.<a href="#section-2.3.1-3" class="pilcrow">¶</a></p>
<p id="section-2.3.1-4">The WAMP subscription meta events shall be dispatched by the router to the same realm as the WAMP session which triggered the event.<a href="#section-2.3.1-4" class="pilcrow">¶</a></p>
<div id="wamp-subscription-on-create">
<section id="section-2.3.1.1">
            <h5 id="name-wampsubscriptionon_create">
<a href="#section-2.3.1.1" class="section-number selfRef">2.3.1.1. </a><a href="#name-wampsubscriptionon_create" class="section-name selfRef">wamp.subscription.on_create</a>
            </h5>
<p id="section-2.3.1.1-1">Fired when a subscription is created through a subscription request for a topic which was previously without subscribers. The event payload consists of positional arguments:<a href="#section-2.3.1.1-1" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-2.3.1.1-2.1">
                <code>session|id</code>: ID of the session performing the subscription request.<a href="#section-2.3.1.1-2.1" class="pilcrow">¶</a>
</li>
              <li class="compact" id="section-2.3.1.1-2.2">
                <code>SubscriptionDetails|dict</code>: Information on the created subscription.<a href="#section-2.3.1.1-2.2" class="pilcrow">¶</a>
</li>
            </ul>
<p id="section-2.3.1.1-3"><strong>Object Schemas</strong><a href="#section-2.3.1.1-3" class="pilcrow">¶</a></p>
<div class="lang-javascript sourcecode" id="section-2.3.1.1-4">
<pre>      SubscriptionDetails :=
      {
          "id": subscription|id,
          "created": time_created|iso_8601_string,
          "uri": topic|uri,
          "match": match_policy|string
      }
</pre><a href="#section-2.3.1.1-4" class="pilcrow">¶</a>
</div>
<p id="section-2.3.1.1-5">See <a href="#pattern-based-subscriptions">Pattern-based Subscriptions</a> for a description of <code>match_policy</code>.<a href="#section-2.3.1.1-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="wamp-subscription-on-subscribe">
<section id="section-2.3.1.2">
            <h5 id="name-wampsubscriptionon_subscrib">
<a href="#section-2.3.1.2" class="section-number selfRef">2.3.1.2. </a><a href="#name-wampsubscriptionon_subscrib" class="section-name selfRef">wamp.subscription.on_subscribe</a>
            </h5>
<p id="section-2.3.1.2-1">Fired when a session is added to a subscription.  The event payload consists of positional arguments:<a href="#section-2.3.1.2-1" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-2.3.1.2-2.1">
                <code>session|id</code>: ID of the session being added to a subscription.<a href="#section-2.3.1.2-2.1" class="pilcrow">¶</a>
</li>
              <li class="compact" id="section-2.3.1.2-2.2">
                <code>subscription|id</code>: ID of the subscription to which the session is being added.<a href="#section-2.3.1.2-2.2" class="pilcrow">¶</a>
</li>
            </ul>
</section>
</div>
<div id="wamp-subscription-on-unsubscribe">
<section id="section-2.3.1.3">
            <h5 id="name-wampsubscriptionon_unsubscr">
<a href="#section-2.3.1.3" class="section-number selfRef">2.3.1.3. </a><a href="#name-wampsubscriptionon_unsubscr" class="section-name selfRef">wamp.subscription.on_unsubscribe</a>
            </h5>
<p id="section-2.3.1.3-1">Fired when a session is removed from a subscription. The event payload consists of positional arguments:<a href="#section-2.3.1.3-1" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-2.3.1.3-2.1">
                <code>session|id</code>: ID of the session being removed from a subscription.<a href="#section-2.3.1.3-2.1" class="pilcrow">¶</a>
</li>
              <li class="compact" id="section-2.3.1.3-2.2">
                <code>subscription|id</code>: ID of the subscription from which the session is being removed.<a href="#section-2.3.1.3-2.2" class="pilcrow">¶</a>
</li>
            </ul>
</section>
</div>
<div id="wamp-subscription-on-delete">
<section id="section-2.3.1.4">
            <h5 id="name-wampsubscriptionon_delete">
<a href="#section-2.3.1.4" class="section-number selfRef">2.3.1.4. </a><a href="#name-wampsubscriptionon_delete" class="section-name selfRef">wamp.subscription.on_delete</a>
            </h5>
<p id="section-2.3.1.4-1">Fired when a subscription is deleted after the last session attached to it has been removed. The event payload consists of positional arguments:<a href="#section-2.3.1.4-1" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-2.3.1.4-2.1">
                <code>session|id</code>: ID of the last session being removed from a subscription.<a href="#section-2.3.1.4-2.1" class="pilcrow">¶</a>
</li>
              <li class="compact" id="section-2.3.1.4-2.2">
                <code>subscription|id</code>: ID of the subscription being deleted.<a href="#section-2.3.1.4-2.2" class="pilcrow">¶</a>
</li>
            </ul>
</section>
</div>
</section>
</div>
<div id="procedures-2">
<section id="section-2.3.2">
          <h4 id="name-procedures-3">
<a href="#section-2.3.2" class="section-number selfRef">2.3.2. </a><a href="#name-procedures-3" class="section-name selfRef">Procedures</a>
          </h4>
<p id="section-2.3.2-1">A client can actively retrieve information about subscriptions via the following meta-procedures:<a href="#section-2.3.2-1" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-2.3.2-2.1">
              <code>wamp.subscription.list</code>: Retrieves subscription IDs listed according to match policies.<a href="#section-2.3.2-2.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-2.3.2-2.2">
              <code>wamp.subscription.lookup</code>: Obtains the subscription (if any) managing a topic, according to some match policy.<a href="#section-2.3.2-2.2" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-2.3.2-2.3">
              <code>wamp.subscription.match</code>: Retrieves a list of IDs of subscriptions matching a topic URI, irrespective of match policy.<a href="#section-2.3.2-2.3" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-2.3.2-2.4">
              <code>wamp.subscription.get</code>: Retrieves information on a particular subscription.<a href="#section-2.3.2-2.4" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-2.3.2-2.5">
              <code>wamp.subscription.list_subscribers</code>: Retrieves a list of session IDs for sessions currently attached to the subscription.<a href="#section-2.3.2-2.5" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-2.3.2-2.6">
              <code>wamp.subscription.count_subscribers</code>: Obtains the number of sessions currently attached to the subscription.<a href="#section-2.3.2-2.6" class="pilcrow">¶</a>
</li>
          </ul>
<div id="wamp-subscription-list">
<section id="section-2.3.2.1">
            <h5 id="name-wampsubscriptionlist">
<a href="#section-2.3.2.1" class="section-number selfRef">2.3.2.1. </a><a href="#name-wampsubscriptionlist" class="section-name selfRef">wamp.subscription.list</a>
            </h5>
<p id="section-2.3.2.1-1">Retrieves subscription IDs listed according to match policies.<a href="#section-2.3.2.1-1" class="pilcrow">¶</a></p>
<p id="section-2.3.2.1-2"><strong>Arguments</strong>
- None<a href="#section-2.3.2.1-2" class="pilcrow">¶</a></p>
<p id="section-2.3.2.1-3"><strong>Results</strong><a href="#section-2.3.2.1-3" class="pilcrow">¶</a></p>
<p id="section-2.3.2.1-4">The result consists of one positional argument:<a href="#section-2.3.2.1-4" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-2.3.2.1-5.1">
                <code>SubscriptionLists|dict</code>: A dictionary with a list of subscription IDs for each match policy.<a href="#section-2.3.2.1-5.1" class="pilcrow">¶</a>
</li>
            </ul>
<p id="section-2.3.2.1-6"><strong>Object Schemas</strong><a href="#section-2.3.2.1-6" class="pilcrow">¶</a></p>
<div class="lang-javascript sourcecode" id="section-2.3.2.1-7">
<pre>      SubscriptionLists :=
      {
          "exact": subscription_ids|list,
          "prefix": subscription_ids|list,
          "wildcard": subscription_ids|list
      }
</pre><a href="#section-2.3.2.1-7" class="pilcrow">¶</a>
</div>
<p id="section-2.3.2.1-8">See <a href="#pattern-based-subscriptions">Pattern-based Subscriptions</a> for information on match policies.<a href="#section-2.3.2.1-8" class="pilcrow">¶</a></p>
</section>
</div>
<div id="wamp-subscription-lookup">
<section id="section-2.3.2.2">
            <h5 id="name-wampsubscriptionlookup">
<a href="#section-2.3.2.2" class="section-number selfRef">2.3.2.2. </a><a href="#name-wampsubscriptionlookup" class="section-name selfRef">wamp.subscription.lookup</a>
            </h5>
<p id="section-2.3.2.2-1">Obtains the subscription (if any) managing a topic, according to some match policy.<a href="#section-2.3.2.2-1" class="pilcrow">¶</a></p>
<p id="section-2.3.2.2-2"><strong>Arguments</strong><a href="#section-2.3.2.2-2" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-2.3.2.2-3.1">
                <code>topic|uri</code>: The URI of the topic.<a href="#section-2.3.2.2-3.1" class="pilcrow">¶</a>
</li>
              <li class="compact" id="section-2.3.2.2-3.2">(Optional) <code>options|dict</code>: Same options as when subscribing to a topic.<a href="#section-2.3.2.2-3.2" class="pilcrow">¶</a>
</li>
            </ul>
<p id="section-2.3.2.2-4"><strong>Results</strong><a href="#section-2.3.2.2-4" class="pilcrow">¶</a></p>
<p id="section-2.3.2.2-5">The result consists of one positional argument:<a href="#section-2.3.2.2-5" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-2.3.2.2-6.1">(Nullable) <code>subscription|id</code>: The ID of the subscription managing the topic, if found, or null.<a href="#section-2.3.2.2-6.1" class="pilcrow">¶</a>
</li>
            </ul>
</section>
</div>
<div id="wamp-subscription-match">
<section id="section-2.3.2.3">
            <h5 id="name-wampsubscriptionmatch">
<a href="#section-2.3.2.3" class="section-number selfRef">2.3.2.3. </a><a href="#name-wampsubscriptionmatch" class="section-name selfRef">wamp.subscription.match</a>
            </h5>
<p id="section-2.3.2.3-1">Retrieves a list of IDs of subscriptions matching a topic URI, irrespective of match policy.<a href="#section-2.3.2.3-1" class="pilcrow">¶</a></p>
<p id="section-2.3.2.3-2"><strong>Arguments</strong><a href="#section-2.3.2.3-2" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-2.3.2.3-3.1">
                <code>topic|uri</code>: The topic to match.<a href="#section-2.3.2.3-3.1" class="pilcrow">¶</a>
</li>
            </ul>
<p id="section-2.3.2.3-4"><strong>Results</strong><a href="#section-2.3.2.3-4" class="pilcrow">¶</a></p>
<p id="section-2.3.2.3-5">The result consists of positional arguments:<a href="#section-2.3.2.3-5" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-2.3.2.3-6.1">(Nullable) <code>subscription_ids|list</code>: A list of all matching subscription IDs, or null.<a href="#section-2.3.2.3-6.1" class="pilcrow">¶</a>
</li>
            </ul>
</section>
</div>
<div id="wamp-subscription-get">
<section id="section-2.3.2.4">
            <h5 id="name-wampsubscriptionget">
<a href="#section-2.3.2.4" class="section-number selfRef">2.3.2.4. </a><a href="#name-wampsubscriptionget" class="section-name selfRef">wamp.subscription.get</a>
            </h5>
<p id="section-2.3.2.4-1">Retrieves information on a particular subscription.<a href="#section-2.3.2.4-1" class="pilcrow">¶</a></p>
<p id="section-2.3.2.4-2"><strong>Arguments</strong><a href="#section-2.3.2.4-2" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-2.3.2.4-3.1">
                <code>subscription|id</code>: The ID of the subscription to retrieve.<a href="#section-2.3.2.4-3.1" class="pilcrow">¶</a>
</li>
            </ul>
<p id="section-2.3.2.4-4"><strong>Results</strong><a href="#section-2.3.2.4-4" class="pilcrow">¶</a></p>
<p id="section-2.3.2.4-5">The result consists of one positional argument:<a href="#section-2.3.2.4-5" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-2.3.2.4-6.1">
                <code>SubscriptionDetails|dict</code>: Details on the subscription.<a href="#section-2.3.2.4-6.1" class="pilcrow">¶</a>
</li>
            </ul>
<p id="section-2.3.2.4-7"><strong>Error URIs</strong><a href="#section-2.3.2.4-7" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-2.3.2.4-8.1">
                <code>wamp.error.no_such_subscription</code>: No subscription with the given ID exists on the router.<a href="#section-2.3.2.4-8.1" class="pilcrow">¶</a>
</li>
            </ul>
<p id="section-2.3.2.4-9"><strong>Object Schemas</strong><a href="#section-2.3.2.4-9" class="pilcrow">¶</a></p>
<div class="lang-javascript sourcecode" id="section-2.3.2.4-10">
<pre>      SubscriptionDetails :=
      {
          "id": subscription|id,
          "created": time_created|iso_8601_string,
          "uri": topic|uri,
          "match": match_policy|string
      }
</pre><a href="#section-2.3.2.4-10" class="pilcrow">¶</a>
</div>
<p id="section-2.3.2.4-11">See <a href="#pattern-based-subscriptions">Pattern-based Subscriptions</a> for information on match policies.<a href="#section-2.3.2.4-11" class="pilcrow">¶</a></p>
</section>
</div>
<div id="wamp-subscription-list-subscribers">
<section id="section-2.3.2.5">
            <h5 id="name-wampsubscriptionlist_subscr">
<a href="#section-2.3.2.5" class="section-number selfRef">2.3.2.5. </a><a href="#name-wampsubscriptionlist_subscr" class="section-name selfRef">wamp.subscription.list_subscribers</a>
            </h5>
<p id="section-2.3.2.5-1">Retrieves a list of session IDs for sessions currently attached to the subscription.<a href="#section-2.3.2.5-1" class="pilcrow">¶</a></p>
<p id="section-2.3.2.5-2"><strong>Arguments</strong>
- <code>subscription|id</code>: The ID of the subscription to get subscribers for.<a href="#section-2.3.2.5-2" class="pilcrow">¶</a></p>
<p id="section-2.3.2.5-3"><strong>Results</strong><a href="#section-2.3.2.5-3" class="pilcrow">¶</a></p>
<p id="section-2.3.2.5-4">The result consists of positional arguments:<a href="#section-2.3.2.5-4" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-2.3.2.5-5.1">
                <code>subscribers_ids|list</code>: A list of WAMP session IDs of subscribers currently attached to the subscription.<a href="#section-2.3.2.5-5.1" class="pilcrow">¶</a>
</li>
            </ul>
<p id="section-2.3.2.5-6"><strong>Error URIs</strong><a href="#section-2.3.2.5-6" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-2.3.2.5-7.1">
                <code>wamp.error.no_such_subscription</code>: No subscription with the given ID exists on the router.<a href="#section-2.3.2.5-7.1" class="pilcrow">¶</a>
</li>
            </ul>
</section>
</div>
<div id="wamp-subscription-count-subscribers">
<section id="section-2.3.2.6">
            <h5 id="name-wampsubscriptioncount_subsc">
<a href="#section-2.3.2.6" class="section-number selfRef">2.3.2.6. </a><a href="#name-wampsubscriptioncount_subsc" class="section-name selfRef">wamp.subscription.count_subscribers</a>
            </h5>
<p id="section-2.3.2.6-1">Obtains the number of sessions currently attached to a subscription.<a href="#section-2.3.2.6-1" class="pilcrow">¶</a></p>
<p id="section-2.3.2.6-2"><strong>Arguments</strong><a href="#section-2.3.2.6-2" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-2.3.2.6-3.1">
                <code>subscription|id</code>: The ID of the subscription to get the number of subscribers for.<a href="#section-2.3.2.6-3.1" class="pilcrow">¶</a>
</li>
            </ul>
<p id="section-2.3.2.6-4"><strong>Results</strong><a href="#section-2.3.2.6-4" class="pilcrow">¶</a></p>
<p id="section-2.3.2.6-5">The result consists of one positional argument:<a href="#section-2.3.2.6-5" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-2.3.2.6-6.1">
                <code>count|int</code>: The number of sessions currently attached to a subscription.<a href="#section-2.3.2.6-6.1" class="pilcrow">¶</a>
</li>
            </ul>
<p id="section-2.3.2.6-7"><strong>Error URIs</strong><a href="#section-2.3.2.6-7" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-2.3.2.6-8.1">
                <code>wamp.error.no_such_subscription</code>: No subscription with the given ID exists on the router.<a href="#section-2.3.2.6-8.1" class="pilcrow">¶</a>
</li>
            </ul>
</section>
</div>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="adv-rpc">
<section id="section-3">
      <h2 id="name-advanced-rpc">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-advanced-rpc" class="section-name selfRef">Advanced RPC</a>
      </h2>
<div id="rpc-progressive-call-results">
<section id="section-3.1">
        <h3 id="name-progressive-call-results">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-progressive-call-results" class="section-name selfRef">Progressive Call Results</a>
        </h3>
<p id="section-3.1-1">A procedure implemented by a <em>Callee</em> and registered at a <em>Dealer</em> may produce progressive results. Progressive results can e.g. be used to return partial results for long-running operations, or to chunk the transmission of larger results sets.<a href="#section-3.1-1" class="pilcrow">¶</a></p>
<p id="section-3.1-2"><strong>Feature Announcement</strong><a href="#section-3.1-2" class="pilcrow">¶</a></p>
<p id="section-3.1-3">Support for this advanced feature MUST be announced by <em>Callers</em> (<code>role := "caller"</code>), <em>Callees</em> (<code>role := "callee"</code>) and <em>Dealers</em> (<code>role := "dealer"</code>) via<a href="#section-3.1-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.1-4">
<pre>    HELLO.Details.roles.&lt;role&gt;.features.
         progressive_call_results|bool := true
</pre><a href="#section-3.1-4" class="pilcrow">¶</a>
</div>
<p id="section-3.1-5">Additionally, <em>Callees</em> and <em>Dealers</em> MUST support Call Canceling, which is required for canceling progressive results if the original <em>Caller</em> leaves the realm. If a <em>Callee</em> supports Progressive Call Results, but not Call Canceling, then the <em>Dealer</em> disregards the <em>Callees</em> Progressive Call Results feature.<a href="#section-3.1-5" class="pilcrow">¶</a></p>
<p id="section-3.1-6"><strong>Message Flow</strong><a href="#section-3.1-6" class="pilcrow">¶</a></p>
<p id="section-3.1-7">The message flow for progressive results involves:<a href="#section-3.1-7" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.1-8">
<pre> ,------.           ,------.          ,------.
 |Caller|           |Dealer|          |Callee|
 `--+---'           `--+---'          `--+---'
    |       CALL       |                 |
    | -----------------&gt;                 |
    |                  |                 |
    |                  |    INVOCATION   |
    |                  | ----------------&gt;
    |                  |                 |
    |                  | YIELD (progress)|
    |                  | &lt;----------------
    |                  |                 |
    | RESULT (progress)|                 |
    | &lt;-----------------                 |
    |                  |                 |
    |                  | YIELD (progress)|
    |                  | &lt;----------------
    |                  |                 |
    | RESULT (progress)|                 |
    | &lt;-----------------                 |
    |                  |                 |
    |                  |                 |
    |       ...        |       ...       |
    |                  |                 |
    |                  |  YIELD or ERROR |
    |                  | &lt;----------------
    |                  |                 |
    |  RESULT or ERROR |                 |
    | &lt;-----------------                 |
 ,--+---.           ,--+---.          ,--+---.
 |Caller|           |Dealer|          |Callee|
 `------'           `------'          `------'
</pre><a href="#section-3.1-8" class="pilcrow">¶</a>
</div>
<p id="section-3.1-9">A <em>Caller</em> indicates its willingness to receive progressive results by setting<a href="#section-3.1-9" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.1-10">
<pre>    CALL.Options.receive_progress|bool := true
</pre><a href="#section-3.1-10" class="pilcrow">¶</a>
</div>
<p id="section-3.1-11"><em>Example.</em> Caller-to-Dealer <code>CALL</code><a href="#section-3.1-11" class="pilcrow">¶</a></p>
<div class="lang-json sourcecode" id="section-3.1-12">
<pre>    [
        48,
        77133,
        {
            "receive_progress": true
        },
        "com.myapp.compute_revenue",
        [2010, 2011, 2012]
    ]
</pre><a href="#section-3.1-12" class="pilcrow">¶</a>
</div>
<p id="section-3.1-13">If the <em>Callee</em> supports Progressive Call Results, the <em>Dealer</em> will forward the <em>Caller's</em> willingness to receive progressive results by setting<a href="#section-3.1-13" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.1-14">
<pre>    INVOCATION.Details.receive_progress|bool := true
</pre><a href="#section-3.1-14" class="pilcrow">¶</a>
</div>
<p id="section-3.1-15"><em>Example.</em> Dealer-to-Callee <code>INVOCATION</code><a href="#section-3.1-15" class="pilcrow">¶</a></p>
<div class="lang-json sourcecode" id="section-3.1-16">
<pre>    [
        68,
        87683,
        324,
        {
            "receive_progress": true
        },
        [2010, 2011, 2012]
    ]
</pre><a href="#section-3.1-16" class="pilcrow">¶</a>
</div>
<p id="section-3.1-17">An endpoint implementing the procedure produces progressive results by sending <code>YIELD</code> messages to the <em>Dealer</em> with<a href="#section-3.1-17" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.1-18">
<pre>    YIELD.Options.progress|bool := true
</pre><a href="#section-3.1-18" class="pilcrow">¶</a>
</div>
<p id="section-3.1-19"><em>Example.</em> Callee-to-Dealer progressive <code>YIELDs</code><a href="#section-3.1-19" class="pilcrow">¶</a></p>
<div class="lang-json sourcecode" id="section-3.1-20">
<pre>    [
        70,
        87683,
        {
            "progress": true
        },
        ["Y2010", 120]
    ]
</pre><a href="#section-3.1-20" class="pilcrow">¶</a>
</div>
<div class="lang-json sourcecode" id="section-3.1-21">
<pre>    [
        70,
        87683,
        {
            "progress": true
        },
        ["Y2011", 205]
    ]
</pre><a href="#section-3.1-21" class="pilcrow">¶</a>
</div>
<p id="section-3.1-22">Upon receiving an <code>YIELD</code> message from a <em>Callee</em> with <code>YIELD.Options.progress == true</code> (for a call that is still ongoing), the <em>Dealer</em> will <strong>immediately</strong> send a <code>RESULT</code> message to the original <em>Caller</em> with<a href="#section-3.1-22" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.1-23">
<pre>    RESULT.Details.progress|bool := true
</pre><a href="#section-3.1-23" class="pilcrow">¶</a>
</div>
<p id="section-3.1-24"><em>Example.</em> Dealer-to-Caller progressive <code>RESULTs</code><a href="#section-3.1-24" class="pilcrow">¶</a></p>
<div class="lang-json sourcecode" id="section-3.1-25">
<pre>    [
        50,
        77133,
        {
            "progress": true
        },
        ["Y2010", 120]
    ]
</pre><a href="#section-3.1-25" class="pilcrow">¶</a>
</div>
<div class="lang-json sourcecode" id="section-3.1-26">
<pre>    [
        50,
        77133,
        {
            "progress": true
        },
        ["Y2011", 205]
    ]
</pre><a href="#section-3.1-26" class="pilcrow">¶</a>
</div>
<p id="section-3.1-27">and so on...<a href="#section-3.1-27" class="pilcrow">¶</a></p>
<p id="section-3.1-28">An invocation MUST <em>always</em> end in either a <em>normal</em> <code>RESULT</code> or <code>ERROR</code> message being sent by the <em>Callee</em> and received by the <em>Dealer</em>.<a href="#section-3.1-28" class="pilcrow">¶</a></p>
<p id="section-3.1-29"><em>Example.</em> Callee-to-Dealer final <code>YIELD</code><a href="#section-3.1-29" class="pilcrow">¶</a></p>
<div class="lang-json sourcecode" id="section-3.1-30">
<pre>    [
        70,
        87683,
        {},
        ["Total", 490]
    ]
</pre><a href="#section-3.1-30" class="pilcrow">¶</a>
</div>
<p id="section-3.1-31"><em>Example.</em> Callee-to-Dealer final <code>ERROR</code><a href="#section-3.1-31" class="pilcrow">¶</a></p>
<div class="lang-json sourcecode" id="section-3.1-32">
<pre>    [
        8,
        68,
        87683,
        {},
        "com.myapp.invalid_revenue_year",
        [1830]
    ]
</pre><a href="#section-3.1-32" class="pilcrow">¶</a>
</div>
<p id="section-3.1-33">A call MUST <em>always</em> end in either a <em>normal</em> <code>RESULT</code> or <code>ERROR</code> message being sent by the <em>Dealer</em> and received by the <em>Caller</em>.<a href="#section-3.1-33" class="pilcrow">¶</a></p>
<p id="section-3.1-34"><em>Example.</em> Dealer-to-Caller final <code>RESULT</code><a href="#section-3.1-34" class="pilcrow">¶</a></p>
<div class="lang-json sourcecode" id="section-3.1-35">
<pre>    [
        50,
        77133,
        {},
        ["Total", 490]
    ]
</pre><a href="#section-3.1-35" class="pilcrow">¶</a>
</div>
<p id="section-3.1-36"><em>Example.</em> Dealer-to-Caller final <code>ERROR</code><a href="#section-3.1-36" class="pilcrow">¶</a></p>
<div class="lang-json sourcecode" id="section-3.1-37">
<pre>    [
        8,
        68,
        77133,
        {},
        "com.myapp.invalid_revenue_year",
        [1830]
    ]
</pre><a href="#section-3.1-37" class="pilcrow">¶</a>
</div>
<p id="section-3.1-38">In other words: <code>YIELD</code> with <code>YIELD.Options.progress == true</code> and <code>RESULT</code> with <code>RESULT.Details.progress == true</code> messages may only be sent <em>during</em> a call or invocation is still ongoing.<a href="#section-3.1-38" class="pilcrow">¶</a></p>
<p id="section-3.1-39">The final <code>YIELD</code> and final <code>RESULT</code> may also be empty, e.g. when all actual results have already been transmitted in progressive result messages.<a href="#section-3.1-39" class="pilcrow">¶</a></p>
<p id="section-3.1-40"><em>Example.</em> Callee-to-Dealer <code>YIELDs</code><a href="#section-3.1-40" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.1-41">
<pre>    [70, 87683, {"progress": true}, ["Y2010", 120]]
    [70, 87683, {"progress": true}, ["Y2011", 205]]
     ...
    [70, 87683, {"progress": true}, ["Total", 490]]
    [70, 87683, {}]
</pre><a href="#section-3.1-41" class="pilcrow">¶</a>
</div>
<p id="section-3.1-42"><em>Example.</em> Dealer-to-Caller <code>RESULTs</code><a href="#section-3.1-42" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.1-43">
<pre>    [50, 77133, {"progress": true}, ["Y2010", 120]]
    [50, 77133, {"progress": true}, ["Y2011", 205]]
     ...
    [50, 77133, {"progress": true}, ["Total", 490]]
    [50, 77133, {}]
</pre><a href="#section-3.1-43" class="pilcrow">¶</a>
</div>
<p id="section-3.1-44">The progressive <code>YIELD</code> and progressive <code>RESULT</code> may also be empty, e.g. when those messages are only used to signal that the procedure is still running and working, and the actual result is completely delivered in the final <code>YIELD</code> and <code>RESULT</code>:<a href="#section-3.1-44" class="pilcrow">¶</a></p>
<p id="section-3.1-45"><em>Example.</em> Callee-to-Dealer <code>YIELDs</code><a href="#section-3.1-45" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.1-46">
<pre>    [70, 87683, {"progress": true}]
    [70, 87683, {"progress": true}]
    ...
    [70, 87683, {}, [["Y2010", 120], ["Y2011", 205], ...,
        ["Total", 490]]]
</pre><a href="#section-3.1-46" class="pilcrow">¶</a>
</div>
<p id="section-3.1-47"><em>Example.</em> Dealer-to-Caller <code>RESULTs</code><a href="#section-3.1-47" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.1-48">
<pre>    [50, 77133, {"progress": true}]
    [50, 77133, {"progress": true}]
    ...
    [50, 77133, {}, [["Y2010", 120], ["Y2011", 205], ...,
        ["Total", 490]]]
</pre><a href="#section-3.1-48" class="pilcrow">¶</a>
</div>
<blockquote id="section-3.1-49">
          <p id="section-3.1-49.1">Note that intermediate, progressive results and/or the final result MAY have different structure. The WAMP peer implementation is responsible for mapping everything into a form suitable for consumption in the host language.<a href="#section-3.1-49.1" class="pilcrow">¶</a></p>
</blockquote>
<p id="section-3.1-50"><em>Example.</em> Callee-to-Dealer <code>YIELDs</code><a href="#section-3.1-50" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.1-51">
<pre>    [70, 87683, {"progress": true}, ["partial 1", 10]]
    [70, 87683, {"progress": true}, [], {"foo": 10,
        "bar": "partial 1"}]
     ...
    [70, 87683, {}, [1, 2, 3], {"moo": "hello"}]
</pre><a href="#section-3.1-51" class="pilcrow">¶</a>
</div>
<p id="section-3.1-52"><em>Example.</em> Dealer-to-Caller <code>RESULTs</code><a href="#section-3.1-52" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.1-53">
<pre>    [50, 77133, {"progress": true}, ["partial 1", 10]]
    [50, 77133, {"progress": true}, [], {"foo": 10,
        "bar": "partial 1"}]
     ...
    [50, 77133, {}, [1, 2, 3], {"moo": "hello"}]
</pre><a href="#section-3.1-53" class="pilcrow">¶</a>
</div>
<p id="section-3.1-54">Even if a <em>Caller</em> has indicated its expectation to receive progressive results by setting <code>CALL.Options.receive_progress|bool := true</code>, a <em>Callee</em> is <strong>not required</strong> to produce progressive results. <code>CALL.Options.receive_progress</code> and <code>INVOCATION.Details.receive_progress</code> are simply indications that the <em>Caller</em> is prepared to process progressive results, should there be any produced. In other words, <em>Callees</em> are free to ignore such <code>receive_progress</code> hints at any time.<a href="#section-3.1-54" class="pilcrow">¶</a></p>
<p id="section-3.1-55"><strong>Caller Leaving</strong><a href="#section-3.1-55" class="pilcrow">¶</a></p>
<p id="section-3.1-56">The <em>Dealer</em>'s behavior for when a <em>Caller</em> leaves or disconnects during a progressive results call shall be the same as in a basic, non-progressive call. That is, the <em>Dealer</em> sends an INTERRUPT to the <em>Callee</em> with <code>mode="killnowait"</code>. See <a href="#rpc-caller-leaving">Caller Leaving During RPC Invocation</a> under the Basic Profile.<a href="#section-3.1-56" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.1-57">
<pre> ,------.           ,------.          ,------.
 |Caller|           |Dealer|          |Callee|
 `--+---'           `--+---'          `--+---'
    |       CALL       |                 |
    | -----------------&gt;                 |
    |                  |    INVOCATION   |
    |                  | ----------------&gt;
    |                  |                 |
    |                  | YIELD (progress)|
    |                  | &lt;----------------
    |                  |                 |
    | RESULT (progress)|                 |
    | &lt;-----------------                 |
 ,--+---.              |                 |
 |Caller|              |                 |
 `------'              |    INTERRUPT    |
  (gone)               | ----------------&gt;
                       |                 |
                    ,--+---.          ,--+---.
                    |Dealer|          |Callee|
                    `------'          `------'
</pre><a href="#section-3.1-57" class="pilcrow">¶</a>
</div>
<p id="section-3.1-58">Such cancellation when the caller leaves addresses a potential security vulnerability: In cases where progressive results are used to stream data to <em>Callers</em>, and network connectivity is unreliable, <em>Callers</em> may often get disconnected in the middle of receiving such progressive results. Without the mandated cancellation behavior, recurring connect-call-disconnect cycles by a <em>Caller</em> would result in a rapidly growing backlog of unprocessed streaming results, overloading the router and further degrading network connectivity.<a href="#section-3.1-58" class="pilcrow">¶</a></p>
<p id="section-3.1-59"><strong>Callee Leaving</strong><a href="#section-3.1-59" class="pilcrow">¶</a></p>
<p id="section-3.1-60">The <em>Dealer</em>'s behavior for when a <em>Callee</em> leaves or disconnects during a progressive results call shall be the same as in a basic, non-progressive call. That is, the <em>Dealer</em> sends an ERROR message to the <em>Caller</em> with the <code>wamp.error.canceled</code> URI. See <a href="#rpc-callee-leaving">Callee Leaving During an RPC Invocation</a> under the Basic Profile.<a href="#section-3.1-60" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.1-61">
<pre> ,------.           ,------.          ,------.
 |Caller|           |Dealer|          |Callee|
 `--+---'           `--+---'          `--+---'
    |        CALL      |                 |
    | -----------------&gt;                 |
    |                  |    INVOCATION   |
    |                  | ----------------&gt;
    |                  |                 |
    |                  | YIELD (progress)|
    |                  | &lt;----------------
    |                  |                 |
    | RESULT (progress)|                 |
    | &lt;----------------|                 |
    |                  |              ,--+---.
    |                  |              |Callee|
    |                  |              `------'
    |      ERROR       |               (gone)
    | &lt;--------------- |
    |                  |
 ,--+---.           ,--+---.
 |Caller|           |Dealer|
 `------'           `------'
</pre><a href="#section-3.1-61" class="pilcrow">¶</a>
</div>
<p id="section-3.1-62"><strong>Ignoring Requests for Progressive Call Results</strong><a href="#section-3.1-62" class="pilcrow">¶</a></p>
<p id="section-3.1-63">A <em>Callee</em> that does not support progressive results SHOULD ignore any <code>INVOCATION.Details.receive_progress</code> flag.<a href="#section-3.1-63" class="pilcrow">¶</a></p>
<p id="section-3.1-64">A <em>Callee</em> that supports progressive results, but does not support call canceling is considered by the <em>Dealer</em> to not support progressive results.<a href="#section-3.1-64" class="pilcrow">¶</a></p>
<p id="section-3.1-65"><strong>Timeouts</strong><a href="#section-3.1-65" class="pilcrow">¶</a></p>
<p id="section-3.1-66">When the <em>Call Timeouts</em> feature is used in combination with Progressive Call Results, the <code>CALL.Options.timeout|integer</code> option shall represent the time limit between the initial call and the first result, and between results thereafter.<a href="#section-3.1-66" class="pilcrow">¶</a></p>
<p id="section-3.1-67">For Dealer-initiated timeouts, this corresponds to
- the time between receipt of the <code>CALL</code> message and receipt of the first <code>YIELD</code> message, and,
- the time between received <code>YIELD</code> messages thereafter.<a href="#section-3.1-67" class="pilcrow">¶</a></p>
<p id="section-3.1-68">For Callee-initiated timeouts, this corresponds to
- the time between receipt of the <code>INVOCATION</code> message and acquisition of the first result, and,
- the time between acquisition of successive results thereafter.<a href="#section-3.1-68" class="pilcrow">¶</a></p>
<p id="section-3.1-69">Note that for progressive results, the timeout value does <em>not</em> correspond to the duration of the complete call from initiation to the final result. The rationale for this is that it would be unfeasible to compute a reasonable timeout value for a call having a non-deterministic number of progressive results.<a href="#section-3.1-69" class="pilcrow">¶</a></p>
</section>
</div>
<div id="rpc-progressive-call-invocations">
<section id="section-3.2">
        <h3 id="name-progressive-call-invocation">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-progressive-call-invocation" class="section-name selfRef">Progressive Call Invocations</a>
        </h3>
<p id="section-3.2-1">A <em>Caller</em> may issue a call having progressive invocations. This can be useful in a few cases:<a href="#section-3.2-1" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.2-2.1">Payload is too big to send it whole in one request, e.g., uploading a file.<a href="#section-3.2-2.1" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-3.2-2.2">Long-term data transfer that needs to be consumed early, such as a media stream.<a href="#section-3.2-2.2" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-3.2-2.3">RPC is called too often and overall processing can be optimized: avoid the need to generate a new id for requests,
initiate data structures for a new call, etc.<a href="#section-3.2-2.3" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-3.2-3">In such cases, a procedure implemented by a <em>Callee</em> and registered at a <em>Dealer</em> may be made to receive progressive call invocations,
where the <em>Callee</em> may start processing the incoming data without awaiting the entire set of payload chunks.<a href="#section-3.2-3" class="pilcrow">¶</a></p>
<p id="section-3.2-4"><strong>Feature Announcement</strong><a href="#section-3.2-4" class="pilcrow">¶</a></p>
<p id="section-3.2-5">Support for this advanced feature MUST be announced by <em>Callers</em> (<code>role := "caller"</code>), <em>Callees</em> (<code>role := "callee"</code>)
and <em>Dealers</em> (<code>role := "dealer"</code>) via<a href="#section-3.2-5" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.2-6">
<pre>    HELLO.Details.roles.&lt;role&gt;.features.progressive_call_invocations|bool := true
</pre><a href="#section-3.2-6" class="pilcrow">¶</a>
</div>
<p id="section-3.2-7">Progressive call invocations can work only if all three peers support and announce this feature.
In addition, <em>Callees</em> MUST announce support of the <em>Call Cancelling</em> feature via<a href="#section-3.2-7" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.2-8">
<pre>    HELLO.Details.roles.callee.features.call_cancelling|bool := true
</pre><a href="#section-3.2-8" class="pilcrow">¶</a>
</div>
<p id="section-3.2-9">As a consequence, <em>Dealers</em> MUST also announce support of the <em>Call Cancelling</em> feature via<a href="#section-3.2-9" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.2-10">
<pre>    WELCOME.Details.roles.dealer.features.call_cancelling|bool := true
</pre><a href="#section-3.2-10" class="pilcrow">¶</a>
</div>
<p id="section-3.2-11">The following cases, where a <em>Caller</em> sends a <code>CALL</code> message with <code>progress := true</code>, MUST be treated as <em>protocol errors</em>
with the underlying WAMP sessions being aborted:<a href="#section-3.2-11" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.2-12.1">The <em>Caller</em> did not announce the progressive call invocations feature during the <code>HELLO</code> handshake.<a href="#section-3.2-12.1" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-3.2-12.2">The <em>Dealer</em> did not announce the progressive call invocations feature during the <code>HELLO</code> handshake.<a href="#section-3.2-12.2" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-3.2-13">Otherwise, in cases where the <em>Caller</em> sends a <code>CALL</code> message with <code>progress := true</code> but the <em>Callee</em> does not support
progressive call invocations or call cancelling, the call MUST be treated as an <em>application error</em> with the <em>Dealer</em> responding
to the <em>Caller</em> with the <code>wamp.error.feature_not_supported</code> error message.<a href="#section-3.2-13" class="pilcrow">¶</a></p>
<p id="section-3.2-14"><strong>Message Flow</strong><a href="#section-3.2-14" class="pilcrow">¶</a></p>
<p id="section-3.2-15">The message flow for a progressive call when a <em>Callee</em> waits for all chunks before processing and sending a single result:<a href="#section-3.2-15" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.2-16">
<pre> ,------.                  ,------.                 ,------.
 |Caller|                  |Dealer|                 |Callee|
 `--+---'                  `--+---'                 `--+---'
    |     CALL (progress)     |                        |
    | ----------------------&gt; |                        |
    |                         | INVOCATION (progress)  |
    |                         | ----------------------&gt;|
    |     CALL (progress)     |                        |
    | -----------------------&gt;|                        |
    |                         | INVOCATION (progress)  |
    |                         | ----------------------&gt;|
    |                         |                        |
    |           ...           |          ...           |
    |                         |                        |
    |     CALL (final)        |                        |
    | -----------------------&gt;|                        |
    |                         |   INVOCATION (final)   |
    |                         | ----------------------&gt;|
    |                         |                        |
    |                         | YIELD (final) or ERROR |
    |                         | &lt;----------------------|
    |                         |                        |
    | RESULT (final) or ERROR |                        |
    | &lt;-----------------------|                        |
 ,--+---.                  ,--+---.                 ,--+---.
 |Caller|                  |Dealer|                 |Callee|
 `------'                  `------'                 `------'
</pre><a href="#section-3.2-16" class="pilcrow">¶</a>
</div>
<p id="section-3.2-17">As a <code>progressive</code> call chunks are part of the same overall call, the <em>Caller</em> must send the same <code>Request|id</code>
for every <code>CALL</code> and the <em>Dealer</em> must also use the same <code>Request|id</code> with every <code>INVOCATION</code> to the <em>Callee</em>.<a href="#section-3.2-17" class="pilcrow">¶</a></p>
<p id="section-3.2-18">A <em>Caller</em> indicates its willingness to issue a progressive call by setting<a href="#section-3.2-18" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.2-19">
<pre>    CALL.Options.progress|bool := true
</pre><a href="#section-3.2-19" class="pilcrow">¶</a>
</div>
<p id="section-3.2-20"><em>Example.</em> Caller-to-Dealer <code>CALL</code><a href="#section-3.2-20" class="pilcrow">¶</a></p>
<div class="lang-json sourcecode" id="section-3.2-21">
<pre>    [
        48,
        77245,
        {
            "progress": true
        },
        "com.myapp.get_country_by_coords",
        [50.450001, 30.523333]
    ]
</pre><a href="#section-3.2-21" class="pilcrow">¶</a>
</div>
<p id="section-3.2-22">If the <em>Callee</em> supports progressive call invocations, the <em>Dealer</em> shall forward the <em>Caller's</em> willingness to send progressive call invocations by setting<a href="#section-3.2-22" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.2-23">
<pre>    INVOCATION.Details.progress|bool := true
</pre><a href="#section-3.2-23" class="pilcrow">¶</a>
</div>
<p id="section-3.2-24"><em>Example.</em> Dealer-to-Callee <code>INVOCATION</code><a href="#section-3.2-24" class="pilcrow">¶</a></p>
<div class="lang-json sourcecode" id="section-3.2-25">
<pre>    [
        68,
        35224,
        379,
        {
            "progress": true
        },
        [50.450001, 30.523333]
    ]
</pre><a href="#section-3.2-25" class="pilcrow">¶</a>
</div>
<p id="section-3.2-26">A call invocation MUST <em>always</em> end in a <em>normal</em> <code>CALL</code> without the <code>"progress": true</code> option, or explicitly
set <code>"progress": false</code> which is the default.<a href="#section-3.2-26" class="pilcrow">¶</a></p>
<p id="section-3.2-27"><strong>Progressive Call Invocations and Shared Registration</strong><a href="#section-3.2-27" class="pilcrow">¶</a></p>
<p id="section-3.2-28">RPCs can have a multiple registrations (see <code>Shared Registration</code> feature) with different <code>&lt;invocation_policies&gt;</code>.
However, allowing progressive <code>CALL</code> messages to be routed to different <em>Callees</em> would lead to unexpected results.
To prevent this the <em>Dealer</em> MUST make a first <code>INVOCATION</code> based on <code>&lt;invocation_policy&gt;</code> and then route all
subsequent <code>progressive</code> calls to the same <em>Callee</em>.<a href="#section-3.2-28" class="pilcrow">¶</a></p>
<p id="section-3.2-29"><strong>Caller Leaving</strong><a href="#section-3.2-29" class="pilcrow">¶</a></p>
<p id="section-3.2-30">The <em>Dealer</em>'s behavior for when a <em>Caller</em> leaves or disconnects during a call with progressive invocations shall be the same as in a basic, non-progressive call. That is, the <em>Dealer</em> sends an INTERRUPT to the <em>Callee</em> with <code>mode="killnowait"</code>. See <a href="#rpc-caller-leaving">Caller Leaving During RPC Invocation</a> under the Basic Profile.<a href="#section-3.2-30" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.2-31">
<pre> ,------.            ,------.                 ,------.
 |Caller|            |Dealer|                 |Callee|
 `--+---'            `--+---'                 `--+---'
    |  CALL (progress)  |                        |
    | -----------------&gt;|                        |
    |                   | INVOCATION (progress)  |
    |                   | ----------------------&gt;|
    |  CALL (progress)  |                        |
    | -----------------&gt;|                        |
    |                   | INVOCATION (progress)  |
    |                   | ----------------------&gt;|
 ,--+---.               |                        |
 |Caller|               |                        |
 `------'               |                        |
  (gone)                |                        |
                        |       INTERRUPT        |
                        | ----------------------&gt;|
                        |                        |
                     ,--+---.                 ,--+---.
                     |Dealer|                 |Callee|
                     `------'                 `------'
</pre><a href="#section-3.2-31" class="pilcrow">¶</a>
</div>
<p id="section-3.2-32">As in progressive call results, such cancellation when the caller leaves addresses a potential security vulnerability:
In cases where progressive call invocations are used to stream data from a <em>Caller</em>, and network connectivity is unreliable,
the <em>Caller</em> may often get disconnected in the middle of sending progressive data. This can lead to unneeded memory
consumption for the <em>Dealer</em> and <em>Callee</em>, due to the need to store temporary metadata about ongoing calls.<a href="#section-3.2-32" class="pilcrow">¶</a></p>
<p id="section-3.2-33"><strong>Callee Leaving</strong><a href="#section-3.2-33" class="pilcrow">¶</a></p>
<p id="section-3.2-34">The <em>Dealer</em>'s behavior for when a <em>Callee</em> leaves or disconnects during a call with progressive invocations shall be the same as in a basic, non-progressive call. That is, the <em>Dealer</em> sends an ERROR message to the <em>Caller</em> with the <code>wamp.error.canceled</code> URI. See <a href="#rpc-callee-leaving">Callee Leaving During an RPC Invocation</a> under the Basic Profile.<a href="#section-3.2-34" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.2-35">
<pre> ,------.           ,------.                ,------.
 |Caller|           |Dealer|                |Callee|
 `--+---'           `--+---'                `--+---'
    |  CALL (progress) |                       |
    | -----------------&gt;                       |
    |                  | INVOCATION (progress) |
    |                  | ----------------------&gt;
    |                  |                       |
    |                  |                       |
    |                  |                    ,--+---.
    |                  |                    |Callee|
    |      ERROR       |                    `------'
    | &lt;--------------- |                     (gone)
    |                  |
 ,--+---.           ,--+---.
 |Caller|           |Dealer|
 `------'           `------'
</pre><a href="#section-3.2-35" class="pilcrow">¶</a>
</div>
<p id="section-3.2-36"><strong>Continuations on Completed Calls</strong><a href="#section-3.2-36" class="pilcrow">¶</a></p>
<p id="section-3.2-37">A call with progressive invocations is considered completed by the <em>Dealer</em> when the latter receives a correlated final YIELD or ERROR message from the <em>Callee</em>, or when the <em>Callee</em> leaves the realm.<a href="#section-3.2-37" class="pilcrow">¶</a></p>
<p id="section-3.2-38">Due to network delays, the <em>Caller</em> may be unaware that the call is completed by time it sends another progressive CALL continuation.<a href="#section-3.2-38" class="pilcrow">¶</a></p>
<p id="section-3.2-39">When a <em>Dealer</em> receives a CALL under the following conditions:<a href="#section-3.2-39" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.2-40.1">the <em>Dealer</em> supports Progressive Call Invocations,<a href="#section-3.2-40.1" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-3.2-40.2">the CALL request ID does not correspond to a new call request, and,<a href="#section-3.2-40.2" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-3.2-40.3">the CALL request ID does not match any RPC invocation in progress,<a href="#section-3.2-40.3" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-3.2-41">then it MUST ignore and discard that CALL message without any further correlated response to the <em>Caller</em>. The rationale for this is that the <em>Caller</em> will eventually receive a correlated RESULT or ERROR message from the previous call completion and will be able to handle the call completion accordingly.<a href="#section-3.2-41" class="pilcrow">¶</a></p>
<p id="section-3.2-42">The sequence diagram below illustrates this sitation, where the Network actor models network delay.<a href="#section-3.2-42" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.2-43">
<pre> ,------.     ,-------.      ,------.      ,------.
 |Caller|     |Network|      |Dealer|      |Callee|
 `--+---'     `---+---'      `--+---'      `--+---'
    |  CALL #123  |             |             |
    | (progress)  |             |             |
    | ------------&gt;  CALL #123  |             |
    |             | (progress)  |             |
    |             | ------------&gt;  INVOCATION |
    |             |             |  (progress) |
    |             |             | ------------&gt;
    |  CALL #123  |             |             |
    | (progress)  |             |    ERROR    |
    | ------------&gt;             | &lt;-----------|
    |             |    ERROR    |             |
    |             | &lt;-----------|             |
    |             | ,---------. |             |
    |             | |  Call   | |             |
    |             | |Completed| |             |
    |             | `---------' |             |
    |             |             |             |
    |             |  CALL #123  |             |
    |             | (progress)  |             |
    |             | ------------&gt;             |
    |             | ,---------. |             |
    |             | | Ignored | |             |
    |             | `---------' |             |
    |    ERROR    |             |             |
    | &lt;-----------|             |             |
    |             |             |             |
 ,--+---.     ,---+---.      ,--+---.    ,--+---.
 |Caller|     |Network|      |Dealer|    |Callee|
 `------'     `-------'      `------'    `------'
</pre><a href="#section-3.2-43" class="pilcrow">¶</a>
</div>
<p id="section-3.2-44">From the <em>Callee</em>'s perspective, a call with progressive invocations is considered completed when the <em>Callee</em> sends a correlated final YIELD or ERROR message.<a href="#section-3.2-44" class="pilcrow">¶</a></p>
<p id="section-3.2-45">Due to network delays, the <em>Dealer</em> may be unaware that the call is completed by time it sends another progressive INVOCATION.<a href="#section-3.2-45" class="pilcrow">¶</a></p>
<p id="section-3.2-46">When a <em>Callee</em> receives an INVOCATION under the following conditions:<a href="#section-3.2-46" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.2-47.1">the <em>Callee</em> supports Progressive Call Invocations,<a href="#section-3.2-47.1" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-3.2-47.2">the INVOCATION request ID does not correspond to a new call request, and,<a href="#section-3.2-47.2" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-3.2-47.3">the INVOCATION request ID does not match any RPC invocation in progress,<a href="#section-3.2-47.3" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-3.2-48">then it MUST ignore and discard that INVOCATION message without any further correlated response to the <em>Dealer</em>. The rationale for this is that the <em>Dealer</em> will eventually receive a correlated YIELD or ERROR message from the <em>Callee</em> and then send a correlated RESULT or ERROR message to the <em>Caller</em>, thus the <em>Caller</em> and the <em>Dealer</em> will both be able to handle the call completion accordingly.<a href="#section-3.2-48" class="pilcrow">¶</a></p>
<p id="section-3.2-49">The sequence diagram below illustrates this sitation, where the Network actor models network delay.<a href="#section-3.2-49" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.2-50">
<pre> ,------.     ,------.        ,-------.         ,------.
 |Caller|     |Dealer|        |Network|         |Callee|
 `--+---'     `--+---'        `---+---'         `--+---'
    | CALL #123  |                |                |
    | (progres)  |                |                |
    | -----------&gt;                |                |
    |            | INVOCATION #42 |                |
    |            | (progress)     |                |
    |            | ---------------&gt;                |
    |            |                | INVOCATION #42 |
    |            |                | (progress)     |
    |            |                | ---------------&gt;
    | CALL #123  |                |                |
    | (progress) |                |     ERROR      |
    | -----------&gt;                | &lt;--------------|
    |            | INVOCATION #42 |                |
    |            | (progress)     |                |
    |            | ---------------&gt;                |
    |            |                | INVOCATION #42 |
    |            |                | (progress)     |
    |            |     ERROR      | ---------------&gt;
    |            | &lt;--------------|   ,-------.    |
    |    ERROR   |                |   |Ignored|    |
    | &lt;----------|                |   `---+---'    |
    |            |                |                |
 ,--+---.     ,--+---.        ,---+---.       ,--+---.
 |Caller|     |Dealer|        |Network|       |Callee|
 `------'     `------'        `-------'       `------'
</pre><a href="#section-3.2-50" class="pilcrow">¶</a>
</div>
<p id="section-3.2-51"><strong>Verification of CALL Request IDs</strong><a href="#section-3.2-51" class="pilcrow">¶</a></p>
<p id="section-3.2-52">When sending a CALL that continues a progressive call, its request ID is the same as the CALL that initiated the progressive call invocation. Therefore, when progressive call invocations are enabled, request IDs from CALL messages may not appear sequential. For example:<a href="#section-3.2-52" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="compact type-1" id="section-3.2-53">
<li id="section-3.2-53.1">
            <code>[CALL, 1, {"progress":true}, "foo"]</code><a href="#section-3.2-53.1" class="pilcrow">¶</a>
</li>
          <li id="section-3.2-53.2">
            <code>[CALL, 2, {}, "bar"]</code><a href="#section-3.2-53.2" class="pilcrow">¶</a>
</li>
          <li id="section-3.2-53.3">
            <code>[CALL, 1, {}, "foo"]</code> (OK, continues CALL request #1)<a href="#section-3.2-53.3" class="pilcrow">¶</a>
</li>
        </ol>
<p id="section-3.2-54">The requirement for CALL request IDs to be sequential session scope (see <a href="#protocol_errors">Protocol Violations</a>) must therefore only apply to <strong>new</strong> RPC transactions:<a href="#section-3.2-54" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="compact type-1" id="section-3.2-55">
<li id="section-3.2-55.1">
            <code>[CALL, 1, {"progress":true}, "foo"]</code><a href="#section-3.2-55.1" class="pilcrow">¶</a>
</li>
          <li id="section-3.2-55.2">
            <code>[CALL, 2, {}, "bar"]</code><a href="#section-3.2-55.2" class="pilcrow">¶</a>
</li>
          <li id="section-3.2-55.3">
            <code>[CALL, 4, {}, "baz"]</code> (protocol violation, request ID 3 expected)<a href="#section-3.2-55.3" class="pilcrow">¶</a>
</li>
        </ol>
<p id="section-3.2-56">Let us define <em>watermark</em> as the maximum valid request ID of all received CALL messages during a <em>Dealer</em>'s run time.<a href="#section-3.2-56" class="pilcrow">¶</a></p>
<p id="section-3.2-57">Let us also define <em>continuation candiate</em> as a CALL with a request ID that is equal to or less than the <em>watermark</em>.<a href="#section-3.2-57" class="pilcrow">¶</a></p>
<p id="section-3.2-58">When a <em>Dealer</em> receives a CALL with a request ID that is exactly one above the watermark, then it shall be considered a new RPC transaction, and the requirement for sequential session scope IDs is verified.<a href="#section-3.2-58" class="pilcrow">¶</a></p>
<p id="section-3.2-59">When a <em>Dealer</em> receives a CALL with a request ID that is greater than one above the watermark, then this corresponds to a gap in the session scope ID sequence and MUST always be treated as a protocol violation.<a href="#section-3.2-59" class="pilcrow">¶</a></p>
<p id="section-3.2-60">When a <em>Dealer</em> receives a CALL with a request ID that is equal to or less than the watermark, then it is considered as a <em>continuation candidate</em> for a progressive invocation transfer.<a href="#section-3.2-60" class="pilcrow">¶</a></p>
<p id="section-3.2-61">As discussed in the previous section, a <em>Caller</em> may be unaware that a progressive invocation transfer is completed while sending a CALL continuation for that progressive invocation. Therefore, the <em>Dealer</em> cannot simply just check against progressive transfers in progress when verifying the validity of continuation candidates. It must also consider past progressive transfers that have been completed.<a href="#section-3.2-61" class="pilcrow">¶</a></p>
<p id="section-3.2-62">In order to validate the request ID of continuation candidates, it is suggested that a <em>Dealer</em> maintain a table of request IDs of completed progressive invocation transfers, where each entry is kept for a limited <em>grace period</em>. When a <em>Dealer</em> receives a continuation candidate with a request ID that is not in that table, nor in the list of active progressive invocations, then it is considered a protocol violation. Care must be taken in choosing the grace period: too short and data races can occur with slow networks, too long and memory usage of the table may become excessive when frequent progressive calls are made.<a href="#section-3.2-62" class="pilcrow">¶</a></p>
<p id="section-3.2-63">Due to resource constraints, it may not be desireable to implement such a grace period table, so <em>Dealers</em> MAY instead discard continuation candidates with request IDs that cannot be found in the list of active progressive invocation transfers.<a href="#section-3.2-63" class="pilcrow">¶</a></p>
<p id="section-3.2-64">The following pseudocode summarizes the algorithm for verifying CALL request IDs when progressive call invocations are enabled:<a href="#section-3.2-64" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.2-65">
<pre>if (request_id == watermark + 1)
    watermark = watermak + 1
    initiate_new_call()
else if (request_id &gt; watermark + 1)
    // Gap in request IDs
    abort_session("wamp.error.protocol_violation")
else
    // Continuation candidate
    if (active_call_records.contains(request_id, procedure_uri))
        record = active_call_records.at(request_id)
        if (record.is_progressive_invocation_call())
            continue_call()
        else
            abort_session("wamp.error.protocol_violation")
        endif
    else if (strict_request_id_verification_enabled)
        if (grace_period_table.contains(request_id, procedure_uri))
            discard_call()
        else
            abort_session("wamp.error.protocol_violation")
        endif
    else
        discard_call()
    endif
endif
</pre><a href="#section-3.2-65" class="pilcrow">¶</a>
</div>
<p id="section-3.2-66"><strong>Ignoring Progressive Call Invocations</strong><a href="#section-3.2-66" class="pilcrow">¶</a></p>
<p id="section-3.2-67">Unlike some other advanced features, a <em>Callee</em> cannot be unaware of progressive call invocations.
Therefore, if a <em>Callee</em> doesn't support this feature, the <em>Dealer</em> MUST respond to the <em>Caller</em> with an
<code>wamp.error.feature_not_supported</code> error message.<a href="#section-3.2-67" class="pilcrow">¶</a></p>
<p id="section-3.2-68">A <em>Callee</em> that supports progressive call invocations, but does not support call canceling, shall be considered by the <em>Dealer</em>
as not supporting progressive call invocations.<a href="#section-3.2-68" class="pilcrow">¶</a></p>
<p id="section-3.2-69"><strong>Progressive Call Invocations with Progressive Call Results</strong><a href="#section-3.2-69" class="pilcrow">¶</a></p>
<p id="section-3.2-70"><em>Progressive Call Invocations</em> may be used in conjunction with <em>Progressive Call Results</em> if the <em>Caller</em>, <em>Dealer</em>, and <em>Callee</em> all support both features. This allows the <em>Callee</em> to start sending partial results back to the <em>Caller</em> after receiving one or more initial payload chunks. Efficient two-way streams between a <em>Caller</em> and <em>Callee</em> can be implemented this way.<a href="#section-3.2-70" class="pilcrow">¶</a></p>
<p id="section-3.2-71">The following message flow illustrates a call using progressive call invocations when a <em>Callee</em> starts sending progressive call
results immediately. Note that <code>YIELD</code> messages don't need to be matched with <code>CALL</code>/<code>INVOCATION</code> messages.
For example, the <em>caller</em> can send a few <code>CALL</code> messages before starting to receive <code>RESULT</code> messages; they do not need
to be matched pairs.<a href="#section-3.2-71" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.2-72">
<pre> ,------.                  ,------.                 ,------.
 |Caller|                  |Dealer|                 |Callee|
 `--+---'                  `--+---'                 `--+---'
    |     CALL (progress)     |                        |
    |------------------------&gt;|                        |
    |                         | INVOCATION (progress)  |
    |                         |-----------------------&gt;|
    |                         |                        |
    |                         |   YIELD (progress)     |
    |                         |&lt;-----------------------|
    |                         |                        |
    |   RESULT (progress)     |                        |
    |&lt;------------------------|                        |
    |                         |                        |
    |    CALL (progress)      |                        |
    |------------------------&gt;|                        |
    |                         | INVOCATION (progress)  |
    |                         |-----------------------&gt;|
    |                         |                        |
    |    CALL (progress)      |                        |
    |------------------------&gt;|                        |
    |                         | INVOCATION (progress)  |
    |                         |-----------------------&gt;|
    |                         |    YIELD (progress)    |
    |                         |&lt;-----------------------|
    |                         |                        |
    |   RESULT (progress)     |                        |
    |&lt;------------------------|                        |
    |                         |                        |
    |                         |    YIELD (progress)    |
    |                         |&lt;-----------------------|
    |                         |                        |
    |   RESULT (progress)     |                        |
    |&lt;------------------------|                        |
    |                         |                        |
    |          ...            |          ...           |
    |                         |                        |
    |      CALL (final)       |                        |
    |------------------------&gt;|                        |
    |                         |   INVOCATION (final)   |
    |                         |-----------------------&gt;|
    |                         |                        |
    |                         | YIELD (final) or ERROR |
    |                         |&lt;-----------------------|
    |                         |                        |
    | RESULT (final) or ERROR |                        |
    |&lt;------------------------|                        |
 ,--+---.                  ,--+---.                 ,--+---.
 |Caller|                  |Dealer|                 |Callee|
 `------'                  `------'                 `------'
</pre><a href="#section-3.2-72" class="pilcrow">¶</a>
</div>
<p id="section-3.2-73">Because they are part of the same call operation, the request ID is the same in all <code>CALL</code>,
<code>INVOCATION</code>, <code>YIELD</code>, and <code>ERROR</code> messages in the above exchange.<a href="#section-3.2-73" class="pilcrow">¶</a></p>
<p id="section-3.2-74"><strong>Freezing of Options in Progressive Call Invocations</strong><a href="#section-3.2-74" class="pilcrow">¶</a></p>
<p id="section-3.2-75">Except for <code>progress</code>, items in the <code>Options</code> dictionary of the <strong>initiating</strong> progressive <code>CALL</code> shall be effective for
the entirety of the progressive call request. Only the <code>progress</code> option shall be considered by the <em>Dealer</em> in subsequent progressive call invocations
(within the same overall request). Except for <code>progress</code>, items in the <code>Details</code>
dictionary of corresponding <code>INVOCATION</code> messages shall be based on the initiating progressive <code>CALL</code> only.<a href="#section-3.2-75" class="pilcrow">¶</a></p>
<p id="section-3.2-76">For example, if <code>disclose_me=true</code> was specified in the initiating progressive call, all subsequent progressive call invocations
(within the same call) shall be considered by the <em>Dealer</em> to implictly have <code>disclose_me=true</code> as well. That is, all
<code>INVOCATION</code> messages associated with the overall request shall contain caller identify information.<a href="#section-3.2-76" class="pilcrow">¶</a></p>
<p id="section-3.2-77">Any option besides <code>progress</code> SHOULD be omitted altogether by the <em>Caller</em> in subsequent progressive call invocations. Not having to repeat (and not being able to change) options is more in tune with the concept of a media stream where options are set up initially, and the source (<em>Caller</em>) only needs to keep uploading more data thereafter.<a href="#section-3.2-77" class="pilcrow">¶</a></p>
<p id="section-3.2-78">In subsequent call invocations:<a href="#section-3.2-78" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.2-79.1">
            <em>Dealers</em> and <em>Callees</em> MUST ignore any option except for <code>progress</code><a href="#section-3.2-79.1" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-3.2-79.2">
            <em>Dealers</em> SHOULD NOT propagate any option passed by the <em>Caller</em>, except for <code>progress</code><a href="#section-3.2-79.2" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-3.2-80"><em>Dealers</em> and <em>Callees</em> are responsible for remembering the options of the initiating progressive <code>CALL</code>.<a href="#section-3.2-80" class="pilcrow">¶</a></p>
<p id="section-3.2-81">For reference, here is a list of options that are frozen upon the initial progressive call invocations:<a href="#section-3.2-81" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.2-82.1">
            <code>CALL.Options.disclose_me|bool</code><a href="#section-3.2-82.1" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-3.2-82.2">
            <code>CALL.Options.ppt_cipher|string</code><a href="#section-3.2-82.2" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-3.2-82.3">
            <code>CALL.Options.ppt_keyid|string</code><a href="#section-3.2-82.3" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-3.2-82.4">
            <code>CALL.Options.ppt_scheme|string</code><a href="#section-3.2-82.4" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-3.2-82.5">
            <code>CALL.Options.ppt_serializer|string</code><a href="#section-3.2-82.5" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-3.2-82.6">
            <code>CALL.Options.receive_progress|bool</code><a href="#section-3.2-82.6" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-3.2-82.7">
            <code>CALL.Options.rkey</code><a href="#section-3.2-82.7" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-3.2-82.8">
            <code>CALL.Options.runmode|string</code><a href="#section-3.2-82.8" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-3.2-82.9">
            <code>CALL.Options.timeout|integer</code><a href="#section-3.2-82.9" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-3.2-83">These rules concerning progressive call invocation options also apply to custom options that are not part of this specification.<a href="#section-3.2-83" class="pilcrow">¶</a></p>
</section>
</div>
<div id="rpc-call-timeout">
<section id="section-3.3">
        <h3 id="name-call-timeouts">
<a href="#section-3.3" class="section-number selfRef">3.3. </a><a href="#name-call-timeouts" class="section-name selfRef">Call Timeouts</a>
        </h3>
<p id="section-3.3-1">The Call Timeouts feature allows for <strong>automatic</strong> cancellation of a remote procedure call by the <em>Dealer</em> or <em>Callee</em> after a specified time duration.<a href="#section-3.3-1" class="pilcrow">¶</a></p>
<p id="section-3.3-2">A <em>Caller</em> specifies a timeout by providing<a href="#section-3.3-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.3-3">
<pre>    CALL.Options.timeout|integer
</pre><a href="#section-3.3-3" class="pilcrow">¶</a>
</div>
<p id="section-3.3-4">in milliseconds. Automatic call timeouts are deactivated if there is no <code>timeout</code> option, or if its value is <code>0</code>.<a href="#section-3.3-4" class="pilcrow">¶</a></p>
<p id="section-3.3-5"><strong>Dealer-Initiated Timeouts</strong><a href="#section-3.3-5" class="pilcrow">¶</a></p>
<p id="section-3.3-6">If the <em>Callee</em> does not support Call Timeouts, a <em>Dealer</em> supporting this feature MUST start a timeout timer upon receiving a <code>CALL</code> message with a <code>timeout</code> option. The message flow for call timeouts is identical to Call Canceling, except that there is no <code>CANCEL</code> message that originates from the <em>Caller</em>. The cancellation mode is implicitly <code>killnowait</code> if the <em>Callee</em> supports call cancellation, otherwise the cancellation mode is <code>skip</code>.<a href="#section-3.3-6" class="pilcrow">¶</a></p>
<p id="section-3.3-7">The error message that is returned to the <em>Caller</em> MUST use <code>wamp.error.timeout</code> as the reason URI.<a href="#section-3.3-7" class="pilcrow">¶</a></p>
<p id="section-3.3-8"><strong>Callee-Initiated Timeouts</strong><a href="#section-3.3-8" class="pilcrow">¶</a></p>
<p id="section-3.3-9">If the <em>Callee</em> supports Call Timeouts, the <em>Dealer</em> MAY propagate the <code>CALL.Options.timeout|integer</code> option via the <code>INVOCATION</code> message and allow the <em>Callee</em> to handle the timeout logic. If the operation times out, the <em>Callee</em> MUST return an <code>ERROR</code> message with <code>wamp.error.timeout</code> as the reason URI.<a href="#section-3.3-9" class="pilcrow">¶</a></p>
<p id="section-3.3-10"><em>Callees</em> wanting to handle the timeout logic MAY specify this intention via the <code>REGISTER.Options.forward_timeout|boolean</code> option. The <em>Dealer</em>, upon receiving a CALL with the <code>timeout</code> option set, checks if the matching RPC registration had the <code>forward_timeout</code> option set, then accordingly either forwards the timeout value or handles the timeout logic locally without forwarding the timeout value.<a href="#section-3.3-10" class="pilcrow">¶</a></p>
<p id="section-3.3-11"><em>Dealers</em> MAY choose to override the <code>REGISTER.Options.forward_timeout|boolean</code> option based on router configuration. For example, if a <em>Dealer</em> is resource-constrained and does not wish to maintain a queue of pending call timeouts, it may decide to always forward the CALL timeout option to <em>Callees</em>.<a href="#section-3.3-11" class="pilcrow">¶</a></p>
<p id="section-3.3-12"><strong>Caller-Initiated Timeouts</strong><a href="#section-3.3-12" class="pilcrow">¶</a></p>
<p id="section-3.3-13"><em>Callers</em> may run their own timeout timer and send a <code>CANCEL</code> message upon timeout. This is permitted if the <em>Dealer</em> supports Call Canceling and is not considered to be a usage of the Call Timeouts feature.<a href="#section-3.3-13" class="pilcrow">¶</a></p>
<p id="section-3.3-14"><strong>Feature Announcement</strong><a href="#section-3.3-14" class="pilcrow">¶</a></p>
<p id="section-3.3-15">Support for this feature MUST be announced by <em>Dealers</em> (<code>role := "dealer"</code>) and MAY be announced by <em>Callees</em> (<code>role := "callee"</code>) via<a href="#section-3.3-15" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.3-16">
<pre>    HELLO.Details.roles.&lt;role&gt;.features.call_timeout|bool := true
</pre><a href="#section-3.3-16" class="pilcrow">¶</a>
</div>
<p id="section-3.3-17">If a <em>Callee</em> does not support Call Timeouts, it may optionally announce support for Call Cancellation via<a href="#section-3.3-17" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.3-18">
<pre>    HELLO.Details.roles.&lt;role&gt;.features.call_canceling|bool := true
</pre><a href="#section-3.3-18" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="rpc-call-canceling">
<section id="section-3.4">
        <h3 id="name-call-canceling">
<a href="#section-3.4" class="section-number selfRef">3.4. </a><a href="#name-call-canceling" class="section-name selfRef">Call Canceling</a>
        </h3>
<p id="section-3.4-1">A <em>Caller</em> might want to actively cancel a call that was issued, but not has yet returned. An example where this is useful could be a user triggering a long running operation and later changing his mind or no longer willing to wait.<a href="#section-3.4-1" class="pilcrow">¶</a></p>
<p id="section-3.4-2"><strong>Feature Announcement</strong><a href="#section-3.4-2" class="pilcrow">¶</a></p>
<p id="section-3.4-3">Support for this feature MUST be announced by <em>Callers</em> (<code>role := "caller"</code>), <em>Callees</em> (<code>role := "callee"</code>) and <em>Dealers</em> (<code>role := "dealer"</code>) via<a href="#section-3.4-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.4-4">
<pre>    HELLO.Details.roles.&lt;role&gt;.features.call_canceling|bool := true
</pre><a href="#section-3.4-4" class="pilcrow">¶</a>
</div>
<p id="section-3.4-5"><strong>Message Flow</strong><a href="#section-3.4-5" class="pilcrow">¶</a></p>
<p id="section-3.4-6">The message flow between <em>Callers</em>, a <em>Dealer</em> and <em>Callees</em> for canceling remote procedure calls involves the following messages:<a href="#section-3.4-6" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.4-7.1">
            <code>CANCEL</code><a href="#section-3.4-7.1" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-3.4-7.2">
            <code>INTERRUPT</code><a href="#section-3.4-7.2" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-3.4-7.3">
            <code>ERROR</code><a href="#section-3.4-7.3" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-3.4-8">A call may be canceled at the <em>Callee</em> or at the <em>Dealer</em> side. Cancellation behaves differently depending on the mode:<a href="#section-3.4-8" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.4-9.1">
            <strong>skip</strong>: The pending call is canceled and <code>ERROR</code> is sent immediately back to the caller. No <code>INTERRUPT</code> is sent to the callee and the result is discarded when received.<a href="#section-3.4-9.1" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-3.4-9.2">
            <strong>kill</strong>: <code>INTERRUPT</code> is sent to the callee, but <code>ERROR</code> is not returned to the caller until after the callee has responded to the canceled call. In this case the caller may receive <code>RESULT</code> or <code>ERROR</code> depending whether the callee finishes processing the invocation or the interrupt first.<a href="#section-3.4-9.2" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-3.4-9.3">
            <strong>killnowait</strong>: The pending call is canceled and <code>ERROR</code> is sent immediately back to the caller. <code>INTERRUPT</code> is sent to the callee and any response to the invocation or interrupt from the callee is discarded when received.<a href="#section-3.4-9.3" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-3.4-10">If the callee does not support call canceling, then behavior is <strong>skip</strong>.<a href="#section-3.4-10" class="pilcrow">¶</a></p>
<p id="section-3.4-11">Message flow during call canceling when <em>Callee</em> supports this feature and mode is <code>kill</code><a href="#section-3.4-11" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.4-12">
<pre>    ,------.          ,------.          ,------.
    |Caller|          |Dealer|          |Callee|
    `--+---'          `--+---'          `--+---'
       |       CALL      |                 |
       | ----------------&gt;                 |
       |                 |                 |
       |                 |    INVOCATION   |
       |                 | ----------------&gt;
       |                 |                 |
       |      CANCEL     |                 |
       | ----------------&gt;                 |
       |                 |                 |
       |                 |    INTERRUPT    |
       |                 | ----------------&gt;
       |                 |                 |
       |                 |      ERROR      |
       |                 | &lt;----------------
       |                 |                 |
       |      ERROR      |                 |
       | &lt;----------------                 |
    ,--+---.          ,--+---.          ,--+---.
    |Caller|          |Dealer|          |Callee|
    `------'          `------'          `------'
</pre><a href="#section-3.4-12" class="pilcrow">¶</a>
</div>
<p id="section-3.4-13">Message flow during call canceling when <em>Callee</em> does not support this feature or mode is <code>skip</code><a href="#section-3.4-13" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.4-14">
<pre>    ,------.          ,------.            ,------.
    |Caller|          |Dealer|            |Callee|
    `--+---'          `--+---'            `--+---'
       |       CALL      |                   |
       | ----------------&gt;                   |
       |                 |                   |
       |                 |    INVOCATION     |
       |                 | ----------------&gt; |
       |                 |                   |
       |      CANCEL     |                   |
       | ----------------&gt;                   |
       |                 |                   |
       |      ERROR      |                   |
       | &lt;----------------                   |
       |                 |                   |
       |                 | RESULT (skipped)  |
       |                 | &lt;---------------- |
       |                 |                   |
       |                 | or ERROR (skipped)|
       |                 | &lt;-----------------
    ,--+---.          ,--+---.            ,--+---.
    |Caller|          |Dealer|            |Callee|
    `------'          `------'            `------'
</pre><a href="#section-3.4-14" class="pilcrow">¶</a>
</div>
<p id="section-3.4-15">Message flow during call canceling when <em>Callee</em> supports this feature and mode is <code>killnowait</code><a href="#section-3.4-15" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.4-16">
<pre>    ,------.          ,------.          ,------.
    |Caller|          |Dealer|          |Callee|
    `--+---'          `--+---'          `--+---'
       |       CALL      |                 |
       | ----------------&gt;                 |
       |                 |                 |
       |                 |    INVOCATION   |
       |                 | ----------------&gt;
       |                 |                 |
       |      CANCEL     |                 |
       | ----------------&gt;                 |
       |                 |                 |
       |      ERROR      |                 |
       | &lt;----------------                 |
       |                 |    INTERRUPT    |
       |                 | ----------------&gt;
       |                 |                 |
    ,--+---.          ,--+---.          ,--+---.
    |Caller|          |Dealer|          |Callee|
    `------'          `------'          `------'
</pre><a href="#section-3.4-16" class="pilcrow">¶</a>
</div>
<p id="section-3.4-17">A <em>Caller</em> cancels a remote procedure call initiated (but not yet finished) by sending a <code>CANCEL</code> message to the <em>Dealer</em>:<a href="#section-3.4-17" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.4-18">
<pre>    [CANCEL, CALL.Request|id, Options|dict]
</pre><a href="#section-3.4-18" class="pilcrow">¶</a>
</div>
<p id="section-3.4-19">A <em>Dealer</em> cancels an invocation of an endpoint initiated (but not yet finished) by sending a <code>INTERRUPT</code> message to the <em>Callee</em>:<a href="#section-3.4-19" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.4-20">
<pre>    [INTERRUPT, INVOCATION.Request|id, Options|dict]
</pre><a href="#section-3.4-20" class="pilcrow">¶</a>
</div>
<p id="section-3.4-21">Options:<a href="#section-3.4-21" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.4-22">
<pre>    CANCEL.Options.mode|string == "skip" | "kill" | "killnowait"
</pre><a href="#section-3.4-22" class="pilcrow">¶</a>
</div>
<p id="section-3.4-23"><strong>Ignoring Results after Cancel</strong><a href="#section-3.4-23" class="pilcrow">¶</a></p>
<p id="section-3.4-24">After the <em>Dealer</em> sends an <code>INTERRUPT</code> when mode="killnowait", any responses from the <em>Callee</em> are ignored.  This means that it is not necessary for the <em>Callee</em> to respond with an <code>ERROR</code> message, when mode="killnowait", since the <em>Dealer</em> ignores it.<a href="#section-3.4-24" class="pilcrow">¶</a></p>
</section>
</div>
<div id="rpc-call-rerouting">
<section id="section-3.5">
        <h3 id="name-call-re-routing">
<a href="#section-3.5" class="section-number selfRef">3.5. </a><a href="#name-call-re-routing" class="section-name selfRef">Call Re-Routing</a>
        </h3>
<p id="section-3.5-1">A <em>CALLEE</em> might not be able to attend to a call. This may be due to a multitude of reasons including, but not limited to:<a href="#section-3.5-1" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.5-2.1">
            <em>CALLEE</em> is busy handling other requests and is not able to attend<a href="#section-3.5-2.1" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-3.5-2.2">
            <em>CALLEE</em> has dependency issues which prevent it from being able to fulfil the request<a href="#section-3.5-2.2" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-3.5-2.3">In a HA environment, the <em>Callee</em> knows that it is scheduled to be taken off the HA cluster and as such should not handle the request.<a href="#section-3.5-2.3" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-3.5-3">A <em>unavailable</em> response allows for <strong>automatic</strong> reroute of a call by the <em>Dealer</em> without the <em>CALLER</em> ever having to know about it.<a href="#section-3.5-3" class="pilcrow">¶</a></p>
<p id="section-3.5-4">When such a situation occurs, the <em>Callee</em> responds to a <code>INVOCATION</code> message with the error uri:<a href="#section-3.5-4" class="pilcrow">¶</a></p>
<p id="section-3.5-5">wamp.error.unavailable<a href="#section-3.5-5" class="pilcrow">¶</a></p>
<p id="section-3.5-6">When the <em>Dealer</em> receives the <code>wamp.error.unavailable</code> message in response to an <code>INVOCATION</code>, it will reroute the <code>CALL</code> to another <em>registration</em> according to the rerouting rules of the <code>invocation_policy</code> of the <code>procedure</code>, as given below.<a href="#section-3.5-6" class="pilcrow">¶</a></p>
<p id="section-3.5-7"><strong>Feature Announcement</strong><a href="#section-3.5-7" class="pilcrow">¶</a></p>
<p id="section-3.5-8">Support for this feature MUST be announced by <em>Callees</em> (<code>role := "callee"</code>) and <em>Dealers</em> (<code>role := "dealer"</code>) via<a href="#section-3.5-8" class="pilcrow">¶</a></p>
<p id="section-3.5-9">HELLO.Details.roles.&lt;role&gt;.features.call_reroute|bool := true<a href="#section-3.5-9" class="pilcrow">¶</a></p>
<p id="section-3.5-10"><strong>Rerouting Rules</strong><a href="#section-3.5-10" class="pilcrow">¶</a></p>
<p id="section-3.5-11">The <em>Dealer</em> MUST adhere to the <code>invocation policy</code> of the <code>procedure</code> when rerouting the <code>CALL</code>, while assuming that the <code>unavailable</code> registration virtually does not exist.<a href="#section-3.5-11" class="pilcrow">¶</a></p>
<p id="section-3.5-12">For different <code>invocation policy</code> the <em>Dealer</em> MUST follow:<a href="#section-3.5-12" class="pilcrow">¶</a></p>
<table class="center" id="table-6">
          <caption><a href="#table-6" class="selfRef">Table 6</a></caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">Invocation Policy</th>
              <th class="text-left" rowspan="1" colspan="1">Operation</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">
                <code>single</code>
</td>
              <td class="text-left" rowspan="1" colspan="1">Responds with a <code>wamp.error.no_available_callee</code> error message to the <em>CALLER</em>
</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">
                <code>roundrobin</code>
</td>
              <td class="text-left" rowspan="1" colspan="1">Picks the next <code>registration</code> from the <em>Registration Queue</em> of the <em>Procedure</em>
</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">
                <code>random</code>
</td>
              <td class="text-left" rowspan="1" colspan="1">Picks another <code>registration</code> at random from the Registration Queue of the <em>Procedure</em>, as long as it is not the same <code>registration</code>
</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">
                <code>first</code>
</td>
              <td class="text-left" rowspan="1" colspan="1">Picks the <code>registration</code> which was registered after the <em>called</em> registration was registered</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">
                <code>last</code>
</td>
              <td class="text-left" rowspan="1" colspan="1">Picks the <code>registration</code> which was registered right before the <em>called</em> registration was registered</td>
            </tr>
          </tbody>
        </table>
<p id="section-3.5-14"><strong>Failure Scenario</strong><a href="#section-3.5-14" class="pilcrow">¶</a></p>
<p id="section-3.5-15">In case all available registrations of a <em>Procedure</em> responds with a <code>wamp.error.unavailable</code> for a <em>CALL</em>, the <em>Dealer</em> MUST respond with a <code>wamp.error.no_available_callee</code> to the <em>CALLER</em><a href="#section-3.5-15" class="pilcrow">¶</a></p>
</section>
</div>
<div id="rpc-call-identification">
<section id="section-3.6">
        <h3 id="name-caller-identification">
<a href="#section-3.6" class="section-number selfRef">3.6. </a><a href="#name-caller-identification" class="section-name selfRef">Caller Identification</a>
        </h3>
<p id="section-3.6-1">A <em>Caller</em> MAY <strong>request</strong> the disclosure of its identity (its WAMP session ID) to endpoints of a routed call via<a href="#section-3.6-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.6-2">
<pre>    CALL.Options.disclose_me|bool := true
</pre><a href="#section-3.6-2" class="pilcrow">¶</a>
</div>
<p id="section-3.6-3"><em>Example</em><a href="#section-3.6-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.6-4">
<pre>    [48, 7814135, {"disclose_me": true}, "com.myapp.echo",
        ["Hello, world!"]]
</pre><a href="#section-3.6-4" class="pilcrow">¶</a>
</div>
<p id="section-3.6-5">If above call is issued by a <em>Caller</em> with WAMP session ID <code>3335656</code>, the <em>Dealer</em> sends an <code>INVOCATION</code> message to <em>Callee</em> with the <em>Caller's</em> WAMP session ID in <code>INVOCATION.Details.caller</code>:<a href="#section-3.6-5" class="pilcrow">¶</a></p>
<p id="section-3.6-6"><em>Example</em><a href="#section-3.6-6" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.6-7">
<pre>    [68, 6131533, 9823526, {"caller": 3335656}, ["Hello, world!"]]
</pre><a href="#section-3.6-7" class="pilcrow">¶</a>
</div>
<p id="section-3.6-8">Note that a <em>Dealer</em> MAY disclose the identity of a <em>Caller</em> even without the <em>Caller</em> having explicitly requested to do so when the <em>Dealer</em> configuration (for the called procedure) is setup to do so.<a href="#section-3.6-8" class="pilcrow">¶</a></p>
<p id="section-3.6-9"><strong>Identity Information</strong><a href="#section-3.6-9" class="pilcrow">¶</a></p>
<p id="section-3.6-10">When <em>Caller</em> disclosure is allowed for a particular CALL message, the
corresponding <code>INVOCATION</code> message MUST contain an
<code>INVOCATION.Details.caller|integer</code> property set to the <em>Caller</em>'s session ID.<a href="#section-3.6-10" class="pilcrow">¶</a></p>
<p id="section-3.6-11">The following additional properties MAY also be included::<a href="#section-3.6-11" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.6-12.1">
            <code>INVOCATION.Details.caller_authid|string</code><a href="#section-3.6-12.1" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-3.6-12.2">
            <code>INVOCATION.Details.caller_authrole|string</code><a href="#section-3.6-12.2" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-3.6-13"><strong>Feature Announcement</strong><a href="#section-3.6-13" class="pilcrow">¶</a></p>
<p id="section-3.6-14">Support for this feature MUST be announced by <em>Callers</em> (<code>role := "caller"</code>), <em>Callees</em> (<code>role := "callee"</code>) and <em>Dealers</em> (<code>role := "dealer"</code>) via<a href="#section-3.6-14" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.6-15">
<pre>    HELLO.Details.roles.&lt;role&gt;.features.
         caller_identification|bool := true
</pre><a href="#section-3.6-15" class="pilcrow">¶</a>
</div>
<p id="section-3.6-16"><strong>Request Identification</strong><a href="#section-3.6-16" class="pilcrow">¶</a></p>
<p id="section-3.6-17">A <em>Dealer</em> MAY deny a <em>Caller's</em> request to disclose its identity:<a href="#section-3.6-17" class="pilcrow">¶</a></p>
<p id="section-3.6-18"><em>Example</em><a href="#section-3.6-18" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.6-19">
<pre>    [8, 48, 7814135, "wamp.error.disclose_me.not_allowed"]
</pre><a href="#section-3.6-19" class="pilcrow">¶</a>
</div>
<p id="section-3.6-20">A <em>Callee</em> MAY <strong>request</strong> the disclosure of caller identity via<a href="#section-3.6-20" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.6-21">
<pre>    REGISTER.Options.disclose_caller|bool := true
</pre><a href="#section-3.6-21" class="pilcrow">¶</a>
</div>
<p id="section-3.6-22"><em>Example</em><a href="#section-3.6-22" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.6-23">
<pre>    [64, 927639114088448, {"disclose_caller":true},
        "com.maypp.add2"]
</pre><a href="#section-3.6-23" class="pilcrow">¶</a>
</div>
<p id="section-3.6-24">With the above registration, the registered procedure is called with the caller's sessionID as part of the call details object.<a href="#section-3.6-24" class="pilcrow">¶</a></p>
</section>
</div>
<div id="rpc-call-trust-levels">
<section id="section-3.7">
        <h3 id="name-call-trust-levels">
<a href="#section-3.7" class="section-number selfRef">3.7. </a><a href="#name-call-trust-levels" class="section-name selfRef">Call Trust Levels</a>
        </h3>
<p id="section-3.7-1">A <em>Dealer</em> may be configured to automatically assign <em>trust levels</em> to calls issued by <em>Callers</em> according to the <em>Dealer</em> configuration on a per-procedure basis and/or depending on the application defined role of the (authenticated) <em>Caller</em>.<a href="#section-3.7-1" class="pilcrow">¶</a></p>
<p id="section-3.7-2">A <em>Dealer</em> supporting trust level will provide<a href="#section-3.7-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.7-3">
<pre>    INVOCATION.Details.trustlevel|integer
</pre><a href="#section-3.7-3" class="pilcrow">¶</a>
</div>
<p id="section-3.7-4">in an <code>INVOCATION</code> message sent to a <em>Callee</em>. The trustlevel <code>0</code> means lowest trust, and higher integers represent (application-defined) higher levels of trust.<a href="#section-3.7-4" class="pilcrow">¶</a></p>
<p id="section-3.7-5"><em>Example</em><a href="#section-3.7-5" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.7-6">
<pre>    [68, 6131533, 9823526, {"trustlevel": 2}, ["Hello, world!"]]
</pre><a href="#section-3.7-6" class="pilcrow">¶</a>
</div>
<p id="section-3.7-7">In above event, the <em>Dealer</em> has (by configuration and/or other information) deemed the call (and hence the invocation) to be of trustlevel <code>2</code>.<a href="#section-3.7-7" class="pilcrow">¶</a></p>
<p id="section-3.7-8"><strong>Feature Announcement</strong><a href="#section-3.7-8" class="pilcrow">¶</a></p>
<p id="section-3.7-9">Support for this feature MUST be announced by <em>Callees</em> (<code>role := "callee"</code>) and <em>Dealers</em> (<code>role := "dealer"</code>) via<a href="#section-3.7-9" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.7-10">
<pre>    HELLO.Details.roles.&lt;role&gt;.features.call_trustlevels|bool := true
</pre><a href="#section-3.7-10" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="rpc-pattern-reg">
<section id="section-3.8">
        <h3 id="name-pattern-based-registrations">
<a href="#section-3.8" class="section-number selfRef">3.8. </a><a href="#name-pattern-based-registrations" class="section-name selfRef">Pattern-based Registrations</a>
        </h3>
<p id="section-3.8-1">By default, <em>Callees</em> register procedures with <strong>exact matching policy</strong>. That is a call will only be routed to a <em>Callee</em> by the <em>Dealer</em> if the procedure called (<code>CALL.Procedure</code>) <em>exactly</em> matches the endpoint registered (<code>REGISTER.Procedure</code>).<a href="#section-3.8-1" class="pilcrow">¶</a></p>
<p id="section-3.8-2">A <em>Callee</em> might want to register procedures based on a <em>pattern</em>. This can be useful to reduce the number of individual registrations to be set up or to subscribe to a open set of topics, not known beforehand by the <em>Subscriber</em>.<a href="#section-3.8-2" class="pilcrow">¶</a></p>
<p id="section-3.8-3">If the <em>Dealer</em> and the <em>Callee</em> support <strong>pattern-based registrations</strong>, this matching can happen by<a href="#section-3.8-3" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.8-4.1">
            <strong>prefix-matching policy</strong><a href="#section-3.8-4.1" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-3.8-4.2">
            <strong>wildcard-matching policy</strong><a href="#section-3.8-4.2" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-3.8-5"><strong>Feature Announcement</strong><a href="#section-3.8-5" class="pilcrow">¶</a></p>
<p id="section-3.8-6">Support for this feature MUST be announced by <em>Callees</em> (<code>role := "callee"</code>) and <em>Dealers</em> (<code>role := "dealer"</code>) via<a href="#section-3.8-6" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.8-7">
<pre>    HELLO.Details.roles.&lt;role&gt;.features.
        pattern_based_registration|bool := true
</pre><a href="#section-3.8-7" class="pilcrow">¶</a>
</div>
<div id="prefix-matching">
<section id="section-3.8.1">
          <h4 id="name-prefix-matching">
<a href="#section-3.8.1" class="section-number selfRef">3.8.1. </a><a href="#name-prefix-matching" class="section-name selfRef">Prefix Matching</a>
          </h4>
<p id="section-3.8.1-1">A <em>Callee</em> requests <strong>prefix-matching policy</strong> with a registration request by setting<a href="#section-3.8.1-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.8.1-2">
<pre>    REGISTER.Options.match|string := "prefix"
</pre><a href="#section-3.8.1-2" class="pilcrow">¶</a>
</div>
<p id="section-3.8.1-3"><em>Example</em><a href="#section-3.8.1-3" class="pilcrow">¶</a></p>
<div class="lang-json sourcecode" id="section-3.8.1-4">
<pre>    [
        64,
        612352435,
        {
            "match": "prefix"
        },
        "com.myapp.myobject1"
    ]
</pre><a href="#section-3.8.1-4" class="pilcrow">¶</a>
</div>
<p id="section-3.8.1-5">When a <strong>prefix-matching policy</strong> is in place, any call with a procedure that has <code>REGISTER.Procedure</code> as a <em>prefix</em> will match the registration, and potentially be routed to <em>Callees</em> on that registration.<a href="#section-3.8.1-5" class="pilcrow">¶</a></p>
<p id="section-3.8.1-6">In above example, the following calls with <code>CALL.Procedure</code><a href="#section-3.8.1-6" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.8.1-7.1">
              <code>com.myapp.myobject1.myprocedure1</code><a href="#section-3.8.1-7.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.8.1-7.2">
              <code>com.myapp.myobject1-mysubobject1</code><a href="#section-3.8.1-7.2" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.8.1-7.3">
              <code>com.myapp.myobject1.mysubobject1.myprocedure1</code><a href="#section-3.8.1-7.3" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.8.1-7.4">
              <code>com.myapp.myobject1</code><a href="#section-3.8.1-7.4" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-3.8.1-8">will all apply for call routing. A call with one of the following <code>CALL.Procedure</code><a href="#section-3.8.1-8" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.8.1-9.1">
              <code>com.myapp.myobject2</code><a href="#section-3.8.1-9.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.8.1-9.2">
              <code>com.myapp.myobject</code><a href="#section-3.8.1-9.2" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-3.8.1-10">will not apply.<a href="#section-3.8.1-10" class="pilcrow">¶</a></p>
</section>
</div>
<div id="wildcard-matching">
<section id="section-3.8.2">
          <h4 id="name-wildcard-matching">
<a href="#section-3.8.2" class="section-number selfRef">3.8.2. </a><a href="#name-wildcard-matching" class="section-name selfRef">Wildcard Matching</a>
          </h4>
<p id="section-3.8.2-1">A <em>Callee</em> requests <strong>wildcard-matching policy</strong> with a registration request by setting<a href="#section-3.8.2-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.8.2-2">
<pre>    REGISTER.Options.match|string := "wildcard"
</pre><a href="#section-3.8.2-2" class="pilcrow">¶</a>
</div>
<p id="section-3.8.2-3">Wildcard-matching allows to provide wildcards for <strong>whole</strong> URI components.<a href="#section-3.8.2-3" class="pilcrow">¶</a></p>
<p id="section-3.8.2-4"><em>Example</em><a href="#section-3.8.2-4" class="pilcrow">¶</a></p>
<div class="lang-json sourcecode" id="section-3.8.2-5">
<pre>    [
        64,
        612352435,
        {
            "match": "wildcard"
        },
        "com.myapp..myprocedure1"
    ]
</pre><a href="#section-3.8.2-5" class="pilcrow">¶</a>
</div>
<p id="section-3.8.2-6">In the above registration request, the 3rd URI component is empty, which signals a wildcard in that URI component position. In this example, calls with <code>CALL.Procedure</code> e.g.<a href="#section-3.8.2-6" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.8.2-7.1">
              <code>com.myapp.myobject1.myprocedure1</code><a href="#section-3.8.2-7.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.8.2-7.2">
              <code>com.myapp.myobject2.myprocedure1</code><a href="#section-3.8.2-7.2" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-3.8.2-8">will all apply for call routing. Calls with <code>CALL.Procedure</code> e.g.<a href="#section-3.8.2-8" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.8.2-9.1">
              <code>com.myapp.myobject1.myprocedure1.mysubprocedure1</code><a href="#section-3.8.2-9.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.8.2-9.2">
              <code>com.myapp.myobject1.myprocedure2</code><a href="#section-3.8.2-9.2" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-3.8.2-9.3">
              <code>com.myapp2.myobject1.myprocedure1</code><a href="#section-3.8.2-9.3" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-3.8.2-10">will not apply for call routing.<a href="#section-3.8.2-10" class="pilcrow">¶</a></p>
<p id="section-3.8.2-11">When a single call matches more than one of a <em>Callees</em> registrations, the call MAY be routed for invocation on multiple registrations, depending on call settings.<a href="#section-3.8.2-11" class="pilcrow">¶</a></p>
</section>
</div>
<div id="design-aspects">
<section id="section-3.8.3">
          <h4 id="name-design-aspects">
<a href="#section-3.8.3" class="section-number selfRef">3.8.3. </a><a href="#name-design-aspects" class="section-name selfRef">Design Aspects</a>
          </h4>
<p id="section-3.8.3-1"><strong>No set semantics</strong><a href="#section-3.8.3-1" class="pilcrow">¶</a></p>
<p id="section-3.8.3-2">Since each <em>Callee</em>'s' registrations "stands on its own", there is no <em>set semantics</em> implied by pattern-based registrations.<a href="#section-3.8.3-2" class="pilcrow">¶</a></p>
<p id="section-3.8.3-3">E.g. a <em>Callee</em> cannot register to a broad pattern, and then unregister from a subset of that broad pattern to form a more complex registration. Each registration is separate.<a href="#section-3.8.3-3" class="pilcrow">¶</a></p>
<p id="section-3.8.3-4"><strong>Calls matching multiple registrations</strong><a href="#section-3.8.3-4" class="pilcrow">¶</a></p>
<p id="section-3.8.3-5">There can be situations, when some call URI matches more then one registration. In this case a call is routed to one and only one best matched RPC registration, or fails with ERROR <code>wamp.error.no_such_procedure</code>.<a href="#section-3.8.3-5" class="pilcrow">¶</a></p>
<p id="section-3.8.3-6">The following algorithm MUST be applied to find a single RPC registration to which a call is routed:<a href="#section-3.8.3-6" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="compact type-1" id="section-3.8.3-7">
<li id="section-3.8.3-7.1">Check for exact matching registration. If this match exists <span class="unicode">— (U+2014)</span> use it.<a href="#section-3.8.3-7.1" class="pilcrow">¶</a>
</li>
            <li id="section-3.8.3-7.2">If there are prefix-based registrations, find the registration with the longest prefix match. Longest means it has more URI components matched, e.g. for call URI <code>a1.b2.c3.d4</code> registration <code>a1.b2.c3</code> has higher priority than registration <code>a1.b2</code>. If this match exists <span class="unicode">— (U+2014)</span> use it.<a href="#section-3.8.3-7.2" class="pilcrow">¶</a>
</li>
            <li id="section-3.8.3-7.3">If there are wildcard-based registrations, find the registration with the longest portion of URI components matched before each wildcard. E.g. for call URI <code>a1.b2.c3.d4</code> registration <code>a1.b2..d4</code> has higher priority than registration <code>a1...d4</code>, see below for more complex examples. If this match exists <span class="unicode">— (U+2014)</span> use it.<a href="#section-3.8.3-7.3" class="pilcrow">¶</a>
</li>
            <li id="section-3.8.3-7.4">If there is no exact match, no prefix match, and no wildcard match, then <em>Dealer</em> MUST return ERROR <code>wamp.error.no_such_procedure</code>.<a href="#section-3.8.3-7.4" class="pilcrow">¶</a>
</li>
          </ol>
<p id="section-3.8.3-8"><em>Examples</em><a href="#section-3.8.3-8" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.8.3-9">
<pre>Registered RPCs:
    1. 'a1.b2.c3.d4.e55' (exact),
    2. 'a1.b2.c3' (prefix),
    3. 'a1.b2.c3.d4' (prefix),
    4. 'a1.b2..d4.e5',
    5. 'a1.b2.c33..e5',
    6. 'a1.b2..d4.e5..g7',
    7. 'a1.b2..d4..f6.g7'

Call request RPC URI: 'a1.b2.c3.d4.e55' →
    exact match. Use RPC 1
Call request RPC URI: 'a1.b2.c3.d98.e74' →
    no exact match, single prefix match. Use RPC 2
Call request RPC URI: 'a1.b2.c3.d4.e325' →
    no exact match, 2 prefix matches (2,3), select longest one.
    Use RPC 3
Call request RPC URI: 'a1.b2.c55.d4.e5' →
    no exact match, no prefix match, single wildcard match.
    Use RPC 4
Call request RPC URI: 'a1.b2.c33.d4.e5' →
    no exact match, no prefix match, 2 wildcard matches (4,5),
    but RPC 5 has longer first portion (a1.b2.c33). Use RPC 5
Call request RPC URI: 'a1.b2.c88.d4.e5.f6.g7' →
    no exact match, no prefix match, 2 wildcard matches (6,7),
    both having equal first portions (a1.b2), but RPC 6 has longer
    second portion (d4.e5). Use RPC 6
Call request RPC URI: 'a2.b2.c2.d2.e2' →
    no exact match, no prefix match, no wildcard match.
    Return wamp.error.no_such_procedure
</pre><a href="#section-3.8.3-9" class="pilcrow">¶</a>
</div>
<p id="section-3.8.3-10"><strong>Concrete procedure called</strong><a href="#section-3.8.3-10" class="pilcrow">¶</a></p>
<p id="section-3.8.3-11">If an endpoint was registered with a pattern-based matching policy, a <em>Dealer</em> MUST supply the original <code>CALL.Procedure</code> as provided by the <em>Caller</em> in<a href="#section-3.8.3-11" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.8.3-12">
<pre>    INVOCATION.Details.procedure
</pre><a href="#section-3.8.3-12" class="pilcrow">¶</a>
</div>
<p id="section-3.8.3-13">to the <em>Callee</em>.<a href="#section-3.8.3-13" class="pilcrow">¶</a></p>
<p id="section-3.8.3-14"><em>Example</em><a href="#section-3.8.3-14" class="pilcrow">¶</a></p>
<div class="lang-json sourcecode" id="section-3.8.3-15">
<pre>    [
        68,
        6131533,
        9823527,
        {
            "procedure": "com.myapp.procedure.proc1"
        },
        ["Hello, world!"]
    ]
</pre><a href="#section-3.8.3-15" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="rpc-shared-registration">
<section id="section-3.9">
        <h3 id="name-shared-registration">
<a href="#section-3.9" class="section-number selfRef">3.9. </a><a href="#name-shared-registration" class="section-name selfRef">Shared Registration</a>
        </h3>
<p id="section-3.9-1">Feature status: <strong>alpha</strong><a href="#section-3.9-1" class="pilcrow">¶</a></p>
<p id="section-3.9-2">As a default, only a single <strong>Callee</strong> may register a procedure for a URI.<a href="#section-3.9-2" class="pilcrow">¶</a></p>
<p id="section-3.9-3">There are use cases where more flexibility is required. As an example, for an application component with a high computing load, several instances may run, and load balancing of calls across these may be desired. As another example, in an application a second or third component providing a procedure may run, which are only to be called in case the primary component is no longer reachable (hot standby).<a href="#section-3.9-3" class="pilcrow">¶</a></p>
<p id="section-3.9-4">When shared registrations are supported, then the first <strong>Callee</strong> to register a procedure for a particular URI MAY determine that additional registrations for this URI are allowed, and what <strong>Invocation Rules</strong> to apply in case such additional registrations are made.<a href="#section-3.9-4" class="pilcrow">¶</a></p>
<p id="section-3.9-5">This is done through setting<a href="#section-3.9-5" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.9-6">
<pre>    REGISTER.Options.invoke|string := &lt;invocation_policy&gt;
</pre><a href="#section-3.9-6" class="pilcrow">¶</a>
</div>
<p id="section-3.9-7">where <code>&lt;invocation_policy&gt;</code> is one of<a href="#section-3.9-7" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.9-8.1">'single'<a href="#section-3.9-8.1" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-3.9-8.2">'roundrobin'<a href="#section-3.9-8.2" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-3.9-8.3">'random'<a href="#section-3.9-8.3" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-3.9-8.4">'first'<a href="#section-3.9-8.4" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-3.9-8.5">'last'<a href="#section-3.9-8.5" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-3.9-9">If the option is not set, 'single' is applied as a default.<a href="#section-3.9-9" class="pilcrow">¶</a></p>
<p id="section-3.9-10">With 'single', the <strong>Dealer</strong> MUST fail all subsequent attempts to register a procedure for the URI while the registration remains in existence.<a href="#section-3.9-10" class="pilcrow">¶</a></p>
<p id="section-3.9-11">With the other values, the <strong>Dealer</strong> MUST fail all subsequent attempts to register a procedure for the URI where the value for this option does not match that of the initial registration.<a href="#section-3.9-11" class="pilcrow">¶</a></p>
<p id="section-3.9-12"><strong>Feature Announcement</strong><a href="#section-3.9-12" class="pilcrow">¶</a></p>
<p id="section-3.9-13">Support for this feature MUST be announced by <em>Callees</em> (<code>role := "callee"</code>) and <em>Dealers</em> (<code>role := "dealer"</code>) via<a href="#section-3.9-13" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.9-14">
<pre>    HELLO.Details.roles.&lt;role&gt;.features.
        shared_registration|bool := true
</pre><a href="#section-3.9-14" class="pilcrow">¶</a>
</div>
<div id="load-balancing">
<section id="section-3.9.1">
          <h4 id="name-load-balancing">
<a href="#section-3.9.1" class="section-number selfRef">3.9.1. </a><a href="#name-load-balancing" class="section-name selfRef">Load Balancing</a>
          </h4>
<p id="section-3.9.1-1">For sets of registrations registered using either 'roundrobin' or 'random', load balancing is performed across calls to the URI.<a href="#section-3.9.1-1" class="pilcrow">¶</a></p>
<p id="section-3.9.1-2">For 'roundrobin', callees are picked subsequently from the list of registrations (ordered by the order of registration), with the picking looping back to the beginning of the list once the end has been reached.<a href="#section-3.9.1-2" class="pilcrow">¶</a></p>
<p id="section-3.9.1-3">For 'random' a callee is picked randomly from the list of registrations for each call.<a href="#section-3.9.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="hot-stand-by">
<section id="section-3.9.2">
          <h4 id="name-hot-stand-by">
<a href="#section-3.9.2" class="section-number selfRef">3.9.2. </a><a href="#name-hot-stand-by" class="section-name selfRef">Hot Stand-By</a>
          </h4>
<p id="section-3.9.2-1">For sets of registrations registered using either 'first' or 'last', the first respectively last callee on the current list of registrations (ordered by the order of registration) is called.<a href="#section-3.9.2-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="rpc-sharded-registration">
<section id="section-3.10">
        <h3 id="name-sharded-registration">
<a href="#section-3.10" class="section-number selfRef">3.10. </a><a href="#name-sharded-registration" class="section-name selfRef">Sharded Registration</a>
        </h3>
<p id="section-3.10-1">Feature status: <strong>sketch</strong><a href="#section-3.10-1" class="pilcrow">¶</a></p>
<p id="section-3.10-2"><strong>Sharded Registrations</strong> are intended to allow calling a procedure which is offered by a sharded database, by routing the call to a single shard.<a href="#section-3.10-2" class="pilcrow">¶</a></p>
<p id="section-3.10-3"><strong>Feature Announcement</strong><a href="#section-3.10-3" class="pilcrow">¶</a></p>
<p id="section-3.10-4">Support for this feature MUST be announced by <em>Callers</em> (<code>role := "caller"</code>), <em>Callees</em> (<code>role := "callee"</code>) and <em>Dealers</em> (<code>role := "dealer"</code>) via<a href="#section-3.10-4" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.10-5">
<pre>HELLO.Details.roles.&lt;role&gt;.features.sharded_registration|bool := true
</pre><a href="#section-3.10-5" class="pilcrow">¶</a>
</div>
<div id="all-calls">
<section id="section-3.10.1">
          <h4 id="name-all-calls">
<a href="#section-3.10.1" class="section-number selfRef">3.10.1. </a><a href="#name-all-calls" class="section-name selfRef">"All" Calls</a>
          </h4>
<p id="section-3.10.1-1">Write me.<a href="#section-3.10.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="partitioned-calls">
<section id="section-3.10.2">
          <h4 id="name-partitioned-calls">
<a href="#section-3.10.2" class="section-number selfRef">3.10.2. </a><a href="#name-partitioned-calls" class="section-name selfRef">"Partitioned" Calls</a>
          </h4>
<p id="section-3.10.2-1">If <code>CALL.Options.runmode == "partition"</code>, then <code>CALL.Options.rkey</code> MUST be present.<a href="#section-3.10.2-1" class="pilcrow">¶</a></p>
<p id="section-3.10.2-2">The call is then routed to all endpoints that were registered ..<a href="#section-3.10.2-2" class="pilcrow">¶</a></p>
<p id="section-3.10.2-3">The call is then processed as for "All" Calls.<a href="#section-3.10.2-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="rpc-registration-revocation">
<section id="section-3.11">
        <h3 id="name-registration-revocation">
<a href="#section-3.11" class="section-number selfRef">3.11. </a><a href="#name-registration-revocation" class="section-name selfRef">Registration Revocation</a>
        </h3>
<p id="section-3.11-1">Feature status: <strong>alpha</strong><a href="#section-3.11-1" class="pilcrow">¶</a></p>
<p id="section-3.11-2">This feature allows a <em>Dealer</em> to actively revoke a previously granted registration.
To achieve this, the existing UNREGISTERED message is extended as described below.<a href="#section-3.11-2" class="pilcrow">¶</a></p>
<p id="section-3.11-3"><strong>Feature Announcement</strong><a href="#section-3.11-3" class="pilcrow">¶</a></p>
<p id="section-3.11-4">Support for this feature MUST be announced by <em>Callees</em> (role := "callee") and <em>Dealers</em> (role := "dealer") via<a href="#section-3.11-4" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.11-5">
<pre>    HELLO.Details.roles.&lt;role&gt;.features.
         registration_revocation|bool := true
</pre><a href="#section-3.11-5" class="pilcrow">¶</a>
</div>
<p id="section-3.11-6">If the <em>Callee</em> does not support registration_revocation, the <em>Dealer</em> may still revoke a registration to support administrative functionality. In this case, the <em>Dealer</em> MUST NOT send an <strong>UNREGISTERED</strong> message to the <em>Callee</em>. The <em>Callee</em> MAY use the registration meta event <code>wamp.registration.on_unregister</code> to determine whether a session is removed from a registration.<a href="#section-3.11-6" class="pilcrow">¶</a></p>
<p id="section-3.11-7"><strong>Extending UNREGISTERED</strong><a href="#section-3.11-7" class="pilcrow">¶</a></p>
<p id="section-3.11-8">When revoking a registration, the router has no request ID to reply to. So it's set to zero and another argument is appended to indicate which registration to revoke. Optionally, a reason why the registration was revoked is also appended.<a href="#section-3.11-8" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.11-9">
<pre>    [UNREGISTERED, 0, Details|dict]
</pre><a href="#section-3.11-9" class="pilcrow">¶</a>
</div>
<p id="section-3.11-10">where<a href="#section-3.11-10" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-3.11-11.1">
            <code>Details.registration|bool</code> MUST be a previously issued registration ID.<a href="#section-3.11-11.1" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-3.11-11.2">
            <code>Details.reason|string</code> MAY provide a reason as to why the registration was revoked.<a href="#section-3.11-11.2" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-3.11-12"><em>Example</em><a href="#section-3.11-12" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.11-13">
<pre>    [67, 0, {"registration": 1293722, "reason": "moving endpoint to other callee"}]
</pre><a href="#section-3.11-13" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="adv-pubsub">
<section id="section-4">
      <h2 id="name-advanced-pubsub">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-advanced-pubsub" class="section-name selfRef">Advanced PubSub</a>
      </h2>
<div id="pubsub-bw-listing">
<section id="section-4.1">
        <h3 id="name-subscriber-black-and-whitel">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-subscriber-black-and-whitel" class="section-name selfRef">Subscriber Black- and Whitelisting</a>
        </h3>
<p id="section-4.1-1"><strong>Subscriber Black- and Whitelisting</strong> is an advanced <em>Broker</em> feature where a <em>Publisher</em> is able to restrict the set of receivers of a published event.<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<p id="section-4.1-2">Under normal Publish &amp; Subscriber event dispatching, a <em>Broker</em> will dispatch a published event to all (authorized) <em>Subscribers</em> other than the <em>Publisher</em> itself. This set of receivers can be further reduced on a per-publication basis by the <em>Publisher</em> using <strong>Subscriber Black- and Whitelisting</strong>.<a href="#section-4.1-2" class="pilcrow">¶</a></p>
<p id="section-4.1-3">The <em>Publisher</em> can explicitly <strong>exclude</strong> <em>Subscribers</em> based on WAMP <code>sessionid</code>, <code>authid</code> or <code>authrole</code>. This is referred to as <strong>Blacklisting</strong>.<a href="#section-4.1-3" class="pilcrow">¶</a></p>
<p id="section-4.1-4">A <em>Publisher</em> may also explicitly define a <strong>eligible</strong> list of <em>Subscribers</em> based on WAMP <code>sessionid</code>, <code>authid</code> or <code>authrole</code>. This is referred to as <strong>Whitelisting</strong>.<a href="#section-4.1-4" class="pilcrow">¶</a></p>
<p id="section-4.1-5">Use Cases include the following.<a href="#section-4.1-5" class="pilcrow">¶</a></p>
<p id="section-4.1-6"><strong>Avoiding Callers from being self-notified</strong><a href="#section-4.1-6" class="pilcrow">¶</a></p>
<p id="section-4.1-7">Consider an application that exposes a procedure to update a product price. The procedure might not only actually update the product price (e.g. in a backend database), but additionally publish an event with the updated product price, so that <strong>all</strong> application components get notified actively of the new price.<a href="#section-4.1-7" class="pilcrow">¶</a></p>
<p id="section-4.1-8">However, the application might want to exclude the originator of the product price update (the <strong>Caller</strong> of the price update procedure) from receiving the update event - as the originator naturally already knows the new price, and might get confused when it receives an update the <strong>Caller</strong> has triggered himself.<a href="#section-4.1-8" class="pilcrow">¶</a></p>
<p id="section-4.1-9">The product price update procedure can use <code>PUBLISH.Options.exclude|list[int]</code> to exclude the <strong>Caller</strong> of the procedure.<a href="#section-4.1-9" class="pilcrow">¶</a></p>
<blockquote id="section-4.1-10">
          <p id="section-4.1-10.1">Note that the product price update procedure needs to know the session ID of the <strong>Caller</strong> to be able to exclude him. For this, please see <strong>Caller Identification</strong>.<a href="#section-4.1-10.1" class="pilcrow">¶</a></p>
</blockquote>
<p id="section-4.1-11">A similar approach can be used for other CRUD-like procedures.<a href="#section-4.1-11" class="pilcrow">¶</a></p>
<p id="section-4.1-12"><strong>Restricting receivers of sensitive information</strong><a href="#section-4.1-12" class="pilcrow">¶</a></p>
<p id="section-4.1-13">Consider an application with users that have different <code>authroles</code>, such as "manager" and "staff" that publishes events with updates to "customers". The topics being published to could be structured like<a href="#section-4.1-13" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.1-14">
<pre>    com.example.myapp.customer.&lt;customer ID&gt;
</pre><a href="#section-4.1-14" class="pilcrow">¶</a>
</div>
<p id="section-4.1-15">The application might want to restrict the receivers of customer updates depending on the <code>authrole</code> of the user. E.g. a user authenticated under <code>authrole</code> "manager" might be allowed to receive any kind of customer update, including personal and business sensitive information. A user under <code>authrole</code> "staff" might only be allowed to receive a subset of events.<a href="#section-4.1-15" class="pilcrow">¶</a></p>
<p id="section-4.1-16">The application can publish <strong>all</strong> customer updates to the <strong>same</strong> topic <code>com.example.myapp.customer.&lt;customer ID&gt;</code> and use <code>PUBLISH.Options.eligible_authrole|list[string]</code> to safely restrict the set of actual receivers as desired.<a href="#section-4.1-16" class="pilcrow">¶</a></p>
<p id="section-4.1-17"><strong>Feature Definition</strong><a href="#section-4.1-17" class="pilcrow">¶</a></p>
<p id="section-4.1-18">A <em>Publisher</em> may restrict the actual receivers of an event from the set of <em>Subscribers</em> through the use of<a href="#section-4.1-18" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-4.1-19.1">
            <p id="section-4.1-19.1.1">Blacklisting Options<a href="#section-4.1-19.1.1" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-4.1-19.1.2.1">
                <code>PUBLISH.Options.exclude|list[int]</code><a href="#section-4.1-19.1.2.1" class="pilcrow">¶</a>
</li>
              <li class="compact" id="section-4.1-19.1.2.2">
                <code>PUBLISH.Options.exclude_authid|list[string]</code><a href="#section-4.1-19.1.2.2" class="pilcrow">¶</a>
</li>
              <li class="compact" id="section-4.1-19.1.2.3">
                <code>PUBLISH.Options.exclude_authrole|list[string]</code><a href="#section-4.1-19.1.2.3" class="pilcrow">¶</a>
</li>
            </ul>
</li>
          <li class="compact" id="section-4.1-19.2">
            <p id="section-4.1-19.2.1">Whitelisting Options<a href="#section-4.1-19.2.1" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-4.1-19.2.2.1">
                <code>PUBLISH.Options.eligible|list[int]</code><a href="#section-4.1-19.2.2.1" class="pilcrow">¶</a>
</li>
              <li class="compact" id="section-4.1-19.2.2.2">
                <code>PUBLISH.Options.eligible_authid|list[string]</code><a href="#section-4.1-19.2.2.2" class="pilcrow">¶</a>
</li>
              <li class="compact" id="section-4.1-19.2.2.3">
                <code>PUBLISH.Options.eligible_authrole|list[string]</code><a href="#section-4.1-19.2.2.3" class="pilcrow">¶</a>
</li>
            </ul>
</li>
        </ul>
<p id="section-4.1-20"><code>PUBLISH.Options.exclude</code> is a list of integers with WAMP <code>sessionids</code> providing an explicit list of (potential) <em>Subscribers</em> that won't receive a published event, even though they may be subscribed. In other words, <code>PUBLISH.Options.exclude</code> is a <strong>blacklist</strong> of (potential) <em>Subscribers</em>.<a href="#section-4.1-20" class="pilcrow">¶</a></p>
<p id="section-4.1-21"><code>PUBLISH.Options.eligible</code> is a list of integers with WAMP WAMP <code>sessionids</code> providing an explicit list of (potential) <em>Subscribers</em> that are allowed to receive a published event. In other words, <code>PUBLISH.Options.eligible</code> is a <strong>whitelist</strong> of (potential) <em>Subscribers</em>.<a href="#section-4.1-21" class="pilcrow">¶</a></p>
<p id="section-4.1-22">The <code>exclude_authid</code>, <code>exclude_authrole</code>, <code>eligible_authid</code> and <code>eligible_authrole</code> options work similar, but not on the basis of WAMP <code>sessionid</code>, but <code>authid</code> and <code>authrole</code>.<a href="#section-4.1-22" class="pilcrow">¶</a></p>
<p id="section-4.1-23">An (authorized) <em>Subscriber</em> to topic T will receive an event published to T if and only if all of the following statements hold true:<a href="#section-4.1-23" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="compact type-1" id="section-4.1-24">
<li id="section-4.1-24.1">if there is an <code>eligible</code> attribute present, the <em>Subscriber</em>'s <code>sessionid</code> is in this list<a href="#section-4.1-24.1" class="pilcrow">¶</a>
</li>
          <li id="section-4.1-24.2">if there is an <code>eligible_authid</code> attribute present, the <em>Subscriber</em>'s <code>authid</code> is in this list<a href="#section-4.1-24.2" class="pilcrow">¶</a>
</li>
          <li id="section-4.1-24.3">if there is an <code>eligible_authrole</code> attribute present, the <em>Subscriber</em>'s <code>authrole</code> is in this list<a href="#section-4.1-24.3" class="pilcrow">¶</a>
</li>
          <li id="section-4.1-24.4">if there is an <code>exclude attribute</code> present, the <em>Subscriber</em>'s <code>sessionid</code> is NOT in this list<a href="#section-4.1-24.4" class="pilcrow">¶</a>
</li>
          <li id="section-4.1-24.5">if there is an <code>exclude_authid</code> attribute present, the <em>Subscriber</em>'s <code>authid</code> is NOT in this list<a href="#section-4.1-24.5" class="pilcrow">¶</a>
</li>
          <li id="section-4.1-24.6">if there is an <code>exclude_authrole</code> attribute present, the <em>Subscriber</em>'s <code>authrole</code> is NOT in this list<a href="#section-4.1-24.6" class="pilcrow">¶</a>
</li>
        </ol>
<p id="section-4.1-25">For example, if both <code>PUBLISH.Options.exclude</code> and <code>PUBLISH.Options.eligible</code> are present, the <em>Broker</em> will dispatch events published only to <em>Subscribers</em> that are not explicitly excluded in <code>PUBLISH.Options.exclude</code> <strong>and</strong> which are explicitly eligible via <code>PUBLISH.Options.eligible</code>.<a href="#section-4.1-25" class="pilcrow">¶</a></p>
<p id="section-4.1-26"><em>Example</em><a href="#section-4.1-26" class="pilcrow">¶</a></p>
<div class="lang-json sourcecode" id="section-4.1-27">
<pre>    [
       16,
       239714735,
       {
          "exclude": [
             7891255,
             1245751
          ]
       },
       "com.myapp.mytopic1",
       [
          "Hello, world!"
       ]
    ]
</pre><a href="#section-4.1-27" class="pilcrow">¶</a>
</div>
<p id="section-4.1-28">The above event will get dispatched to all <em>Subscribers</em> of <code>com.myapp.mytopic1</code>, but not WAMP sessions with IDs <code>7891255</code> or <code>1245751</code> (and also not the publishing session).<a href="#section-4.1-28" class="pilcrow">¶</a></p>
<p id="section-4.1-29"><em>Example</em><a href="#section-4.1-29" class="pilcrow">¶</a></p>
<div class="lang-json sourcecode" id="section-4.1-30">
<pre>    [
       16,
       239714735,
       {
          "eligible": [
             7891255,
             1245751
          ]
       },
       "com.myapp.mytopic1",
       [
          "Hello, world!"
       ]
    ]
</pre><a href="#section-4.1-30" class="pilcrow">¶</a>
</div>
<p id="section-4.1-31">The above event will get dispatched to WAMP sessions with IDs <code>7891255</code> or <code>1245751</code> only - but only if those are actually subscribed to the topic <code>com.myapp.mytopic1</code>.<a href="#section-4.1-31" class="pilcrow">¶</a></p>
<p id="section-4.1-32"><em>Example</em><a href="#section-4.1-32" class="pilcrow">¶</a></p>
<div class="lang-json sourcecode" id="section-4.1-33">
<pre>    [
       16,
       239714735,
       {
          "eligible": [
             7891255,
             1245751,
             9912315
          ],
          "exclude": [
             7891255
          ]
       },
       "com.myapp.mytopic1",
       [
          "Hello, world!"
       ]
    ]
</pre><a href="#section-4.1-33" class="pilcrow">¶</a>
</div>
<p id="section-4.1-34">The above event will get dispatched to WAMP sessions with IDs <code>1245751</code> or <code>9912315</code> only, since <code>7891255</code> is excluded - but only if those are actually subscribed to the topic <code>com.myapp.mytopic1</code>.<a href="#section-4.1-34" class="pilcrow">¶</a></p>
<p id="section-4.1-35"><strong>Feature Announcement</strong><a href="#section-4.1-35" class="pilcrow">¶</a></p>
<p id="section-4.1-36">Support for this feature MUST be announced by <em>Publishers</em> (<code>role := "publisher"</code>) and <em>Brokers</em> (<code>role := "broker"</code>) via<a href="#section-4.1-36" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.1-37">
<pre>    HELLO.Details.roles.&lt;role&gt;.features.
        subscriber_blackwhite_listing|bool := true
</pre><a href="#section-4.1-37" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="pubsub-pub-exclusion">
<section id="section-4.2">
        <h3 id="name-publisher-exclusion">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-publisher-exclusion" class="section-name selfRef">Publisher Exclusion</a>
        </h3>
<p id="section-4.2-1">By default, a <em>Publisher</em> of an event will <strong>not</strong> itself receive an event published, even when subscribed to the <code>Topic</code> the <em>Publisher</em> is publishing to. This behavior can be overridden using this feature.<a href="#section-4.2-1" class="pilcrow">¶</a></p>
<p id="section-4.2-2">To override the exclusion of a publisher from its own publication, the <code>PUBLISH</code> message must include the following option:<a href="#section-4.2-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.2-3">
<pre>    PUBLISH.Options.exclude_me|bool
</pre><a href="#section-4.2-3" class="pilcrow">¶</a>
</div>
<p id="section-4.2-4">When publishing with <code>PUBLISH.Options.exclude_me := false</code>, the <em>Publisher</em> of the event will receive that event, if it is subscribed to the <code>Topic</code> published to.<a href="#section-4.2-4" class="pilcrow">¶</a></p>
<p id="section-4.2-5"><em>Example</em><a href="#section-4.2-5" class="pilcrow">¶</a></p>
<div class="lang-json sourcecode" id="section-4.2-6">
<pre>    [
        16,
        239714735,
        {
            "exclude_me": false
        },
        "com.myapp.mytopic1",
        ["Hello, world!"]
    ]
</pre><a href="#section-4.2-6" class="pilcrow">¶</a>
</div>
<p id="section-4.2-7">In this example, the <em>Publisher</em> will receive the published event, if it is subscribed to <code>com.myapp.mytopic1</code>.<a href="#section-4.2-7" class="pilcrow">¶</a></p>
<p id="section-4.2-8"><strong>Feature Announcement</strong><a href="#section-4.2-8" class="pilcrow">¶</a></p>
<p id="section-4.2-9">Support for this feature MUST be announced by <em>Publishers</em> (<code>role := "publisher"</code>) and <em>Brokers</em> (<code>role := "broker"</code>) via<a href="#section-4.2-9" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.2-10">
<pre>    HELLO.Details.roles.&lt;role&gt;.features.
        publisher_exclusion|bool := true
</pre><a href="#section-4.2-10" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="pubsub-pub-identification">
<section id="section-4.3">
        <h3 id="name-publisher-identification">
<a href="#section-4.3" class="section-number selfRef">4.3. </a><a href="#name-publisher-identification" class="section-name selfRef">Publisher Identification</a>
        </h3>
<p id="section-4.3-1">A <em>Publisher</em> may request the disclosure of its identity (its WAMP session ID) to receivers of a published event by setting<a href="#section-4.3-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.3-2">
<pre>    PUBLISH.Options.disclose_me|bool := true
</pre><a href="#section-4.3-2" class="pilcrow">¶</a>
</div>
<p id="section-4.3-3"><em>Example</em><a href="#section-4.3-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.3-4">
<pre>    [16, 239714735, {"disclose_me": true}, "com.myapp.mytopic1",
        ["Hello, world!"]]
</pre><a href="#section-4.3-4" class="pilcrow">¶</a>
</div>
<p id="section-4.3-5">If above event is published by a <em>Publisher</em> with WAMP session ID <code>3335656</code>, the <em>Broker</em> would send an <code>EVENT</code> message to <em>Subscribers</em> with the <em>Publisher's</em> WAMP session ID in <code>EVENT.Details.publisher</code>:<a href="#section-4.3-5" class="pilcrow">¶</a></p>
<p id="section-4.3-6"><em>Example</em><a href="#section-4.3-6" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.3-7">
<pre>    [36, 5512315355, 4429313566, {"publisher": 3335656},
        ["Hello, world!"]]
</pre><a href="#section-4.3-7" class="pilcrow">¶</a>
</div>
<p id="section-4.3-8">Note that a <em>Broker</em> may deny a <em>Publisher's</em> request to disclose its identity:<a href="#section-4.3-8" class="pilcrow">¶</a></p>
<p id="section-4.3-9"><em>Example</em><a href="#section-4.3-9" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.3-10">
<pre>    [8, 16, 239714735, {}, "wamp.error.option_disallowed.disclose_me"]
</pre><a href="#section-4.3-10" class="pilcrow">¶</a>
</div>
<p id="section-4.3-11">A <em>Broker</em> may also (automatically) disclose the identity of a <em>Publisher</em> even without the <em>Publisher</em> having explicitly requested to do so when the <em>Broker</em> configuration (for the publication topic) is set up to do so.<a href="#section-4.3-11" class="pilcrow">¶</a></p>
<p id="section-4.3-12"><strong>Additional Identity Information</strong><a href="#section-4.3-12" class="pilcrow">¶</a></p>
<p id="section-4.3-13">When publisher disclosure is allowed for a particular PUBLISH message, the
corresponding <code>EVENT</code> message MAY also contain the following additional
properties in its <code>Details</code> dictionary:<a href="#section-4.3-13" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-4.3-14.1">
            <code>EVENT.Details.publisher_authid|string</code><a href="#section-4.3-14.1" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-4.3-14.2">
            <code>EVENT.Details.publisher_authrole|string</code><a href="#section-4.3-14.2" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-4.3-15"><strong>Feature Announcement</strong><a href="#section-4.3-15" class="pilcrow">¶</a></p>
<p id="section-4.3-16">Support for this feature MUST be announced by <em>Publishers</em> (<code>role := "publisher"</code>), <em>Brokers</em> (<code>role := "broker"</code>) and <em>Subscribers</em> (<code>role := "subscriber"</code>) via<a href="#section-4.3-16" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.3-17">
<pre>    HELLO.Details.roles.&lt;role&gt;.features.
        publisher_identification|bool := true
</pre><a href="#section-4.3-17" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="pubsub-pub-trustlevels">
<section id="section-4.4">
        <h3 id="name-publication-trust-levels">
<a href="#section-4.4" class="section-number selfRef">4.4. </a><a href="#name-publication-trust-levels" class="section-name selfRef">Publication Trust Levels</a>
        </h3>
<p id="section-4.4-1">A <em>Broker</em> may be configured to automatically assign <em>trust levels</em> to events published by <em>Publishers</em> according to the <em>Broker</em> configuration on a per-topic basis and/or depending on the application defined role of the (authenticated) <em>Publisher</em>.<a href="#section-4.4-1" class="pilcrow">¶</a></p>
<p id="section-4.4-2">A <em>Broker</em> supporting trust level will provide<a href="#section-4.4-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.4-3">
<pre>    EVENT.Details.trustlevel|integer
</pre><a href="#section-4.4-3" class="pilcrow">¶</a>
</div>
<p id="section-4.4-4">in an <code>EVENT</code> message sent to a <em>Subscriber</em>. The trustlevel <code>0</code> means lowest trust, and higher integers represent (application-defined) higher levels of trust.<a href="#section-4.4-4" class="pilcrow">¶</a></p>
<p id="section-4.4-5"><em>Example</em><a href="#section-4.4-5" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.4-6">
<pre>    [36, 5512315355, 4429313566, {"trustlevel": 2},
        ["Hello, world!"]]
</pre><a href="#section-4.4-6" class="pilcrow">¶</a>
</div>
<p id="section-4.4-7">In above event, the <em>Broker</em> has (by configuration and/or other information) deemed the event publication to be of trustlevel <code>2</code>.<a href="#section-4.4-7" class="pilcrow">¶</a></p>
<p id="section-4.4-8"><strong>Feature Announcement</strong><a href="#section-4.4-8" class="pilcrow">¶</a></p>
<p id="section-4.4-9">Support for this feature MUST be announced by <em>Subscribers</em> (<code>role := "subscriber"</code>) and <em>Brokers</em> (<code>role := "broker"</code>) via<a href="#section-4.4-9" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.4-10">
<pre>    HELLO.Details.roles.&lt;role&gt;.features.
        publication_trustlevels|bool := true
</pre><a href="#section-4.4-10" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="pattern-based-subscription">
<section id="section-4.5">
        <h3 id="name-pattern-based-subscription">
<a href="#section-4.5" class="section-number selfRef">4.5. </a><a href="#name-pattern-based-subscription" class="section-name selfRef">Pattern-based Subscription</a>
        </h3>
<p id="section-4.5-1">By default, <em>Subscribers</em> subscribe to topics with <strong>exact matching policy</strong>. That is an event will only be
dispatched to a <em>Subscriber</em> by the <em>Broker</em> if the topic published to (<code>PUBLISH.Topic</code>) <em>exactly</em> matches the
topic subscribed to (<code>SUBSCRIBE.Topic</code>).<a href="#section-4.5-1" class="pilcrow">¶</a></p>
<p id="section-4.5-2">A <em>Subscriber</em> might want to subscribe to topics based on a <em>pattern</em>. This can be useful to reduce the number of
individual subscriptions to be set up and to subscribe to topics the <em>Subscriber</em> is not aware of at the time of
subscription, or which do not yet exist at this time.<a href="#section-4.5-2" class="pilcrow">¶</a></p>
<p id="section-4.5-3">Let's review the event publication flow. When one peer decides to publish a message to a topic, it results in
a <code>PUBLISH</code> WAMP message with fields for the <code>Publication</code> id, <code>Details</code> dictionary, and, optionally,
the payload arguments.<a href="#section-4.5-3" class="pilcrow">¶</a></p>
<p id="section-4.5-4">A given event received by the router from a publisher via a <code>PUBLISH</code> message will match one or more
subscriptions:<a href="#section-4.5-4" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-4.5-5.1">zero or one exact subscription<a href="#section-4.5-5.1" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-4.5-5.2">zero or more prefix subscriptions<a href="#section-4.5-5.2" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-4.5-5.3">zero or more wildcard subscriptions<a href="#section-4.5-5.3" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-4.5-6">The same published event is then forwarded to subscribers for every matching subscription.
Thus, a given event might be sent multiple times to the same client under different subscriptions.
Every subscription instance, based on a topic URI and some options, has a unique ID. All
subscribers of the same subscription are given the same subscription ID.<a href="#section-4.5-6" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.5-7">
<pre>                             +----------+          +------------+        +----------+
                             |          |          |   Exact    |        |Subscriber|
                             |          |--Event--&gt;|Subscription|---+---&gt;|   peer   |
                             |          |          +------------+   |    +----------+
 +----------+                |          |          +------------+   |    +----------+
 |Publisher |                |  Broker  |          |  Wildcard  |   +---&gt;|Subscriber|
 |   peer   |--Publication--&gt;|          |--Event--&gt;|Subscription|---+---&gt;|   peer   |
 +----------+                |          |          +------------+   |    +----------+
                             |          |          +------------+   |    +----------+
                             |          |          |   Prefix   |   +---&gt;|Subscriber|
                             |          |--Event--&gt;|Subscription|-------&gt;|   peer   |
                             +----------+          +------------+        +----------+
</pre><a href="#section-4.5-7" class="pilcrow">¶</a>
</div>
<p id="section-4.5-8">If the <em>Broker</em> and the <em>Subscriber</em> support <strong>pattern-based subscriptions</strong>, this matching can happen by<a href="#section-4.5-8" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-4.5-9.1">prefix-matching policy<a href="#section-4.5-9.1" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-4.5-9.2">wildcard-matching policy<a href="#section-4.5-9.2" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-4.5-10"><strong>Feature Announcement</strong><a href="#section-4.5-10" class="pilcrow">¶</a></p>
<p id="section-4.5-11">Support for this feature MUST be announced by <em>Subscribers</em> (<code>role := "subscriber"</code>) and <em>Brokers</em> (<code>role := "broker"</code>) via<a href="#section-4.5-11" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.5-12">
<pre>    HELLO.Details.roles.&lt;role&gt;.features.
        pattern_based_subscription|bool := true
</pre><a href="#section-4.5-12" class="pilcrow">¶</a>
</div>
<div id="prefix-matching-1">
<section id="section-4.5.1">
          <h4 id="name-prefix-matching-2">
<a href="#section-4.5.1" class="section-number selfRef">4.5.1. </a><a href="#name-prefix-matching-2" class="section-name selfRef">Prefix Matching</a>
          </h4>
<p id="section-4.5.1-1">A <em>Subscriber</em> requests <strong>prefix-matching policy</strong> with a subscription request by setting<a href="#section-4.5.1-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.5.1-2">
<pre>    SUBSCRIBE.Options.match|string := "prefix"
</pre><a href="#section-4.5.1-2" class="pilcrow">¶</a>
</div>
<p id="section-4.5.1-3"><em>Example</em><a href="#section-4.5.1-3" class="pilcrow">¶</a></p>
<div class="lang-json sourcecode" id="section-4.5.1-4">
<pre>    [
        32,
        912873614,
        {
            "match": "prefix"
        },
        "com.myapp.topic.emergency"
    ]
</pre><a href="#section-4.5.1-4" class="pilcrow">¶</a>
</div>
<p id="section-4.5.1-5">When a <strong>prefix-matching policy</strong> is in place, any event with a topic that has <code>SUBSCRIBE.Topic</code> as a <em>prefix</em> will match the subscription, and potentially be delivered to <em>Subscribers</em> on the subscription.<a href="#section-4.5.1-5" class="pilcrow">¶</a></p>
<p id="section-4.5.1-6">In the above example, events with <code>PUBLISH.Topic</code><a href="#section-4.5.1-6" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-4.5.1-7.1">
              <code>com.myapp.topic.emergency.11</code><a href="#section-4.5.1-7.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-4.5.1-7.2">
              <code>com.myapp.topic.emergency-low</code><a href="#section-4.5.1-7.2" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-4.5.1-7.3">
              <code>com.myapp.topic.emergency.category.severe</code><a href="#section-4.5.1-7.3" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-4.5.1-7.4">
              <code>com.myapp.topic.emergency</code><a href="#section-4.5.1-7.4" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-4.5.1-8">will all apply for dispatching. An event with <code>PUBLISH.Topic</code> e.g. <code>com.myapp.topic.emerge</code> will not apply.<a href="#section-4.5.1-8" class="pilcrow">¶</a></p>
</section>
</div>
<div id="wildcard-matching-1">
<section id="section-4.5.2">
          <h4 id="name-wildcard-matching-2">
<a href="#section-4.5.2" class="section-number selfRef">4.5.2. </a><a href="#name-wildcard-matching-2" class="section-name selfRef">Wildcard Matching</a>
          </h4>
<p id="section-4.5.2-1">A <em>Subscriber</em> requests <strong>wildcard-matching policy</strong> with a subscription request by setting<a href="#section-4.5.2-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.5.2-2">
<pre>    SUBSCRIBE.Options.match|string := "wildcard"
</pre><a href="#section-4.5.2-2" class="pilcrow">¶</a>
</div>
<p id="section-4.5.2-3">Wildcard-matching allows to provide wildcards for <strong>whole</strong> URI components.<a href="#section-4.5.2-3" class="pilcrow">¶</a></p>
<p id="section-4.5.2-4"><em>Example</em><a href="#section-4.5.2-4" class="pilcrow">¶</a></p>
<div class="lang-json sourcecode" id="section-4.5.2-5">
<pre>    [
        32,
        912873614,
        {
            "match": "wildcard"
        },
        "com.myapp..userevent"
    ]
</pre><a href="#section-4.5.2-5" class="pilcrow">¶</a>
</div>
<p id="section-4.5.2-6">In above subscription request, the 3rd URI component is empty, which signals a wildcard in that URI component position. In this example, events with <code>PUBLISH.Topic</code><a href="#section-4.5.2-6" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-4.5.2-7.1">
              <code>com.myapp.foo.userevent</code><a href="#section-4.5.2-7.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-4.5.2-7.2">
              <code>com.myapp.bar.userevent</code><a href="#section-4.5.2-7.2" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-4.5.2-7.3">
              <code>com.myapp.a12.userevent</code><a href="#section-4.5.2-7.3" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-4.5.2-8">will all apply for dispatching. Events with <code>PUBLISH.Topic</code><a href="#section-4.5.2-8" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-4.5.2-9.1">
              <code>com.myapp.foo.userevent.bar</code><a href="#section-4.5.2-9.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-4.5.2-9.2">
              <code>com.myapp.foo.user</code><a href="#section-4.5.2-9.2" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-4.5.2-9.3">
              <code>com.myapp2.foo.userevent</code><a href="#section-4.5.2-9.3" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-4.5.2-10">will not apply for dispatching.<a href="#section-4.5.2-10" class="pilcrow">¶</a></p>
</section>
</div>
<div id="design-aspects-1">
<section id="section-4.5.3">
          <h4 id="name-design-aspects-2">
<a href="#section-4.5.3" class="section-number selfRef">4.5.3. </a><a href="#name-design-aspects-2" class="section-name selfRef">Design Aspects</a>
          </h4>
<p id="section-4.5.3-1"><strong>No set semantics</strong><a href="#section-4.5.3-1" class="pilcrow">¶</a></p>
<p id="section-4.5.3-2">Since each <em>Subscriber's</em> subscription "stands on its own", there is no <em>set semantics</em> implied by pattern-based subscriptions.<a href="#section-4.5.3-2" class="pilcrow">¶</a></p>
<p id="section-4.5.3-3">E.g. a <em>Subscriber</em> cannot subscribe to a broad pattern, and then unsubscribe from a subset of that broad pattern to form a more complex subscription. Each subscription is separate.<a href="#section-4.5.3-3" class="pilcrow">¶</a></p>
<p id="section-4.5.3-4"><strong>Events matching multiple subscriptions</strong><a href="#section-4.5.3-4" class="pilcrow">¶</a></p>
<p id="section-4.5.3-5">When a single event matches more than one of a <em>Subscriber's</em> subscriptions, the event will be delivered for each subscription.<a href="#section-4.5.3-5" class="pilcrow">¶</a></p>
<p id="section-4.5.3-6">The <em>Subscriber</em> can detect the delivery of that same event on multiple subscriptions via <code>EVENT.PUBLISHED.Publication</code>, which will be identical.<a href="#section-4.5.3-6" class="pilcrow">¶</a></p>
<p id="section-4.5.3-7"><strong>Concrete topic published to</strong><a href="#section-4.5.3-7" class="pilcrow">¶</a></p>
<p id="section-4.5.3-8">If a subscription was established with a pattern-based matching policy, a <em>Broker</em> MUST supply the original <code>PUBLISH.Topic</code> as provided by the <em>Publisher</em> in<a href="#section-4.5.3-8" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.5.3-9">
<pre>    EVENT.Details.topic|uri
</pre><a href="#section-4.5.3-9" class="pilcrow">¶</a>
</div>
<p id="section-4.5.3-10">to the <em>Subscribers</em>.<a href="#section-4.5.3-10" class="pilcrow">¶</a></p>
<p id="section-4.5.3-11"><em>Example</em><a href="#section-4.5.3-11" class="pilcrow">¶</a></p>
<div class="lang-json sourcecode" id="section-4.5.3-12">
<pre>    [
        36,
        5512315355,
        4429313566,
        {
            "topic": "com.myapp.topic.emergency.category.severe"
        },
        ["Hello, world!"]
    ]
</pre><a href="#section-4.5.3-12" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="pubsub-sharded-subscription">
<section id="section-4.6">
        <h3 id="name-sharded-subscription">
<a href="#section-4.6" class="section-number selfRef">4.6. </a><a href="#name-sharded-subscription" class="section-name selfRef">Sharded Subscription</a>
        </h3>
<p id="section-4.6-1">Feature status: <strong>alpha</strong><a href="#section-4.6-1" class="pilcrow">¶</a></p>
<p id="section-4.6-2">Support for this feature MUST be announced by <em>Publishers</em> (<code>role := "publisher"</code>), <em>Subscribers</em> (<code>role := "subscriber"</code>) and <em>Brokers</em> (<code>role := "broker"</code>) via<a href="#section-4.6-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.6-3">
<pre>    HELLO.Details.roles.&lt;role&gt;.features.shareded_subscriptions|
        bool := true
</pre><a href="#section-4.6-3" class="pilcrow">¶</a>
</div>
<p id="section-4.6-4">Resource keys: <code>PUBLISH.Options.rkey|string</code> is a stable, technical <strong>resource key</strong>.<a href="#section-4.6-4" class="pilcrow">¶</a></p>
<blockquote id="section-4.6-5">
          <p id="section-4.6-5.1">E.g. if your sensor has a unique serial identifier, you can use that.<a href="#section-4.6-5.1" class="pilcrow">¶</a></p>
</blockquote>
<p id="section-4.6-6"><em>Example</em><a href="#section-4.6-6" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.6-7">
<pre>    [16, 239714735, {"rkey": "sn239019"}, "com.myapp.sensor.sn239019.
        temperature", [33.9]]
</pre><a href="#section-4.6-7" class="pilcrow">¶</a>
</div>
<p id="section-4.6-8">Node keys: <code>SUBSCRIBE.Options.nkey|string</code> is a stable, technical <strong>node key</strong>.<a href="#section-4.6-8" class="pilcrow">¶</a></p>
<blockquote id="section-4.6-9">
          <p id="section-4.6-9.1">E.g. if your backend process runs on a dedicated host, you can use its hostname.<a href="#section-4.6-9.1" class="pilcrow">¶</a></p>
</blockquote>
<p id="section-4.6-10"><em>Example</em><a href="#section-4.6-10" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.6-11">
<pre>    [32, 912873614, {"match": "wildcard", "nkey": "node23"},
        "com.myapp.sensor..temperature"]
</pre><a href="#section-4.6-11" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="pubsub-event-history">
<section id="section-4.7">
        <h3 id="name-event-history">
<a href="#section-4.7" class="section-number selfRef">4.7. </a><a href="#name-event-history" class="section-name selfRef">Event History</a>
        </h3>
<p id="section-4.7-1">Instead of complex QoS for message delivery, a <em>Broker</em> may provide <em>Event History</em>. With event history, a <em>Subscriber</em>
is responsible for handling overlaps (duplicates) when it wants "exactly-once" message processing across restarts.<a href="#section-4.7-1" class="pilcrow">¶</a></p>
<p id="section-4.7-2">The event history may be transient, or it may be persistent where it survives <em>Broker</em> restarts.<a href="#section-4.7-2" class="pilcrow">¶</a></p>
<p id="section-4.7-3">The <em>Broker</em> implementation may allow for configuration of event history on a per-topic or per-topic-pattern
basis. Such configuration could enable/disable the feature, set the event history storage location,
set parameters for sub-features such as compression, or set the event history data retention policy.<a href="#section-4.7-3" class="pilcrow">¶</a></p>
<p id="section-4.7-4">Event History saves events published to discrete subscriptions, in the chronological order received by the broker.
Let us examine an example.<a href="#section-4.7-4" class="pilcrow">¶</a></p>
<p id="section-4.7-5">Subscriptions:<a href="#section-4.7-5" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="compact type-1" id="section-4.7-6">
<li id="section-4.7-6.1">Subscription to exact match 'com.mycompany.log.auth' topic<a href="#section-4.7-6.1" class="pilcrow">¶</a>
</li>
          <li id="section-4.7-6.2">Subscription to exact match 'com.mycompany.log.basket' topic<a href="#section-4.7-6.2" class="pilcrow">¶</a>
</li>
          <li id="section-4.7-6.3">Subscription to prefix-based 'com.mycompany.log' topic<a href="#section-4.7-6.3" class="pilcrow">¶</a>
</li>
        </ol>
<p id="section-4.7-7">Publication messages:<a href="#section-4.7-7" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="compact type-1" id="section-4.7-8">
<li id="section-4.7-8.1">Publication to topic 'com.mycompany.log.auth'. Forwarded as events to subscriptions 1 and 3.<a href="#section-4.7-8.1" class="pilcrow">¶</a>
</li>
          <li id="section-4.7-8.2">Publication to topic 'com.mycompany.log.basket'. Delivered as event to subscriptions 2 and 3.<a href="#section-4.7-8.2" class="pilcrow">¶</a>
</li>
          <li id="section-4.7-8.3">Publication to topic 'com.mycompany.log.basket'. Delivered as events to subscriptions 2 and 3.<a href="#section-4.7-8.3" class="pilcrow">¶</a>
</li>
          <li id="section-4.7-8.4">Publication to topic 'com.mycompany.log.basket'. Delivered as events subscriptions 2 and 3.<a href="#section-4.7-8.4" class="pilcrow">¶</a>
</li>
          <li id="section-4.7-8.5">Publication to topic 'com.mycompany.log.checkout'. Delivered as an event to subscription 3 only.<a href="#section-4.7-8.5" class="pilcrow">¶</a>
</li>
        </ol>
<p id="section-4.7-9">Event History:<a href="#section-4.7-9" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-4.7-10.1">Event history for subscription 1 contains publication 1 only.<a href="#section-4.7-10.1" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-4.7-10.2">Event history for subscription 2 contains publications 2, 3, and 4.<a href="#section-4.7-10.2" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-4.7-10.3">Event history for subscription 3 contains all publications.<a href="#section-4.7-10.3" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-4.7-11"><strong>Feature Announcement</strong><a href="#section-4.7-11" class="pilcrow">¶</a></p>
<p id="section-4.7-12">A <em>Broker</em> that implements <em>event history</em> must indicate
<code>HELLO.roles.broker.features.event_history = true</code>, must announce the role <code>HELLO.roles.callee</code>,
and must provide the meta procedures described below.<a href="#section-4.7-12" class="pilcrow">¶</a></p>
<p id="section-4.7-13"><strong>Receiving Event History</strong><a href="#section-4.7-13" class="pilcrow">¶</a></p>
<p id="section-4.7-14">A <em>Caller</em> can request message history by calling the <em>Broker</em> meta procedure<a href="#section-4.7-14" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.7-15">
<pre>    wamp.subscription.get_events
</pre><a href="#section-4.7-15" class="pilcrow">¶</a>
</div>
<p id="section-4.7-16">With payload:<a href="#section-4.7-16" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-4.7-17.1">
            <code>Arguments</code> = <code>[subscription|id]</code>. The subscription id for which to retrieve event history<a href="#section-4.7-17.1" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-4.7-17.2">
            <p id="section-4.7-17.2.1"><code>ArgumentsKw</code>:<a href="#section-4.7-17.2.1" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-4.7-17.2.2.1">
                <code>reverse</code>. Boolean. Optional. Traverses events in reverse order of occurrence.
The default is to traverse events in order of occurrence.<a href="#section-4.7-17.2.2.1" class="pilcrow">¶</a>
</li>
              <li class="compact" id="section-4.7-17.2.2.2">
                <code>limit</code>. Positive integer. Optional. Indicates the maximum number of events to retrieve. Can be used for pagination.<a href="#section-4.7-17.2.2.2" class="pilcrow">¶</a>
</li>
              <li class="compact" id="section-4.7-17.2.2.3">
                <code>from_time</code>. RFC3339-formatted timestamp string. Optional. Only include publications occurring at the
given timestamp or after (using <code>&gt;=</code> comparison).<a href="#section-4.7-17.2.2.3" class="pilcrow">¶</a>
</li>
              <li class="compact" id="section-4.7-17.2.2.4">
                <code>after_time</code>. RFC3339-formatted timestamp string. Optional. Only include publications occurring after the
given timestamp (using <code>&gt;</code> comparison).<a href="#section-4.7-17.2.2.4" class="pilcrow">¶</a>
</li>
              <li class="compact" id="section-4.7-17.2.2.5">
                <code>before_time</code>. RFC3339-formatted timestamp string. Optional. Only include publications occurring before the
given timestamp (using <code>&lt;</code> comparison).<a href="#section-4.7-17.2.2.5" class="pilcrow">¶</a>
</li>
              <li class="compact" id="section-4.7-17.2.2.6">
                <code>until_time</code>. RFC3339-formatted timestamp string. Optional. Only include publications occurring before the
given timestamp including date itself (using <code>&lt;=</code> comparison).<a href="#section-4.7-17.2.2.6" class="pilcrow">¶</a>
</li>
              <li class="compact" id="section-4.7-17.2.2.7">
                <code>topic</code>. WAMP URI. Optional. For pattern-based subscriptions, only include publications to
the specified topic.<a href="#section-4.7-17.2.2.7" class="pilcrow">¶</a>
</li>
              <li class="compact" id="section-4.7-17.2.2.8">
                <code>from_publication</code>. Positive integer. Optional. Events in the results must have occurred at or following the event with the given <code>publication|id</code> (includes the event with the given <code>publication|id</code> in the results).<a href="#section-4.7-17.2.2.8" class="pilcrow">¶</a>
</li>
              <li class="compact" id="section-4.7-17.2.2.9">
                <code>after_publication</code>. Positive integer. Optional. Events in the results must have occurred following the event with the given <code>publication_id</code> (excludes the event with the given <code>publication|id</code> in the results).
Useful for pagination: pass the <code>publication|id</code>
attribute of the last event returned in the previous page of results when navigating in order of occurrence (<code>reverse</code> argument absent or false).<a href="#section-4.7-17.2.2.9" class="pilcrow">¶</a>
</li>
              <li class="compact" id="section-4.7-17.2.2.10">
                <code>before_publication</code>. Positive integer. Optional. Events in the results must have occurred previously to the event with the given <code>publication|id</code> (excludes the event with the given <code>publication|id</code> in the results).
Useful for pagination: pass the <code>publication|id</code>
attribute of the last event returned in the previous page of results when navigating in reverse order of occurrence (<code>reverse=true</code>).<a href="#section-4.7-17.2.2.10" class="pilcrow">¶</a>
</li>
              <li class="compact" id="section-4.7-17.2.2.11">
                <code>until_publication</code>. Positive integer. Optional. Events in the results must have occurred at or previously to the event with the given <code>publication|id</code> (includes the event with the given <code>publication|id</code> in the results).<a href="#section-4.7-17.2.2.11" class="pilcrow">¶</a>
</li>
            </ul>
</li>
        </ul>
<p id="section-4.7-18">It is possible to pass multiple options at the same time. In this case they will be treated as conditions with
logical <code>AND</code>. Note that the <code>publication|id</code> event attribute is not ordered as it belongs to the Global scope. But since events are
stored in the order they are received by the broker, it is possible to find an event with the specified <code>publication|id</code> and then
return events including or excluding the matched one depending on the <code>*_publication</code> filter attributes.<a href="#section-4.7-18" class="pilcrow">¶</a></p>
<p id="section-4.7-19">The <code>arguments</code> payload field returned by the above RPC uses the same schema: an array of <code>Event</code> objects containing
an additional <code>timestamp</code> string attribute in <a href="https://www.ietf.org/rfc/rfc3339.txt">RFC3339</a> format. It can also be an empty array in the case where there were no publications to the
specified subscription, or all events were filtered out by the specified criteria. Additional general information
about the query may be returned via the <code>argumentsKw</code> payload field.<a href="#section-4.7-19" class="pilcrow">¶</a></p>
<div class="lang-javascript sourcecode" id="section-4.7-20">
<pre>  [
    {
        "timestamp": "yyyy-MM-ddThh:mm:ss.SSSZ", // string with event date/time in RFC3339 format
        "subscription": 2342423, // The subscription ID of the event
        "publication": 32445235, // The original publication ID of the event
        "details": {},           // The original details of the event
        "args": [],              // The original list arguments payload of the event. May be ommited
        "kwargs": {}             // The original key-value arguments payload of the event. May be ommited
    }
  ]
</pre><a href="#section-4.7-20" class="pilcrow">¶</a>
</div>
<p id="section-4.7-21">Clients should not rely on timestamps being unique and monotonic. When events occur in quick succession, it's possible for some of them to have the same timestamp. When a router in an IoT system is deployed off-grid and is not synchronized to an NTP server, it's possible for the timestamps to jump backwards when the router's wall clock time or time zone is manually adjusted.<a href="#section-4.7-21" class="pilcrow">¶</a></p>
<p id="section-4.7-22">In cases where the events list is too large to send as a single RPC result, router implementations
may provide additional options, such as pagination or returning progressive results.<a href="#section-4.7-22" class="pilcrow">¶</a></p>
<p id="section-4.7-23">As the Event History feature operates on <code>subscription|id</code>, there can be situations when there are not yet any
subscribers to a topic of interest, but publications to the topic occur. In this situation, the <em>Broker</em> cannot
predict that events under that topic should be stored. If the <em>Broker</em> implementation allows configuration on
a per-topic basis, it may overcome this situations by preinitializing history-enabled topics with "dummy"
subscriptions even if there are not yet any real subscribers to those topics.<a href="#section-4.7-23" class="pilcrow">¶</a></p>
<p id="section-4.7-24">Sometimes, a client may not be willing to subscribe to a topic just for the purpose of obtaining a subscription id.
In that case a client may use other <a href="#name-procedures-3">Subscriptions Meta API RPC</a> for retrieving subscription
IDs by topic URIs if the router supports it.<a href="#section-4.7-24" class="pilcrow">¶</a></p>
<p id="section-4.7-25"><strong>Security Aspects</strong><a href="#section-4.7-25" class="pilcrow">¶</a></p>
<p id="section-4.7-26">TODO/FIXME: This part of Event History needs more discussion and clarification.
But at least provides some basic information to take into account.<a href="#section-4.7-26" class="pilcrow">¶</a></p>
<p id="section-4.7-27">In order to request event history, a peer must be allowed to subscribe to a desired subscription first. Thus, if a peer
cannot subscribe to a topic resulting in a subscription, it means that it cannot receive events history for that
topic either. To sidestep this problem, a peer must be allowed to call related meta procedures for obtaining the
event history as described above. Prohibited Event History meta procedure calls must fail with the
<code>wamp.error.not_authorized</code> error URI.<a href="#section-4.7-27" class="pilcrow">¶</a></p>
<p id="section-4.7-28">Original publications may include additional options, such as <code>black-white-listing</code> that triggers special event
processing. These same rules must also apply to event history requests. For example, if the original publication contains
<code>eligible_authrole = 'admin'</code>, but the request for history came from a peer with <code>authrole = 'user'</code>, then even if
<code>user</code> is authorized to subscribe to the topic (and thus is authorized to ask for event history), this publication
must be filtered out from the results of this specific request, by the router side.<a href="#section-4.7-28" class="pilcrow">¶</a></p>
<p id="section-4.7-29">The <code>black-white-listing</code> feature also allows the filtering of event delivery on a <code>session ID</code> basis. In the context of
event history, this can result in unexpected behaviour: session ids are generated randomly at runtime for every
session establishment, so newly connected sessions asking for event history may receive events that were originally
excluded, or, vice versa, may not receive expected events due to session ID mismatch. To prevent this unexpected
behaviour, all events published with <code>Options.exclude|list[int]</code> or <code>Options.eligible|list[int]</code> should be ignored by
the Event History mechanism and not be saved at all.<a href="#section-4.7-29" class="pilcrow">¶</a></p>
<p id="section-4.7-30">Finally, Event History should only filter according to attributes that do not change during the run time of the router,
which are currently <code>authrole</code> and <code>authid</code>. Filtering based on ephemeral attributes like <code>session ID</code> <span class="unicode">– (U+2013)</span> and perhaps
other future custom attributes <span class="unicode">– (U+2013)</span> should result in the event not being stored in the history at all, to avoid
unintentional leaking of event information.<a href="#section-4.7-30" class="pilcrow">¶</a></p>
</section>
</div>
<div id="event-retention">
<section id="section-4.8">
        <h3 id="name-event-retention">
<a href="#section-4.8" class="section-number selfRef">4.8. </a><a href="#name-event-retention" class="section-name selfRef">Event Retention</a>
        </h3>
<p id="section-4.8-1">Event Retention is where a particular topic has an event associated with it which is delivered upon an opting-in client subscribing to the topic.<a href="#section-4.8-1" class="pilcrow">¶</a></p>
<p id="section-4.8-2">It can be used for topics that generally have single or very few Publishers notifying Subscribers of a single updating piece of data -- for example, a topic where a sensor publishes changes of temperature &amp; humidity in a data center.
It may do this every time the data changes (making the time between updates potentially very far apart), which causes an issue for new Subscribers who may need the last-known value upon connection, rather than waiting an unknown period of time until it is updated.
Event Retention covers this use case by allowing the Publisher to mark a event as 'retained', bound to the topic it was sent to, which can be delivered upon a new client subscription that asks for it.
It is similar to Event History, but allows the publisher to decide what the most important recent event is on the topic, even if other events are being delivered.<a href="#section-4.8-2" class="pilcrow">¶</a></p>
<p id="section-4.8-3">A <em>Broker</em> that advertises support MAY provide <em>event retention</em> on topics it provides.
This event retention SHOULD be provided on a best-effort basis, and MUST NOT be interpreted as permanent or reliable storage by clients.
This event retention is limited to one event that all subscribers would receive, and MAY include other supplemental events that have limited distribution (for example, a event published with subscriber black/whitelisting).<a href="#section-4.8-3" class="pilcrow">¶</a></p>
<p id="section-4.8-4">A <em>Publisher</em> can request storage of a new Retained Event by setting <code>Publish.Options.retain|bool</code> to <code>true</code>.
Lack of the key in <code>Publish.Options</code> MUST be interpreted as a <code>false</code> value.
A Broker MAY decline to provide event retention on certain topics by ignoring the <code>Publish.Options.retain</code> value.
Brokers that allow event retention on the given topic MUST set the topic Retained Event to this if it were eligible to be published on the topic.<a href="#section-4.8-4" class="pilcrow">¶</a></p>
<p id="section-4.8-5"><em>Subscribers</em> may request access to the Retained Event by setting <code>Subscribe.Options.get_retained|bool</code> to <code>true</code>.
Lack of the key in <code>Subscribe.Options</code> MUST be interpreted as a <code>false</code> value.
When they opt-in to receiving the Retained Event, the Broker MUST send the Subscriber the <strong>most recent</strong> Retained Event that they would have received if they were subscribing when it was published.
The Broker MUST NOT send the Subscriber a Retained Event that they would not be eligible to receive if they were subscribing when it was published.
The <em>Retained Event</em>, as sent to the subscribing client, MUST have <code>Event.Details.retained|bool</code> set to <code>true</code>, to inform subscribers that it is not an immediately new message.<a href="#section-4.8-5" class="pilcrow">¶</a></p>
<p id="section-4.8-6"><strong>Feature Announcement</strong><a href="#section-4.8-6" class="pilcrow">¶</a></p>
<p id="section-4.8-7">Support for this feature MUST be announced by <em>Brokers</em> (<code>role := "broker"</code>) via<a href="#section-4.8-7" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.8-8">
<pre>    Welcome.Details.roles.broker.features.event_retention|bool := true
</pre><a href="#section-4.8-8" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="subscription-revocation">
<section id="section-4.9">
        <h3 id="name-subscription-revocation">
<a href="#section-4.9" class="section-number selfRef">4.9. </a><a href="#name-subscription-revocation" class="section-name selfRef">Subscription Revocation</a>
        </h3>
<p id="section-4.9-1">Feature status: <strong>alpha</strong><a href="#section-4.9-1" class="pilcrow">¶</a></p>
<p id="section-4.9-2">This feature allows a <em>Broker</em> to actively revoke a previously granted subscription.
To achieve this, the existing UNSUBSCRIBED message is extended as described below.<a href="#section-4.9-2" class="pilcrow">¶</a></p>
<p id="section-4.9-3"><strong>Feature Announcement</strong><a href="#section-4.9-3" class="pilcrow">¶</a></p>
<p id="section-4.9-4">Support for this feature MUST be announced by <em>Subscribers</em> (role := "subscriber") and <em>Brokers</em> (role := "broker") via<a href="#section-4.9-4" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.9-5">
<pre>    HELLO.Details.roles.&lt;role&gt;.features.
         subscription_revocation|bool := true
</pre><a href="#section-4.9-5" class="pilcrow">¶</a>
</div>
<p id="section-4.9-6">If the <em>Subscriber</em> does not support subscription_revocation, the <em>Broker</em> MAY still revoke a subscription to
support administrative functionality. In this case, the <em>Broker</em> MUST NOT send an <strong>UNSUBSCRIBED</strong>
message to the <em>Subscriber</em>. The <em>Subscriber</em> MAY use the subscription meta event <code>wamp.subscription.on_unsubscribe</code>
to determine whether a session is removed from a subscription.<a href="#section-4.9-6" class="pilcrow">¶</a></p>
<p id="section-4.9-7"><strong>Extending UNSUBSCRIBED</strong><a href="#section-4.9-7" class="pilcrow">¶</a></p>
<p id="section-4.9-8">When revoking a subscription, the router has no request ID to reply to. So it's set to zero and another argument is
appended to indicate which subscription to revoke. Optionally, a reason why the subscription was revoked is also appended.<a href="#section-4.9-8" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.9-9">
<pre>    [UNSUBSCRIBED, 0, Details|dict]
</pre><a href="#section-4.9-9" class="pilcrow">¶</a>
</div>
<p id="section-4.9-10">where<a href="#section-4.9-10" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-4.9-11.1">
            <code>Details.subscription|bool</code> MUST be a previously issued subscription ID.<a href="#section-4.9-11.1" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-4.9-11.2">
            <code>Details.reason|string</code> MAY provide a reason as to why the subscription was revoked.<a href="#section-4.9-11.2" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-4.9-12"><em>Example</em><a href="#section-4.9-12" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.9-13">
<pre>    [35, 0, {"subscription": 1293722, "reason": "no longer authorized"}]
</pre><a href="#section-4.9-13" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="session-testament">
<section id="section-4.10">
        <h3 id="name-session-testament">
<a href="#section-4.10" class="section-number selfRef">4.10. </a><a href="#name-session-testament" class="section-name selfRef">Session Testament</a>
        </h3>
<p id="section-4.10-1">When a WAMP client disconnects, or the WAMP session is destroyed, it may want to notify other subscribers or publish some fixed data.
Since a client may disconnect uncleanly, this can't be done reliably by them.
A <em>Testament</em>, however, set on the server, can be reliably sent by the <em>Broker</em> once either the WAMP session has detached or the client connection has been lost, and allows this functionality.
It can be triggered when a Session is either detached (the client has disconnected from it, or frozen it, in the case of Session Resumption) or destroyed (when the WAMP session no longer exists on the server).<a href="#section-4.10-1" class="pilcrow">¶</a></p>
<p id="section-4.10-2">This allows clients that otherwise would not be able to know when other clients disconnect get a notification (for example, by using the WAMP Session Meta API) with a format the disconnected client chose.<a href="#section-4.10-2" class="pilcrow">¶</a></p>
<p id="section-4.10-3"><strong>Feature Announcement</strong><a href="#section-4.10-3" class="pilcrow">¶</a></p>
<p id="section-4.10-4">Support for this feature MUST be announced by <em>Dealers</em> (<code>role := "dealer"</code>) via<a href="#section-4.10-4" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.10-5">
<pre>    HELLO.Details.roles.dealer.features.
        testament_meta_api|bool := true
</pre><a href="#section-4.10-5" class="pilcrow">¶</a>
</div>
<p id="section-4.10-6"><strong>Testament Meta Procedures</strong><a href="#section-4.10-6" class="pilcrow">¶</a></p>
<p id="section-4.10-7">A <em>Client</em> can call the following procedures to set/flush Testaments:<a href="#section-4.10-7" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-4.10-8.1">
            <code>wamp.session.add_testament</code> to add a Testament which will be published on a particular topic when the Session is detached or destroyed.<a href="#section-4.10-8.1" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-4.10-8.2">
            <code>wamp.session.flush_testaments</code> to remove the Testaments for that Session, either for when it is detached or destroyed.<a href="#section-4.10-8.2" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-4.10-9"><strong>wamp.session.add_testament</strong><a href="#section-4.10-9" class="pilcrow">¶</a></p>
<p id="section-4.10-10">Adds a new testament:<a href="#section-4.10-10" class="pilcrow">¶</a></p>
<p id="section-4.10-11"><em>Positional arguments</em><a href="#section-4.10-11" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="compact type-1" id="section-4.10-12">
<li id="section-4.10-12.1">
            <code>topic|uri</code> - the topic to publish the event on<a href="#section-4.10-12.1" class="pilcrow">¶</a>
</li>
          <li id="section-4.10-12.2">
            <code>args|list</code> - positional arguments for the event<a href="#section-4.10-12.2" class="pilcrow">¶</a>
</li>
          <li id="section-4.10-12.3">
            <code>kwargs|dict</code> - keyword arguments for the event<a href="#section-4.10-12.3" class="pilcrow">¶</a>
</li>
        </ol>
<p id="section-4.10-13"><em>Keyword arguments</em><a href="#section-4.10-13" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="compact type-1" id="section-4.10-14">
<li id="section-4.10-14.1">
            <code>publish_options|dict</code> - options for the event when it is published -- see <code>Publish.Options</code>. Not all options may be honoured (for example, <code>acknowledge</code>). By default, there are no options.<a href="#section-4.10-14.1" class="pilcrow">¶</a>
</li>
          <li id="section-4.10-14.2">
            <code>scope|string</code> - When the testament should be published. Valid values are <code>detached</code> (when the WAMP session is detached, for example, when using Event Retention) or <code>destroyed</code> (when the WAMP session is finalized and destroyed on the Broker). Default MUST be <code>destroyed</code>.<a href="#section-4.10-14.2" class="pilcrow">¶</a>
</li>
        </ol>
<p id="section-4.10-15"><code>wamp.session.add_testament</code> does not return a value.<a href="#section-4.10-15" class="pilcrow">¶</a></p>
<p id="section-4.10-16"><strong>wamp.session.flush_testaments</strong><a href="#section-4.10-16" class="pilcrow">¶</a></p>
<p id="section-4.10-17">Removes testaments for the given scope:<a href="#section-4.10-17" class="pilcrow">¶</a></p>
<p id="section-4.10-18"><em>Keyword arguments</em><a href="#section-4.10-18" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="compact type-1" id="section-4.10-19">
<li id="section-4.10-19.1">
            <code>scope|string</code> - Which set of testaments to be removed. Valid values are the same as <code>wamp.session.add_testament</code>, and the default MUST be <code>destroyed</code>.<a href="#section-4.10-19.1" class="pilcrow">¶</a>
</li>
        </ol>
<p id="section-4.10-20"><code>wamp.session.flush_testaments</code> does not return a value.<a href="#section-4.10-20" class="pilcrow">¶</a></p>
<p id="section-4.10-21"><strong>Testaments in Use</strong><a href="#section-4.10-21" class="pilcrow">¶</a></p>
<p id="section-4.10-22">A <em>Client</em> that wishes to send some form of data when their <em>Session</em> ends unexpectedly or their <em>Transport</em> becomes lost can set a testament using the WAMP Testament Meta API, when a <em>Router</em> supports it.
For example, a client may call <code>add_testament</code> (this example uses the implicit <code>scope</code> option of <code>destroyed</code>):<a href="#section-4.10-22" class="pilcrow">¶</a></p>
<div class="lang-python sourcecode" id="section-4.10-23">
<pre>yield self.call('wamp.session.add_testament',
                'com.myapp.mytopic', ['Seeya!'], {'my_name': 'app1'})
</pre><a href="#section-4.10-23" class="pilcrow">¶</a>
</div>
<p id="section-4.10-24">The <em>Router</em> will then store this information on the WAMP Session, either in a <code>detached</code> or <code>destroyed</code> bucket, in the order they were added.
A client MUST be able to set multiple testaments per-scope.
If the <em>Router</em> does not support Session Resumption (therefore removing the distinction between a detached and destroyed session), it MUST still use these two separate buckets to allow <code>wamp.session.flush_testaments</code> to work.<a href="#section-4.10-24" class="pilcrow">¶</a></p>
<p id="section-4.10-25">When a <em>Session</em> is <em>detached</em>, the <em>Router</em> will inspect it for any Testaments in the <code>detached</code> scope, and publish them in the order that the Router received them, on the specified topic, with the specified arguments, keyword arguments, and publish options.
The <em>Router</em> MAY ignore publish options that do not make sense for a Testament (for example, acknowledged publishes).<a href="#section-4.10-25" class="pilcrow">¶</a></p>
<p id="section-4.10-26">When a <em>Session</em> is going to be <em>destroyed</em>, the <em>Router</em> will inspect it for any Testaments in the <code>destroyed</code> scope, and publish them in the same way as it would for the <code>detached</code> scope, in the order that they were received.<a href="#section-4.10-26" class="pilcrow">¶</a></p>
<p id="section-4.10-27">A <em>Router</em> that does not allow Session Resumption MUST send <code>detached</code>-scope Testaments before <code>destroyed</code>-scope Testaments.<a href="#section-4.10-27" class="pilcrow">¶</a></p>
<p id="section-4.10-28">A <em>Client</em> can also clear testaments if the information is no longer relevant (for example, it is shutting down completely cleanly).
For example, a client may call <code>wamp.session.flush_testaments</code>:<a href="#section-4.10-28" class="pilcrow">¶</a></p>
<div class="lang-python sourcecode" id="section-4.10-29">
<pre>yield self.call('wamp.session.flush_testaments', scope='detached')
yield self.call('wamp.session.flush_testaments', scope='destroyed')
</pre><a href="#section-4.10-29" class="pilcrow">¶</a>
</div>
<p id="section-4.10-30">The <em>Router</em> will then flush all Testaments stored for the given scope.<a href="#section-4.10-30" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="auth-methods">
<section id="section-5">
      <h2 id="name-authentication-methods">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-authentication-methods" class="section-name selfRef">Authentication Methods</a>
      </h2>
<p id="section-5-1">Authentication is a complex area. Some applications might want to leverage authentication information coming from the transport underlying WAMP, e.g. HTTP cookies or TLS certificates.<a href="#section-5-1" class="pilcrow">¶</a></p>
<p id="section-5-2">Some transports might imply trust or implicit authentication by their very nature, e.g. Unix domain sockets with appropriate file system permissions in place.<a href="#section-5-2" class="pilcrow">¶</a></p>
<p id="section-5-3">Other application might want to perform their own authentication using external mechanisms (completely outside and independent of WAMP).<a href="#section-5-3" class="pilcrow">¶</a></p>
<p id="section-5-4">Some applications might want to perform their own authentication schemes by using basic WAMP mechanisms, e.g. by using application-defined remote procedure calls.<a href="#section-5-4" class="pilcrow">¶</a></p>
<p id="section-5-5">And some applications might want to use a transport independent scheme, nevertheless predefined by WAMP.<a href="#section-5-5" class="pilcrow">¶</a></p>
<p id="section-5-6"><strong>WAMP-level Authentication</strong><a href="#section-5-6" class="pilcrow">¶</a></p>
<p id="section-5-7">The message flow between Clients and Routers for establishing and tearing down sessions MAY involve the following messages which authenticate a session:<a href="#section-5-7" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="compact type-1" id="section-5-8">
<li id="section-5-8.1">
          <code>CHALLENGE</code><a href="#section-5-8.1" class="pilcrow">¶</a>
</li>
        <li id="section-5-8.2">
          <code>AUTHENTICATE</code><a href="#section-5-8.2" class="pilcrow">¶</a>
</li>
      </ol>
<div class="alignLeft art-text artwork" id="section-5-9">
<pre>     ,------.          ,------.
     |Client|          |Router|
     `--+---'          `--+---'
        |      HELLO      |
        | ----------------&gt;
        |                 |
        |    CHALLENGE    |
        | &lt;----------------
        |                 |
        |   AUTHENTICATE  |
        | ----------------&gt;
        |                 |
        | WELCOME or ABORT|
        | &lt;----------------
     ,--+---.          ,--+---.
     |Client|          |Router|
     `------'          `------'
</pre><a href="#section-5-9" class="pilcrow">¶</a>
</div>
<p id="section-5-10">Concrete use of <code>CHALLENGE</code> and <code>AUTHENTICATE</code> messages depends on the specific authentication method.<a href="#section-5-10" class="pilcrow">¶</a></p>
<p id="section-5-11">See <a href="#wampcra">WAMP Challenge-Response Authentication</a> or <a href="#ticketauth">ticket authentication</a> for the use in these authentication methods.<a href="#section-5-11" class="pilcrow">¶</a></p>
<p id="section-5-12">If two-factor authentication is desired, then two subsequent rounds of <code>CHALLENGE</code> and <code>RESPONSE</code> may be employed.<a href="#section-5-12" class="pilcrow">¶</a></p>
<p id="section-5-13"><em>CHALLENGE</em><a href="#section-5-13" class="pilcrow">¶</a></p>
<p id="section-5-14">An authentication MAY be required for the establishment of a session. Such requirement MAY be based on the <code>Realm</code> the connection is requested for.<a href="#section-5-14" class="pilcrow">¶</a></p>
<p id="section-5-15">To request authentication, the Router MUST send a <code>CHALLENGE</code> message to the <em>Endpoint</em>.<a href="#section-5-15" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5-16">
<pre>    [CHALLENGE, AuthMethod|string, Extra|dict]
</pre><a href="#section-5-16" class="pilcrow">¶</a>
</div>
<p id="section-5-17"><em>AUTHENTICATE</em><a href="#section-5-17" class="pilcrow">¶</a></p>
<p id="section-5-18">In response to a <code>CHALLENGE</code> message, the Client MUST send an <code>AUTHENTICATE</code> message.<a href="#section-5-18" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5-19">
<pre>    [AUTHENTICATE, Signature|string, Extra|dict]
</pre><a href="#section-5-19" class="pilcrow">¶</a>
</div>
<p id="section-5-20">If the authentication succeeds, the Router MUST send a <code>WELCOME</code> message, else it MUST send an <code>ABORT</code> message.<a href="#section-5-20" class="pilcrow">¶</a></p>
<p id="section-5-21"><strong>Transport-level Authentication</strong><a href="#section-5-21" class="pilcrow">¶</a></p>
<p id="section-5-22"><em>Cookie-based Authentication</em><a href="#section-5-22" class="pilcrow">¶</a></p>
<p id="section-5-23">When running WAMP over WebSocket, the transport provides HTTP client cookies during the WebSocket opening handshake. The cookies can be used to authenticate one peer (the client) against the other (the server). The other authentication direction cannot be supported by cookies.<a href="#section-5-23" class="pilcrow">¶</a></p>
<p id="section-5-24">This transport-level authentication information may be forwarded to the WAMP level within <code>HELLO.Details.transport.auth|any</code> in the client-to-server direction.<a href="#section-5-24" class="pilcrow">¶</a></p>
<p id="section-5-25"><em>TLS Certificate Authentication</em><a href="#section-5-25" class="pilcrow">¶</a></p>
<p id="section-5-26">When running WAMP over a TLS (either secure WebSocket or raw TCP) transport, a peer may authenticate to the other via the TLS certificate mechanism. A server might authenticate to the client, and a client may authenticate to the server (TLS client-certificate based authentication).<a href="#section-5-26" class="pilcrow">¶</a></p>
<p id="section-5-27">This transport-level authentication information may be forwarded to the WAMP level within <code>HELLO.Details.transport.auth|any</code> in both directions (if available).<a href="#section-5-27" class="pilcrow">¶</a></p>
<div id="ticketauth">
<section id="section-5.1">
        <h3 id="name-ticket-based-authentication">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-ticket-based-authentication" class="section-name selfRef">Ticket-based Authentication</a>
        </h3>
<p id="section-5.1-1">With <em>Ticket-based authentication</em>, the client needs to present the server an authentication "ticket" - some magic value to authenticate itself to the server.<a href="#section-5.1-1" class="pilcrow">¶</a></p>
<p id="section-5.1-2">This "ticket" could be a long-lived, pre-agreed secret (e.g. a user password) or a short-lived authentication token (like a Kerberos token). WAMP does not care or interpret the ticket presented by the client.<a href="#section-5.1-2" class="pilcrow">¶</a></p>
<blockquote id="section-5.1-3">
          <p id="section-5.1-3.1">Caution: This scheme is extremely simple and flexible, but the resulting security may be limited. E.g., the ticket value will be sent over the wire. If the transport WAMP is running over is not encrypted, a man-in-the-middle can sniff and possibly hijack the ticket. If the ticket value is reused, that might enable replay attacks.<a href="#section-5.1-3.1" class="pilcrow">¶</a></p>
</blockquote>
<p id="section-5.1-4">A typical authentication begins with the client sending a <code>HELLO</code> message specifying the <code>ticket</code> method as (one of) the authentication methods:<a href="#section-5.1-4" class="pilcrow">¶</a></p>
<div class="lang-javascript sourcecode" id="section-5.1-5">
<pre>    [1, "realm1",
      {
        "roles": ...,
        "authmethods": ["ticket"],
        "authid": "joe"
      }
    ]
</pre><a href="#section-5.1-5" class="pilcrow">¶</a>
</div>
<p id="section-5.1-6">The <code>HELLO.Details.authmethods|list</code> is used by the client to announce the authentication methods it is prepared to perform. For Ticket-based, this MUST include <code>"ticket"</code>.<a href="#section-5.1-6" class="pilcrow">¶</a></p>
<p id="section-5.1-7">The <code>HELLO.Details.authid|string</code> is the authentication ID (e.g. username) the client wishes to authenticate as. For Ticket-based authentication, this MUST be provided.<a href="#section-5.1-7" class="pilcrow">¶</a></p>
<p id="section-5.1-8">If the server is unwilling or unable to perform Ticket-based authentication, it'll either skip forward trying other authentication methods (if the client announced any) or send an <code>ABORT</code> message.<a href="#section-5.1-8" class="pilcrow">¶</a></p>
<p id="section-5.1-9">If the server is willing to let the client authenticate using a ticket and the server recognizes the provided <code>authid</code>, it'll send a <code>CHALLENGE</code> message:<a href="#section-5.1-9" class="pilcrow">¶</a></p>
<div class="lang-javascript sourcecode" id="section-5.1-10">
<pre>    [4, "ticket", {}]
</pre><a href="#section-5.1-10" class="pilcrow">¶</a>
</div>
<p id="section-5.1-11">The client will send an <code>AUTHENTICATE</code> message containing a ticket:<a href="#section-5.1-11" class="pilcrow">¶</a></p>
<div class="lang-javascript sourcecode" id="section-5.1-12">
<pre>    [5, "secret!!!", {}]
</pre><a href="#section-5.1-12" class="pilcrow">¶</a>
</div>
<p id="section-5.1-13">The server will then check if the ticket provided is permissible (for the <code>authid</code> given).<a href="#section-5.1-13" class="pilcrow">¶</a></p>
<p id="section-5.1-14">If the authentication succeeds, the server will finally respond with a <code>WELCOME</code> message:<a href="#section-5.1-14" class="pilcrow">¶</a></p>
<div class="lang-javascript sourcecode" id="section-5.1-15">
<pre>    [2, 3251278072152162,
      {
        "authid": "joe",
        "authrole": "user",
        "authmethod": "ticket",
        "authprovider": "static",
        "roles": ...
      }
    ]
</pre><a href="#section-5.1-15" class="pilcrow">¶</a>
</div>
<p id="section-5.1-16">where<a href="#section-5.1-16" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="compact type-1" id="section-5.1-17">
<li id="section-5.1-17.1">
            <code>authid|string</code>: The authentication ID the client was (actually) authenticated as.<a href="#section-5.1-17.1" class="pilcrow">¶</a>
</li>
          <li id="section-5.1-17.2">
            <code>authrole|string</code>: The authentication role the client was authenticated for.<a href="#section-5.1-17.2" class="pilcrow">¶</a>
</li>
          <li id="section-5.1-17.3">
            <code>authmethod|string</code>: The authentication method, here <code>"ticket"</code><a href="#section-5.1-17.3" class="pilcrow">¶</a>
</li>
          <li id="section-5.1-17.4">
            <code>authprovider|string</code>: The actual provider of authentication. For Ticket-based authentication, this can be freely chosen by the app, e.g. <code>static</code> or <code>dynamic</code>.<a href="#section-5.1-17.4" class="pilcrow">¶</a>
</li>
        </ol>
<p id="section-5.1-18">The <code>WELCOME.Details</code> again contain the actual authentication information active. If the authentication fails, the server will response with an <code>ABORT</code> message.<a href="#section-5.1-18" class="pilcrow">¶</a></p>
</section>
</div>
<div id="wampcra">
<section id="section-5.2">
        <h3 id="name-challenge-response-authenti">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-challenge-response-authenti" class="section-name selfRef">Challenge Response Authentication</a>
        </h3>
<p id="section-5.2-1">WAMP Challenge-Response ("WAMP-CRA") authentication is a simple, secure authentication mechanism using a shared secret. The client and the server share a secret. The secret never travels the wire, hence WAMP-CRA can be used via non-TLS connections. The actual pre-sharing of the secret is outside the scope of the authentication mechanism.<a href="#section-5.2-1" class="pilcrow">¶</a></p>
<p id="section-5.2-2">A typical authentication begins with the client sending a <code>HELLO</code> message specifying the <code>wampcra</code> method as (one of) the authentication methods:<a href="#section-5.2-2" class="pilcrow">¶</a></p>
<div class="lang-javascript sourcecode" id="section-5.2-3">
<pre>    [1, "realm1",
        {
            "roles": ...,
            "authmethods": ["wampcra"],
            "authid": "peter"
        }
    ]
</pre><a href="#section-5.2-3" class="pilcrow">¶</a>
</div>
<p id="section-5.2-4">The <code>HELLO.Details.authmethods|list</code> is used by the client to announce the authentication methods it is prepared to perform. For WAMP-CRA, this MUST include <code>"wampcra"</code>.<a href="#section-5.2-4" class="pilcrow">¶</a></p>
<p id="section-5.2-5">The <code>HELLO.Details.authid|string</code> is the authentication ID (e.g. username) the client wishes to authenticate as. For WAMP-CRA, this MUST be provided.<a href="#section-5.2-5" class="pilcrow">¶</a></p>
<p id="section-5.2-6">If the server is unwilling or unable to perform WAMP-CRA authentication, it MAY either skip forward trying other authentication methods (if the client announced any) or send an <code>ABORT</code> message.<a href="#section-5.2-6" class="pilcrow">¶</a></p>
<p id="section-5.2-7">If the server is willing to let the client authenticate using WAMP-CRA, and the server recognizes the provided <code>authid</code>, it MUST send a <code>CHALLENGE</code> message:<a href="#section-5.2-7" class="pilcrow">¶</a></p>
<div class="lang-javascript sourcecode" id="section-5.2-8">
<pre>    [4, "wampcra",
        {
            "challenge": "{ \"nonce\": \"LHRTC9zeOIrt_9U3\",
                \"authprovider\": \"userdb\", \"authid\": \"peter\",
                \"timestamp\": \"2014-06-22T16:36:25.448Z\",
                \"authrole\": \"user\", \"authmethod\": \"wampcra\",
                \"session\": 3251278072152162}"
        }
    ]
</pre><a href="#section-5.2-8" class="pilcrow">¶</a>
</div>
<p id="section-5.2-9">The <code>CHALLENGE.Details.challenge|string</code> is a string the client needs to create a signature for. The string MUST BE a JSON serialized object which MUST contain:<a href="#section-5.2-9" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="compact type-1" id="section-5.2-10">
<li id="section-5.2-10.1">
            <code>authid|string</code>: The authentication ID the client will be authenticated as when the authentication succeeds.<a href="#section-5.2-10.1" class="pilcrow">¶</a>
</li>
          <li id="section-5.2-10.2">
            <code>authrole|string</code>: The authentication role the client will be authenticated as when the authentication succeeds.<a href="#section-5.2-10.2" class="pilcrow">¶</a>
</li>
          <li id="section-5.2-10.3">
            <code>authmethod|string</code>: The authentication methods, here <code>"wampcra"</code><a href="#section-5.2-10.3" class="pilcrow">¶</a>
</li>
          <li id="section-5.2-10.4">
            <code>authprovider|string</code>: The actual provider of authentication. For WAMP-CRA, this can be freely chosen by the app, e.g. <code>userdb</code>.<a href="#section-5.2-10.4" class="pilcrow">¶</a>
</li>
          <li id="section-5.2-10.5">
            <code>nonce|string</code>: A random value.<a href="#section-5.2-10.5" class="pilcrow">¶</a>
</li>
          <li id="section-5.2-10.6">
            <code>timestamp|string</code>: The UTC timestamp (ISO8601 format) the authentication was started, e.g. <code>2014-06-22T16:51:41.643Z</code>.<a href="#section-5.2-10.6" class="pilcrow">¶</a>
</li>
          <li id="section-5.2-10.7">
            <code>session|int</code>: The WAMP session ID that will be assigned to the session once it is authenticated successfully.<a href="#section-5.2-10.7" class="pilcrow">¶</a>
</li>
        </ol>
<p id="section-5.2-11">The client needs to compute the signature as follows:<a href="#section-5.2-11" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.2-12">
<pre>    signature := HMAC[SHA256]_{secret} (challenge)
</pre><a href="#section-5.2-12" class="pilcrow">¶</a>
</div>
<p id="section-5.2-13">That is, compute the HMAC-SHA256 using the shared <code>secret</code> over the <code>challenge</code>.<a href="#section-5.2-13" class="pilcrow">¶</a></p>
<p id="section-5.2-14">After computing the signature, the client will send an <code>AUTHENTICATE</code> message containing the signature, as a base64-encoded string:<a href="#section-5.2-14" class="pilcrow">¶</a></p>
<div class="lang-javascript sourcecode" id="section-5.2-15">
<pre>    [5, "gir1mSx+deCDUV7wRM5SGIn/+R/ClqLZuH4m7FJeBVI=", {}]
</pre><a href="#section-5.2-15" class="pilcrow">¶</a>
</div>
<p id="section-5.2-16">The server will then check if<a href="#section-5.2-16" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-5.2-17.1">the signature matches the one expected<a href="#section-5.2-17.1" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-5.2-17.2">the <code>AUTHENTICATE</code> message was sent in due time<a href="#section-5.2-17.2" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-5.2-18">If the authentication succeeds, the server will finally respond with a <code>WELCOME</code> message:<a href="#section-5.2-18" class="pilcrow">¶</a></p>
<div class="lang-javascript sourcecode" id="section-5.2-19">
<pre>    [2, 3251278072152162,
        {
            "authid": "peter",
            "authrole": "user",
            "authmethod": "wampcra",
            "authprovider": "userdb",
            "roles": ...
        }
    ]
</pre><a href="#section-5.2-19" class="pilcrow">¶</a>
</div>
<p id="section-5.2-20">The <code>WELCOME.Details</code> again contain the actual authentication information active.<a href="#section-5.2-20" class="pilcrow">¶</a></p>
<p id="section-5.2-21">If the authentication fails, the server will response with an <code>ABORT</code> message.<a href="#section-5.2-21" class="pilcrow">¶</a></p>
<p id="section-5.2-22"><strong>Server-side Verification</strong><a href="#section-5.2-22" class="pilcrow">¶</a></p>
<p id="section-5.2-23">The challenge sent during WAMP-CRA contains<a href="#section-5.2-23" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="compact type-1" id="section-5.2-24">
<li id="section-5.2-24.1">random information (the <code>nonce</code>) to make WAMP-CRA robust against replay attacks<a href="#section-5.2-24.1" class="pilcrow">¶</a>
</li>
          <li id="section-5.2-24.2">timestamp information (the <code>timestamp</code>) to allow WAMP-CRA timeout on authentication requests that took too long<a href="#section-5.2-24.2" class="pilcrow">¶</a>
</li>
          <li id="section-5.2-24.3">session information (the <code>session</code>) to bind the authentication to a WAMP session ID<a href="#section-5.2-24.3" class="pilcrow">¶</a>
</li>
          <li id="section-5.2-24.4">all the authentication information that relates to authorization like <code>authid</code> and <code>authrole</code><a href="#section-5.2-24.4" class="pilcrow">¶</a>
</li>
        </ol>
<p id="section-5.2-25"><strong>Three-legged Authentication</strong><a href="#section-5.2-25" class="pilcrow">¶</a></p>
<p id="section-5.2-26">The signing of the challenge sent by the server usually is done directly on the client. However, this is no strict requirement.<a href="#section-5.2-26" class="pilcrow">¶</a></p>
<p id="section-5.2-27">E.g. a client might forward the challenge to another party (hence the "three-legged") for creating the signature. This can be used when the client was previously already authenticated to that third party, and WAMP-CRA should run piggy packed on that authentication.<a href="#section-5.2-27" class="pilcrow">¶</a></p>
<p id="section-5.2-28">The third party would, upon receiving a signing request, simply check if the client is already authenticated, and if so, create a signature for WAMP-CRA.<a href="#section-5.2-28" class="pilcrow">¶</a></p>
<p id="section-5.2-29">In this case, the secret is actually shared between the WAMP server who wants to authenticate clients using WAMP-CRA and the third party server, who shares a secret with the WAMP server.<a href="#section-5.2-29" class="pilcrow">¶</a></p>
<p id="section-5.2-30">This scenario is also the reason the challenge sent with WAMP-CRA is not simply a random value, but a JSON serialized object containing sufficient authentication information for the third party to check.<a href="#section-5.2-30" class="pilcrow">¶</a></p>
<p id="section-5.2-31"><strong>Password Salting</strong><a href="#section-5.2-31" class="pilcrow">¶</a></p>
<p id="section-5.2-32">WAMP-CRA operates using a shared secret. While the secret is never sent over the wire, a shared secret often requires storage of that secret on the client and the server - and storing a password verbatim (unencrypted) is not recommended in general.<a href="#section-5.2-32" class="pilcrow">¶</a></p>
<p id="section-5.2-33">WAMP-CRA allows the use of salted passwords following the <a href="http://en.wikipedia.org/wiki/PBKDF2">PBKDF2</a> key derivation scheme. With salted passwords, the password itself is never stored, but only a key derived from the password and a password salt. This derived key is then practically working as the new shared secret.<a href="#section-5.2-33" class="pilcrow">¶</a></p>
<p id="section-5.2-34">When the password is salted, the server will during WAMP-CRA send a <code>CHALLENGE</code> message containing additional information:<a href="#section-5.2-34" class="pilcrow">¶</a></p>
<div class="lang-javascript sourcecode" id="section-5.2-35">
<pre>    [4, "wampcra",
        {
            "challenge": "{ \"nonce\": \"LHRTC9zeOIrt_9U3\",
                \"authprovider\": \"userdb\", \"authid\": \"peter\",
                \"timestamp\": \"2014-06-22T16:36:25.448Z\",
                \"authrole\": \"user\", \"authmethod\": \"wampcra\",
                \"session\": 3251278072152162}",
            "salt": "salt123",
            "keylen": 32,
            "iterations": 1000
        }
    ]
</pre><a href="#section-5.2-35" class="pilcrow">¶</a>
</div>
<p id="section-5.2-36">The <code>CHALLENGE.Details.salt|string</code> is the password salt in use. The <code>CHALLENGE.Details.keylen|int</code> and <code>CHALLENGE.Details.iterations|int</code> are parameters for the PBKDF2 algorithm.<a href="#section-5.2-36" class="pilcrow">¶</a></p>
</section>
</div>
<div id="wamp-scram">
<section id="section-5.3">
        <h3 id="name-salted-challenge-response-a">
<a href="#section-5.3" class="section-number selfRef">5.3. </a><a href="#name-salted-challenge-response-a" class="section-name selfRef">Salted Challenge Response Authentication</a>
        </h3>
<p id="section-5.3-1">The WAMP Salted Challenge Response Authentication Mechanism ("WAMP-SCRAM"), is a password-based authentication method where the shared secret is neither transmitted nor stored as cleartext. WAMP-SCRAM is based on <a href="https://tools.ietf.org/html/rfc5802">RFC5802</a> (<em>Salted Challenge Response Authentication Mechanism</em>) and <a href="https://tools.ietf.org/html/rfc7677">RFC7677</a> (<em>SCRAM-SHA-256 and SCRAM-SHA-256-PLUS</em>).<a href="#section-5.3-1" class="pilcrow">¶</a></p>
<p id="section-5.3-2">WAMP-SCRAM supports the Argon2 (<a href="https://datatracker.ietf.org/doc/draft-irtf-cfrg-argon2/">draft-irtf-cfrg-argon2</a>) password-based key derivation function, a memory-hard algorithm intended to resist cracking on GPU hardware. PBKDF2 (<a href="https://tools.ietf.org/html/rfc2898">RFC2898</a>) is also supported for applications that are required to use primitives currently approved by cryptographic standards.<a href="#section-5.3-2" class="pilcrow">¶</a></p>
<p id="section-5.3-3"><strong>Security Considerations</strong><a href="#section-5.3-3" class="pilcrow">¶</a></p>
<p id="section-5.3-4">With WAMP-SCRAM, if the authentication database is stolen, an attacker cannot impersonate a user unless they guess the password offline by brute force.<a href="#section-5.3-4" class="pilcrow">¶</a></p>
<p id="section-5.3-5">In the event that the server's authentication database is stolen, and the attacker either eavesdrops on one authentication exchange or impersonates a server, the attacker gains the ability to impersonate that particular user on that server. If the same salt is used on other servers, the attacker would gain the ability to impersonate that user on all servers using the same salt. That's why it's important to use a per-user random salt.<a href="#section-5.3-5" class="pilcrow">¶</a></p>
<p id="section-5.3-6">An eavesdropper that captures a user authentication exchange has enough information to mount an offline, brute-force dictionary attack for that particular user. If passwords are sufficiently strong, the cost/time needed to crack a password becomes prohibitive.<a href="#section-5.3-6" class="pilcrow">¶</a></p>
<p id="section-5.3-7">Note that when HTML/JavaScript assets are served to a web browser, WAMP-SCRAM does not safeguard against a man-in-the-middle tampering with those assets. Those assets could be tampered with in a way that captures the user's password and sends it to the attacker.<a href="#section-5.3-7" class="pilcrow">¶</a></p>
<p id="section-5.3-8">In light of the above security concerns, a secure TLS transport is therefore advised to prevent such attacks. The channel binding feature of SCRAM can be used to ensure that the TLS endpoints are the same between client and router.<a href="#section-5.3-8" class="pilcrow">¶</a></p>
<p id="section-5.3-9"><strong>Deviations from RFC5802</strong><a href="#section-5.3-9" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-5.3-10">
<li id="section-5.3-10.1">
            <p id="section-5.3-10.1.1">To simplify parsing, SCRAM attributes in the authentication exchange messages are encoded as members of the <code>Options</code>/<code>Details</code> objects without escaping the <code>,</code> and <code>=</code> characters. However, the <code>AuthMessage</code> used to compute the client and server signatures DOES use the exact syntax specified in <a href="https://tools.ietf.org/html/rfc5802#section-7">RFC5802, section 7</a>. This makes it possible to use existing test vectors to verify WAMP-SCRAM implementations.<a href="#section-5.3-10.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-5.3-10.2">
            <p id="section-5.3-10.2.1">Hashing based on the weaker SHA-1 specified in <a href="https://tools.ietf.org/html/rfc5802">RFC5802</a> is intentionally not supported by WAMP-SCRAM, in favor of the stronger SHA-256 specified in <a href="https://tools.ietf.org/html/rfc7677">RFC7677</a>.<a href="#section-5.3-10.2.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-5.3-10.3">
            <p id="section-5.3-10.3.1">The <a href="https://datatracker.ietf.org/doc/draft-irtf-cfrg-argon2">Argon2</a> key derivation function MAY be used instead of PBKDF2.<a href="#section-5.3-10.3.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-5.3-10.4">
            <p id="section-5.3-10.4.1">Nonces are required to be base64-encoded, which is stricter than the <code>printable</code> syntax specification of <a href="https://tools.ietf.org/html/rfc5802">RFC5802</a>.<a href="#section-5.3-10.4.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-5.3-10.5">
            <p id="section-5.3-10.5.1">The <code>"y"</code> channel binding flag is not used as there is currently no standard way for WAMP routers to announce channel binding capabilities.<a href="#section-5.3-10.5.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-5.3-10.6">
            <p id="section-5.3-10.6.1">The use of <code>authzid</code> for user impersonation is not supported.<a href="#section-5.3-10.6.1" class="pilcrow">¶</a></p>
</li>
        </ol>
<p id="section-5.3-11"><strong>authmethod Type String</strong><a href="#section-5.3-11" class="pilcrow">¶</a></p>
<p id="section-5.3-12"><code>"wamp-scram"</code> SHALL be used as the <code>authmethod</code> type string for WAMP-SCRAM authentication. Announcement by routers of WAMP-SCRAM support is outside the scope of this document.<a href="#section-5.3-12" class="pilcrow">¶</a></p>
<p id="section-5.3-13"><strong>Base64 encoding</strong><a href="#section-5.3-13" class="pilcrow">¶</a></p>
<p id="section-5.3-14">Base64 encoding of octet strings is restricted to canonical form with no whitespace, as defined in <a href="https://tools.ietf.org/html/rfc4648">RFC4648</a> (<em>The Base16, Base32, and Base64 Data Encodings</em>).<a href="#section-5.3-14" class="pilcrow">¶</a></p>
<p id="section-5.3-15"><strong>Nonces</strong><a href="#section-5.3-15" class="pilcrow">¶</a></p>
<p id="section-5.3-16">In WAMP-SCRAM, a <em>nonce</em> (number used once) is a base64-encoded sequence of random octets. It SHOULD be of sufficient length to make a replay attack unfeasible. A length of 16 octets (128 bits) is recommended for each of the client and server-generated nonces.<a href="#section-5.3-16" class="pilcrow">¶</a></p>
<p id="section-5.3-17">See <a href="https://tools.ietf.org/html/rfc4086">RFC4086</a> (<em>Randomness Requirements for Security</em>) for best practices concerning randomness.<a href="#section-5.3-17" class="pilcrow">¶</a></p>
<p id="section-5.3-18"><strong>Salts</strong><a href="#section-5.3-18" class="pilcrow">¶</a></p>
<p id="section-5.3-19">A <em>salt</em> is a base64-encoded sequence of random octets.<a href="#section-5.3-19" class="pilcrow">¶</a></p>
<p id="section-5.3-20">To prevent rainbow table attacks in the event of database theft, the salt MUST be generated randomly by the server <strong>for each user</strong>. The random salt is stored with each user record in the authentication database.<a href="#section-5.3-20" class="pilcrow">¶</a></p>
<p id="section-5.3-21"><strong>Username/Password String Normalization</strong><a href="#section-5.3-21" class="pilcrow">¶</a></p>
<p id="section-5.3-22">Username and password strings SHALL be normalized according to the <em>SASLprep</em> profile described in <a href="https://tools.ietf.org/html/rfc4013">RFC4013</a>, using the <em>stringprep</em> algorithm described in <a href="https://tools.ietf.org/html/rfc3454">RFC3454</a>.<a href="#section-5.3-22" class="pilcrow">¶</a></p>
<p id="section-5.3-23">While SASLprep preserves the case of usernames, the server MAY choose to perform case insensitive comparisons when searching for a username in the authentication database.<a href="#section-5.3-23" class="pilcrow">¶</a></p>
<p id="section-5.3-24"><strong>Channel Binding</strong><a href="#section-5.3-24" class="pilcrow">¶</a></p>
<p id="section-5.3-25"><em>Channel binding</em> is a feature that allows a higher layer to establish that the other end of an underlying secure channel is bound to its higher layer counterpart. See <a href="https://tools.ietf.org/html/rfc5056">RFC5056</a> (<em>On the Use of Channel Bindings</em>) for an in-depth discussion.<a href="#section-5.3-25" class="pilcrow">¶</a></p>
<p id="section-5.3-26"><a href="https://tools.ietf.org/html/rfc5929">RFC5929</a> defines binding types for use with TLS transports, of which <code>tls-unique</code> and <code>tls-server-end-point</code> are applicable for WAMP-SCRAM. For each channel binding type, there is a corresponding definition of the <em>channel binding data</em> that must be sent in response to the authentication challenge.<a href="#section-5.3-26" class="pilcrow">¶</a></p>
<p id="section-5.3-27">Negotiation and announcement of channel binding is outside the scope of this document. <a href="https://tools.ietf.org/html/rfc5929#section-6">RFC5929 section 6</a> recommends that application protocols use <code>tls-unique</code> exclusively, except perhaps where server-side proxies are commonly deployed.<a href="#section-5.3-27" class="pilcrow">¶</a></p>
<p id="section-5.3-28">Note that WAMP-SCRAM channel binding is not generally possible with web browser clients due to the lack of a suitable API for this purpose.<a href="#section-5.3-28" class="pilcrow">¶</a></p>
<p id="section-5.3-29"><em>The tls-unique Channel Binding Type</em><a href="#section-5.3-29" class="pilcrow">¶</a></p>
<p id="section-5.3-30">The <code>tls-unique</code> channel binding type allows the WAMP layer to establish that the other peer is authenticating over the same, unique TLS connection. The channel binding data for this type corresponds to the bytes of the first TLS Finished message, as described in <a href="https://tools.ietf.org/html/rfc5929#section-3">RFC5929, section 3</a>. <a href="https://tools.ietf.org/html/rfc5929#section-10.2">RFC5929 section 10.2</a> addresses the concern of disclosing this data over the TLS channel (in short, the TLS Finished message would already be visible to eavesdroppers).<a href="#section-5.3-30" class="pilcrow">¶</a></p>
<p id="section-5.3-31">To safeguard against the <em>triple handshake attack</em> described in <a href="https://tools.ietf.org/html/rfc7627">RFC7627</a>, this channel binding type MUST be used over a TLS channel that uses the <em>extended master secret</em> extension, or over a TLS channel where session resumption is not permitted.<a href="#section-5.3-31" class="pilcrow">¶</a></p>
<p id="section-5.3-32"><em>The tls-server-end-point Channel Binding Type</em><a href="#section-5.3-32" class="pilcrow">¶</a></p>
<p id="section-5.3-33">The <code>tls-server-end-point</code> channel binding type allows the WAMP layer to establish that the other peer is authenticating over a TLS connection to a server having been issued a Public Key Infrastructure Certificate. The channel binding data for this type is a hash of the TLS server's certificate, computed as described in <a href="https://tools.ietf.org/html/rfc5929#section-4.1">RFC5929, section 4.1</a>. The certificate is hashed to accommodate memory-constrained implementations.<a href="#section-5.3-33" class="pilcrow">¶</a></p>
<p id="section-5.3-34"><strong>Authentication Exchange</strong><a href="#section-5.3-34" class="pilcrow">¶</a></p>
<p id="section-5.3-35">WAMP-SCRAM uses a single round of challenge/response pairs after the client authentication request and before the authentication outcome.<a href="#section-5.3-35" class="pilcrow">¶</a></p>
<p id="section-5.3-36">The mapping of RFC5802 messages to WAMP messages is as follows:<a href="#section-5.3-36" class="pilcrow">¶</a></p>
<table class="left" id="table-7">
          <caption><a href="#table-7" class="selfRef">Table 7</a></caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">SCRAM Message</th>
              <th class="text-left" rowspan="1" colspan="1">WAMP Message</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">
                <code>client-first-message</code>
</td>
              <td class="text-left" rowspan="1" colspan="1">
                <code>HELLO</code>
</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">
                <code>server-first-message</code>
</td>
              <td class="text-left" rowspan="1" colspan="1">
                <code>CHALLENGE</code>
</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">
                <code>client-final-message</code>
</td>
              <td class="text-left" rowspan="1" colspan="1">
                <code>AUTHENTICATE</code>
</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">
                <code>server-final-message</code> with <code>verifier</code>
</td>
              <td class="text-left" rowspan="1" colspan="1">
                <code>WELCOME</code>
</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">
                <code>server-final-message</code> with <code>server-error</code>
</td>
              <td class="text-left" rowspan="1" colspan="1">
                <code>ABORT</code>
</td>
            </tr>
          </tbody>
        </table>
<p id="section-5.3-38"><em>Initial Client Authentication Message</em><a href="#section-5.3-38" class="pilcrow">¶</a></p>
<p id="section-5.3-39">WAMP-SCRAM authentication begins with the client sending a <code>HELLO</code> message specifying the <code>wamp-scram</code> method as (one of) the authentication methods:<a href="#section-5.3-39" class="pilcrow">¶</a></p>
<div class="lang-javascript sourcecode" id="section-5.3-40">
<pre>    [1, "realm1",
        {
            "roles": ...,
            "authmethods": ["wamp-scram"],
            "authid": "user",
            "authextra":
                {
                    "nonce": "egVDf3DMJh0=",
                    "channel_binding": null
                }

        }
    ]
</pre><a href="#section-5.3-40" class="pilcrow">¶</a>
</div>
<p id="section-5.3-41">where:<a href="#section-5.3-41" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="compact type-1" id="section-5.3-42">
<li id="section-5.3-42.1">
            <code>authid|string</code>: The identity of the user performing authentication. This corresponds to the <code>username</code> parameter in RFC5802.<a href="#section-5.3-42.1" class="pilcrow">¶</a>
</li>
          <li id="section-5.3-42.2">
            <code>authextra.nonce|string</code>: A base64-encoded sequence of random octets, generated by the client. See <a href="#nonces">Nonces</a>.<a href="#section-5.3-42.2" class="pilcrow">¶</a>
</li>
          <li id="section-5.3-42.3">
            <code>authextra.channel_binding|string</code>: Optional string containing the desired channel binding type. See <a href="#channel-binding">Channel Bindings</a>.<a href="#section-5.3-42.3" class="pilcrow">¶</a>
</li>
        </ol>
<p id="section-5.3-43">Upon receiving the <code>HELLO</code> message, the server MUST terminate the authentication process by sending an <code>ABORT</code> message under any of the following circumstances:<a href="#section-5.3-43" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-5.3-44.1">The server does not support the WAMP-SCRAM <code>authmethods</code>, and there are no other methods left that the server supports for this <code>authid</code>.<a href="#section-5.3-44.1" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-5.3-44.2">The the server does not support the requested <code>channel_binding</code> type.<a href="#section-5.3-44.2" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-5.3-44.3">(Optional) The server does not recognize the given <code>authid</code>. In this case, the server MAY proceed with a mock <code>CHALLENGE</code> message to avoid leaking information on the existence of usernames. This mock <code>CHALLENGE</code> SHOULD contain a generated <code>salt</code> value that is always the same for a given <code>authid</code>, otherwise an attacker may discover that the user doesn't actually exist.<a href="#section-5.3-44.3" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-5.3-45"><em>Initial Server Authentication Message</em><a href="#section-5.3-45" class="pilcrow">¶</a></p>
<p id="section-5.3-46">If none of the above failure conditions apply, and the server is ready to let the client authenticate using WAMP-SCRAM, then it SHALL send a <code>CHALLENGE</code> message:<a href="#section-5.3-46" class="pilcrow">¶</a></p>
<div class="lang-javascript sourcecode" id="section-5.3-47">
<pre>    [4, "wamp-scram",
        {
            "nonce": "egVDf3DMJh0=SBmkFIh7sSo=",
            "salt": "aBc+fx0NAVA=",
            "kdf": "pbkdf2",
            "iterations": 4096,
            "memory": null
        }
    ]
</pre><a href="#section-5.3-47" class="pilcrow">¶</a>
</div>
<p id="section-5.3-48">where:<a href="#section-5.3-48" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="compact type-1" id="section-5.3-49">
<li id="section-5.3-49.1">
            <code>nonce|string</code>: A server-generated nonce that is appended to the client-generated nonce sent in the previous <code>HELLO</code> message. See <a href="#nonces">Nonces</a>.<a href="#section-5.3-49.1" class="pilcrow">¶</a>
</li>
          <li id="section-5.3-49.2">
            <code>salt|string</code>: The base64-encoded salt for this user, to be passed to the key derivation function. This value is stored with each user record in the authentication database. See <a href="#salts">Salts</a>.<a href="#section-5.3-49.2" class="pilcrow">¶</a>
</li>
          <li id="section-5.3-49.3">
            <code>kdf</code>: The key derivation function (KDF) used to hash the password. This value is stored with each user record in the authentication database. See <a href="#key-derivation-functions">Key Derivation Functions</a>.<a href="#section-5.3-49.3" class="pilcrow">¶</a>
</li>
          <li id="section-5.3-49.4">
            <code>iterations|integer</code>: The execution time cost factor to use for generating the <code>SaltedPassword</code> hash. This value is stored with each user record in the authentication database.<a href="#section-5.3-49.4" class="pilcrow">¶</a>
</li>
          <li id="section-5.3-49.5">
            <code>memory|integer</code>: The memory cost factor to use for generating the <code>SaltedPassword</code> hash. This is only used by the Argon2 key derivation function, where it is stored with each user record in the authentication database.<a href="#section-5.3-49.5" class="pilcrow">¶</a>
</li>
        </ol>
<p id="section-5.3-50">The client MUST respond with an ABORT message if <code>CHALLENGE.Details.nonce</code> does not begin with the client nonce sent in <code>HELLO.Details.nonce</code>.<a href="#section-5.3-50" class="pilcrow">¶</a></p>
<p id="section-5.3-51">The client SHOULD respond with an ABORT message if it detects that the cost parameters are unusually low. Such low-cost parameters could be the result of a rogue server attempting to obtain a weak password hash that can be easily cracked. What constitutes unusually low parameters is implementation-specific and is not covered by this document.<a href="#section-5.3-51" class="pilcrow">¶</a></p>
<p id="section-5.3-52"><em>Final Client Authentication Message</em><a href="#section-5.3-52" class="pilcrow">¶</a></p>
<p id="section-5.3-53">Upon receiving a valid <code>CHALLENGE</code> message, the client SHALL respond with an <code>AUTHENTICATE</code> message:<a href="#section-5.3-53" class="pilcrow">¶</a></p>
<div class="lang-javascript sourcecode" id="section-5.3-54">
<pre>    [5, "dHzbZapWIk4jUhN+Ute9ytag9zjfMHgsqmmiz7AndVQ=",
        {
            "nonce": "egVDf3DMJh0=SBmkFIh7sSo=",
            "channel_binding": null,
            "cbind_data": null
        }
    ]
</pre><a href="#section-5.3-54" class="pilcrow">¶</a>
</div>
<p id="section-5.3-55">where:<a href="#section-5.3-55" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="compact type-1" id="section-5.3-56">
<li id="section-5.3-56.1">
            <code>Signature|string</code> argument: The base64-encoded <code>ClientProof</code>, computed as described in the <a href="#scram-algorithms">SCRAM-Algorithms</a> section.<a href="#section-5.3-56.1" class="pilcrow">¶</a>
</li>
          <li id="section-5.3-56.2">
            <code>nonce|string</code>: The concatenated client-server nonce from the previous <code>CHALLENGE</code> message.<a href="#section-5.3-56.2" class="pilcrow">¶</a>
</li>
          <li id="section-5.3-56.3">
            <code>channel_binding|string</code>: Optional string containing the channel binding type that was sent in the original <code>HELLO</code> message.<a href="#section-5.3-56.3" class="pilcrow">¶</a>
</li>
          <li id="section-5.3-56.4">
            <code>cbind_data|string</code>: Optional base64-encoded channel binding data. MUST be present if and only if <code>channel_binding</code> is not <code>null</code>. The format of the binding data is dependent on the binding type. See <a href="#channel-binding">Channel Binding</a>.<a href="#section-5.3-56.4" class="pilcrow">¶</a>
</li>
        </ol>
<p id="section-5.3-57">Upon receiving the <code>AUTHENTICATE</code> message, the server SHALL then check that:<a href="#section-5.3-57" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-5.3-58.1">The <code>AUTHENTICATE</code> message was received in due time.<a href="#section-5.3-58.1" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-5.3-58.2">The <code>ClientProof</code> passed via the <code>Signature|string</code> argument is validated against the <code>StoredKey</code> and <code>ServerKey</code> stored in the authentication database. See <a href="#scram-algorithms">SCRAM Algorithms</a>.<a href="#section-5.3-58.2" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-5.3-58.3">
            <code>nonce</code> matches the one previously sent via <code>CHALLENGE</code>.<a href="#section-5.3-58.3" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-5.3-58.4">The <code>channel_binding</code> matches the one sent in the <code>HELLO</code> message.<a href="#section-5.3-58.4" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-5.3-58.5">The <code>cbind_data</code> sent by the client matches the channel binding data that the server sees on its side of the channel.<a href="#section-5.3-58.5" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-5.3-59"><em>Final Server Authentication Message - Success</em><a href="#section-5.3-59" class="pilcrow">¶</a></p>
<p id="section-5.3-60">If the authentication succeeds, the server SHALL finally respond with a <code>WELCOME</code> message:<a href="#section-5.3-60" class="pilcrow">¶</a></p>
<div class="lang-javascript sourcecode" id="section-5.3-61">
<pre>    [2, 3251278072152162,
        {
            "authid": "user",
            "authrole": "frontend",
            "authmethod": "wamp-scram",
            "authprovider": "static",
            "roles": ...,
            "authextra":
                {
                    "verifier":
                      "v=6rriTRBi23WpRR/wtup+mMhUZUn/dB5nLTJRsjl95G4="
                }
        }
    ]
</pre><a href="#section-5.3-61" class="pilcrow">¶</a>
</div>
<p id="section-5.3-62">where:<a href="#section-5.3-62" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="compact type-1" id="section-5.3-63">
<li id="section-5.3-63.1">
            <code>authid|string</code>: The authentication ID the client was actually authenticated as.<a href="#section-5.3-63.1" class="pilcrow">¶</a>
</li>
          <li id="section-5.3-63.2">
            <code>authrole|string</code>: The authentication role the client was authenticated for.<a href="#section-5.3-63.2" class="pilcrow">¶</a>
</li>
          <li id="section-5.3-63.3">
            <code>authmethod|string</code>: The authentication method, here <code>"wamp-scram"</code>.<a href="#section-5.3-63.3" class="pilcrow">¶</a>
</li>
          <li id="section-5.3-63.4">
            <code>authprovider|string</code>: The actual provider of authentication. For WAMP-SCRAM authentication, this can be freely chosen by the app, e.g. static or dynamic.<a href="#section-5.3-63.4" class="pilcrow">¶</a>
</li>
          <li id="section-5.3-63.5">
            <code>authextra.verifier|string</code>: The base64-encoded <code>ServerSignature</code>, computed as described in the <a href="#scram-algorithms">SCRAM Algorithms</a> section.<a href="#section-5.3-63.5" class="pilcrow">¶</a>
</li>
        </ol>
<p id="section-5.3-64">The client SHOULD check the <code>verifier</code> for mutual authentication, terminating the session if invalid.<a href="#section-5.3-64" class="pilcrow">¶</a></p>
<p id="section-5.3-65"><em>Final Server Authentication Message - Failure</em><a href="#section-5.3-65" class="pilcrow">¶</a></p>
<p id="section-5.3-66">If the authentication fails, the server SHALL respond with an <code>ABORT</code> message.<a href="#section-5.3-66" class="pilcrow">¶</a></p>
<p id="section-5.3-67">The server MAY include a SCRAM-specific error string in the <code>ABORT</code> message as a <code>Details.scram</code> attribute. SCRAM error strings are listed in <a href="https://tools.ietf.org/html/rfc5802#section-7">RFC5802, section 7</a>, under <code>server-error-value</code>.<a href="#section-5.3-67" class="pilcrow">¶</a></p>
<p id="section-5.3-68"><strong>SCRAM Algorithms</strong><a href="#section-5.3-68" class="pilcrow">¶</a></p>
<p id="section-5.3-69"><em>This section is non-normative</em>.<a href="#section-5.3-69" class="pilcrow">¶</a></p>
<p id="section-5.3-70"><a href="https://tools.ietf.org/html/rfc5802">RFC5802</a> specifies the algorithms used to compute the <code>ClientProof</code>, <code>ServerSignature</code>, <code>ServerKey</code>, and <code>StoredKey</code> values referenced by this document. Those algorithms are summarized here in pseudocode for reference.<a href="#section-5.3-70" class="pilcrow">¶</a></p>
<p id="section-5.3-71"><strong>Notation</strong><a href="#section-5.3-71" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-5.3-72.1">
            <code>"="</code>: The variable on the left-hand side is the result of the expression on the right-hand side.<a href="#section-5.3-72.1" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-5.3-72.2">
            <code>"+"</code>: String concatenation.<a href="#section-5.3-72.2" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-5.3-72.3">
            <code>IfNull(attribute, value, else)</code>: If the given <code>attribute</code> is absent or null, evaluates to the given <code>value</code>, otherwise evaluates to the given <code>else</code> value.<a href="#section-5.3-72.3" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-5.3-72.4">
            <code>Decimal(integer)</code>: The decimal string representation of the given <code>integer</code>.<a href="#section-5.3-72.4" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-5.3-72.5">
            <code>Base64(octets)</code>: Base64 encoding of the given octet sequence, restricted to canonical form with no whitespace, as defined in <a href="https://tools.ietf.org/html/rfc4648">RFC4648</a>.<a href="#section-5.3-72.5" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-5.3-72.6">
            <code>UnBase64(str)</code>: Decode the given Base64 string into an octet sequence.<a href="#section-5.3-72.6" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-5.3-72.7">
            <code>Normalize(str)</code>: Normalize the given string using the SASLprep profile <a href="https://tools.ietf.org/html/rfc4013">RFC4013</a> of the "stringprep" algorithm <a href="https://tools.ietf.org/html/rfc3454">RFC3454</a>.<a href="#section-5.3-72.7" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-5.3-72.8">
            <code>XOR</code>: The exclusive-or operation applied to each octet of the left and right-hand-side octet sequences.<a href="#section-5.3-72.8" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-5.3-72.9">
            <code>SHA256(str)</code>: The SHA-256 cryptographic hash function.<a href="#section-5.3-72.9" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-5.3-72.10">
            <code>HMAC(key, str)</code>: Keyed-hash message authentication code, as defined in <a href="https://www.ietf.org/rfc/rfc2104.txt">RFC2104</a>, with SHA-256 as the underlying hash function.<a href="#section-5.3-72.10" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-5.3-72.11">
            <code>KDF(str, salt, params...)</code>: One of the supported key derivations function, with the output key length the same as the SHA-256 output length (32 octets). <code>params...</code> are the additional parameters that are applicable for the function: <code>iterations</code> and <code>memory</code>.<a href="#section-5.3-72.11" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-5.3-72.12">
            <code>Escape(str)</code>: Replace every occurrence of "<code>,</code>" and "<code>=</code>" in the given string with "<code>=2C</code>" and "<code>=3D</code>" respectively.<a href="#section-5.3-72.12" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-5.3-73"><strong>Data Stored on the Server</strong><a href="#section-5.3-73" class="pilcrow">¶</a></p>
<p id="section-5.3-74">For each user, the server needs to store:<a href="#section-5.3-74" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="compact type-1" id="section-5.3-75">
<li id="section-5.3-75.1">A random, per-user salt.<a href="#section-5.3-75.1" class="pilcrow">¶</a>
</li>
          <li id="section-5.3-75.2">The type string corresponding to the key derivation function (KDF) used to hash the password (e.g. <code>"argon2id13"</code>). This is needed to handle future revisions of the KDF, as well as allowing migration to stronger KDFs that may be added to WAMP-SCRAM in the future. This may also be needed if the KDF used during user registration is configurable or selectable on a per-user basis.<a href="#section-5.3-75.2" class="pilcrow">¶</a>
</li>
          <li id="section-5.3-75.3">Parameters that are applicable to the key derivation function : <code>iterations</code> and possibly <code>memory</code>.<a href="#section-5.3-75.3" class="pilcrow">¶</a>
</li>
          <li id="section-5.3-75.4">The <code>StoredKey</code>.<a href="#section-5.3-75.4" class="pilcrow">¶</a>
</li>
          <li id="section-5.3-75.5">The <code>ServerKey</code>.<a href="#section-5.3-75.5" class="pilcrow">¶</a>
</li>
        </ol>
<p id="section-5.3-76">where <code>StoredKey</code> and <code>ServerKey</code> are computed as follows:<a href="#section-5.3-76" class="pilcrow">¶</a></p>
<div class="lang-javascript sourcecode" id="section-5.3-77">
<pre>SaltedPassword  = KDF(Normalize(password), salt, params...)
ClientKey       = HMAC(SaltedPassword, "Client Key")
StoredKey       = SHA256(ClientKey)
ServerKey       = HMAC(SaltedPassword, "Server Key")
</pre><a href="#section-5.3-77" class="pilcrow">¶</a>
</div>
<p id="section-5.3-78">Note that <code>"Client Key"</code> and <code>"Server Key"</code> are string literals.<a href="#section-5.3-78" class="pilcrow">¶</a></p>
<p id="section-5.3-79">The manner in which the <code>StoredKey</code> and <code>ServerKey</code> are shared with the server during user registration is outside the scope of SCRAM and this document.<a href="#section-5.3-79" class="pilcrow">¶</a></p>
<p id="section-5.3-80"><strong>AuthMessage</strong><a href="#section-5.3-80" class="pilcrow">¶</a></p>
<p id="section-5.3-81">In SCRAM, <code>AuthMessage</code> is used for computing <code>ClientProof</code> and <code>ServerSignature</code>. <code>AuthMessage</code> is computed using attributes that were sent in the first three messages of the authentication exchange.<a href="#section-5.3-81" class="pilcrow">¶</a></p>
<div class="lang-javascript sourcecode" id="section-5.3-82">
<pre>ClientFirstBare = "n=" + Escape(HELLO.Details.authid) + "," +
                  "r=" + HELLO.Details.authextra.nonce

ServerFirst = "r=" + CHALLENGE.Details.nonce + "," +
              "s=" + CHALLENGE.Details.salt + "," +
              "i=" + Decimal(CHALLENGE.Details.iterations)

CBindName = AUTHENTICATE.Extra.channel_binding

CBindData = AUTHENTICATE.Extra.cbind_data

CBindFlag = IfNull(CBindName, "n", "p=" + CBindName)

CBindInput = CBindFlag + ",," +
             IfNull(CBindData, "", UnBase64(CBindData))

ClientFinalNoProof = "c=" + Base64(CBindInput) + "," +
                     "r=" + AUTHENTICATE.Extra.nonce

AuthMessage = ClientFirstBare + "," + ServerFirst + "," +
              ClientFinalNoProof
</pre><a href="#section-5.3-82" class="pilcrow">¶</a>
</div>
<p id="section-5.3-83"><strong>ClientProof</strong><a href="#section-5.3-83" class="pilcrow">¶</a></p>
<p id="section-5.3-84"><code>ClientProof</code> is computed by the client during the authentication exchange as follows:<a href="#section-5.3-84" class="pilcrow">¶</a></p>
<div class="lang-javascript sourcecode" id="section-5.3-85">
<pre>SaltedPassword  = KDF(Normalize(password), salt, params...)
ClientKey       = HMAC(SaltedPassword, "Client Key")
StoredKey       = SHA256(ClientKey)
ClientSignature = HMAC(StoredKey, AuthMessage)
ClientProof     = ClientKey XOR ClientSignature
</pre><a href="#section-5.3-85" class="pilcrow">¶</a>
</div>
<p id="section-5.3-86">The <code>ClientProof</code> is then sent to the server, base64-encoded, via the <code>AUTHENTICATE.Signature</code> argument.<a href="#section-5.3-86" class="pilcrow">¶</a></p>
<p id="section-5.3-87">The server verifies the <code>ClientProof</code> by computing the <code>RecoveredStoredKey</code> and comparing it to the actual <code>StoredKey</code>:<a href="#section-5.3-87" class="pilcrow">¶</a></p>
<div class="lang-javascript sourcecode" id="section-5.3-88">
<pre>ClientSignature    = HMAC(StoredKey, AuthMessage)
RecoveredClientKey = ClientSignature XOR ReceivedClientProof
RecoveredStoredKey = SHA256(RecoveredClientKey)
</pre><a href="#section-5.3-88" class="pilcrow">¶</a>
</div>
<p id="section-5.3-89">Note that the client MAY cache the <code>ClientKey</code> and <code>StoredKey</code> (or just <code>SaltedPassword</code>) to avoid having to perform the expensive KDF computation for every authentication exchange. Storing these values securely on the client is outside the scope of this document.<a href="#section-5.3-89" class="pilcrow">¶</a></p>
<p id="section-5.3-90"><strong>ServerSignature</strong><a href="#section-5.3-90" class="pilcrow">¶</a></p>
<p id="section-5.3-91"><code>ServerSignature</code> is computed by the server during the authentication exchange as follows:<a href="#section-5.3-91" class="pilcrow">¶</a></p>
<div class="lang-javascript sourcecode" id="section-5.3-92">
<pre>ServerSignature = HMAC(ServerKey, AuthMessage)
</pre><a href="#section-5.3-92" class="pilcrow">¶</a>
</div>
<p id="section-5.3-93">The <code>ServerSignature</code> is then sent to the client, base64-encoded, via the <code>WELCOME.Details.authextra.verifier</code> attribute.<a href="#section-5.3-93" class="pilcrow">¶</a></p>
<p id="section-5.3-94">The client verifies the <code>ServerSignature</code> by computing it and comparing it with the <code>ServerSignature</code> sent by the server:<a href="#section-5.3-94" class="pilcrow">¶</a></p>
<div class="lang-javascript sourcecode" id="section-5.3-95">
<pre>ServerKey       = HMAC(SaltedPassword, "Server Key")
ServerSignature = HMAC(ServerKey, AuthMessage)
</pre><a href="#section-5.3-95" class="pilcrow">¶</a>
</div>
<p id="section-5.3-96"><strong>Key Derivation Functions</strong><a href="#section-5.3-96" class="pilcrow">¶</a></p>
<p id="section-5.3-97">SCRAM uses a password-based key derivation function (KDF) to hash user passwords. WAMP-SCRAM supports both <a href="https://datatracker.ietf.org/doc/draft-irtf-cfrg-argon2/">Argon2</a> and <a href="https://tools.ietf.org/html/rfc2898">PBKDF2</a> as the KDF. Argon2 is recommended because of its memory hardness and resistance against GPU hardware. PBKDF2, which does not feature memory hardness, is also supported for applications that are required to use primitives currently approved by cryptographic standards.<a href="#section-5.3-97" class="pilcrow">¶</a></p>
<p id="section-5.3-98">The following table maps the <code>CHALLENGE.Details.kdf</code> type string to the corresponding KDF.<a href="#section-5.3-98" class="pilcrow">¶</a></p>
<table class="center" id="table-8">
          <caption><a href="#table-8" class="selfRef">Table 8</a></caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">KDF type string</th>
              <th class="text-left" rowspan="1" colspan="1">Function</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">
                <code>"argon2id13"</code>
</td>
              <td class="text-left" rowspan="1" colspan="1">Argon2id variant of Argon2, version 1.3</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">
                <code>"pbkdf2"</code>
</td>
              <td class="text-left" rowspan="1" colspan="1">PBKDF2</td>
            </tr>
          </tbody>
        </table>
<p id="section-5.3-100">To promote interoperability, WAMP-SCRAM client/server implementations SHOULD support both of the above KDFs. During authentication, there is no "negotiation" of the KDF, and the client MUST use the same KDF than the one used to create the keys stored in the authentication database.<a href="#section-5.3-100" class="pilcrow">¶</a></p>
<p id="section-5.3-101">Which KDF is used to hash the password during user registration is up to the application and/or server implementation, and is not covered by this document. Possibilities include:<a href="#section-5.3-101" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-5.3-102.1">making the KDF selectable at runtime during registration,<a href="#section-5.3-102.1" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-5.3-102.2">making the KDF statically configurable on the server, or,<a href="#section-5.3-102.2" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-5.3-102.3">hard-coding the KDF selection on the server.<a href="#section-5.3-102.3" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-5.3-103"><em>Argon2</em><a href="#section-5.3-103" class="pilcrow">¶</a></p>
<p id="section-5.3-104">The Argon2 key derivation function, proposed in <a href="https://datatracker.ietf.org/doc/draft-irtf-cfrg-argon2/">draft-irtf-cfrg-argon2</a>, is computed using the following parameters:<a href="#section-5.3-104" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-5.3-105.1">
            <code>CHALLENGE.Details.salt</code> as the cryptographic salt,<a href="#section-5.3-105.1" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-5.3-105.2">
            <code>CHALLENGE.Details.iterations</code> as the number of iterations,<a href="#section-5.3-105.2" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-5.3-105.3">
            <code>CHALLENGE.Details.memory</code> as the memory size (in kibibytes),<a href="#section-5.3-105.3" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-5.3-105.4">1 as the parallelism parameter,<a href="#section-5.3-105.4" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-5.3-105.5">Argon2id as the algorithm variant, and,<a href="#section-5.3-105.5" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-5.3-105.6">32 octets as the output key length.<a href="#section-5.3-105.6" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-5.3-106">For WAMP-SCRAM, the parallelism parameter is fixed to 1 due to the password being hashed on the client side, where it is not generally known how many cores/threads are available on the client's device.<a href="#section-5.3-106" class="pilcrow">¶</a></p>
<p id="section-5.3-107">Section 4 of the Argon2 internet draft recommends the general procedure for selecting parameters, of which the following guidelines are applicable to WAMP-SCRAM:<a href="#section-5.3-107" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-5.3-108.1">A 128-bit salt is recommended, which can be reduced to 64-bit if space is limited.<a href="#section-5.3-108.1" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-5.3-108.2">The <code>memory</code> parameter is to be configured to the maximum amount of memory usage that can be tolerated on client devices for computing the hash.<a href="#section-5.3-108.2" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-5.3-108.3">The <code>iterations</code> parameter is to be determined experimentally so that execution time on the client reaches the maximum that can be tolerated by users during authentication. If the execution time is intolerable with <code>iterations</code> = 1, then reduce the <code>memory</code> parameter as needed.<a href="#section-5.3-108.3" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-5.3-109"><em>PBKDF2</em><a href="#section-5.3-109" class="pilcrow">¶</a></p>
<p id="section-5.3-110">The PBKDF2 key derivation function, defined in <a href="https://tools.ietf.org/html/rfc2898">RFC2898</a>, is used with SHA-256 as the pseudorandom function (PRF).<a href="#section-5.3-110" class="pilcrow">¶</a></p>
<p id="section-5.3-111">The PDBKDF2 hash is computed using the following parameters:<a href="#section-5.3-111" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-5.3-112.1">
            <code>CHALLENGE.Details.salt</code> as the cryptographic salt,<a href="#section-5.3-112.1" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-5.3-112.2">
            <code>CHALLENGE.Details.iterations</code> as the iteration count, and,<a href="#section-5.3-112.2" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-5.3-112.3">32 octets as the output key length (<code>dkLen</code>), which matches the SHA-256 output length.<a href="#section-5.3-112.3" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-5.3-113"><a href="https://tools.ietf.org/html/rfc2898">RFC2898 section 4.1</a> recommends at least 64 bits for the salt.<a href="#section-5.3-113" class="pilcrow">¶</a></p>
<p id="section-5.3-114">The <code>iterations</code> parameter SHOULD be determined experimentally so that execution time on the client reaches the maximum that can be tolerated by users during authentication. <a href="https://tools.ietf.org/html/rfc7677#section-4">RFC7677 section 4</a> recommends an iteration count of at least 4096, with a significantly higher value on non-mobile clients.<a href="#section-5.3-114" class="pilcrow">¶</a></p>
</section>
</div>
<div id="cryptosignauth">
<section id="section-5.4">
        <h3 id="name-cryptosign-based-authentica">
<a href="#section-5.4" class="section-number selfRef">5.4. </a><a href="#name-cryptosign-based-authentica" class="section-name selfRef">Cryptosign-based Authentication</a>
        </h3>
<p id="section-5.4-1"><em>WAMP-Cryptosign</em> is a WAMP authentication method based on
<em>public-private key cryptography</em>. Specifically, it is based on <a href="https://ed25519.cr.yp.to/">Ed25519</a> digital signatures as described in <span>[<a href="#RFC8032" class="cite xref">RFC8032</a>]</span>.<a href="#section-5.4-1" class="pilcrow">¶</a></p>
<p id="section-5.4-2"><strong>Ed25519</strong> is an <a href="https://ed25519.cr.yp.to/ed25519-20110926.pdf">elliptic curve signature scheme</a> that instantiates the Edwards-curve Digital Signature Algorithm (EdDSA) with elliptic curve parameters which are equivalent to <a href="https://cr.yp.to/ecdh.html">Curve25519</a>.
<strong>Curve25519</strong> is a <a href="https://safecurves.cr.yp.to/">SafeCurve</a>, which means it is easy to implement and avoid security issues resulting from common implementation challenges and bugs.
Ed25519 is intended to operate at around the 128-bit security level, and there are robust native implementations available as open-source, e.g. <a href="https://github.com/jedisct1/libsodium">libsodium</a>, which can be used from script languages, e.g. <a href="https://github.com/pyca/pynacl">PyNaCl</a>.<a href="#section-5.4-2" class="pilcrow">¶</a></p>
<p id="section-5.4-3">An implementation of <em>WAMP-Cryptosign</em> MUST provide<a href="#section-5.4-3" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-5.4-4.1">
            <a href="#clientauth">Client Authentication</a><a href="#section-5.4-4.1" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-5.4-5">and MAY implement one or more of<a href="#section-5.4-5" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-5.4-6.1">
            <a href="#channelbinding">TLS Channel Binding</a><a href="#section-5.4-6.1" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-5.4-6.2">
            <a href="#routerauth">Router Authentication</a><a href="#section-5.4-6.2" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-5.4-6.3">
            <a href="#trustrootcerts">Trustroots and Certificates</a><a href="#section-5.4-6.3" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-5.4-6.4">
            <a href="#remoteattestation">Remote Attestation</a><a href="#section-5.4-6.4" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-5.4-7">The following sections describe each of above features of <em>WAMP-Cryptosign</em>.<a href="#section-5.4-7" class="pilcrow">¶</a></p>
<p id="section-5.4-8">Examples of complete authentication message exchanges can be found at the end of this
chapter in <a href="#examplemessageexchanges">Example Message Exchanges</a>.<a href="#section-5.4-8" class="pilcrow">¶</a></p>
<p id="section-5.4-9">In WAMP, the following <strong>cryptographic primitives</strong> are used with <em>WAMP-Cryptosign</em> authentication:<a href="#section-5.4-9" class="pilcrow">¶</a></p>
<p id="section-5.4-10"><strong>Elliptic Curves:</strong><a href="#section-5.4-10" class="pilcrow">¶</a></p>
<table class="center" id="table-9">
          <caption><a href="#table-9" class="selfRef">Table 9</a></caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">SECG</th>
              <th class="text-left" rowspan="1" colspan="1">Usage in WAMP</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">secp256r1</td>
              <td class="text-left" rowspan="1" colspan="1">Transport Encryption (WAMP transport encryption)</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">curve25519</td>
              <td class="text-left" rowspan="1" colspan="1">Session Authentication (WAMP-Cryptosign authentication)</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">secp256k1</td>
              <td class="text-left" rowspan="1" colspan="1">Data Signatures (WAMP-Cryptosign certificates, WAMP E2E encryption)</td>
            </tr>
          </tbody>
        </table>
<ul class="compact">
<li class="compact" id="section-5.4-12.1">
            <a href="https://datatracker.ietf.org/doc/html/rfc4492">RFC4492: Elliptic Curve Cryptography (ECC) Cipher Suites for Transport Layer Security (TLS)</a><a href="#section-5.4-12.1" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-5.4-12.2">
            <a href="https://datatracker.ietf.org/doc/html/rfc7748">RFC7748: Elliptic Curves for Security</a><a href="#section-5.4-12.2" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-5.4-13"><strong>Hash Functions:</strong><a href="#section-5.4-13" class="pilcrow">¶</a></p>
<table class="center" id="table-10">
          <caption><a href="#table-10" class="selfRef">Table 10</a></caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">SECG</th>
              <th class="text-left" rowspan="1" colspan="1">Usage in WAMP</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">sha256</td>
              <td class="text-left" rowspan="1" colspan="1">Session Authentication (WAMP-Cryptosign authentication)</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">keccak256</td>
              <td class="text-left" rowspan="1" colspan="1">Data Signatures (WAMP-Cryptosign certificates, WAMP E2E encryption)</td>
            </tr>
          </tbody>
        </table>
<p id="section-5.4-15">Note that <code>sha256</code> refers to the SHA-2 algorithm, while <code>sha3-256</code> is a different algorithm refering to SHA-3.<a href="#section-5.4-15" class="pilcrow">¶</a></p>
<p id="section-5.4-16"><strong>Signature Schemes:</strong><a href="#section-5.4-16" class="pilcrow">¶</a></p>
<table class="center" id="table-11">
          <caption><a href="#table-11" class="selfRef">Table 11</a></caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">SECG</th>
              <th class="text-left" rowspan="1" colspan="1">Usage in WAMP</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">ed25519</td>
              <td class="text-left" rowspan="1" colspan="1">Session Authentication (WAMP-Cryptosign Authentication)</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">ecdsa</td>
              <td class="text-left" rowspan="1" colspan="1">Data Signatures (Ethereum, WAMP-Cryptosign Certificates, WAMP-E2E)</td>
            </tr>
          </tbody>
        </table>
<div id="clientauth">
<section id="section-5.4.1">
          <h4 id="name-client-authentication">
<a href="#section-5.4.1" class="section-number selfRef">5.4.1. </a><a href="#name-client-authentication" class="section-name selfRef">Client Authentication</a>
          </h4>
<p id="section-5.4.1-1">A <em>Client</em> is authenticated to a <em>Router</em> by:<a href="#section-5.4.1-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="compact type-1" id="section-5.4.1-2">
<li id="section-5.4.1-2.1">sending a <code>HELLO</code>, announcing its public key<a href="#section-5.4.1-2.1" class="pilcrow">¶</a>
</li>
            <li id="section-5.4.1-2.2">signing a (random) challenge received in <code>CHALLENGE</code> with its private key<a href="#section-5.4.1-2.2" class="pilcrow">¶</a>
</li>
            <li id="section-5.4.1-2.3">let the router verify the signature, proofing the client actually controls the private key, and thus the authenticity of the client as identified by the public key<a href="#section-5.4.1-2.3" class="pilcrow">¶</a>
</li>
            <li id="section-5.4.1-2.4">let the router admit the client to a realm under a role, based on the public key<a href="#section-5.4.1-2.4" class="pilcrow">¶</a>
</li>
          </ol>
<p id="section-5.4.1-3">Thus, the client is identified using its public key, and the <em>Router</em> needs to know said public key and its desired realm and role in advance.<a href="#section-5.4.1-3" class="pilcrow">¶</a></p>
<p id="section-5.4.1-4">A <em>Client</em> for which the <em>Router</em> does not previously know the client's public key MAY use the <a href="#name-trustroots-and-certificates">Trustroots and Certificates</a> feature to trust a <em>Client</em> based on an additional certificate presented by the client.<a href="#section-5.4.1-4" class="pilcrow">¶</a></p>
<p id="section-5.4.1-5">A <em>Router</em> is optionally (see <a href="#name-router-authentication">Router Authentication</a>) authenticated to a <em>Client</em> by:<a href="#section-5.4.1-5" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="compact type-1" id="section-5.4.1-6">
<li id="section-5.4.1-6.1">client includes a (random) <code>HELLO.Details.challenge|string</code><a href="#section-5.4.1-6.1" class="pilcrow">¶</a>
</li>
            <li id="section-5.4.1-6.2">the router sends the signature as part of its challenge to the client, in <code>CHALLENGE.extra.signature|string</code><a href="#section-5.4.1-6.2" class="pilcrow">¶</a>
</li>
          </ol>
<p id="section-5.4.1-7">Again, in this case, the <em>Router</em> includes a trustroot and certificate for the client to verify.<a href="#section-5.4.1-7" class="pilcrow">¶</a></p>
<div id="computing-the-signature">
<section id="section-5.4.1.1">
            <h5 id="name-computing-the-signature">
<a href="#section-5.4.1.1" class="section-number selfRef">5.4.1.1. </a><a href="#name-computing-the-signature" class="section-name selfRef">Computing the Signature</a>
            </h5>
<p id="section-5.4.1.1-1">The challenge sent by the router is a 32 bytes random value, encoded as a Hex string in <code>CHALLENGE.extra.challenge|string</code>.<a href="#section-5.4.1.1-1" class="pilcrow">¶</a></p>
<p id="section-5.4.1.1-2">When no channel binding is active, the Ed25519 signature over the 32 bytes message MUST be computed using the WAMP-Cryptosign <em>private key</em> of the authenticating client.<a href="#section-5.4.1.1-2" class="pilcrow">¶</a></p>
<p id="section-5.4.1.1-3">When channel binding is active, the challenge MUST first be XOR'ed bytewise with the channel ID, e.g. the 32 bytes from TLS with channel binding <code>"tls-unique"</code>, and the resulting message (which again has length 32 bytes) MUST be signed using the WAMP-Cryptosign <em>private key</em> of the authenticating client.<a href="#section-5.4.1.1-3" class="pilcrow">¶</a></p>
<p id="section-5.4.1.1-4">The client MUST return the concatenation of the signature and the message signed (96 bytes) in the <code>AUTHENTICATE</code> message.<a href="#section-5.4.1.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="example-message-flow">
<section id="section-5.4.1.2">
            <h5 id="name-example-message-flow">
<a href="#section-5.4.1.2" class="section-number selfRef">5.4.1.2. </a><a href="#name-example-message-flow" class="section-name selfRef">Example Message Flow</a>
            </h5>
<p id="section-5.4.1.2-1">A typical authentication begins with the client sending a <code>HELLO</code> message specifying the <code>cryptosign</code> method as (one of) the authentication methods:<a href="#section-5.4.1.2-1" class="pilcrow">¶</a></p>
<div class="lang-javascript sourcecode" id="section-5.4.1.2-2">
<pre>[1, "realm1", {
    "roles": {/* see below */},
    "authmethods": ["cryptosign"],
    "authid": "client01@example.com",
    "authextra": {
        "pubkey": "545efb0a2192db8d43f118e9bf9aee081466e1ef36c708b96ee6f62dddad9122"
    }
}]
</pre><a href="#section-5.4.1.2-2" class="pilcrow">¶</a>
</div>
<p id="section-5.4.1.2-3">The <code>HELLO.Details.authmethods|list</code> is used by the client to announce the authentication methods it is prepared to perform. For WAMP-Cryptosign, this MUST include <code>"cryptosign"</code>.<a href="#section-5.4.1.2-3" class="pilcrow">¶</a></p>
<p id="section-5.4.1.2-4">The <code>HELLO.Details.authid|string</code> is the authentication ID (e.g. username) the client wishes to authenticate as. For WAMP-Cryptosign authentication, this MAY be provided. If no <code>authid</code> is provided, the router SHOULD automatically chose and assign an <code>authid</code> (e.g. the Hex encode public key).<a href="#section-5.4.1.2-4" class="pilcrow">¶</a></p>
<p id="section-5.4.1.2-5">The <code>HELLO.Details.authextra|dict</code> contains the following members for WAMP-Cryptosign:<a href="#section-5.4.1.2-5" class="pilcrow">¶</a></p>
<table class="center" id="table-12">
              <caption><a href="#table-12" class="selfRef">Table 12</a></caption>
<thead>
                <tr>
                  <th class="text-left" rowspan="1" colspan="1">Field</th>
                  <th class="text-left" rowspan="1" colspan="1">Type</th>
                  <th class="text-left" rowspan="1" colspan="1">Required</th>
                  <th class="text-left" rowspan="1" colspan="1">Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td class="text-left" rowspan="1" colspan="1">pubkey</td>
                  <td class="text-left" rowspan="1" colspan="1">string</td>
                  <td class="text-left" rowspan="1" colspan="1">yes</td>
                  <td class="text-left" rowspan="1" colspan="1">The client public key (32 bytes) as a Hex encoded string, e.g. <code>545efb0a2192db8d43f118e9bf9aee081466e1ef36c708b96ee6f62dddad9122</code>
</td>
                </tr>
                <tr>
                  <td class="text-left" rowspan="1" colspan="1">channel_binding</td>
                  <td class="text-left" rowspan="1" colspan="1">string</td>
                  <td class="text-left" rowspan="1" colspan="1">no</td>
                  <td class="text-left" rowspan="1" colspan="1">If TLS channel binding is in use, the TLS channel binding type, e.g. <code>"tls-unique"</code>.</td>
                </tr>
                <tr>
                  <td class="text-left" rowspan="1" colspan="1">challenge</td>
                  <td class="text-left" rowspan="1" colspan="1">string</td>
                  <td class="text-left" rowspan="1" colspan="1">no</td>
                  <td class="text-left" rowspan="1" colspan="1">A client chosen, random challenge (32 bytes) as a Hex encoded string, to be signed by the router.</td>
                </tr>
                <tr>
                  <td class="text-left" rowspan="1" colspan="1">trustroot</td>
                  <td class="text-left" rowspan="1" colspan="1">string</td>
                  <td class="text-left" rowspan="1" colspan="1">no</td>
                  <td class="text-left" rowspan="1" colspan="1">When the client includes a client certificate (see below), the Ethereum address of the trustroot of the certificate chain to be used, e.g. <code>0x72b3486d38E9f49215b487CeAaDF27D6acf22115</code>, which can be a <em>Standalone Trustroot</em> or an <em>On-chain Trustroot</em> (see <a href="#trustroots">Trustroots</a>)</td>
                </tr>
              </tbody>
            </table>
<p id="section-5.4.1.2-7">The client needs to announce the WAMP <code>roles</code> and features it supports, for example:<a href="#section-5.4.1.2-7" class="pilcrow">¶</a></p>
<div class="lang-javascript sourcecode" id="section-5.4.1.2-8">
<pre>{"callee": {"features": {"call_canceling": True,
                         "caller_identification": True,
                         "pattern_based_registration": True,
                         "progressive_call_results": True,
                         "registration_revocation": True,
                         "shared_registration": True}},
"caller": {"features": {"call_canceling": True,
                        "caller_identification": True,
                        "progressive_call_results": True}},
"publisher": {"features": {"publisher_exclusion": True,
                           "publisher_identification": True,
                           "subscriber_blackwhite_listing": True}},
"subscriber": {"features": {"pattern_based_subscription": True,
                            "publisher_identification": True,
                            "subscription_revocation": True}}}}
</pre><a href="#section-5.4.1.2-8" class="pilcrow">¶</a>
</div>
<p id="section-5.4.1.2-9">If the router is unwilling or unable to perform WAMP-Cryptosign authentication, it'll either skip forward trying other authentication methods (if the client announced any) or send an <code>ABORT</code> message.<a href="#section-5.4.1.2-9" class="pilcrow">¶</a></p>
<p id="section-5.4.1.2-10">If the router is willing to let the client authenticate using WAMP-Cryptosign and the router recognizes the provided <code>HELLO.Details.authextra.pubkey|string</code>, it'll send a <code>CHALLENGE</code> message:<a href="#section-5.4.1.2-10" class="pilcrow">¶</a></p>
<div class="lang-javascript sourcecode" id="section-5.4.1.2-11">
<pre>[4, "cryptosign", {
    "challenge": "fa034062ad76352b53a25358854577730db82f367aa439709c91296d04a5716c",
    "channel_binding": null
}]
</pre><a href="#section-5.4.1.2-11" class="pilcrow">¶</a>
</div>
<p id="section-5.4.1.2-12">The client will send an <code>AUTHENTICATE</code> message containing a signature:<a href="#section-5.4.1.2-12" class="pilcrow">¶</a></p>
<div class="lang-javascript sourcecode" id="section-5.4.1.2-13">
<pre>[5 'e2f0297a193b63b7a4a92028e9e2e6107f82730560d54a657bd982cb4b3151490399debbbde998e494d3c3b2a5e2e91271291e10dee85a6cfaa127885ddd8b0afa034062ad76352b53a25358854577730db82f367aa439709c91296d04a5716c', {}]
</pre><a href="#section-5.4.1.2-13" class="pilcrow">¶</a>
</div>
<p id="section-5.4.1.2-14">If the authentication succeeds, the server will router respond with a <code>WELCOME</code> message:<a href="#section-5.4.1.2-14" class="pilcrow">¶</a></p>
<div class="lang-javascript sourcecode" id="section-5.4.1.2-15">
<pre>[2, 7562122397119786, {
    "authextra": {
        "x_cb_node": "intel-nuci7-27532",
        "x_cb_peer": "tcp4:127.0.0.1:49032",
        "x_cb_pid": 27637,
        "x_cb_worker": "worker001"
    },
    "authid": "client01@example.com",
    "authmethod": "cryptosign",
    "authprovider": "static",
    "authrole": "user",
    "realm": "realm1",
    "roles": {/* see below */}
}]
</pre><a href="#section-5.4.1.2-15" class="pilcrow">¶</a>
</div>
<p id="section-5.4.1.2-16">where<a href="#section-5.4.1.2-16" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="compact type-1" id="section-5.4.1.2-17">
<li id="section-5.4.1.2-17.1">
                <code>authid|string</code>: The authentication ID the client was (actually) authenticated as.<a href="#section-5.4.1.2-17.1" class="pilcrow">¶</a>
</li>
              <li id="section-5.4.1.2-17.2">
                <code>authrole|string</code>: The authentication role the client was authenticated for.<a href="#section-5.4.1.2-17.2" class="pilcrow">¶</a>
</li>
              <li id="section-5.4.1.2-17.3">
                <code>authmethod|string</code>: The authentication method, here <code>"cryptosign"</code><a href="#section-5.4.1.2-17.3" class="pilcrow">¶</a>
</li>
              <li id="section-5.4.1.2-17.4">
                <code>authprovider|string</code>: The actual provider of authentication. For Ticket-based authentication, this can be freely chosen by the app, e.g. <code>static</code> or <code>dynamic</code>.<a href="#section-5.4.1.2-17.4" class="pilcrow">¶</a>
</li>
            </ol>
<p id="section-5.4.1.2-18">The <code>WELCOME.Details</code> again contain the actual authentication information active. If the authentication fails, the router will response with an <code>ABORT</code> message.<a href="#section-5.4.1.2-18" class="pilcrow">¶</a></p>
<p id="section-5.4.1.2-19">When the authentication is successful, <code>WELCOME.Details.roles|dict</code> will announce the roles and features the router supports:<a href="#section-5.4.1.2-19" class="pilcrow">¶</a></p>
<div class="lang-javascript sourcecode" id="section-5.4.1.2-20">
<pre>{"broker": {"features": {"event_retention": True,
                                    "pattern_based_subscription": True,
                                    "publisher_exclusion": True,
                                    "publisher_identification": True,
                                    "session_meta_api": True,
                                    "subscriber_blackwhite_listing": True,
                                    "subscription_meta_api": True,
                                    "subscription_revocation": True}},
            "dealer": {"features": {"call_canceling": True,
                                    "caller_identification": True,
                                    "pattern_based_registration": True,
                                    "progressive_call_results": True,
                                    "registration_meta_api": True,
                                    "registration_revocation": True,
                                    "session_meta_api": True,
                                    "shared_registration": True,
                                    "testament_meta_api": True}}
    }
</pre><a href="#section-5.4.1.2-20" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="test-vectors">
<section id="section-5.4.1.3">
            <h5 id="name-test-vectors">
<a href="#section-5.4.1.3" class="section-number selfRef">5.4.1.3. </a><a href="#name-test-vectors" class="section-name selfRef">Test Vectors</a>
            </h5>
<p id="section-5.4.1.3-1">The following test vectors allow to verify an implementation of WAMP-Cryptosign signatures. You can use <code>channel_id</code>, <code>private_key</code> and <code>challenge</code> as input, and check the computed signature matches <code>signature</code>.<a href="#section-5.4.1.3-1" class="pilcrow">¶</a></p>
<p id="section-5.4.1.3-2">The test vectors contain instances for both with and without a <code>channel_id</code>, which represents the TLS channel ID when using TLS with <code>tls-unique</code> channel binding.<a href="#section-5.4.1.3-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.4.1.3-3">
<pre>test_vectors_1 = [
    {
        'channel_id': None,
        'private_key': '4d57d97a68f555696620a6d849c0ce582568518d729eb753dc7c732de2804510',
        'challenge': 'ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff',
        'signature': 'b32675b221f08593213737bef8240e7c15228b07028e19595294678c90d11c0cae80a357331bfc5cc9fb71081464e6e75013517c2cf067ad566a6b7b728e5d03ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff'
    },
    {
        'channel_id': None,
        'private_key': 'd511fe78e23934b3dadb52fcd022974b80bd92bccc7c5cf404e46cc0a8a2f5cd',
        'challenge': 'b26c1f87c13fc1da14997f1b5a71995dff8fbe0a62fae8473c7bdbd05bfb607d',
        'signature': 'd4209ad10d5aff6bfbc009d7e924795de138a63515efc7afc6b01b7fe5201372190374886a70207b042294af5bd64ce725cd8dceb344e6d11c09d1aaaf4d660fb26c1f87c13fc1da14997f1b5a71995dff8fbe0a62fae8473c7bdbd05bfb607d'
    },
    {
        'channel_id': None,
        'private_key': '6e1fde9cf9e2359a87420b65a87dc0c66136e66945196ba2475990d8a0c3a25b',
        'challenge': 'b05e6b8ad4d69abf74aa3be3c0ee40ae07d66e1895b9ab09285a2f1192d562d2',
        'signature': '7beb282184baadd08f166f16dd683b39cab53816ed81e6955def951cb2ddad1ec184e206746fd82bda075af03711d3d5658fc84a76196b0fa8d1ebc92ef9f30bb05e6b8ad4d69abf74aa3be3c0ee40ae07d66e1895b9ab09285a2f1192d562d2'
    },
    {
        'channel_id': '62e935ae755f3d48f80d4d59f6121358c435722a67e859cc0caa8b539027f2ff',
        'private_key': '4d57d97a68f555696620a6d849c0ce582568518d729eb753dc7c732de2804510',
        'challenge': 'ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff',
        'signature': '9b6f41540c9b95b4b7b281c3042fa9c54cef43c842d62ea3fd6030fcb66e70b3e80d49d44c29d1635da9348d02ec93f3ed1ef227dfb59a07b580095c2b82f80f9d16ca518aa0c2b707f2b2a609edeca73bca8dd59817a633f35574ac6fd80d00'
    },
    {
        'channel_id': '62e935ae755f3d48f80d4d59f6121358c435722a67e859cc0caa8b539027f2ff',
        'private_key': 'd511fe78e23934b3dadb52fcd022974b80bd92bccc7c5cf404e46cc0a8a2f5cd',
        'challenge': 'b26c1f87c13fc1da14997f1b5a71995dff8fbe0a62fae8473c7bdbd05bfb607d',
        'signature': '305aaa3ac25e98f651427688b3fc43fe7d8a68a7ec1d7d61c61517c519bd4a427c3015599d83ca28b4c652333920223844ef0725eb5dc2febfd6af7677b73f01d0852a29b460fc92ec943242ac638a053bbacc200512b18b30d15083cbdc9282'
    },
    {
        'channel_id': '62e935ae755f3d48f80d4d59f6121358c435722a67e859cc0caa8b539027f2ff',
        'private_key': '6e1fde9cf9e2359a87420b65a87dc0c66136e66945196ba2475990d8a0c3a25b',
        'challenge': 'b05e6b8ad4d69abf74aa3be3c0ee40ae07d66e1895b9ab09285a2f1192d562d2',
        'signature': 'ee3c7644fd8070532bc1fde3d70d742267da545d8c8f03e63bda63f1ad4214f4d2c4bfdb4eb9526def42deeb7e31602a6ff99eba893e0a4ad4d45892ca75e608d2b75e24a189a7f78ca776ba36fc53f6c3e31c32f251f2c524f0a44202f2902d'
    },
]
</pre><a href="#section-5.4.1.3-3" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="channelbinding">
<section id="section-5.4.2">
          <h4 id="name-tls-channel-binding">
<a href="#section-5.4.2" class="section-number selfRef">5.4.2. </a><a href="#name-tls-channel-binding" class="section-name selfRef">TLS Channel Binding</a>
          </h4>
<p id="section-5.4.2-1"><em>TLS Channel Binding</em> is an optional feature for WAMP-Cryptosign when running on top of TLS for link encryption.
The use of "channel binding" to bind authentication at application layers to secure sessions at lower layers in the network stack protects against certain attack scenarios. For more background information, please see<a href="#section-5.4.2-1" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-5.4.2-2.1">
              <a href="https://tools.ietf.org/html/rfc5056">RFC5056: On the Use of Channel Bindings to Secure Channels</a><a href="#section-5.4.2-2.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-5.4.2-2.2">
              <a href="https://www.ietf.org/proceedings/90/slides/slides-90-uta-0.pdf">Binding Security Tokens to TLS Channels</a><a href="#section-5.4.2-2.2" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-5.4.2-3">A client that wishes to use TLS Channel Binding with WAMP-Cryptosign must include an attribute <code>channel_binding</code> in the <code>authextra</code> sent in <code>HELLO.Details</code>:<a href="#section-5.4.2-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.4.2-4">
<pre>[1, 'realm1', {
  'authextra': {
    'channel_binding': 'tls-unique',
    'pubkey': '545efb0a2192db8d43f118e9bf9aee081466e1ef36c708b96ee6f62dddad9122'
  },
  'authmethods': ['cryptosign']
  }]
</pre><a href="#section-5.4.2-4" class="pilcrow">¶</a>
</div>
<p id="section-5.4.2-5">The <code>channel_binding</code>, if present, MUST be a string with a value of <code>tls-unique</code> or <code>tls-exporter</code>,
to specify the channel binding type that is to be used:<a href="#section-5.4.2-5" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-5.4.2-6.1">
              <code>tls-unique</code>: <a href="https://datatracker.ietf.org/doc/html/rfc5929">RFC5929: Channel Bindings for TLS</a><a href="#section-5.4.2-6.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-5.4.2-6.2">
              <code>tls-exporter</code>: <a href="https://datatracker.ietf.org/doc/html/rfc9266">RFC9266: Channel Bindings for TLS 1.3</a><a href="#section-5.4.2-6.2" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-5.4.2-7">When a router receives a HELLO message from a client with a TLS channel binding attribute present,
the router MUST:<a href="#section-5.4.2-7" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="compact type-1" id="section-5.4.2-8">
<li id="section-5.4.2-8.1">get the TLS channel ID (32 bytes) of the TLS session with the respective channel type requested<a href="#section-5.4.2-8.1" class="pilcrow">¶</a>
</li>
            <li id="section-5.4.2-8.2">generate new challenge (32 random bytes)<a href="#section-5.4.2-8.2" class="pilcrow">¶</a>
</li>
            <li id="section-5.4.2-8.3">expect the client to send back a signature in AUTHENTICATE computed over <code>challenge XOR channel_id</code><a href="#section-5.4.2-8.3" class="pilcrow">¶</a>
</li>
          </ol>
<p id="section-5.4.2-9">and send back the <code>channel_binding</code> in use, and the <code>challenge</code> in a CHALLENGE message:<a href="#section-5.4.2-9" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.4.2-10">
<pre>[4, 'cryptosign', {
  'challenge': '0e9192bc08512c8198da159c1ae600ba91729215f35d56102ee318558e773537',
  'channel_binding': 'tls-unique'}]
</pre><a href="#section-5.4.2-10" class="pilcrow">¶</a>
</div>
<p id="section-5.4.2-11">The authenticating client MUST verify the actual channel binding in use matches the one it requested. If a router does not support the <code>channel_binding</code> the client requested, it may chose to continue the authentication without channel binding, and hence <code>CHALLENGE.Extra</code> would not contain a <code>channel_binding</code>.<a href="#section-5.4.2-11" class="pilcrow">¶</a></p>
<p id="section-5.4.2-12">The client MUST then locally fetch the <code>channel_id</code> from the underlying TLS connection and
sign <code>CHALLENGE.Extra.challenge XOR channel_id</code> using its private key.<a href="#section-5.4.2-12" class="pilcrow">¶</a></p>
</section>
</div>
<div id="routerauth">
<section id="section-5.4.3">
          <h4 id="name-router-authentication">
<a href="#section-5.4.3" class="section-number selfRef">5.4.3. </a><a href="#name-router-authentication" class="section-name selfRef">Router Authentication</a>
          </h4>
<p id="section-5.4.3-1">With the basic <em>Client Authentication</em> mechanism in WAMP-Cryptosign, the router is able to authenticate
the client, since to successfully sign <code>CHALLENGE.Extra.challenge</code> the client will need the
private key corresponding to the public key which the client announced in <code>HELLO.Details.pubkey</code> to be authenticated under.<a href="#section-5.4.3-1" class="pilcrow">¶</a></p>
<p id="section-5.4.3-2">However, from this alone, the client can not be sure the router against which it is authenticating is
actually valid, as in authentic. <em>Router Authentication</em> adds this capability.<a href="#section-5.4.3-2" class="pilcrow">¶</a></p>
<p id="section-5.4.3-3">To request a router to authenticate, a client will start the authentication handshake by sending
<code>HELLO.Details.challenge|string</code>:<a href="#section-5.4.3-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.4.3-4">
<pre>[1, 'realm1', {
  'authextra': {
    'challenge': 'bbae60ea44cdd7b20dc7010a618b0f0803fab25a817520b4b7f057299b524deb',
    'pubkey': '545efb0a2192db8d43f118e9bf9aee081466e1ef36c708b96ee6f62dddad9122'
    }}]
</pre><a href="#section-5.4.3-4" class="pilcrow">¶</a>
</div>
<p id="section-5.4.3-5">Similar to <em>Client Authentication</em>, the <code>challenge</code> must encode a 32 bytes random value as a string in HEX format, and the router MUST respond by signing this challenge value with its (the router's) private key,
and send back the signature in <code>CHALLENGE.Extra.signature</code><a href="#section-5.4.3-5" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.4.3-6">
<pre>[4, 'cryptosign', {
  'challenge': '0e9192bc08512c8198da159c1ae600ba91729215f35d56102ee318558e773537',
  'pubkey': '4a3838f6fe75251e613329d53fc69b262d5eac97fb1d73bebbaed4015b53c862',
  'signature': 'fd5128d2d207ba58a9d1d6f41b72c747964ad9d1294077b3b1eee6130b05843ab12c53c7f2519f73d4feb82db19d8ca0fc26b62bde6518e79a882f5795bc9f00bbae60ea44cdd7b20dc7010a618b0f0803fab25a817520b4b7f057299b524deb'}]
</pre><a href="#section-5.4.3-6" class="pilcrow">¶</a>
</div>
<p id="section-5.4.3-7">When <em>Router Authentication</em> is used, the router MUST also send its public key in <code>CHALLENGE.Extra.pubkey</code>.<a href="#section-5.4.3-7" class="pilcrow">¶</a></p>
<p id="section-5.4.3-8">Further, <em>Router Authentication</em> can be combined with <em>TLS Channel Binding</em>, in which case the value
signed by the router will be <code>HELLO.Details.challenge XOR channel_id</code>.<a href="#section-5.4.3-8" class="pilcrow">¶</a></p>
</section>
</div>
<div id="trustrootcerts">
<section id="section-5.4.4">
          <h4 id="name-trustroots-and-certificates">
<a href="#section-5.4.4" class="section-number selfRef">5.4.4. </a><a href="#name-trustroots-and-certificates" class="section-name selfRef">Trustroots and Certificates</a>
          </h4>
<div id="certificate-chains">
<section id="section-5.4.4.1">
            <h5 id="name-certificate-chains">
<a href="#section-5.4.4.1" class="section-number selfRef">5.4.4.1. </a><a href="#name-certificate-chains" class="section-name selfRef">Certificate Chains</a>
            </h5>
<p id="section-5.4.4.1-1">A public-key certificate is a signed statement that is used to establish an association between an identity and a public key. This is called a machine identity. The entity that vouches for this association and signs the certificate is the issuer of the certificate and the identity whose public key is being vouched for is the subject of the certificate. In order to associate the identity and the public key, a chain of certificates is used. The certificate chain is also called the certification path or chain of trust.<a href="#section-5.4.4.1-1" class="pilcrow">¶</a></p>
<p id="section-5.4.4.1-2"><em>What is a Certificate Chain?</em><a href="#section-5.4.4.1-2" class="pilcrow">¶</a></p>
<p id="section-5.4.4.1-3">A certificate chain is a list of certificates (usually starting with an end-entity certificate) followed by one or more CA certificates (usually the last one being a self-signed certificate), with the following properties:<a href="#section-5.4.4.1-3" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-5.4.4.1-4.1">The <strong>issuer</strong> of each certificate (except the last one) matches the <strong>subject of</strong> the next certificate in the list.<a href="#section-5.4.4.1-4.1" class="pilcrow">¶</a>
</li>
              <li class="compact" id="section-5.4.4.1-4.2">Each certificate (except the last one) is supposed to be signed by the secret key corresponding to the next certificate in the chain (i.e. the signature of one certificate can be verified using the public key contained in the following certificate).<a href="#section-5.4.4.1-4.2" class="pilcrow">¶</a>
</li>
              <li class="compact" id="section-5.4.4.1-4.3">The last certificate in the list is a <strong>trust anchor</strong>: a certificate that you trust because it was delivered to you by some trustworthy procedure. A trust anchor is a CA certificate (or more precisely, the public verification key of a CA) used by a relying party as the starting point for path validation.<a href="#section-5.4.4.1-4.3" class="pilcrow">¶</a>
</li>
            </ul>
<p id="section-5.4.4.1-5">More information about certificate chains, while in the context of x509, can be found in this white paper published by the <em>PKI forum</em>: <a href="http://www.oasis-pki.org/pdfs/Understanding_Path_construction-DS2.pdf">Understanding Certification Path Construction</a>.<a href="#section-5.4.4.1-5" class="pilcrow">¶</a></p>
<p id="section-5.4.4.1-6"><em>What are On-chain Trust Anchors?</em><a href="#section-5.4.4.1-6" class="pilcrow">¶</a></p>
<p id="section-5.4.4.1-7">In x509, the set of trusted root CA certificates are stored in a machine/device local certificate store. This set of trusted root CA certificates are:<a href="#section-5.4.4.1-7" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="compact type-1" id="section-5.4.4.1-8">
<li id="section-5.4.4.1-8.1">filled and fixed by the software or device vendor with a default root CA certificates set<a href="#section-5.4.4.1-8.1" class="pilcrow">¶</a>
</li>
              <li id="section-5.4.4.1-8.2">may be extendable or replaceable by a user provided custom root CA certificates set<a href="#section-5.4.4.1-8.2" class="pilcrow">¶</a>
</li>
            </ol>
<p id="section-5.4.4.1-9">With 1., the user implicitly trusts the vendor, and all root CAs in the set installed by the vendor.
With 2., the user must manage a public-private key infrastructure, and when information is to be
shared with other parties, the use PKI must be made available to those parties, and the parties
will operationally and administratively depend on the PKI hosting party.
In summary, x509 follows a centralized and hierarchical trust model.<a href="#section-5.4.4.1-9" class="pilcrow">¶</a></p>
<p id="section-5.4.4.1-10">With WAMP-Cryptosign, we use a public blockchain for certificate chain trust anchors. Using a public blockchain, specifically Ethereum, provides a decentralized, shared and cryptographically secure
storage for root CA certificates, that is trust anchors. These anchors can be associated with
other entities stored on-chain, such as <em>federated Realms</em>.<a href="#section-5.4.4.1-10" class="pilcrow">¶</a></p>
<p id="section-5.4.4.1-11">The following diagram shows the structure of certificate chains in WAMP-Cryptosign:<a href="#section-5.4.4.1-11" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.4.4.1-12">
<pre>           EIP712AuthorityCertificate
        +------------------------------+
        |   chainId                    |       Root Certificate
        |   verifyingContract          |
        |   validFrom                  |         * trust anchor, stored on-chain
   +----+-- issuer (== realm owner)    |         * tied to a realm
   +----+-&gt; subject (== issuer) -------+----+    * self-signed by realm owner
        |   realm                      |    |
        |   capabilities               |    |
        |   meta                       |    |
        +------------------------------+    |   +------------------------------+
        |   issuerSignature            +----+---&gt; Public Blockchain (L1 or L2) |
        +------------------------------+    |   +------------------------------+
                                            |
                                            |
                                            |
                                            |
                                            |
           EIP712AuthorityCertificate       |
        +------------------------------+    |
        |   chainId                    |    |   Intermediate Certificate
        |   verifyingContract          |    |
        |   validFrom                  |    |    * stored off-chain
        |   issuer  &lt;------------------+----+    * same realm as issueing cert
  +-----+-- subject                    |         * subset of capabilities
  |     |   realm                      |             of issueing cert
  |     |   capabilities               |
  |     |   meta                       |
  |     +------------------------------+
  |     |   issuerSignature            |
  |     +------------------------------+
  |


optional hierarchical chain of intermediate certificates


  |
  |        EIP712AuthorityCertificate
  |     +------------------------------+
  |     |   chainId                    |        Intermediate Certificate
  |     |   verifyingContract          |
  |     |   validFrom                  |         * stored off-chain
  +-----+-&gt; issuer                     |         * same realm as issueing cert
        |   subject--------------------+----+    * subset of capabilities
        |   realm                      |    |        of issueing cert
        |   capabilities               |    |
        |   meta                       |    |
        +------------------------------+    |
        |   issuerSignature            |    |
        +------------------------------+    |
                                            |
                                            |
                                            |
                                            |
                                            |
           EIP712DelegateCertificate        |
        +------------------------------+    |
        |   chainId                    |    |   End-point Certificate
        |   verifyingContract          |    |
        |   validFrom                  |    |     * ephemeral, generate per-boot
        |   delegate &lt;-----------------+----+     * subject is WAMP-Cryptosign pubkey
        |   csPubKey                   |          * Boot time (UTC in Posix ns)
        |   bootedAt                   |
        |   meta                       |
        |                              |
        |                              |
        +------------------------------+         +--------------------------+
        |   delegateSignature          +---------&gt; Hardware Security Module |
        +------------------------------+         +--------------------------+
</pre><a href="#section-5.4.4.1-12" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="certificate-types">
<section id="section-5.4.4.2">
            <h5 id="name-certificate-types">
<a href="#section-5.4.4.2" class="section-number selfRef">5.4.4.2. </a><a href="#name-certificate-types" class="section-name selfRef">Certificate Types</a>
            </h5>
<p id="section-5.4.4.2-1">The certificate types <code>EIP712AuthorityCertificate</code> and <code>EIP712DelegateCertificate</code> follow <a href="https://eips.ethereum.org/EIPS/eip-712">EIP712</a> and use Ethereum signatures.<a href="#section-5.4.4.2-1" class="pilcrow">¶</a></p>
<p id="section-5.4.4.2-2"><code>EIP712AuthorityCertificate</code>:<a href="#section-5.4.4.2-2" class="pilcrow">¶</a></p>
<div class="lang-json sourcecode" id="section-5.4.4.2-3">
<pre>[
    {
        "name": "chainId",
        "type": "uint256"
    },
    {
        "name": "verifyingContract",
        "type": "address"
    },
    {
        "name": "validFrom",
        "type": "uint256"
    },
    {
        "name": "issuer",
        "type": "address"
    },
    {
        "name": "subject",
        "type": "address"
    },
    {
        "name": "realm",
        "type": "address"
    },
    {
        "name": "capabilities",
        "type": "uint64"
    },
    {
        "name": "meta",
        "type": "string"
    }
]
</pre><a href="#section-5.4.4.2-3" class="pilcrow">¶</a>
</div>
<p id="section-5.4.4.2-4"><code>EIP712DelegateCertificate</code>:<a href="#section-5.4.4.2-4" class="pilcrow">¶</a></p>
<div class="lang-json sourcecode" id="section-5.4.4.2-5">
<pre>[
    {
        "name": "chainId",
        "type": "uint256"
    },
    {
        "name": "verifyingContract",
        "type": "address"
    },
    {
        "name": "validFrom",
        "type": "uint256"
    },
    {
        "name": "delegate",
        "type": "address"
    },
    {
        "name": "csPubKey",
        "type": "bytes32"
    },
    {
        "name": "bootedAt",
        "type": "uint64"
    },
    {
        "name": "meta",
        "type": "string"
    }
]
</pre><a href="#section-5.4.4.2-5" class="pilcrow">¶</a>
</div>
<p id="section-5.4.4.2-6">The EIP712 types for certificates contain:<a href="#section-5.4.4.2-6" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-5.4.4.2-7.1">
                <code>chainId</code>: the chain ID of the blockchain this signed typed data is bound to<a href="#section-5.4.4.2-7.1" class="pilcrow">¶</a>
</li>
              <li class="compact" id="section-5.4.4.2-7.2">
                <code>verifyingContract</code>: the address of the (main) smart contract this signed typed data is bound to<a href="#section-5.4.4.2-7.2" class="pilcrow">¶</a>
</li>
            </ul>
<p id="section-5.4.4.2-8">This prevents cross-chain and cross-contract attacks. The <code>chainId</code> is an integer according to <a href="https://github.com/ethereum/EIPs/blob/master/EIPS/eip-155.md">EIP155</a>:<a href="#section-5.4.4.2-8" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-5.4.4.2-9.1">Ethereum Mainnet (ChainID 1)<a href="#section-5.4.4.2-9.1" class="pilcrow">¶</a>
</li>
              <li class="compact" id="section-5.4.4.2-9.2">Goerli Testnet (ChainID 5)<a href="#section-5.4.4.2-9.2" class="pilcrow">¶</a>
</li>
              <li class="compact" id="section-5.4.4.2-9.3">zkSync 2.0 Alpha Testnet (ChainID 280)<a href="#section-5.4.4.2-9.3" class="pilcrow">¶</a>
</li>
            </ul>
<p id="section-5.4.4.2-10">Besides EIP712, other comparable approaches to specify cryptographically hashable, typed structured data ("messages") include:<a href="#section-5.4.4.2-10" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-5.4.4.2-11.1">
                <a href="https://docs.rs/veriform/latest/veriform/">Veriform</a>: cryptographically verifiable and canonicalized <a href="https://github.com/iqlusioninc/veriform/blob/develop/spec/draft-veriform-spec.md">message format</a> similar to Protocol Buffers, with an "embedded-first" (heapless) implementation suitable for certificates or other signed objects<a href="#section-5.4.4.2-11.1" class="pilcrow">¶</a>
</li>
              <li class="compact" id="section-5.4.4.2-11.2">
                <a href="https://github.com/benlaurie/objecthash">objecthash</a>: A way to cryptographically hash objects (in the JSON-ish sense) that works cross-language. And, therefore, cross-encoding.<a href="#section-5.4.4.2-11.2" class="pilcrow">¶</a>
</li>
            </ul>
</section>
</div>
<div id="capabilities">
<section id="section-5.4.4.3">
            <h5 id="name-capabilities">
<a href="#section-5.4.4.3" class="section-number selfRef">5.4.4.3. </a><a href="#name-capabilities" class="section-name selfRef">Capabilities</a>
            </h5>
<ul class="compact">
<li class="compact" id="section-5.4.4.3-1.1">
                <strong>Bit 0</strong>: <code>CAPABILITY_ROOT_CA</code><a href="#section-5.4.4.3-1.1" class="pilcrow">¶</a>
</li>
              <li class="compact" id="section-5.4.4.3-1.2">
                <strong>Bit 1</strong>: <code>CAPABILITY_INTERMEDIATE_CA</code><a href="#section-5.4.4.3-1.2" class="pilcrow">¶</a>
</li>
              <li class="compact" id="section-5.4.4.3-1.3">
                <strong>Bit 2</strong>: <code>CAPABILITY_PUBLIC_RELAY</code><a href="#section-5.4.4.3-1.3" class="pilcrow">¶</a>
</li>
              <li class="compact" id="section-5.4.4.3-1.4">
                <strong>Bit 3</strong>: <code>CAPABILITY_PRIVATE_RELAY</code><a href="#section-5.4.4.3-1.4" class="pilcrow">¶</a>
</li>
              <li class="compact" id="section-5.4.4.3-1.5">
                <strong>Bit 4</strong>: <code>CAPABILITY_GATEWAY</code><a href="#section-5.4.4.3-1.5" class="pilcrow">¶</a>
</li>
              <li class="compact" id="section-5.4.4.3-1.6">
                <strong>Bit 5</strong>: <code>CAPABILITY_EXCHANGE</code><a href="#section-5.4.4.3-1.6" class="pilcrow">¶</a>
</li>
              <li class="compact" id="section-5.4.4.3-1.7">
                <strong>Bit 6</strong>: <code>CAPABILITY_PROVIDER</code><a href="#section-5.4.4.3-1.7" class="pilcrow">¶</a>
</li>
              <li class="compact" id="section-5.4.4.3-1.8">
                <strong>Bit 7</strong>: <code>CAPABILITY_CONSUMER</code><a href="#section-5.4.4.3-1.8" class="pilcrow">¶</a>
</li>
              <li class="compact" id="section-5.4.4.3-1.9">
                <strong>Bits 8 - 63</strong>: future use, all set to <code>0</code><a href="#section-5.4.4.3-1.9" class="pilcrow">¶</a>
</li>
            </ul>
<p id="section-5.4.4.3-2">Permission to create a <code>CAPABILITY_PUBLIC_RELAY</code> certificate on a realm can be
configured by the realm owner for:<a href="#section-5.4.4.3-2" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-5.4.4.3-3.1">
                <code>PRIVATE</code>: signed by realm owner<a href="#section-5.4.4.3-3.1" class="pilcrow">¶</a>
</li>
              <li class="compact" id="section-5.4.4.3-3.2">
                <code>PERMISSIONED</code>: signed by requestor and realm owner<a href="#section-5.4.4.3-3.2" class="pilcrow">¶</a>
</li>
              <li class="compact" id="section-5.4.4.3-3.3">
                <code>OPEN</code>: signed by requestor<a href="#section-5.4.4.3-3.3" class="pilcrow">¶</a>
</li>
            </ul>
<p id="section-5.4.4.3-4">Permission for <code>CAPABILITY_ROOT_CA</code> is always <code>PRIVATE</code>.<a href="#section-5.4.4.3-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="certificate-chain-verification">
<section id="section-5.4.4.4">
            <h5 id="name-certificate-chain-verificat">
<a href="#section-5.4.4.4" class="section-number selfRef">5.4.4.4. </a><a href="#name-certificate-chain-verificat" class="section-name selfRef">Certificate Chain Verification</a>
            </h5>
<p id="section-5.4.4.4-1">use of a specific method/mechanism, when it comes to establishing trust (i.e. certifying public keys).<a href="#section-5.4.4.4-1" class="pilcrow">¶</a></p>
<p id="section-5.4.4.4-2">To verify a certificate chain and respective certificate signatures<a href="#section-5.4.4.4-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.4.4.4-3">
<pre>[
    (EIP712DelegateCertificate, Signature),       // delegate certificate
    (EIP712AuthorityCertificate, Signature),      // intermediate CA certificate
    ...
    (EIP712AuthorityCertificate, Signature),      // intermediate CA certificate
    (EIP712AuthorityCertificate, Signature)       // root CA certificate
]
</pre><a href="#section-5.4.4.4-3" class="pilcrow">¶</a>
</div>
<p id="section-5.4.4.4-4">the following Certificate Chain Rules (CCR) must be checked:<a href="#section-5.4.4.4-4" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="compact type-1" id="section-5.4.4.4-5">
<li id="section-5.4.4.4-5.1">
                <strong>CCR-1</strong>: The <code>chainId</code> and <code>verifyingContract</code> must match for all certificates to what we expect, and <code>validFrom</code> before current block number on the respective chain.<a href="#section-5.4.4.4-5.1" class="pilcrow">¶</a>
</li>
              <li id="section-5.4.4.4-5.2">
                <strong>CCR-2</strong>: The <code>realm</code> must match for all certificates to the respective realm.<a href="#section-5.4.4.4-5.2" class="pilcrow">¶</a>
</li>
              <li id="section-5.4.4.4-5.3">
                <strong>CCR-3</strong>: The type of the first certificate in the chain must be a <code>EIP712DelegateCertificate</code>, and all subsequent certificates must be of type <code>EIP712AuthorityCertificate</code>.<a href="#section-5.4.4.4-5.3" class="pilcrow">¶</a>
</li>
              <li id="section-5.4.4.4-5.4">
                <strong>CCR-4</strong>: The last certificate must be self-signed (<code>issuer</code> equals <code>subject</code>), it is a root CA certificate.<a href="#section-5.4.4.4-5.4" class="pilcrow">¶</a>
</li>
              <li id="section-5.4.4.4-5.5">
                <strong>CCR-5</strong>: The intermediate certificate's <code>issuer</code> must be equal to the <code>subject</code> of the previous certificate.<a href="#section-5.4.4.4-5.5" class="pilcrow">¶</a>
</li>
              <li id="section-5.4.4.4-5.6">
                <strong>CCR-6</strong>: The root certificate must be <code>validFrom</code> before the intermediate certificate<a href="#section-5.4.4.4-5.6" class="pilcrow">¶</a>
</li>
              <li id="section-5.4.4.4-5.7">
                <strong>CCR-7</strong>: The <code>capabilities</code> of intermediate certificate must be a subset of the root cert<a href="#section-5.4.4.4-5.7" class="pilcrow">¶</a>
</li>
              <li id="section-5.4.4.4-5.8">
                <strong>CCR-8</strong>: The intermediate certificate's <code>subject</code> must be the delegate certificate <code>delegate</code><a href="#section-5.4.4.4-5.8" class="pilcrow">¶</a>
</li>
              <li id="section-5.4.4.4-5.9">
                <strong>CCR-9</strong>: The intermediate certificate must be <code>validFrom</code> before the delegate certificate<a href="#section-5.4.4.4-5.9" class="pilcrow">¶</a>
</li>
              <li id="section-5.4.4.4-5.10">
                <strong>CCR-10</strong>: The root certificate's signature must be valid and signed by the root certificate's <code>issuer</code>.<a href="#section-5.4.4.4-5.10" class="pilcrow">¶</a>
</li>
              <li id="section-5.4.4.4-5.11">
                <strong>CCR-11</strong>: The intermediate certificate's signature must be valid and signed by the intermediate certificate's <code>issuer</code>.<a href="#section-5.4.4.4-5.11" class="pilcrow">¶</a>
</li>
              <li id="section-5.4.4.4-5.12">
                <strong>CCR-12</strong>: The delegate certificate's signature must be valid and signed by the <code>delegate</code>.<a href="#section-5.4.4.4-5.12" class="pilcrow">¶</a>
</li>
            </ol>
</section>
</div>
<div id="trustroots">
<section id="section-5.4.4.5">
            <h5 id="name-trustroots">
<a href="#section-5.4.4.5" class="section-number selfRef">5.4.4.5. </a><a href="#name-trustroots" class="section-name selfRef">Trustroots</a>
            </h5>
<p id="section-5.4.4.5-1">Certificate chains allow to verify a delegate certificate following the Issuers-Subjects up to a <em>Root CA</em>, which is a self-signed certificate (issuer and subject are identical). The <em>Root CA</em> represents the <em>Trustroot</em> of all involved delegates.<a href="#section-5.4.4.5-1" class="pilcrow">¶</a></p>
<p id="section-5.4.4.5-2">When both a connecting WAMP client and the WAMP router are using the same <em>Root CA</em> and thus use a common
<em>Trustroot</em>, they are said to be authorized in the same trust domain (identified by the trustroot).<a href="#section-5.4.4.5-2" class="pilcrow">¶</a></p>
<p id="section-5.4.4.5-3">Trustroots are identified by their Ethereum address, which is computed from the issuer public key according to <a href="https://github.com/ethereumbook/ethereumbook/blob/develop/04keys-addresses.asciidoc#ethereum-addresses">EIP-55</a>.<a href="#section-5.4.4.5-3" class="pilcrow">¶</a></p>
<p id="section-5.4.4.5-4">There are two types of <em>Root CAs</em> and <em>Trustroots</em>:<a href="#section-5.4.4.5-4" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="compact type-1" id="section-5.4.4.5-5">
<li id="section-5.4.4.5-5.1">
                <em>Standalone Trustroot</em><a href="#section-5.4.4.5-5.1" class="pilcrow">¶</a>
</li>
              <li id="section-5.4.4.5-5.2">
                <em>On-chain Trustroot</em><a href="#section-5.4.4.5-5.2" class="pilcrow">¶</a>
</li>
            </ol>
<p id="section-5.4.4.5-6">A <em>Standalone Trustroot</em> is managed by a single operator/owner, does not allow infrastructure elements
(nodes, client, realms) to be integrated between different operators/owners and is privately stored on the
respective operators systems only, usually as files or in databases.<a href="#section-5.4.4.5-6" class="pilcrow">¶</a></p>
<p id="section-5.4.4.5-7">Note that the Ethereum <em>address</em>, can be <em>computed</em> deterministically from the public key of the issuer
of a certificate, even when the certificate (or the issuer) is <em>not</em> stored on-chain.<a href="#section-5.4.4.5-7" class="pilcrow">¶</a></p>
<p id="section-5.4.4.5-8">An <em>On-chain Trustroot</em> in contrast is stored in Ethereum and publically shared between different
operators/owners which allows infrastructure elements (nodes, clients, realms) to be integrated.
For example, clients/nodes operated by different operators can authenticate to each other and
nodes operated by different operators can authenticate to each other sharing the hosting of one realm.<a href="#section-5.4.4.5-8" class="pilcrow">¶</a></p>
<p id="section-5.4.4.5-9">The management of <em>On-Chain Trustroots</em> depends on the policy of the trustroot which is chosen
and fixed when the trustroot is created:<a href="#section-5.4.4.5-9" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="compact type-1" id="section-5.4.4.5-10">
<li id="section-5.4.4.5-10.1">
                <em>Open</em><a href="#section-5.4.4.5-10.1" class="pilcrow">¶</a>
</li>
              <li id="section-5.4.4.5-10.2">
                <em>Permitted</em><a href="#section-5.4.4.5-10.2" class="pilcrow">¶</a>
</li>
              <li id="section-5.4.4.5-10.3">
                <em>Private</em><a href="#section-5.4.4.5-10.3" class="pilcrow">¶</a>
</li>
            </ol>
<p id="section-5.4.4.5-11">With an <em>Open On-chain Trustroot</em>, new certificates can be added to a certificate chain freely
and only requires a signature by the respective intermediate CA issuer.<a href="#section-5.4.4.5-11" class="pilcrow">¶</a></p>
<div id="standalone-trustroots">
<section id="section-5.4.4.5.1">
              <h6 id="name-standalone-trustroots">
<a href="#section-5.4.4.5.1" class="section-number selfRef">5.4.4.5.1. </a><a href="#name-standalone-trustroots" class="section-name selfRef">Standalone Trustroots</a>
              </h6>
<p id="section-5.4.4.5.1-1">For a <em>Standalone Trustroot</em> the <code>trustroot</code> MUST be specified in <code>HELLO.Details.authextra.trustroot|string</code><a href="#section-5.4.4.5.1-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.4.4.5.1-2">
<pre>{'authextra': {'certificates': [/* certificate, see below */],
              'challenge': '2763e7fdb1c34a74e8497daf6c913744d11161a94cec3b16aeec60a788612e17',
              'channel_binding': 'tls-unique',
              'pubkey': '12ae0184b180e9a9c5e45be4a1afbce3c6491320063701cd9c4011a777d04089',
              'trustroot': '0xf766Dc789CF04CD18aE75af2c5fAf2DA6650Ff57'},
</pre><a href="#section-5.4.4.5.1-2" class="pilcrow">¶</a>
</div>
<p id="section-5.4.4.5.1-3">and <code>certificates</code> MUST contain<a href="#section-5.4.4.5.1-3" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-5.4.4.5.1-4.1">a single <code>EIP712DelegateCertificate</code>, and have the complete certificate chain of <code>EIP712AuthorityCertificate</code>s up to <code>trustroot</code> pre-agreed (locally stored or built-in) OR<a href="#section-5.4.4.5.1-4.1" class="pilcrow">¶</a>
</li>
                <li class="compact" id="section-5.4.4.5.1-4.2">the complete chain of certificates starting with a <code>EIP712DelegateCertificate</code> followed by one or more <code>EIP712AuthorityCertificate</code>s up to <code>trustroot</code>.<a href="#section-5.4.4.5.1-4.2" class="pilcrow">¶</a>
</li>
              </ul>
<p id="section-5.4.4.5.1-5"><a href="#message-exchange-example3">Example 3</a> contains an example gor the latter, with a bundled complete certificate chain, that is the last certificate in the list is self-signed (is a root CA certificate) and matches <code>trustroot</code><a href="#section-5.4.4.5.1-5" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.4.4.5.1-6">
<pre>trustroot == 0xf766Dc789CF04CD18aE75af2c5fAf2DA6650Ff57
          == certificates[-1].issuer
          == certificates[-1].subject
</pre><a href="#section-5.4.4.5.1-6" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="on-chain-trustroots">
<section id="section-5.4.4.5.2">
              <h6 id="name-on-chain-trustroots">
<a href="#section-5.4.4.5.2" class="section-number selfRef">5.4.4.5.2. </a><a href="#name-on-chain-trustroots" class="section-name selfRef">On-chain Trustroots</a>
              </h6>
<p id="section-5.4.4.5.2-1">For an <em>On-chain Trustroot</em> the <code>trustroot</code> MUST be specified in <code>HELLO.Details.authextra.trustroot|string</code><a href="#section-5.4.4.5.2-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.4.4.5.2-2">
<pre>{'authextra': {'certificates': [/* certificate, see below */],
              'challenge': '2763e7fdb1c34a74e8497daf6c913744d11161a94cec3b16aeec60a788612e17',
              'channel_binding': 'tls-unique',
              'pubkey': '12ae0184b180e9a9c5e45be4a1afbce3c6491320063701cd9c4011a777d04089',
              'trustroot': '0xf766Dc789CF04CD18aE75af2c5fAf2DA6650Ff57'},
</pre><a href="#section-5.4.4.5.2-2" class="pilcrow">¶</a>
</div>
<p id="section-5.4.4.5.2-3">and <code>certificates</code> MUST contain a single <code>EIP712DelegateCertificate</code>, and have the complete certificate chain of <code>EIP712AuthorityCertificate</code>s up to <code>trustroot</code> stored on-chain (Ethereum).<a href="#section-5.4.4.5.2-3" class="pilcrow">¶</a></p>
<p id="section-5.4.4.5.2-4">This is called a free-standing, on-chain CA.<a href="#section-5.4.4.5.2-4" class="pilcrow">¶</a></p>
<p id="section-5.4.4.5.2-5">When the <code>trustroot</code> is associated with an on-chain <em>Realm</em> that has <code>trustroot</code> configured as the
<em>Realm CA</em>, this is called <em>On-chain CA with CA associated with On-chain Realm</em>.<a href="#section-5.4.4.5.2-5" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="remoteattestation">
<section id="section-5.4.5">
          <h4 id="name-remote-attestation">
<a href="#section-5.4.5" class="section-number selfRef">5.4.5. </a><a href="#name-remote-attestation" class="section-name selfRef">Remote Attestation</a>
          </h4>
<p id="section-5.4.5-1">Remote attestation is a method by which a host (WAMP client) authenticates its hardware and software configuration to a remote host (WAMP router). The goal of remote attestation is to enable a remote system (challenger) to determine the level of trust in the integrity of the platform of another system (attestator).<a href="#section-5.4.5-1" class="pilcrow">¶</a></p>
<p id="section-5.4.5-2">Remote attestation allows to<a href="#section-5.4.5-2" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-5.4.5-3.1">perform security decisions based on security policy and measurement log<a href="#section-5.4.5-3.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-5.4.5-3.2">tie device identity into authentication infrastructure<a href="#section-5.4.5-3.2" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-5.4.5-3.3">verify device state in access control decisions<a href="#section-5.4.5-3.3" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-5.4.5-3.4">avoid exfiltration of credentials<a href="#section-5.4.5-3.4" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-5.4.5-4">Remote attestation is requested by the router sending <code>CHALLENGE.extra.attest|list[int]</code> with a list of device PCRs to be quoted.
A list of all PCRs available (usually 24) in a PCR bank of a device can be obtained running <a href="https://tpm2-tools.readthedocs.io/en/latest/man/tpm2_pcrread.1/#display-all-pcr-values">tpm2_pcrread</a> without arguments.<a href="#section-5.4.5-4" class="pilcrow">¶</a></p>
<p id="section-5.4.5-5">A client receiving such a <code>CHALLENGE</code> MUST include an <em>Event Log</em> with PCRs collected from <em>measured boot</em> signed by the device's security module's <em>Attestation Key (AK)</em> and using the challenge sent by the router <code>CHALLENGE.extra.challenge|string</code> as a nonce.
<a href="https://en.wikipedia.org/wiki/Trusted_Platform_Module">TPM 2.0</a> of the <a href="https://en.wikipedia.org/wiki/Trusted_Computing_Group">TCG</a> specifies a suitable function in <a href="https://tpm2-tools.readthedocs.io/en/latest/man/tss2_quote.1/">tss2_quote</a> (also see <a href="https://tpm2-tss.readthedocs.io/en/latest/group___fapi___quote.html">here</a>).<a href="#section-5.4.5-5" class="pilcrow">¶</a></p>
<p id="section-5.4.5-6">The client MUST include the signed attestation in <code>AUTHENTICATE.Extra.quote</code> and the corresponding measurement log in <code>AUTHENTICATE.Extra.measurement</code>.
The following diagram illustrates <em>Remote Attestation</em> with WAMP-Cryptosign:<a href="#section-5.4.5-6" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.4.5-7">
<pre>    +------------------------------+
    | CHALLENGE sent by router     |
    +------------------------------+

      Selected PCRs (bitmap) == CHALLENGE.Extra.attest

      Nonce == CHALLENGE.Extra.challenge

        |
        |
        |
        |       Quote (signed with AK)
        |      +------------------------------+
        |      |                              |
        +----&gt; | Selected PCRs (bitmap)       |
        |      |                              |
        |      | PCR values (digest)          |
        |      |                              |
        +----&gt; | Nonce                        |
               |                              |
               +------------------------------+
               | Signature (Attestation Key)  |
               |                              |
               +------------------------------+

                             +

               +------------------------------+
               |                              |
               | Measurement Log              |
               |                              |
               |                              |
               |                              |
               +------------------------------+

                    |
                    |
                    |
                    |
                    |
                    |    +------------------------------+
                    +--&gt; | AUTHENTICATE sent by client  |
                         +------------------------------+

                            AUTHENTICATE.Extra.quote

                            AUTHENTICATE.Extra.measurement
</pre><a href="#section-5.4.5-7" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="examplemessageexchanges">
<section id="section-5.4.6">
          <h4 id="name-example-message-exchanges">
<a href="#section-5.4.6" class="section-number selfRef">5.4.6. </a><a href="#name-example-message-exchanges" class="section-name selfRef">Example Message Exchanges</a>
          </h4>
<ul class="compact">
<li class="compact" id="section-5.4.6-1.1">
              <a href="#message-exchange-example1">Example 1</a><a href="#section-5.4.6-1.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-5.4.6-1.2">
              <a href="#message-exchange-example2">Example 2</a><a href="#section-5.4.6-1.2" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-5.4.6-1.3">
              <a href="#message-exchange-example3">Example 3</a><a href="#section-5.4.6-1.3" class="pilcrow">¶</a>
</li>
          </ul>
<div id="message-exchange-example1">
<section id="section-5.4.6.1">
            <h5 id="name-example-1">
<a href="#section-5.4.6.1" class="section-number selfRef">5.4.6.1. </a><a href="#name-example-1" class="section-name selfRef">Example 1</a>
            </h5>
<ul class="compact">
<li class="compact" id="section-5.4.6.1-1.1">
                <em>with</em> router challenge<a href="#section-5.4.6.1-1.1" class="pilcrow">¶</a>
</li>
              <li class="compact" id="section-5.4.6.1-1.2">
                <em>without</em> TLS channel binding<a href="#section-5.4.6.1-1.2" class="pilcrow">¶</a>
</li>
            </ul>
<div class="alignLeft art-text artwork" id="section-5.4.6.1-2">
<pre>WAMP-Transmit(-, -) &gt;&gt;
  HELLO::
    [1,
     'devices',
     {'authextra': {'challenge': 'bbae60ea44cdd7b20dc7010a618b0f0803fab25a817520b4b7f057299b524deb',
                    'channel_binding': None,
                    'pubkey': '545efb0a2192db8d43f118e9bf9aee081466e1ef36c708b96ee6f62dddad9122'},
      'authmethods': ['cryptosign'],
      'roles': {'callee': {'features': {'call_canceling': True,
                                        'caller_identification': True,
                                        'pattern_based_registration': True,
                                        'progressive_call_results': True,
                                        'registration_revocation': True,
                                        'shared_registration': True}},
                'caller': {'features': {'call_canceling': True,
                                        'caller_identification': True,
                                        'progressive_call_results': True}},
                'publisher': {'features': {'publisher_exclusion': True,
                                           'publisher_identification': True,
                                           'subscriber_blackwhite_listing': True}},
                'subscriber': {'features': {'pattern_based_subscription': True,
                                            'publisher_identification': True,
                                            'subscription_revocation': True}}}}]
&gt;&gt;

WAMP-Receive(-, -) &lt;&lt;
  CHALLENGE::
    [4,
     'cryptosign',
     {'challenge': '0e9192bc08512c8198da159c1ae600ba91729215f35d56102ee318558e773537',
      'channel_binding': None,
      'pubkey': '4a3838f6fe75251e613329d53fc69b262d5eac97fb1d73bebbaed4015b53c862',
      'signature': 'fd5128d2d207ba58a9d1d6f41b72c747964ad9d1294077b3b1eee6130b05843ab12c53c7f2519f73d4feb82db19d8ca0fc26b62bde6518e79a882f5795bc9f00bbae60ea44cdd7b20dc7010a618b0f0803fab25a817520b4b7f057299b524deb'}]
&lt;&lt;

WAMP-Transmit(-, -) &gt;&gt;
  AUTHENTICATE::
    [5,
     'a3a178fe792ed772a8fc092f8341e455de96670c8901264a7c312dbf940d5743626fe9fbc29b23dcd2169b308eca309de85a89ccd296b24835de3d95b16b77030e9192bc08512c8198da159c1ae600ba91729215f35d56102ee318558e773537',
     {}]
&gt;&gt;

WAMP-Receive(-, -) &lt;&lt;
  WELCOME::
    [2,
     3735119691078036,
     {'authextra': {'x_cb_node': 'intel-nuci7-49879',
                    'x_cb_peer': 'tcp4:127.0.0.1:53976',
                    'x_cb_pid': 49987,
                    'x_cb_worker': 'worker001'},
      'authid': 'client01@example.com',
      'authmethod': 'cryptosign',
      'authprovider': 'static',
      'authrole': 'device',
      'realm': 'devices',
      'roles': {'broker': {'features': {'event_retention': True,
                                        'pattern_based_subscription': True,
                                        'publisher_exclusion': True,
                                        'publisher_identification': True,
                                        'session_meta_api': True,
                                        'subscriber_blackwhite_listing': True,
                                        'subscription_meta_api': True,
                                        'subscription_revocation': True}},
                'dealer': {'features': {'call_canceling': True,
                                        'caller_identification': True,
                                        'pattern_based_registration': True,
                                        'progressive_call_results': True,
                                        'registration_meta_api': True,
                                        'registration_revocation': True,
                                        'session_meta_api': True,
                                        'shared_registration': True,
                                        'testament_meta_api': True}}},
      'x_cb_node': 'intel-nuci7-49879',
      'x_cb_peer': 'tcp4:127.0.0.1:53976',
      'x_cb_pid': 49987,
      'x_cb_worker': 'worker001'}]
&lt;&lt;

WAMP-Transmit(3735119691078036, client01@example.com) &gt;&gt;
  GOODBYE::
    [6, {}, 'wamp.close.normal']
&gt;&gt;

WAMP-Receive(3735119691078036, client01@example.com) &lt;&lt;
  GOODBYE::
    [6, {}, 'wamp.close.normal']
&lt;&lt;
</pre><a href="#section-5.4.6.1-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="message-exchange-example2">
<section id="section-5.4.6.2">
            <h5 id="name-example-2">
<a href="#section-5.4.6.2" class="section-number selfRef">5.4.6.2. </a><a href="#name-example-2" class="section-name selfRef">Example 2</a>
            </h5>
<ul class="compact">
<li class="compact" id="section-5.4.6.2-1.1">
                <em>with</em> router challenge<a href="#section-5.4.6.2-1.1" class="pilcrow">¶</a>
</li>
              <li class="compact" id="section-5.4.6.2-1.2">
                <em>with</em> TLS channel binding<a href="#section-5.4.6.2-1.2" class="pilcrow">¶</a>
</li>
            </ul>
<div class="alignLeft art-text artwork" id="section-5.4.6.2-2">
<pre>WAMP-Transmit(-, -) &gt;&gt;
  HELLO::
    [1,
     'devices',
     {'authextra': {'challenge': '4f861f12796c2972b7b0026522a687aa851d90355122a61d4f1fdce4d06b564f',
                    'channel_binding': 'tls-unique',
                    'pubkey': '545efb0a2192db8d43f118e9bf9aee081466e1ef36c708b96ee6f62dddad9122'},
      'authmethods': ['cryptosign'],
      'roles': {'callee': {'features': {'call_canceling': True,
                                        'caller_identification': True,
                                        'pattern_based_registration': True,
                                        'progressive_call_results': True,
                                        'registration_revocation': True,
                                        'shared_registration': True}},
                'caller': {'features': {'call_canceling': True,
                                        'caller_identification': True,
                                        'progressive_call_results': True}},
                'publisher': {'features': {'publisher_exclusion': True,
                                           'publisher_identification': True,
                                           'subscriber_blackwhite_listing': True}},
                'subscriber': {'features': {'pattern_based_subscription': True,
                                            'publisher_identification': True,
                                            'subscription_revocation': True}}}}]
&gt;&gt;

WAMP-Receive(-, -) &lt;&lt;
  CHALLENGE::
    [4,
     'cryptosign',
     {'challenge': '358625312c6c3bf64ed51d17d210ce21af1639c774cabf5735a9651d7d91fc6a',
      'channel_binding': 'tls-unique',
      'pubkey': '4a3838f6fe75251e613329d53fc69b262d5eac97fb1d73bebbaed4015b53c862',
      'signature': 'aa05f4cd7747d36b79443f1d4703a681e107edc085d876b508714e2a3a8135bacaae1c018452c4acb3ad2818aa97a6d23e5ac7e3734c7b1f40e6232a70938205a6f5a1f034a28090b195fb2ce2454a82532f5c8baf6ba1dfb5ddae63c09ce72f'}]
&lt;&lt;

WAMP-Transmit(-, -) &gt;&gt;
  AUTHENTICATE::
    [5,
     '25114474580d6e99a6126b091b4565c23db567d686c5b8c3a94e3f2f09dc80300c5b40a124236733fa56396df721eb12ac092362379bd5b27b4db9e2beaa1408dcf59bd361a2921448f0e45e12f303097924f5798a83b895cf6b179a6d664d0a',
     {}]
&gt;&gt;

WAMP-Receive(-, -) &lt;&lt;
  WELCOME::
    [2,
     7325966140445461,
     {'authextra': {'x_cb_node': 'intel-nuci7-49879',
                    'x_cb_peer': 'tcp4:127.0.0.1:54046',
                    'x_cb_pid': 49987,
                    'x_cb_worker': 'worker001'},
      'authid': 'client01@example.com',
      'authmethod': 'cryptosign',
      'authprovider': 'static',
      'authrole': 'device',
      'realm': 'devices',
      'roles': {'broker': {'features': {'event_retention': True,
                                        'pattern_based_subscription': True,
                                        'publisher_exclusion': True,
                                        'publisher_identification': True,
                                        'session_meta_api': True,
                                        'subscriber_blackwhite_listing': True,
                                        'subscription_meta_api': True,
                                        'subscription_revocation': True}},
                'dealer': {'features': {'call_canceling': True,
                                        'caller_identification': True,
                                        'pattern_based_registration': True,
                                        'progressive_call_results': True,
                                        'registration_meta_api': True,
                                        'registration_revocation': True,
                                        'session_meta_api': True,
                                        'shared_registration': True,
                                        'testament_meta_api': True}}},
      'x_cb_node': 'intel-nuci7-49879',
      'x_cb_peer': 'tcp4:127.0.0.1:54046',
      'x_cb_pid': 49987,
      'x_cb_worker': 'worker001'}]
&lt;&lt;
2022-07-13T17:38:29+0200 session joined: {'authextra': {'x_cb_node': 'intel-nuci7-49879',
               'x_cb_peer': 'tcp4:127.0.0.1:54046',
               'x_cb_pid': 49987,
               'x_cb_worker': 'worker001'},
 'authid': 'client01@example.com',
 'authmethod': 'cryptosign',
 'authprovider': 'static',
 'authrole': 'device',
 'realm': 'devices',
 'resumable': False,
 'resume_token': None,
 'resumed': False,
 'serializer': 'cbor.batched',
 'session': 7325966140445461,
 'transport': {'channel_framing': 'websocket',
               'channel_id': {'tls-unique': b'\xe9s\xbe\xe2M\xce\xa9\xe2'
                                            b'\x06%\xf9I\xc0\xe3\xcd('
                                            b'\xd62\xcc\xbe\xfeI\x07\xc2'
                                            b'\xfa\xc2r\x87\x10\xf7\xb1`'},
               'channel_serializer': None,
               'channel_type': 'tls',
               'http_cbtid': None,
               'http_headers_received': None,
               'http_headers_sent': None,
               'is_secure': True,
               'is_server': False,
               'own': None,
               'own_fd': -1,
               'own_pid': 50690,
               'own_tid': 50690,
               'peer': 'tcp4:127.0.0.1:8080',
               'peer_cert': None,
               'websocket_extensions_in_use': None,
               'websocket_protocol': None}}

WAMP-Transmit(7325966140445461, client01@example.com) &gt;&gt;
  GOODBYE::
    [6, {}, 'wamp.close.normal']
&gt;&gt;

WAMP-Receive(7325966140445461, client01@example.com) &lt;&lt;
  GOODBYE::
    [6, {}, 'wamp.close.normal']
&lt;&lt;
</pre><a href="#section-5.4.6.2-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="message-exchange-example3">
<section id="section-5.4.6.3">
            <h5 id="name-example-3">
<a href="#section-5.4.6.3" class="section-number selfRef">5.4.6.3. </a><a href="#name-example-3" class="section-name selfRef">Example 3</a>
            </h5>
<ul class="compact">
<li class="compact" id="section-5.4.6.3-1.1">
                <em>with</em> router challenge<a href="#section-5.4.6.3-1.1" class="pilcrow">¶</a>
</li>
              <li class="compact" id="section-5.4.6.3-1.2">
                <em>with</em> TLS channel binding<a href="#section-5.4.6.3-1.2" class="pilcrow">¶</a>
</li>
              <li class="compact" id="section-5.4.6.3-1.3">
                <em>with</em> client trustroot and certificates<a href="#section-5.4.6.3-1.3" class="pilcrow">¶</a>
</li>
            </ul>
<div class="alignLeft art-text artwork" id="section-5.4.6.3-2">
<pre>WAMP-Transmit(-, -) &gt;&gt;
  HELLO::
    [1,
     'devices',
     {'authextra': {'certificates': [({'domain': {'name': 'WMP', 'version': '1'},
                                       'message': {'bootedAt': 1658765756680628959,
                                                   'chainId': 1,
                                                   'csPubKey': '12ae0184b180e9a9c5e45be4a1afbce3c6491320063701cd9c4011a777d04089',
                                                   'delegate': '0xf5173a6111B2A6B3C20fceD53B2A8405EC142bF6',
                                                   'meta': '',
                                                   'validFrom': 15212703,
                                                   'verifyingContract': '0xf766Dc789CF04CD18aE75af2c5fAf2DA6650Ff57'},
                                       'primaryType': 'EIP712DelegateCertificate',
                                       'types': {'EIP712DelegateCertificate': [{'name': 'chainId',
                                                                                'type': 'uint256'},
                                                                               {'name': 'verifyingContract',
                                                                                'type': 'address'},
                                                                               {'name': 'validFrom',
                                                                                'type': 'uint256'},
                                                                               {'name': 'delegate',
                                                                                'type': 'address'},
                                                                               {'name': 'csPubKey',
                                                                                'type': 'bytes32'},
                                                                               {'name': 'bootedAt',
                                                                                'type': 'uint64'},
                                                                               {'name': 'meta',
                                                                                'type': 'string'}],
                                                 'EIP712Domain': [{'name': 'name',
                                                                   'type': 'string'},
                                                                  {'name': 'version',
                                                                   'type': 'string'}]}},
                                      '8fe06bb269110c6bc0e011ea2b7da07091c674f7fe67458c1805157157da702b70b56cdf662666dc386820ded0116b6b84151df1ed65210eeecd7e477cdb765b1b'),
                                     ({'domain': {'name': 'WMP', 'version': '1'},
                                       'message': {'capabilities': 12,
                                                   'chainId': 1,
                                                   'issuer': '0xf766Dc789CF04CD18aE75af2c5fAf2DA6650Ff57',
                                                   'meta': '',
                                                   'realm': '0xA6e693CC4A2b4F1400391a728D26369D9b82ef96',
                                                   'subject': '0xf5173a6111B2A6B3C20fceD53B2A8405EC142bF6',
                                                   'validFrom': 15212703,
                                                   'verifyingContract': '0xf766Dc789CF04CD18aE75af2c5fAf2DA6650Ff57'},
                                       'primaryType': 'EIP712AuthorityCertificate',
                                       'types': {'EIP712AuthorityCertificate': [{'name': 'chainId',
                                                                                 'type': 'uint256'},
                                                                                {'name': 'verifyingContract',
                                                                                 'type': 'address'},
                                                                                {'name': 'validFrom',
                                                                                 'type': 'uint256'},
                                                                                {'name': 'issuer',
                                                                                 'type': 'address'},
                                                                                {'name': 'subject',
                                                                                 'type': 'address'},
                                                                                {'name': 'realm',
                                                                                 'type': 'address'},
                                                                                {'name': 'capabilities',
                                                                                 'type': 'uint64'},
                                                                                {'name': 'meta',
                                                                                 'type': 'string'}],
                                                 'EIP712Domain': [{'name': 'name',
                                                                   'type': 'string'},
                                                                  {'name': 'version',
                                                                   'type': 'string'}]}},
                                      '0c0eb60a108dbd72a204b41c1d18505358e4e7886b0c9787192a33ac9e0f94c92ce158f8de576fa9cccf28a8c9404ed66c2d355ea4ae7ee65cff0b73215b91bb1c'),
                                     ({'domain': {'name': 'WMP', 'version': '1'},
                                       'message': {'capabilities': 63,
                                                   'chainId': 1,
                                                   'issuer': '0xf766Dc789CF04CD18aE75af2c5fAf2DA6650Ff57',
                                                   'meta': '',
                                                   'realm': '0xA6e693CC4A2b4F1400391a728D26369D9b82ef96',
                                                   'subject': '0xf766Dc789CF04CD18aE75af2c5fAf2DA6650Ff57',
                                                   'validFrom': 15212703,
                                                   'verifyingContract': '0xf766Dc789CF04CD18aE75af2c5fAf2DA6650Ff57'},
                                       'primaryType': 'EIP712AuthorityCertificate',
                                       'types': {'EIP712AuthorityCertificate': [{'name': 'chainId',
                                                                                 'type': 'uint256'},
                                                                                {'name': 'verifyingContract',
                                                                                 'type': 'address'},
                                                                                {'name': 'validFrom',
                                                                                 'type': 'uint256'},
                                                                                {'name': 'issuer',
                                                                                 'type': 'address'},
                                                                                {'name': 'subject',
                                                                                 'type': 'address'},
                                                                                {'name': 'realm',
                                                                                 'type': 'address'},
                                                                                {'name': 'capabilities',
                                                                                 'type': 'uint64'},
                                                                                {'name': 'meta',
                                                                                 'type': 'string'}],
                                                 'EIP712Domain': [{'name': 'name',
                                                                   'type': 'string'},
                                                                  {'name': 'version',
                                                                   'type': 'string'}]}},
                                      'be35c8d6ae735d3bd8b5e27b1e1a067eba53e6a1cb4ef0f607c4717435e8ffa676246e7d08dfb4e83c78ad26f423b727b5d2c90627bdf6c94c1dbdf01979c34b1c')],
                    'challenge': '2763e7fdb1c34a74e8497daf6c913744d11161a94cec3b16aeec60a788612e17',
                    'channel_binding': 'tls-unique',
                    'pubkey': '12ae0184b180e9a9c5e45be4a1afbce3c6491320063701cd9c4011a777d04089',
                    'trustroot': '0xf766Dc789CF04CD18aE75af2c5fAf2DA6650Ff57'},
      'authmethods': ['cryptosign'],
      'roles': {'callee': {'features': {'call_canceling': True,
                                        'caller_identification': True,
                                        'pattern_based_registration': True,
                                        'progressive_call_results': True,
                                        'registration_revocation': True,
                                        'shared_registration': True}},
                'caller': {'features': {'call_canceling': True,
                                        'caller_identification': True,
                                        'progressive_call_results': True}},
                'publisher': {'features': {'publisher_exclusion': True,
                                           'publisher_identification': True,
                                           'subscriber_blackwhite_listing': True}},
                'subscriber': {'features': {'pattern_based_subscription': True,
                                            'publisher_identification': True,
                                            'subscription_revocation': True}}}}]
&gt;&gt;

WAMP-Receive(-, -) &lt;&lt;
  CHALLENGE::
    [4,
     'cryptosign',
     {'challenge': 'e4b40f72f9604754789d472225483bace926b9668d72c9122545e540d8d98f23',
      'channel_binding': 'tls-unique',
      'pubkey': '4a3838f6fe75251e613329d53fc69b262d5eac97fb1d73bebbaed4015b53c862',
      'signature': 'ce456092998d796533d7ef2bab543300409d161066c9520c9284df6bbfb82947b37fb78d69fd56e5118afec62e35e015c60569af2e18ed92fedc738552242d039a38790e9c94064d89335393d39973c14074cd1008d7266de74c641103e30609'}]
&lt;&lt;

WAMP-Transmit(-, -) &gt;&gt;
  AUTHENTICATE::
    [5,
     '16c89629e72aff3f44661e701341b2221a2fa9d93205826fad85e70d3a8dab70a8f54314c14d470ebeb77a0dd16c833928c01134a52b2e73862b7d3f258b600059ef9181d4370b6d19e7691e9a407f29784315dfc949d4696ce5e1f6535ba73d',
     {}]
&gt;&gt;

WAMP-Receive(-, -) &lt;&lt;
  WELCOME::
    [2,
     869996509191260,
     {'authextra': {'x_cb_node': 'intel-nuci7-30969',
                    'x_cb_peer': 'tcp4:127.0.0.1:59172',
                    'x_cb_pid': 31090,
                    'x_cb_worker': 'worker001'},
      'authid': '0xf5173a6111B2A6B3C20fceD53B2A8405EC142bF6',
      'authmethod': 'cryptosign',
      'authprovider': 'static',
      'authrole': 'user',
      'realm': 'realm1',
      'roles': {'broker': {'features': {'event_retention': True,
                                        'pattern_based_subscription': True,
                                        'publisher_exclusion': True,
                                        'publisher_identification': True,
                                        'session_meta_api': True,
                                        'subscriber_blackwhite_listing': True,
                                        'subscription_meta_api': True,
                                        'subscription_revocation': True}},
                'dealer': {'features': {'call_canceling': True,
                                        'caller_identification': True,
                                        'pattern_based_registration': True,
                                        'progressive_call_results': True,
                                        'registration_meta_api': True,
                                        'registration_revocation': True,
                                        'session_meta_api': True,
                                        'shared_registration': True,
                                        'testament_meta_api': True}}},
      'x_cb_node': 'intel-nuci7-30969',
      'x_cb_peer': 'tcp4:127.0.0.1:59172',
      'x_cb_pid': 31090,
      'x_cb_worker': 'worker001'}]
&lt;&lt;

WAMP-Transmit(869996509191260, 0xf5173a6111B2A6B3C20fceD53B2A8405EC142bF6) &gt;&gt;
  GOODBYE::
    [6, {}, 'wamp.close.normal']
&gt;&gt;

WAMP-Receive(869996509191260, 0xf5173a6111B2A6B3C20fceD53B2A8405EC142bF6) &lt;&lt;
  GOODBYE::
    [6, {}, 'wamp.close.normal']
&lt;&lt;
</pre><a href="#section-5.4.6.3-2" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="dynamic-auth.api">
<section id="section-5.5">
        <h3 id="name-dynamic-authentication-api">
<a href="#section-5.5" class="section-number selfRef">5.5. </a><a href="#name-dynamic-authentication-api" class="section-name selfRef">Dynamic Authentication API</a>
        </h3>
<p id="section-5.5-1">Write me.<a href="#section-5.5-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="authorization">
<section id="section-5.6">
        <h3 id="name-authorization">
<a href="#section-5.6" class="section-number selfRef">5.6. </a><a href="#name-authorization" class="section-name selfRef">Authorization</a>
        </h3>
<p id="section-5.6-1">WAMP allows user services to integrate seamlessly while enabling <em>Clients</em> to perform <em>Actions</em>, namely, to<a href="#section-5.6-1" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-5.6-2.1">
            <strong>register</strong> procedures using fully qualified URIs or URI patterns in order to receive invocations<a href="#section-5.6-2.1" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-5.6-2.2">
            <strong>call</strong> procedures at (fully qualified) URIs<a href="#section-5.6-2.2" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-5.6-2.3">
            <strong>subscribe</strong> to topics using fully qualified URIs or URI patterns in order to receive events<a href="#section-5.6-2.3" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-5.6-2.4">
            <strong>publish</strong> events to (fully qualified) URIs<a href="#section-5.6-2.4" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-5.6-3">Performing these actions requires <em>Clients</em> to have an open <em>Session</em> to the same shared <em>Realm</em>.<a href="#section-5.6-3" class="pilcrow">¶</a></p>
<p id="section-5.6-4">A <em>Session</em> is established between a <em>Client</em> to a <em>Router</em>, and is initiated by a <em>Client</em>.<a href="#section-5.6-4" class="pilcrow">¶</a></p>
<p id="section-5.6-5"><em>Sessions</em> MAY be required to <em>Authenticate</em> access to a <em>Realm</em> hosted by a <em>Router</em>.<a href="#section-5.6-5" class="pilcrow">¶</a></p>
<p id="section-5.6-6"><em>Authentication</em> is the sequence of operations that allow a <em>Router</em> to verify the identity of a <em>Session</em>, often as a prerequisite to allowing access to resources within a <em>Realm</em>.<a href="#section-5.6-6" class="pilcrow">¶</a></p>
<p id="section-5.6-7">When the <em>Session</em> authenticates to a <em>Router</em> successfully, the <em>Router</em> will have established the<a href="#section-5.6-7" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-5.6-8.1">
            <code>realm|string</code>,<a href="#section-5.6-8.1" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-5.6-8.2">
            <code>authrole|string</code>, and<a href="#section-5.6-8.2" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-5.6-8.3">
            <code>authid|string</code><a href="#section-5.6-8.3" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-5.6-9">for that <em>Session</em> running in the <em>Client</em>.<a href="#section-5.6-9" class="pilcrow">¶</a></p>
<p id="section-5.6-10">The triple <code>(realm, authrole, authid)</code> is called <em>Principal</em>, and a <em>Session</em> is authenticated under that <em>Principal</em>.<a href="#section-5.6-10" class="pilcrow">¶</a></p>
<p id="section-5.6-11">At any moment, there can be zero, one, or many <em>Sessions</em> with different <em>session ids</em> authenticated under the <em>same</em> <em>Principal</em>.<a href="#section-5.6-11" class="pilcrow">¶</a></p>
<p id="section-5.6-12"><em>Sessions</em> MAY be required to <em>Authorize</em> in order to perform a specific <em>Action</em> on an URI - or an URI pattern - within a <em>Realm</em>.<a href="#section-5.6-12" class="pilcrow">¶</a></p>
<p id="section-5.6-13">This distinction between <em>Authentication</em> and <em>Authorization</em> follows the established practice called "AAA":<a href="#section-5.6-13" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-5.6-14.1">
            <strong>A</strong>uthentication: Establishes who it is (<strong>"subject"</strong>)<a href="#section-5.6-14.1" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-5.6-14.2">
            <strong>A</strong>uthorization: Decides within a <em>Realm</em> whether an <em>Action</em> (<strong>"operation"</strong>) on an URI or URI pattern (<strong>"object"</strong>) is allowed for the requesting <em>Principal</em> (<strong>"subject"</strong>)<a href="#section-5.6-14.2" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-5.6-14.3">
            <strong>A</strong>ccounting: Records, for a <em>Realm</em>, what <em>Action</em> (<strong>"operation"</strong>) on what URI or URI pattern (<strong>"object"</strong>) was requested by which <em>Principal</em> (<strong>"subject"</strong>), and whether it was allowed or denied<a href="#section-5.6-14.3" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
</section>
</div>
<div id="advanced-security-features">
<section id="section-6">
      <h2 id="name-advanced-security-features">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-advanced-security-features" class="section-name selfRef">Advanced Security Features</a>
      </h2>
<p id="section-6-1">This section covers some advanced features and techniques provided by WAMP mainly but not limited to
security and cryptography.<a href="#section-6-1" class="pilcrow">¶</a></p>
<div id="payload-passthru-mode">
<section id="section-6.1">
        <h3 id="name-payload-passthru-mode">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-payload-passthru-mode" class="section-name selfRef">Payload Passthru Mode</a>
        </h3>
<p id="section-6.1-1">In some situations, you may want to reduce the access the router has to the information users transmit, or
payload data is presented in some specific format that can not be simply recognized by WAMP router serializer.<a href="#section-6.1-1" class="pilcrow">¶</a></p>
<p id="section-6.1-2">Here are some use cases:<a href="#section-6.1-2" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-6.1-3.1">Using WAMP via gateways to other technologies like MQTT Brokers or AMQP Queues. So the actual payload
is, for example, MQTT message that should be delivered to a WAMP topic as is.<a href="#section-6.1-3.1" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-6.1-3.2">Sensitive user data that should be delivered to a target <em>Callee</em> without any possibility of unveiling it in transit.<a href="#section-6.1-3.2" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-6.1-4">The above use cases can be fulfilled with the <code>Payload Passthru Mode</code> feature. This feature allows:<a href="#section-6.1-4" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-6.1-5.1">Specifying additional attributes within <code>CALL</code>, <code>PUBLISH</code>, <code>EVENT</code>, <code>YIELD</code>, <code>RESULT</code> messages
to signal the <em>Router</em> to skip payload inspection/conversion.<a href="#section-6.1-5.1" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-6.1-5.2">The forwarding of these additional attributes via <code>INVOCATION</code> and <code>ERROR</code> messages<a href="#section-6.1-5.2" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-6.1-5.3">Encrypting and decrypting payload using cryptographic algorithms.<a href="#section-6.1-5.3" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-6.1-5.4">Providing additional information about payload format and type.<a href="#section-6.1-5.4" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-6.1-6"><strong>Feature Announcement</strong><a href="#section-6.1-6" class="pilcrow">¶</a></p>
<p id="section-6.1-7">Support for this advanced feature MUST be announced by <em>Callers</em> (<code>role := "caller"</code>), <em>Callees</em> (<code>role := "callee"</code>),
<em>Dealers</em> (<code>role := "dealer"</code>), <em>Publishers</em> (<code>role := "publisher"</code>), <em>Subscribers</em> (<code>role := "subscriber"</code>)
and <em>Brokers</em> (<code>role := "broker"</code>) via<a href="#section-6.1-7" class="pilcrow">¶</a></p>
<p id="section-6.1-8">HELLO.Details.roles.&lt;role&gt;.features.payload_passthru_mode|bool := true<a href="#section-6.1-8" class="pilcrow">¶</a></p>
<p id="section-6.1-9">Payload Passthru Mode can work only if all three nodes (<em>Caller</em>, <em>Dealer</em>, <em>Callee</em> or
<em>Publisher</em>, <em>Broker</em>, <em>Subscriber</em>) support and announced this feature.<a href="#section-6.1-9" class="pilcrow">¶</a></p>
<p id="section-6.1-10">Cases where a <em>Caller</em> sends a <code>CALL</code> message with <code>payload passthru</code> without announcing it during the <code>HELLO</code>
handshake MUST be treated as <em>PROTOCOL ERRORS</em> and underlying WAMP connections must be aborted with
the <code>wamp.error.protocol_violation</code> error reason.<a href="#section-6.1-10" class="pilcrow">¶</a></p>
<p id="section-6.1-11">Cases where a <em>Caller</em> sends a <code>CALL</code> message with <code>payload passthru</code> to a <em>Dealer</em>, the latter not announcing
<code>payload passthru</code> support during <code>WELCOME</code> handshake MUST be treated as <em>PROTOCOL ERRORS</em> and the underlying WAMP
connections must be aborted with the <code>wamp.error.protocol_violation</code> error reason.<a href="#section-6.1-11" class="pilcrow">¶</a></p>
<p id="section-6.1-12">Cases where a <em>Caller</em> sends a <code>CALL</code> message with <code>payload passthru</code> to a <em>Dealer</em> that supports this feature,
which then must be routed to a <em>Callee</em> which doesn't support <code>payload passthru</code>, MUST be treated as
<em>APPLICATION ERRORS</em> and the <em>Dealer</em> MUST respond to the <em>Caller</em> with a <code>wamp.error.feature_not_supported</code>
error message.<a href="#section-6.1-12" class="pilcrow">¶</a></p>
<p id="section-6.1-13">Cases where a <em>Publisher</em> sends a <code>PUBLISH</code> message with <code>payload passthru</code>, without announcing it during <code>HELLO</code>
handshake, MUST be treated as <em>PROTOCOL ERRORS</em> and the underlying WAMP connections must be aborted with
the <code>wamp.error.protocol_violation</code> error reason.<a href="#section-6.1-13" class="pilcrow">¶</a></p>
<p id="section-6.1-14">Cases where a <em>Publisher</em> sends a <code>PUBLISH</code> message with <code>payload passthru</code> to a <em>Broker</em>, with the latter not
announcing <code>payload passthru</code> support during the <code>WELCOME</code> handshake, MUST be treated as <em>PROTOCOL ERRORS</em> and
the underlying WAMP connections must be aborted with the <code>wamp.error.protocol_violation</code> error reason.<a href="#section-6.1-14" class="pilcrow">¶</a></p>
<p id="section-6.1-15">Cases where a <em>Publisher</em> sends a <code>PUBLISH</code> message with <code>payload passthru</code> to a <em>Broker</em> that supports this feature,
which then must be routed to a <em>Subscriber</em> which doesn't support <code>payload passthru</code>, cannot be recognized at the
protocol level due to asynchronous message processing and must be covered at the <em>Subscriber</em> side.<a href="#section-6.1-15" class="pilcrow">¶</a></p>
<p id="section-6.1-16">Cases where a <em>Callee</em> sends a <code>YIELD</code> message with <code>payload passthru</code> without announcing it during the <code>HELLO</code>
handshake MUST be treated as <em>PROTOCOL ERRORS</em> and the underlying WAMP connections must be aborted with
the <code>wamp.error.protocol_violation</code> error reason.<a href="#section-6.1-16" class="pilcrow">¶</a></p>
<p id="section-6.1-17">Cases where a <em>Callee</em> sends a <code>YIELD</code> message with <code>payload passthru</code> to a <em>Dealer</em>, with the latter not announcing
<code>payload passthru</code> support during the <code>WELCOME</code> handshake, MUST be treated as <em>PROTOCOL ERRORS</em> and the
underlying WAMP connections must be aborted with the <code>wamp.error.protocol_violation</code> error reason.<a href="#section-6.1-17" class="pilcrow">¶</a></p>
<p id="section-6.1-18">Cases where a <em>Callee</em> sends a <code>YIELD</code> message with <code>payload passthru</code> to a <em>Dealer</em> that supports this feature,
which then must be routed to the <em>Caller</em> which doesn't support <code>payload passthru</code>, MUST be treated as
<em>APPLICATION ERRORS</em> and the <em>Dealer</em> MUST respond to the <em>Callee</em> with a <code>wamp.error.feature_not_supported</code>
error message.<a href="#section-6.1-18" class="pilcrow">¶</a></p>
<p id="section-6.1-19"><strong>Message Attributes</strong><a href="#section-6.1-19" class="pilcrow">¶</a></p>
<p id="section-6.1-20">To use payload passthru mode, the options for <code>CALL</code>, <code>PUBLISH</code> and <code>YIELD</code> messages MUST be extended with additional
attributes. These additional attributes must be forwarded via <code>INVOCATION</code>, <code>EVENT</code> and <code>RESULT</code> messages, respectively,
as well as <code>ERROR</code> messages in the case of failures.<a href="#section-6.1-20" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-6.1-21">
<pre>    CALL.Options.ppt_scheme|string
    CALL.Options.ppt_serializer|string
    CALL.Options.ppt_cipher|string
    CALL.Options.ppt_keyid|string
    ---
    INVOCATION.Details.ppt_scheme|string
    INVOCATION.Details.ppt_serializer|string
    INVOCATION.Details.ppt_cipher|string
    INVOCATION.Details.ppt_keyid|string
    ---
    YIELD.Options.ppt_scheme|string
    YIELD.Options.ppt_serializer|string
    YIELD.Options.ppt_cipher|string
    YIELD.Options.ppt_keyid|string
    ---
    RESULT.Details.ppt_scheme|string
    RESULT.Details.ppt_serializer|string
    RESULT.Details.ppt_cipher|string
    RESULT.Details.ppt_keyid|string
    ---
    ERROR.Details.ppt_scheme|string
    ERROR.Details.ppt_serializer|string
    ERROR.Details.ppt_cipher|string
    ERROR.Details.ppt_keyid|string
</pre><a href="#section-6.1-21" class="pilcrow">¶</a>
</div>
<div class="alignLeft art-text artwork" id="section-6.1-22">
<pre>    PUBLISH.Options.ppt_scheme|string
    PUBLISH.Options.ppt_serializer|string
    PUBLISH.Options.ppt_cipher|string
    PUBLISH.Options.ppt_keyid|string
    ---
    EVENT.Details.ppt_scheme|string
    EVENT.Details.ppt_serializer|string
    EVENT.Details.ppt_cipher|string
    EVENT.Details.ppt_keyid|string
    ---
    ERROR.Options.ppt_scheme|string
    ERROR.Options.ppt_serializer|string
    ERROR.Options.ppt_cipher|string
    ERROR.Options.ppt_keyid|string
</pre><a href="#section-6.1-22" class="pilcrow">¶</a>
</div>
<p id="section-6.1-23"><strong>ppt_scheme Attribute</strong><a href="#section-6.1-23" class="pilcrow">¶</a></p>
<p id="section-6.1-24">The <code>ppt_scheme</code> identifies the Payload Schema. It is a required string attribute. For End-2-End Encryption flow
this attribute can contain the name or identifier of a key management provider that is known to the target peer,
so it can be used with help of additional <code>ppt_*</code> attributes to obtain information about encryption keys.
For gateways and external schemas this can contain the name of related technology. The one predefined is <code>mqtt</code>.
Others may be introduced later. A <em>Router</em> can recognize that <code>Payload Passthru Mode</code> is in use by checking
the existence and non-empty value of this attribute within the options of <code>CALL</code>, <code>PUBLISH</code> and <code>YIELD</code> messages.<a href="#section-6.1-24" class="pilcrow">¶</a></p>
<p id="section-6.1-25"><strong>ppt_serializer Attribute</strong><a href="#section-6.1-25" class="pilcrow">¶</a></p>
<p id="section-6.1-26">The <code>ppt_serializer</code> attribute is optional. It specifies what serializer was used to encode the payload.
It can be a <code>native</code> value to indicate that the incoming data is tunneling through other technologies
specified by the <code>ppt_scheme</code>, or it can be ordinary <code>json</code>, <code>msgpack</code>, <code>cbor</code>, <code>flatbuffers</code> data serializers.
For some predefined <code>ppt_scheme</code> schemas this option may be omitted as schema defines the concrete serializer.
See predefined schemas below.<a href="#section-6.1-26" class="pilcrow">¶</a></p>
<p id="section-6.1-27"><strong>ppt_cipher Attribute</strong><a href="#section-6.1-27" class="pilcrow">¶</a></p>
<p id="section-6.1-28">The <code>ppt_cipher</code> attribute is optional. It is required if the payload is encrypted. This attribute specifies the
cryptographic algorithm that was used to encrypt the payload. It can be <code>xsalsa20poly1305</code>, <code>aes256gcm</code> for now.<a href="#section-6.1-28" class="pilcrow">¶</a></p>
<p id="section-6.1-29"><strong>ppt_keyid Attribute</strong><a href="#section-6.1-29" class="pilcrow">¶</a></p>
<p id="section-6.1-30">The <code>ppt_keyid</code> attribute is optional. This attribute can contain the encryption key id that was used to encrypt
the payload. The <code>ppt_keyid</code> attribute is a string type. The value can be a hex-encoded string, URI, DNS name,
Ethereum address, UUID identifier - any meaningful value which allows the target peer to choose a private key
without guessing. The format of the value may depend on the <code>ppt_scheme</code> attribute.<a href="#section-6.1-30" class="pilcrow">¶</a></p>
<p id="section-6.1-31"><strong>ppt_ Predefined Schemes</strong><a href="#section-6.1-31" class="pilcrow">¶</a></p>
<p id="section-6.1-32"><strong>MQTT Predefined Scheme</strong><a href="#section-6.1-32" class="pilcrow">¶</a></p>
<table class="left" id="table-13">
          <caption><a href="#table-13" class="selfRef">Table 13</a></caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">Attribute</th>
              <th class="text-left" rowspan="1" colspan="1">Required?</th>
              <th class="text-left" rowspan="1" colspan="1">Value</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">ppt_scheme</td>
              <td class="text-left" rowspan="1" colspan="1">Y</td>
              <td class="text-left" rowspan="1" colspan="1">mqtt</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">ppt_serializer</td>
              <td class="text-left" rowspan="1" colspan="1">N*</td>
              <td class="text-left" rowspan="1" colspan="1">native, json, msgpack, cbor</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">ppt_cipher</td>
              <td class="text-left" rowspan="1" colspan="1">N</td>
              <td class="text-left" rowspan="1" colspan="1">-</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">ppt_keyid</td>
              <td class="text-left" rowspan="1" colspan="1">N</td>
              <td class="text-left" rowspan="1" colspan="1">-</td>
            </tr>
          </tbody>
        </table>
<p id="section-6.1-34">*: If <code>ppt_serializer</code> is not provided then it is assuming as <code>native</code>. So no additional serialization
will be applied to payload and payload will be serialized within WAMP message with session serializer.<a href="#section-6.1-34" class="pilcrow">¶</a></p>
<p id="section-6.1-35"><strong>End-to-End Encryption Predefined Scheme</strong><a href="#section-6.1-35" class="pilcrow">¶</a></p>
<p id="section-6.1-36">For <code>End-to-End Encryption</code> flow both peers must support chosen <code>ppt_serializer</code> regardless of their own
session serializer.<a href="#section-6.1-36" class="pilcrow">¶</a></p>
<table class="left" id="table-14">
          <caption><a href="#table-14" class="selfRef">Table 14</a></caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">Attribute</th>
              <th class="text-left" rowspan="1" colspan="1">Required?</th>
              <th class="text-left" rowspan="1" colspan="1">Value</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">ppt_scheme</td>
              <td class="text-left" rowspan="1" colspan="1">Y</td>
              <td class="text-left" rowspan="1" colspan="1">wamp</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">ppt_serializer</td>
              <td class="text-left" rowspan="1" colspan="1">Y</td>
              <td class="text-left" rowspan="1" colspan="1">cbor, flatbuffers</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">ppt_cipher</td>
              <td class="text-left" rowspan="1" colspan="1">N</td>
              <td class="text-left" rowspan="1" colspan="1">xsalsa20poly1305, aes256gcm</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">ppt_keyid</td>
              <td class="text-left" rowspan="1" colspan="1">N</td>
              <td class="text-left" rowspan="1" colspan="1">*</td>
            </tr>
          </tbody>
        </table>
<p id="section-6.1-38">*: The least significant 20 bytes (160 bits) of the SHA256 of the public key (32 bytes) of the data encryption key,
as a hex-encoded string with prefix <code>0x</code> and either uppercase/lowercase alphabetic characters, encoding a
checksum according to EIP55.<a href="#section-6.1-38" class="pilcrow">¶</a></p>
<p id="section-6.1-39"><strong>Custom Scheme Example</strong><a href="#section-6.1-39" class="pilcrow">¶</a></p>
<table class="left" id="table-15">
          <caption><a href="#table-15" class="selfRef">Table 15</a></caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">Attribute</th>
              <th class="text-left" rowspan="1" colspan="1">Required?</th>
              <th class="text-left" rowspan="1" colspan="1">Value</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">ppt_scheme</td>
              <td class="text-left" rowspan="1" colspan="1">Y</td>
              <td class="text-left" rowspan="1" colspan="1">x_my_ppt</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">ppt_serializer</td>
              <td class="text-left" rowspan="1" colspan="1">N</td>
              <td class="text-left" rowspan="1" colspan="1">custom</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">ppt_cipher</td>
              <td class="text-left" rowspan="1" colspan="1">N</td>
              <td class="text-left" rowspan="1" colspan="1">custom</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">ppt_keyid</td>
              <td class="text-left" rowspan="1" colspan="1">N</td>
              <td class="text-left" rowspan="1" colspan="1">custom</td>
            </tr>
          </tbody>
        </table>
<p id="section-6.1-41">When <code>Payload Passthru Mode</code> is used for gateways to other technologies, such as MQTT Brokers, then
the <code>ppt_serializer</code> attribute may be set to the <code>native</code> value. This means that the payload is not to be modified
by WAMP peers, nor serialized in any manner, and is delivered as-is from the originating peer. Another possible case
is when the <code>ppt_serializer</code> attribute is set to any valid serializer, for example <code>msgpack</code>. In this case the
originating WAMP client peer first applies <code>ppt_serializer</code> to serialize the payload (without encryption), then
the resulting binary payload is embedded in the WAMP message, the latter having possibly a different serializer
depending on the one chosen during WAMP Session establishment.<a href="#section-6.1-41" class="pilcrow">¶</a></p>
<p id="section-6.1-42"><strong>Important Note Regarding JSON Serialization</strong><a href="#section-6.1-42" class="pilcrow">¶</a></p>
<p id="section-6.1-43">With <code>Payload Passthru Mode</code>, payloads are treated as binary. To send these binary payloads, the WAMP session
serializer MUST support byte arrays. Most serialization formats known to WAMP support byte arrays, but JSON does
not support them natively. To use <code>Payload Passthru Mode</code> with a JSON serializer, WAMP peers MUST perform the special
<a href="#binary-support-in-json">Binary serialization in JSON</a>. This conversion may have unacceptable overhead, so it is
generally advised to use WAMP session serializers with native byte array support, for example,
<code>MessagePack</code>, <code>CBOR</code>, or <code>FlatBuffers</code>.<a href="#section-6.1-43" class="pilcrow">¶</a></p>
<p id="section-6.1-44"><strong>Message Structure</strong><a href="#section-6.1-44" class="pilcrow">¶</a></p>
<p id="section-6.1-45">When <code>Payload Passthru Mode</code> is in use, the message payload MUST be sent as one binary item within
<code>Arguments|list</code>, while <code>ArgumentsKw|dict</code> MUST be absent or empty.<a href="#section-6.1-45" class="pilcrow">¶</a></p>
<p id="section-6.1-46">Since many WAMP messages assume the possibility of simultaneous use of <code>Arguments|list</code> and <code>ArgumentsKw|dict</code>,
WAMP client implementations must package arguments into the following hash table and then serialize it and
transmit as a single element within <code>Arguments|list</code>.<a href="#section-6.1-46" class="pilcrow">¶</a></p>
<div class="lang-json sourcecode" id="section-6.1-47">
<pre>{
    "args": Arguments|list,
    "kwargs": ArgumentsKw|dict
}
</pre><a href="#section-6.1-47" class="pilcrow">¶</a>
</div>
<p id="section-6.1-48">This will allow maintaining a single interface for client applications, regardless of whether the
<code>Payload Passthru Mode</code> mode, or especially <code>Payload End-to-End Encryption</code> which is built on top of
<code>Payload End-to-End Encryption</code> is used or not.<a href="#section-6.1-48" class="pilcrow">¶</a></p>
<p id="section-6.1-49"><em>Example.</em> Caller-to-Dealer <code>CALL</code> with encryption and key ID<a href="#section-6.1-49" class="pilcrow">¶</a></p>
<div class="lang-json sourcecode" id="section-6.1-50">
<pre>    [
        48,
        25471,
        {
            "ppt_scheme": "wamp",
            "ppt_serializer": "cbor",
            "ppt_cipher": "xsalsa20poly1305",
            "ppt_keyid": "GTtQ37XGJO2O4R8Dvx4AUo8pe61D9evIWpKGQAPdOh0="
        },
        "com.myapp.secret_rpc_for_sensitive_data",
        [Payload|binary]
    ]
</pre><a href="#section-6.1-50" class="pilcrow">¶</a>
</div>
<p id="section-6.1-51"><em>Example.</em> Caller-to-Dealer progressive <code>CALL</code> with encryption and key ID.<a href="#section-6.1-51" class="pilcrow">¶</a></p>
<p id="section-6.1-52">Note that nothing prevents the use of <code>Payload Passthru Mode</code> with other features such as,
for example, <code>Progressive Call Results</code> or <code>Progressive Call Invocations</code>.<a href="#section-6.1-52" class="pilcrow">¶</a></p>
<div class="lang-json sourcecode" id="section-6.1-53">
<pre>    [
        48,
        25471,
        {
            "ppt_scheme": "wamp",
            "ppt_serializer": "flatbuffers",
            "ppt_cipher": "xsalsa20poly1305",
            "ppt_keyid": "GTtQ37XGJO2O4R8Dvx4AUo8pe61D9evIWpKGQAPdOh0=",
            "progress": true
        },
        "com.myapp.progressive_rpc_for_sensitive_data",
        [Payload|binary]
    ]
</pre><a href="#section-6.1-53" class="pilcrow">¶</a>
</div>
<p id="section-6.1-54"><em>Example.</em> Caller-to-Dealer <code>CALL</code> with MQTT payload. Specifying <code>"ppt_serializer": "native"</code> means that
the original MQTT message payload is passed as WAMP payload message as is, without any transcoding.<a href="#section-6.1-54" class="pilcrow">¶</a></p>
<div class="lang-json sourcecode" id="section-6.1-55">
<pre>    [
        48,
        25471,
        {
            "ppt_scheme": "mqtt",
            "ppt_serializer": "native"
        },
        "com.myapp.mqtt_processing",
        [Payload|binary]
    ]
</pre><a href="#section-6.1-55" class="pilcrow">¶</a>
</div>
<p id="section-6.1-56"><em>Example.</em> Caller-to-Dealer <code>CALL</code> with MQTT payload. Specifying <code>"ppt_scheme": "mqtt"</code> simply indicates that
the original source of payload data is received from a related system. Specifying <code>"ppt_serializer": "json"</code>
means that the original MQTT message payload was parsed and encoded with the <code>json</code> serializer before
embedding it into WAMP message.<a href="#section-6.1-56" class="pilcrow">¶</a></p>
<div class="lang-json sourcecode" id="section-6.1-57">
<pre>    [
        48,
        25471,
        {
            "ppt_scheme": "mqtt",
            "ppt_serializer": "json"
        },
        "com.myapp.mqtt_processing",
        [Payload|binary]
    ]
</pre><a href="#section-6.1-57" class="pilcrow">¶</a>
</div>
<p id="section-6.1-58"><em>Example.</em> Dealer-to-Callee <code>INVOCATION</code> with encryption and key ID<a href="#section-6.1-58" class="pilcrow">¶</a></p>
<div class="lang-json sourcecode" id="section-6.1-59">
<pre>    [
        68,
        35477,
        1147,
        {
            "ppt_scheme": "wamp",
            "ppt_serializer": "cbor",
            "ppt_cipher": "xsalsa20poly1305",
            "ppt_keyid": "GTtQ37XGJO2O4R8Dvx4AUo8pe61D9evIWpKGQAPdOh0="
        },
        [Payload|binary]
    ]
</pre><a href="#section-6.1-59" class="pilcrow">¶</a>
</div>
<p id="section-6.1-60"><em>Example.</em> Dealer-to-Callee <code>INVOCATION</code> with MQTT payload<a href="#section-6.1-60" class="pilcrow">¶</a></p>
<div class="lang-json sourcecode" id="section-6.1-61">
<pre>    [
        68,
        35479,
        3344,
        {
            "ppt_scheme": "mqtt",
            "ppt_serializer": "native"
        },
        [Payload|binary]
    ]
</pre><a href="#section-6.1-61" class="pilcrow">¶</a>
</div>
<p id="section-6.1-62"><em>Example.</em> Callee-to-Dealer <code>YIELD</code> with encryption and key ID<a href="#section-6.1-62" class="pilcrow">¶</a></p>
<div class="lang-json sourcecode" id="section-6.1-63">
<pre>    [
        70,
        87683,
        {
            "ppt_scheme": "wamp",
            "ppt_serializer": "flatbuffers",
            "ppt_cipher": "xsalsa20poly1305",
            "ppt_keyid": "GTtQ37XGJO2O4R8Dvx4AUo8pe61D9evNSpGMDQWdOh1="
        },
        [Payload|binary]
    ]
</pre><a href="#section-6.1-63" class="pilcrow">¶</a>
</div>
<p id="section-6.1-64"><em>Example.</em> Callee-to-Dealer progressive <code>YIELD</code> with encryption and key ID<a href="#section-6.1-64" class="pilcrow">¶</a></p>
<p id="section-6.1-65">Nothing prevents the use of <code>Payload Passthru Mode</code> with other features such as, for example, <code>Progressive Call Results</code>.<a href="#section-6.1-65" class="pilcrow">¶</a></p>
<div class="lang-json sourcecode" id="section-6.1-66">
<pre>    [
        70,
        87683,
        {
            "ppt_scheme": "wamp",
            "ppt_serializer": "flatbuffers",
            "ppt_cipher": "xsalsa20poly1305",
            "ppt_keyid": "GTtQ37XGJO2O4R8Dvx4AUo8pe61D9evNSpGMDQWdOh1=",
            "progress": true
        },
        [Payload|binary]
    ]
</pre><a href="#section-6.1-66" class="pilcrow">¶</a>
</div>
<p id="section-6.1-67"><em>Example.</em> Dealer-to-Caller <code>RESULT</code> with encryption and key ID<a href="#section-6.1-67" class="pilcrow">¶</a></p>
<div class="lang-json sourcecode" id="section-6.1-68">
<pre>    [
        50,
        77133,
        {
            "ppt_scheme": "wamp",
            "ppt_serializer": "flatbuffers",
            "ppt_cipher": "xsalsa20poly1305",
            "ppt_keyid": "GTtQ37XGJO2O4R8Dvx4AUo8pe61D9evNSpGMDQWdOh1="
        },
        [Payload|binary]
    ]
</pre><a href="#section-6.1-68" class="pilcrow">¶</a>
</div>
<p id="section-6.1-69"><em>Example.</em> Dealer-to-Caller progressive <code>RESULT</code> with encryption and key ID<a href="#section-6.1-69" class="pilcrow">¶</a></p>
<p id="section-6.1-70">Nothing prevents the use of <code>Payload Passthru Mode</code> with other features such as, for example, <code>Progressive Call Results</code>.<a href="#section-6.1-70" class="pilcrow">¶</a></p>
<div class="lang-json sourcecode" id="section-6.1-71">
<pre>    [
        50,
        77133,
        {
            "ppt_scheme": "wamp",
            "ppt_serializer": "flatbuffers",
            "ppt_cipher": "xsalsa20poly1305",
            "ppt_keyid": "GTtQ37XGJO2O4R8Dvx4AUo8pe61D9evNSpGMDQWdOh1=",
            "progress": true
        },
        [Payload|binary]
    ]
</pre><a href="#section-6.1-71" class="pilcrow">¶</a>
</div>
<p id="section-6.1-72"><em>Example.</em> Callee-to-Dealer <code>ERROR</code> with encryption and key ID<a href="#section-6.1-72" class="pilcrow">¶</a></p>
<div class="lang-json sourcecode" id="section-6.1-73">
<pre>    [
        8,
        68,
        87683,
        {
            "ppt_scheme": "wamp",
            "ppt_serializer": "cbor",
            "ppt_cipher": "xsalsa20poly1305",
            "ppt_keyid": "GTtQ37XGJO2O4R8Dvx4AUo8pe61D9evNSpGMDQWdOh1="
        },
        "com.myapp.invalid_revenue_year",
        [Payload|binary]
    ]
</pre><a href="#section-6.1-73" class="pilcrow">¶</a>
</div>
<p id="section-6.1-74"><em>Example.</em> Publishing event to a topic with encryption and key ID<a href="#section-6.1-74" class="pilcrow">¶</a></p>
<div class="lang-json sourcecode" id="section-6.1-75">
<pre>    [
        16,
        45677,
        {
            "ppt_scheme": "wamp",
            "ppt_serializer": "cbor",
            "ppt_cipher": "xsalsa20poly1305",
            "ppt_keyid": "GTtQ37XGJO2O4R8Dvx4AUo8pe61D9evNSpGMDQWdOh1="
        },
        "com.myapp.mytopic1",
        [Payload|binary]
    ]
</pre><a href="#section-6.1-75" class="pilcrow">¶</a>
</div>
<p id="section-6.1-76"><em>Example.</em> Receiving event for a topic with encryption and key ID<a href="#section-6.1-76" class="pilcrow">¶</a></p>
<div class="lang-json sourcecode" id="section-6.1-77">
<pre>    [
        36,
        5512315355,
        4429313566,
        {
            "ppt_scheme": "wamp",
            "ppt_serializer": "flatbuffers",
            "ppt_cipher": "xsalsa20poly1305",
            "ppt_keyid": "GTtQ37XGJO2O4R8Dvx4AUo8pe61D9evNSpGMDQWdOh1="
        },
        [Payload|binary]
    ]
</pre><a href="#section-6.1-77" class="pilcrow">¶</a>
</div>
<p id="section-6.1-78"><strong>About Supported Serializers and Cryptographic Ciphers</strong><a href="#section-6.1-78" class="pilcrow">¶</a></p>
<p id="section-6.1-79">WAMP serves as infrastructure for delivering messages between peers. Regardless of what encryption algorithm
and serializer were chosen for <code>Payload Passthru Mode</code>, a <em>Router</em> shall not inspect and analyze the <code>ppt_</code> options
and payload of encrypted messages. The application is responsible for choosing serializers and
ciphers known to every peer involved in message processing.<a href="#section-6.1-79" class="pilcrow">¶</a></p>
</section>
</div>
<div id="payload-end-to-end-encryption">
<section id="section-6.2">
        <h3 id="name-payload-end-to-end-encrypti">
<a href="#section-6.2" class="section-number selfRef">6.2. </a><a href="#name-payload-end-to-end-encrypti" class="section-name selfRef">Payload End-to-End Encryption</a>
        </h3>
<p id="section-6.2-1">TBD<a href="#section-6.2-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="adv-transports-serializers">
<section id="section-7">
      <h2 id="name-advanced-transports-and-ser">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-advanced-transports-and-ser" class="section-name selfRef">Advanced Transports and Serializers</a>
      </h2>
<p id="section-7-1">The only requirements that WAMP expects from a transport are: the transport must be message-based, bidirectional, reliable and ordered. This allows WAMP to run over different transports without any impact at the application layer.<a href="#section-7-1" class="pilcrow">¶</a></p>
<p id="section-7-2">Besides the WebSocket transport, the following WAMP transports are currently specified:<a href="#section-7-2" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-7-3.1">
          <a href="#rawsocket">RawSocket Transport</a><a href="#section-7-3.1" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-7-3.2">
          <a href="#batchedwebsocket">Batched WebSocket Transport</a><a href="#section-7-3.2" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-7-3.3">
          <a href="#longpoll">LongPoll Transport</a><a href="#section-7-3.3" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-7-3.4">
          <a href="#multiplexed">Multiplexed Transport</a><a href="#section-7-3.4" class="pilcrow">¶</a>
</li>
      </ul>
<blockquote id="section-7-4">
        <p id="section-7-4.1">Other transports such as HTTP 2.0 ("SPDY") or UDP might be defined in the future.<a href="#section-7-4.1" class="pilcrow">¶</a></p>
</blockquote>
<div id="rawsocket">
<section id="section-7.1">
        <h3 id="name-rawsocket-transport">
<a href="#section-7.1" class="section-number selfRef">7.1. </a><a href="#name-rawsocket-transport" class="section-name selfRef">RawSocket Transport</a>
        </h3>
<p id="section-7.1-1"><strong>WAMP-over-RawSocket</strong> is an (alternative) transport for WAMP that uses length-prefixed, binary messages - a message framing different from WebSocket.<a href="#section-7.1-1" class="pilcrow">¶</a></p>
<p id="section-7.1-2">Compared to WAMP-over-WebSocket, WAMP-over-RawSocket is simple to implement, since there is no need to implement the WebSocket protocol which has some features that make it non-trivial (like a full HTTP-based opening handshake, message fragmentation, masking and variable length integers).<a href="#section-7.1-2" class="pilcrow">¶</a></p>
<p id="section-7.1-3">WAMP-over-RawSocket has even lower overhead than WebSocket, which can be desirable in particular when running on local connections like loopback TCP or Unix domain sockets. It is also expected to allow implementations in microcontrollers in under 2KB RAM.<a href="#section-7.1-3" class="pilcrow">¶</a></p>
<p id="section-7.1-4">WAMP-over-RawSocket can run over TCP, TLS, Unix domain sockets or any reliable streaming underlying transport. When run over TLS on the standard port for secure HTTPS (443), it is also able to traverse most locked down networking environments such as enterprise or mobile networks (unless man-in-the-middle TLS intercepting proxies are in use).<a href="#section-7.1-4" class="pilcrow">¶</a></p>
<p id="section-7.1-5">However, WAMP-over-RawSocket cannot be used with Web browser clients, since browsers do not allow raw TCP connections. Browser extensions would do, but those need to be installed in a browser. WAMP-over-RawSocket also (currently) does not support transport-level compression as WebSocket does provide (<code>permessage-deflate</code> WebSocket extension).<a href="#section-7.1-5" class="pilcrow">¶</a></p>
<p id="section-7.1-6"><strong>Endianess</strong><a href="#section-7.1-6" class="pilcrow">¶</a></p>
<p id="section-7.1-7">WAMP-over-RawSocket uses <em>network byte order</em> ("big-endian"). That means, given a unsigned 32 bit integer<a href="#section-7.1-7" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-7.1-8">
<pre>    0x 11 22 33 44
</pre><a href="#section-7.1-8" class="pilcrow">¶</a>
</div>
<p id="section-7.1-9">the first octet sent out to (or received from) the wire is <code>0x11</code> and the last octet sent out (or received) is <code>0x44</code>.<a href="#section-7.1-9" class="pilcrow">¶</a></p>
<p id="section-7.1-10">Here is how you would convert octets received from the wire into an integer in Python:<a href="#section-7.1-10" class="pilcrow">¶</a></p>
<div class="lang-python sourcecode" id="section-7.1-11">
<pre>import struct

octets_received = b"\x11\x22\x33\x44"
i = struct.unpack("&gt;L", octets_received)[0]
</pre><a href="#section-7.1-11" class="pilcrow">¶</a>
</div>
<p id="section-7.1-12">The integer received has the value <code>287454020</code>.<a href="#section-7.1-12" class="pilcrow">¶</a></p>
<p id="section-7.1-13">And here is how you would send out an integer to the wire in Python:<a href="#section-7.1-13" class="pilcrow">¶</a></p>
<div class="lang-python sourcecode" id="section-7.1-14">
<pre>octets_to_be_send = struct.pack("&gt;L", i)
</pre><a href="#section-7.1-14" class="pilcrow">¶</a>
</div>
<p id="section-7.1-15">The octets to be sent are <code>b"\x11\x22\x33\x44"</code>.<a href="#section-7.1-15" class="pilcrow">¶</a></p>
<p id="section-7.1-16"><strong>Handshake: Client-to-Router Request</strong><a href="#section-7.1-16" class="pilcrow">¶</a></p>
<p id="section-7.1-17">WAMP-over-RawSocket starts with a handshake where the client connecting to a router sends 4 octets:<a href="#section-7.1-17" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-7.1-18">
<pre>    MSB                                 LSB
    31                                    0
    0111 1111 LLLL SSSS RRRR RRRR RRRR RRRR
</pre><a href="#section-7.1-18" class="pilcrow">¶</a>
</div>
<p id="section-7.1-19">The <em>first octet</em> is a magic octet with value <code>0x7F</code>. This value is chosen to avoid any possible collision with the first octet of a valid HTTP request (see <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec5.html#sec5.1">here</a> and <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec2.html#sec2.2">here</a>). No valid HTTP request can have <code>0x7F</code> as its first octet.<a href="#section-7.1-19" class="pilcrow">¶</a></p>
<blockquote id="section-7.1-20">
          <p id="section-7.1-20.1">By using a magic first octet that cannot appear in a regular HTTP request, WAMP-over-RawSocket can be run e.g. on the same TCP listening port as WAMP-over-WebSocket or WAMP-over-LongPoll.<a href="#section-7.1-20.1" class="pilcrow">¶</a></p>
</blockquote>
<p id="section-7.1-21">The <em>second octet</em> consists of a 4 bit <code>LENGTH</code> field and a 4 bit <code>SERIALIZER</code> field.<a href="#section-7.1-21" class="pilcrow">¶</a></p>
<p id="section-7.1-22">The <code>LENGTH</code> value is used by the <em>Client</em> to signal the <strong>maximum message length</strong> of messages it is willing to <strong>receive</strong>. When the handshake completes successfully, a <em>Router</em> MUST NOT send messages larger than this size.<a href="#section-7.1-22" class="pilcrow">¶</a></p>
<p id="section-7.1-23">The possible values for <code>LENGTH</code> are:<a href="#section-7.1-23" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-7.1-24">
<pre>     0: 2**9 octets
     1: 2**10 octets
    ...
    14: 2**23 octets
    15: 2**24 octets
</pre><a href="#section-7.1-24" class="pilcrow">¶</a>
</div>
<p id="section-7.1-25">This means a <em>Client</em> can choose the maximum message length between <strong>512</strong> and <strong>16M</strong> octets.<a href="#section-7.1-25" class="pilcrow">¶</a></p>
<p id="section-7.1-26">The <code>SERIALIZER</code> value is used by the <em>Client</em> to request a specific serializer to be used. When the handshake completes successfully, the <em>Client</em> and <em>Router</em> will use the serializer requested by the <em>Client</em>.<a href="#section-7.1-26" class="pilcrow">¶</a></p>
<p id="section-7.1-27">The possible values for <code>SERIALIZER</code> are:<a href="#section-7.1-27" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-7.1-28">
<pre>    0: illegal
    1: JSON
    2: MessagePack
    3: CBOR
    4: UBJSON
    5: FlatBuffers
    6 - 15: reserved for future serializers
</pre><a href="#section-7.1-28" class="pilcrow">¶</a>
</div>
<p id="section-7.1-29">Here is a Python program that prints all (currently) permissible values for the <em>second octet</em>:<a href="#section-7.1-29" class="pilcrow">¶</a></p>
<div class="lang-python sourcecode" id="section-7.1-30">
<pre>SERMAP = {
    1: 'json',
    2: 'msgpack',
    3: 'cbor',
    4: 'ubjson',
    5: 'flatbuffers',
}

# map serializer / max. msg length to RawSocket handshake
# request or success reply (2nd octet)
for ser in SERMAP:
    for l in range(16):
        octet_2 = (l &lt;&lt; 4) | ser
        print("serializer: {}, maxlen: {} =&gt; 0x{:02x}".format(SERMAP[ser], 2 ** (l + 9), octet_2))
</pre><a href="#section-7.1-30" class="pilcrow">¶</a>
</div>
<p id="section-7.1-31">The <em>third and forth octet</em> are <strong>reserved</strong> and MUST be all zeros for now.<a href="#section-7.1-31" class="pilcrow">¶</a></p>
<p id="section-7.1-32"><strong>Handshake: Router-to-Client Reply</strong><a href="#section-7.1-32" class="pilcrow">¶</a></p>
<p id="section-7.1-33">After a <em>Client</em> has connected to a <em>Router</em>, the <em>Router</em> will first receive the 4 octets handshake request from the <em>Client</em>.<a href="#section-7.1-33" class="pilcrow">¶</a></p>
<p id="section-7.1-34">If the <em>first octet</em> differs from <code>0x7F</code>, it is not a WAMP-over-RawSocket request. Unless the <em>Router</em> also supports other transports on the connecting port (such as WebSocket or LongPoll), the <em>Router</em> MUST <strong>fail the connection</strong>.<a href="#section-7.1-34" class="pilcrow">¶</a></p>
<p id="section-7.1-35">Here is an example of how a <em>Router</em> could parse the <em>second octet</em> in a <em>Clients</em> handshake request:<a href="#section-7.1-35" class="pilcrow">¶</a></p>
<div class="lang-python sourcecode" id="section-7.1-36">
<pre># map RawSocket handshake request (2nd octet) to
# serializer / max. msg length
for i in range(256):
    ser_id = i &amp; 0x0f
    if ser_id != 0:
        ser = SERMAP.get(ser_id, 'currently undefined')
        maxlen = 2 ** ((i &gt;&gt; 4) + 9)
        print("{:02x} =&gt; serializer: {}, maxlen: {}".format(i, ser, maxlen))
    else:
        print("fail the connection: illegal serializer value")
</pre><a href="#section-7.1-36" class="pilcrow">¶</a>
</div>
<p id="section-7.1-37">When the <em>Router</em> is willing to speak the serializer requested by the <em>Client</em>, it will answer with a 4 octets response of identical structure as the <em>Client</em> request:<a href="#section-7.1-37" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-7.1-38">
<pre>    MSB                                 LSB
    31                                    0
    0111 1111 LLLL SSSS RRRR RRRR RRRR RRRR
</pre><a href="#section-7.1-38" class="pilcrow">¶</a>
</div>
<p id="section-7.1-39">Again, the <em>first octet</em> MUST be the value <code>0x7F</code>. The <em>third and forth octets</em> are reserved and MUST be all zeros for now.<a href="#section-7.1-39" class="pilcrow">¶</a></p>
<p id="section-7.1-40">In the <em>second octet</em>, the <em>Router</em> MUST echo the serializer value in <code>SERIALIZER</code> as requested by the <em>Client</em>.<a href="#section-7.1-40" class="pilcrow">¶</a></p>
<p id="section-7.1-41">Similar to the <em>Client</em>, the <em>Router</em> sets the <code>LENGTH</code> field to request a limit on the length of messages sent by the <em>Client</em>.<a href="#section-7.1-41" class="pilcrow">¶</a></p>
<p id="section-7.1-42">During the connection, <em>Router</em> MUST NOT send messages to the <em>Client</em> longer than the <code>LENGTH</code> requested by the <em>Client</em>, and the <em>Client</em> MUST NOT send messages larger than the maximum requested by the <em>Router</em> in its handshake reply.<a href="#section-7.1-42" class="pilcrow">¶</a></p>
<p id="section-7.1-43">If a message received during a connection exceeds the limit requested, a <em>Peer</em> MUST <strong>fail the connection</strong>.<a href="#section-7.1-43" class="pilcrow">¶</a></p>
<p id="section-7.1-44">When the <em>Router</em> is unable to speak the serializer requested by the <em>Client</em>, or it is denying the <em>Client</em> for other reasons, the <em>Router</em> replies with an error:<a href="#section-7.1-44" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-7.1-45">
<pre>    MSB                                 LSB
    31                                    0
    0111 1111 EEEE 0000 RRRR RRRR RRRR RRRR
</pre><a href="#section-7.1-45" class="pilcrow">¶</a>
</div>
<p id="section-7.1-46">An error reply has 4 octets: the <em>first octet</em> is again the magic <code>0x7F</code>, and the <em>third and forth octet</em> are reserved and MUST all be zeros for now.<a href="#section-7.1-46" class="pilcrow">¶</a></p>
<p id="section-7.1-47">The <em>second octet</em> has its lower 4 bits zero'ed (which distinguishes the reply from an success/accepting reply) and the upper 4 bits encode the error:<a href="#section-7.1-47" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-7.1-48">
<pre>    0: illegal (must not be used)
    1: serializer unsupported
    2: maximum message length unacceptable
    3: use of reserved bits (unsupported feature)
    4: maximum connection count reached
    5 - 15: reserved for future errors
</pre><a href="#section-7.1-48" class="pilcrow">¶</a>
</div>
<blockquote id="section-7.1-49">
          <p id="section-7.1-49.1">Note that the error code <code>0</code> MUST NOT be used. This is to allow storage of error state in a host language variable, while allowing <code>0</code> to signal the current state "no error"<a href="#section-7.1-49.1" class="pilcrow">¶</a></p>
</blockquote>
<p id="section-7.1-50">Here is an example of how a <em>Router</em> might create the <em>second octet</em> in an error response:<a href="#section-7.1-50" class="pilcrow">¶</a></p>
<div class="lang-python sourcecode" id="section-7.1-51">
<pre>ERRMAP = {
    0: "illegal (must not be used)",
    1: "serializer unsupported",
    2: "maximum message length unacceptable",
    3: "use of reserved bits (unsupported feature)",
    4: "maximum connection count reached"
}

# map error to RawSocket handshake error reply (2nd octet)
for err in ERRMAP:
    octet_2 = err &lt;&lt; 4
    print("error: {} =&gt; 0x{:02x}").format(ERRMAP[err], err)
</pre><a href="#section-7.1-51" class="pilcrow">¶</a>
</div>
<p id="section-7.1-52">The <em>Client</em> - after having sent its handshake request - will wait for the 4 octets from <em>Router</em> handshake reply.<a href="#section-7.1-52" class="pilcrow">¶</a></p>
<p id="section-7.1-53">Here is an example of how a <em>Client</em> might parse the <em>second octet</em> in a <em>Router</em> handshake reply:<a href="#section-7.1-53" class="pilcrow">¶</a></p>
<div class="lang-python sourcecode" id="section-7.1-54">
<pre># map RawSocket handshake reply (2nd octet)
for i in range(256):
    ser_id = i &amp; 0x0f
    if ser_id:
        # verify the serializer is the one we requested!
        # if not, fail the connection!
        ser = SERMAP.get(ser_id, 'currently undefined')
        maxlen = 2 ** ((i &gt;&gt; 4) + 9)
        print("{:02x} =&gt; serializer: {}, maxlen: {}".format(i, ser, maxlen))
    else:
        err = i &gt;&gt; 4
        print("error: {}".format(ERRMAP.get(err, 'currently undefined')))
</pre><a href="#section-7.1-54" class="pilcrow">¶</a>
</div>
<p id="section-7.1-55"><strong>Serialization</strong><a href="#section-7.1-55" class="pilcrow">¶</a></p>
<p id="section-7.1-56">To send a WAMP message, the message is serialized according to the WAMP serializer agreed in the handshake (e.g. JSON, MessagePack, CBOR, UBJSON or FlatBuffers).<a href="#section-7.1-56" class="pilcrow">¶</a></p>
<p id="section-7.1-57">The length of the serialized messages in octets MUST NOT exceed the maximum requested by the <em>Peer</em>.<a href="#section-7.1-57" class="pilcrow">¶</a></p>
<p id="section-7.1-58">If the serialized length exceed the maximum requested, the WAMP message can not be sent to the <em>Peer</em>. Handling situations like the latter is left to the implementation.<a href="#section-7.1-58" class="pilcrow">¶</a></p>
<p id="section-7.1-59">E.g. a <em>Router</em> that is to forward a WAMP <code>EVENT</code> to a <em>Client</em> which exceeds the maximum length requested by the <em>Client</em> when serialized might:<a href="#section-7.1-59" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-7.1-60.1">drop the event (not forwarding to that specific client) and track dropped events<a href="#section-7.1-60.1" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-7.1-60.2">prohibit publishing to the topic already<a href="#section-7.1-60.2" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-7.1-60.3">remove the event payload, and send an event with extra information (<code>payload_limit_exceeded = true</code>)<a href="#section-7.1-60.3" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-7.1-61"><strong>Framing</strong><a href="#section-7.1-61" class="pilcrow">¶</a></p>
<p id="section-7.1-62">The serialized octets for a message to be sent are prefixed with exactly 4 octets.<a href="#section-7.1-62" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-7.1-63">
<pre>    MSB                                 LSB
    31                                    0
    RRRR XTTT LLLL LLLL LLLL LLLL LLLL LLLL
</pre><a href="#section-7.1-63" class="pilcrow">¶</a>
</div>
<p id="section-7.1-64">The <em>three least significant octets</em> constitute an unsigned 24 bit integer that provides the length of transport message payload following, excluding the 4 octets that constitute the prefix.<a href="#section-7.1-64" class="pilcrow">¶</a></p>
<p id="section-7.1-65">The <em>most significant octet</em> has the following structure<a href="#section-7.1-65" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-7.1-66">
<pre>    MSB   LSB
    7       0
    RRRR XTTT
</pre><a href="#section-7.1-66" class="pilcrow">¶</a>
</div>
<p id="section-7.1-67">The four bits <code>RRRR</code> are reserved for future use and MUST be all zeros for now.<a href="#section-7.1-67" class="pilcrow">¶</a></p>
<p id="section-7.1-68"><code>X</code> is an extra (25th) bit used to encode the message payload length. This bit is only set when the payload length is exactly 16M octets, with the 24 remaining <code>L</code> bits cleared:<a href="#section-7.1-68" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-7.1-69">
<pre>    MSB                                 LSB
    31                                    0
    RRRR 1TTT 0000 0000 0000 0000 0000 0000
</pre><a href="#section-7.1-69" class="pilcrow">¶</a>
</div>
<p id="section-7.1-70">When the payload length is 16M-1 octets, for example, the prefix would be:<a href="#section-7.1-70" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-7.1-71">
<pre>    MSB                                 LSB
    31                                    0
    RRRR 0TTT 1111 1111 1111 1111 1111 1111
</pre><a href="#section-7.1-71" class="pilcrow">¶</a>
</div>
<p id="section-7.1-72">The three bits <code>TTT</code> encode the type of the transport message:<a href="#section-7.1-72" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-7.1-73">
<pre>    0: regular WAMP message
    1: PING
    2: PONG
    3-7: reserved
</pre><a href="#section-7.1-73" class="pilcrow">¶</a>
</div>
<p id="section-7.1-74">For a regular WAMP message (<code>TTT == 0</code>), the length is the length of the serialized WAMP message: the number of octets after serialization (excluding the 4 octets of the prefix).<a href="#section-7.1-74" class="pilcrow">¶</a></p>
<p id="section-7.1-75">For a <code>PING</code> message (<code>TTT == 1</code>), the length is the length of the arbitrary payload that follows. A <em>Peer</em> MUST reply to each <code>PING</code> by sending exactly one <code>PONG</code> immediately, and the <code>PONG</code> MUST echo back the payload of the <code>PING</code> exactly.<a href="#section-7.1-75" class="pilcrow">¶</a></p>
<p id="section-7.1-76">For receiving messages with WAMP-over-RawSocket, a <em>Peer</em> will usually read exactly 4 octets from the incoming stream, decode the transport level message type and payload length, and then receive as many octets as the length was giving.<a href="#section-7.1-76" class="pilcrow">¶</a></p>
<p id="section-7.1-77">When the transport level message type indicates a regular WAMP message, the transport level message payload is unserialized according to the serializer agreed in the handshake and the processed at the WAMP level.<a href="#section-7.1-77" class="pilcrow">¶</a></p>
</section>
</div>
<div id="batchedwebsocket">
<section id="section-7.2">
        <h3 id="name-message-batching">
<a href="#section-7.2" class="section-number selfRef">7.2. </a><a href="#name-message-batching" class="section-name selfRef">Message Batching</a>
        </h3>
<p id="section-7.2-1"><em>WAMP-over-Batched-WebSocket</em> is a variant of WAMP-over-WebSocket where multiple WAMP messages are sent in one WebSocket message.<a href="#section-7.2-1" class="pilcrow">¶</a></p>
<p id="section-7.2-2">Using WAMP message batching can increase wire level efficiency further. In particular when using TLS and the WebSocket implementation is forcing every WebSocket message into a new TLS segment.<a href="#section-7.2-2" class="pilcrow">¶</a></p>
<p id="section-7.2-3">WAMP-over-Batched-WebSocket is negotiated between Peers in the WebSocket opening handshake by agreeing on one of the following WebSocket subprotocols:<a href="#section-7.2-3" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-7.2-4.1">
            <code>wamp.2.json.batched</code><a href="#section-7.2-4.1" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-7.2-4.2">
            <code>wamp.2.msgpack.batched</code><a href="#section-7.2-4.2" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-7.2-4.3">
            <code>wamp.2.cbor.batched</code><a href="#section-7.2-4.3" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-7.2-5">Batching with JSON works by serializing each WAMP message to JSON as normally, appending the single ASCII control character <code>\30</code> (<a href="http://en.wikipedia.org/wiki/Record_separator#Field_separators">record separator</a>) octet <code>0x1e</code> to <em>each</em> serialized messages, and packing a sequence of such serialized messages into a single WebSocket message:<a href="#section-7.2-5" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-7.2-6">
<pre>    Serialized JSON WAMP Msg 1 | 0x1e |
        Serialized JSON WAMP Msg 2 | 0x1e | ...
</pre><a href="#section-7.2-6" class="pilcrow">¶</a>
</div>
<p id="section-7.2-7">Batching with MessagePack works by serializing each WAMP message to MessagePack as normally, prepending a 32 bit unsigned integer (4 octets in big-endian byte order) with the length of the serialized MessagePack message (excluding the 4 octets for the length prefix), and packing a sequence of such serialized (length-prefixed) messages into a single WebSocket message:<a href="#section-7.2-7" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-7.2-8">
<pre>    Length of Msg 1 serialization (uint32) |
        serialized MessagePack WAMP Msg 1 | ...
</pre><a href="#section-7.2-8" class="pilcrow">¶</a>
</div>
<p id="section-7.2-9">With batched transport, even if only a single WAMP message is to be sent in a WebSocket message, the (single) WAMP message needs to be framed as described above. In other words, a single WAMP message is sent as a batch of length <strong>1</strong>. Sending a batch of length <strong>0</strong> (no WAMP message) is illegal and a <em>Peer</em> MUST fail the transport upon receiving such a transport message.<a href="#section-7.2-9" class="pilcrow">¶</a></p>
</section>
</div>
<div id="longpoll">
<section id="section-7.3">
        <h3 id="name-http-longpoll-transport">
<a href="#section-7.3" class="section-number selfRef">7.3. </a><a href="#name-http-longpoll-transport" class="section-name selfRef">HTTP Longpoll Transport</a>
        </h3>
<p id="section-7.3-1">The <em>Long-Poll Transport</em> is able to transmit a WAMP session over plain old HTTP 1.0/1.1. This is realized by the Client issuing HTTP/POSTs requests, one for sending, and one for receiving. Those latter requests are kept open at the server when there are no messages currently pending to be received.<a href="#section-7.3-1" class="pilcrow">¶</a></p>
<p id="section-7.3-2"><strong>Opening a Session</strong><a href="#section-7.3-2" class="pilcrow">¶</a></p>
<p id="section-7.3-3">With the Long-Poll Transport, a Client opens a new WAMP session by sending a HTTP/POST request to a well-known URL, e.g.<a href="#section-7.3-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-7.3-4">
<pre>    http://mypp.com/longpoll/open
</pre><a href="#section-7.3-4" class="pilcrow">¶</a>
</div>
<p id="section-7.3-5">Here, <code>http://mypp.com/longpoll</code> is the base URL for the Long-Poll Transport and <code>/open</code> is a path dedicated for opening new sessions.<a href="#section-7.3-5" class="pilcrow">¶</a></p>
<p id="section-7.3-6">The HTTP/POST request SHOULD have a <code>Content-Type</code> header set to <code>application/json</code> and MUST have a request body with a JSON document that is a dictionary:<a href="#section-7.3-6" class="pilcrow">¶</a></p>
<div class="lang-javascript sourcecode" id="section-7.3-7">
<pre>    {
       "protocols": ["wamp.2.json"]
    }
</pre><a href="#section-7.3-7" class="pilcrow">¶</a>
</div>
<p id="section-7.3-8">The (mandatory) <code>protocols</code> attribute specifies the protocols the client is willing to speak. The server will chose one from this list when establishing the session or fail the request when no protocol overlap was found.<a href="#section-7.3-8" class="pilcrow">¶</a></p>
<p id="section-7.3-9">The valid protocols are:<a href="#section-7.3-9" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-7.3-10.1">
            <code>wamp.2.json.batched</code><a href="#section-7.3-10.1" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-7.3-10.2">
            <code>wamp.2.json</code><a href="#section-7.3-10.2" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-7.3-10.3">
            <code>wamp.2.msgpack.batched</code><a href="#section-7.3-10.3" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-7.3-10.4">
            <code>wamp.2.msgpack</code><a href="#section-7.3-10.4" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-7.3-10.5">
            <code>wamp.2.cbor.batched</code><a href="#section-7.3-10.5" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-7.3-10.6">
            <code>wamp.2.cbor</code><a href="#section-7.3-10.6" class="pilcrow">¶</a>
</li>
        </ul>
<blockquote id="section-7.3-11">
          <p id="section-7.3-11.1">The request path with this and subsequently described HTTP/POST requests MAY contain a query parameter <code>x</code> with some random or sequentially incremented value:<a href="#section-7.3-11.1" class="pilcrow">¶</a></p>
<p id="section-7.3-11.2"><a href="http://mypp.com/longpoll/open?x=382913">http://mypp.com/longpoll/open?x=382913</a><a href="#section-7.3-11.2" class="pilcrow">¶</a></p>
<p id="section-7.3-11.3">The value is ignored, but may help in certain situations to prevent intermediaries from caching the request.<a href="#section-7.3-11.3" class="pilcrow">¶</a></p>
</blockquote>
<p id="section-7.3-12">Returned is a JSON document containing a transport ID and the protocol to speak:<a href="#section-7.3-12" class="pilcrow">¶</a></p>
<div class="lang-javascript sourcecode" id="section-7.3-13">
<pre>    {
       "protocol": "wamp.2.json",
       "transport": "kjmd3sBLOUnb3Fyr"
    }
</pre><a href="#section-7.3-13" class="pilcrow">¶</a>
</div>
<p id="section-7.3-14">As an implied side-effect, two HTTP endpoints are created<a href="#section-7.3-14" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-7.3-15">
<pre>    http://mypp.com/longpoll/&lt;transport_id&gt;/receive
    http://mypp.com/longpoll/&lt;transport_id&gt;/send
</pre><a href="#section-7.3-15" class="pilcrow">¶</a>
</div>
<p id="section-7.3-16">where <code>transport_id</code> is the transport ID returned from <code>open</code>, e.g.<a href="#section-7.3-16" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-7.3-17">
<pre>    http://mypp.com/longpoll/kjmd3sBLOUnb3Fyr/receive
    http://mypp.com/longpoll/kjmd3sBLOUnb3Fyr/send
</pre><a href="#section-7.3-17" class="pilcrow">¶</a>
</div>
<p id="section-7.3-18"><strong>Receiving WAMP Messages</strong><a href="#section-7.3-18" class="pilcrow">¶</a></p>
<p id="section-7.3-19">The Client will then issue HTTP/POST requests (with empty request body) to<a href="#section-7.3-19" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-7.3-20">
<pre>    http://mypp.com/longpoll/kjmd3sBLOUnb3Fyr/receive
</pre><a href="#section-7.3-20" class="pilcrow">¶</a>
</div>
<p id="section-7.3-21">When there are WAMP messages pending downstream, a request will return with a single WAMP message (unbatched modes) or a batch of serialized WAMP messages (batched mode).<a href="#section-7.3-21" class="pilcrow">¶</a></p>
<p id="section-7.3-22">The serialization format used is the one agreed during opening the session.<a href="#section-7.3-22" class="pilcrow">¶</a></p>
<p id="section-7.3-23">The batching uses the same scheme as with <code>wamp.2.json.batched</code> and <code>wamp.2.msgpack.batched</code> transport over WebSocket.<a href="#section-7.3-23" class="pilcrow">¶</a></p>
<blockquote id="section-7.3-24">
          <p id="section-7.3-24.1">Note: In unbatched mode, when there is more than one message pending, there will be at most one message returned for each request. The other pending messages must be retrieved by new requests. With batched mode, all messages pending at request time will be returned in one batch of messages.<a href="#section-7.3-24.1" class="pilcrow">¶</a></p>
</blockquote>
<p id="section-7.3-25"><strong>Sending WAMP Messages</strong><a href="#section-7.3-25" class="pilcrow">¶</a></p>
<p id="section-7.3-26">For sending WAMP messages, the <em>Client</em> will issue HTTP/POST requests to<a href="#section-7.3-26" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-7.3-27">
<pre>    http://mypp.com/longpoll/kjmd3sBLOUnb3Fyr/send
</pre><a href="#section-7.3-27" class="pilcrow">¶</a>
</div>
<p id="section-7.3-28">with request body being a single WAMP message (unbatched modes) or a batch of serialized WAMP messages (batched mode).<a href="#section-7.3-28" class="pilcrow">¶</a></p>
<p id="section-7.3-29">The serialization format used is the one agreed during opening the session.<a href="#section-7.3-29" class="pilcrow">¶</a></p>
<p id="section-7.3-30">The batching uses the same scheme as with <code>wamp.2.json.batched</code> and <code>wamp.2.msgpack.batched</code> transport over WebSocket.<a href="#section-7.3-30" class="pilcrow">¶</a></p>
<p id="section-7.3-31">Upon success, the request will return with HTTP status code 202 ("no content"). Upon error, the request will return with HTTP status code 400 ("bad request").<a href="#section-7.3-31" class="pilcrow">¶</a></p>
<p id="section-7.3-32"><strong>Closing a Session</strong><a href="#section-7.3-32" class="pilcrow">¶</a></p>
<p id="section-7.3-33">To orderly close a session, a Client will issue a HTTP/POST to<a href="#section-7.3-33" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-7.3-34">
<pre>    http://mypp.com/longpoll/kjmd3sBLOUnb3Fyr/close
</pre><a href="#section-7.3-34" class="pilcrow">¶</a>
</div>
<p id="section-7.3-35">with an empty request body. Upon success, the request will return with HTTP status code 202 ("no content").<a href="#section-7.3-35" class="pilcrow">¶</a></p>
</section>
</div>
<div id="binary-support-in-json">
<section id="section-7.4">
        <h3 id="name-binary-support-in-json">
<a href="#section-7.4" class="section-number selfRef">7.4. </a><a href="#name-binary-support-in-json" class="section-name selfRef">Binary support in JSON</a>
        </h3>
<p id="section-7.4-1">Binary data follows a convention for conversion to JSON strings.<a href="#section-7.4-1" class="pilcrow">¶</a></p>
<p id="section-7.4-2">A byte array is converted to a JSON string as follows:<a href="#section-7.4-2" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="compact type-1" id="section-7.4-3">
<li id="section-7.4-3.1">convert the byte array to a Base64 encoded (host language) string<a href="#section-7.4-3.1" class="pilcrow">¶</a>
</li>
          <li id="section-7.4-3.2">prepend the string with a <code>\0</code> character<a href="#section-7.4-3.2" class="pilcrow">¶</a>
</li>
          <li id="section-7.4-3.3">serialize the string to a JSON string<a href="#section-7.4-3.3" class="pilcrow">¶</a>
</li>
        </ol>
<p id="section-7.4-4">where Base64 encoding follows Section 4 of <span>[<a href="#RFC4648" class="cite xref">RFC4648</a>]</span>.<a href="#section-7.4-4" class="pilcrow">¶</a></p>
<p id="section-7.4-5"><em>Example</em><a href="#section-7.4-5" class="pilcrow">¶</a></p>
<p id="section-7.4-6">Consider the byte array (hex representation):<a href="#section-7.4-6" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-7.4-7">
<pre>    10e3ff9053075c526f5fc06d4fe37cdb
</pre><a href="#section-7.4-7" class="pilcrow">¶</a>
</div>
<p id="section-7.4-8">This will get converted to Base64<a href="#section-7.4-8" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-7.4-9">
<pre>    EOP/kFMHXFJvX8BtT+N82w==
</pre><a href="#section-7.4-9" class="pilcrow">¶</a>
</div>
<p id="section-7.4-10">prepended with <code>\0</code><a href="#section-7.4-10" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-7.4-11">
<pre>    \x00EOP/kFMHXFJvX8BtT+N82w==
</pre><a href="#section-7.4-11" class="pilcrow">¶</a>
</div>
<p id="section-7.4-12">and serialized to a JSON string<a href="#section-7.4-12" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-7.4-13">
<pre>    "\\u0000EOP/kFMHXFJvX8BtT+N82w=="
</pre><a href="#section-7.4-13" class="pilcrow">¶</a>
</div>
<p id="section-7.4-14">A JSON string is unserialized to either a string or a byte array using the following procedure:<a href="#section-7.4-14" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="compact type-1" id="section-7.4-15">
<li id="section-7.4-15.1">Unserialize a JSON string to a host language (Unicode) string<a href="#section-7.4-15.1" class="pilcrow">¶</a>
</li>
          <li id="section-7.4-15.2">If the string starts with a <code>\0</code> character, interpret the rest (after the first character) as Base64 and decode to a byte array<a href="#section-7.4-15.2" class="pilcrow">¶</a>
</li>
          <li id="section-7.4-15.3">Otherwise, return the Unicode string<a href="#section-7.4-15.3" class="pilcrow">¶</a>
</li>
        </ol>
<p id="section-7.4-16">Below are complete Python and JavaScript code examples for conversion between byte arrays and JSON strings.<a href="#section-7.4-16" class="pilcrow">¶</a></p>
<p id="section-7.4-17"><strong>Python</strong><a href="#section-7.4-17" class="pilcrow">¶</a></p>
<p id="section-7.4-18">Here is a complete example in Python showing how byte arrays are converted to and from JSON:<a href="#section-7.4-18" class="pilcrow">¶</a></p>
<div class="lang-python sourcecode" id="section-7.4-19">
<pre>import os, base64, json, sys, binascii

data_in = os.urandom(16)
print("In:   {}".format(binascii.hexlify(data_in)))

# encoding
encoded = json.dumps('\0' + base64.b64encode(data_in).
                                    decode('ascii'))

print("JSON: {}".format(encoded))

# decoding
decoded = json.loads(encoded)
if type(decoded) == unicode:
   if decoded[0] == '\0':
      data_out = base64.b64decode(decoded[1:])
   else:
      data_out = decoded

print("Out:  {}".format(binascii.hexlify(data_out)))

assert(data_out == data_in)
</pre><a href="#section-7.4-19" class="pilcrow">¶</a>
</div>
<p id="section-7.4-20"><strong>JavaScript</strong><a href="#section-7.4-20" class="pilcrow">¶</a></p>
<p id="section-7.4-21">Here is a complete example in JavaScript showing how byte arrays are converted to and from JSON:<a href="#section-7.4-21" class="pilcrow">¶</a></p>
<div class="lang-javascript sourcecode" id="section-7.4-22">
<pre>var data_in = new Uint8Array(new ArrayBuffer(16));

// initialize test data
for (var i = 0; i &lt; data_in.length; ++i) {
   data_in[i] = i;
}
console.log(data_in);

// convert byte array to raw string
var raw_out = '';
for (var i = 0; i &lt; data_in.length; ++i) {
   raw_out += String.fromCharCode(data_in[i]);
}

// base64 encode raw string, prepend with \0
// and serialize to JSON
var encoded = JSON.stringify("\0" + window.btoa(raw_out));
console.log(encoded); // "\u0000AAECAwQFBgcICQoLDA0ODw=="

// unserialize from JSON
var decoded = JSON.parse(encoded);

var data_out;
if (decoded.charCodeAt(0) === 0) {
   // strip first character and decode base64 to raw string
   var raw = window.atob(decoded.substring(1));

   // convert raw string to byte array
   var data_out = new Uint8Array(new ArrayBuffer(raw.length));
   for (var i = 0; i &lt; raw.length; ++i) {
      data_out[i] = raw.charCodeAt(i);
   }
} else {
   data_out = decoded;
}

console.log(data_out);
</pre><a href="#section-7.4-22" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="multiplexed">
<section id="section-7.5">
        <h3 id="name-multiplexed-transport">
<a href="#section-7.5" class="section-number selfRef">7.5. </a><a href="#name-multiplexed-transport" class="section-name selfRef">Multiplexed Transport</a>
        </h3>
<p id="section-7.5-1">A Transport may support the multiplexing of multiple logical transports over a single "physical" transport.<a href="#section-7.5-1" class="pilcrow">¶</a></p>
<p id="section-7.5-2">By using such a Transport, multiple WAMP sessions can be transported over a single underlying transport at the same time.<a href="#section-7.5-2" class="pilcrow">¶</a></p>
<p id="section-7.5-3">As an example, the proposed <a href="https://github.com/oberstet/permessage-priority/blob/master/draft-oberstein-hybi-permessage-priority.txt">WebSocket extension "permessage-priority"</a> would allow creating multiple logical Transports for WAMP over a single underlying WebSocket connection.<a href="#section-7.5-3" class="pilcrow">¶</a></p>
<p id="section-7.5-4">Sessions running over a multiplexed Transport are completely independent: they get assigned different session IDs, may join different realms and each session needs to authenticate itself.<a href="#section-7.5-4" class="pilcrow">¶</a></p>
<p id="section-7.5-5">Because of above, Multiplexed Transports for WAMP are actually not detailed in the WAMP spec, but a feature of the transport being used.<a href="#section-7.5-5" class="pilcrow">¶</a></p>
<blockquote id="section-7.5-6">
          <p id="section-7.5-6.1">Note: Currently no WAMP transport supports multiplexing. The work on the MUX extension with WebSocket has stalled, and the <code>permessage-priority</code> proposal above is still just a proposal. However, with RawSocket, we should be able to add multiplexing in the the future (with downward compatibility).<a href="#section-7.5-6.1" class="pilcrow">¶</a></p>
</blockquote>
</section>
</div>
</section>
</div>
<div id="interfaces">
<section id="section-8">
      <h2 id="name-wamp-interfaces">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-wamp-interfaces" class="section-name selfRef">WAMP Interfaces</a>
      </h2>
<p id="section-8-1">WAMP was designed with the goals of being easy to approach and use for application developers. Creating a procedure to expose some custom functionality should be possible in any supported programming language using that language's native elements, with the least amount of additional effort.<a href="#section-8-1" class="pilcrow">¶</a></p>
<p id="section-8-2">Following from that, WAMP uses <em>dynamic typing</em> for the application payloads of calls, call results and error, as well as event payloads.<a href="#section-8-2" class="pilcrow">¶</a></p>
<p id="section-8-3">A WAMP router will happily forward <em>any</em> application payload on <em>any</em> procedure or topic URI as long as the client is <em>authorized</em> (has permission) to execute the respective WAMP action (call, register, publish or subscribe) on the given URI.<a href="#section-8-3" class="pilcrow">¶</a></p>
<p id="section-8-4">This approach has served WAMP well, as application developers can get started immediately, and evolve and change payloads as they need without extra steps.
These advantages in flexibility of course come at a price, as nothing is free, and knowing that price is important to be aware of the tradeoffs one is accepting when using dynamic typing:<a href="#section-8-4" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-8-5.1">problematic coordination of <em>Interfaces</em> within larger developer teams or between different parties<a href="#section-8-5.1" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-8-5.2">no easy way to stabilize, freeze, document or share <em>Interfaces</em><a href="#section-8-5.2" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-8-5.3">no way to programmatically describe <em>Interfaces</em> ("interface reflection") at run-time<a href="#section-8-5.3" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-8-6">Problems such above could be avoided when WAMP supported an <em>option</em> to formally define WAMP-based <em>Interfaces</em>. This needs to answer the following questions:<a href="#section-8-6" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="compact type-1" id="section-8-7">
<li id="section-8-7.1">How to specify the <code>args|List</code> and <code>kwargs|Dict</code> application payloads that are used in WAMP calls, errors and events?<a href="#section-8-7.1" class="pilcrow">¶</a>
</li>
        <li id="section-8-7.2">How to specify the type and URI (patterns) for WAMP RPCs <em>Procedures</em> and WAMP PubSub <em>Topics</em> that make up an <em>Interface</em>, and how to identify an <em>Interface</em> itself as a collection of <em>Procedures</em> and <em>Topics</em>?<a href="#section-8-7.2" class="pilcrow">¶</a>
</li>
        <li id="section-8-7.3">How to package, publish and share <em>Catalogs</em> as a collection of <em>Interfaces</em> plus metadata<a href="#section-8-7.3" class="pilcrow">¶</a>
</li>
      </ol>
<p id="section-8-8">The following sections will describe the solution to each of above questions using WAMP IDL.<a href="#section-8-8" class="pilcrow">¶</a></p>
<p id="section-8-9">Using WAMP Interfaces finally allows to support the following application developer level features:<a href="#section-8-9" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="compact type-1" id="section-8-10">
<li id="section-8-10.1">router-based application payload validation and enforcement<a href="#section-8-10.1" class="pilcrow">¶</a>
</li>
        <li id="section-8-10.2">WAMP interface documentation generation and autodocs Web service<a href="#section-8-10.2" class="pilcrow">¶</a>
</li>
        <li id="section-8-10.3">publication and sharing of WAMP Interfaces and Catalogs<a href="#section-8-10.3" class="pilcrow">¶</a>
</li>
        <li id="section-8-10.4">client binding code generation from WAMP Interfaces<a href="#section-8-10.4" class="pilcrow">¶</a>
</li>
        <li id="section-8-10.5">run-time WAMP type reflection as part of the WAMP meta API<a href="#section-8-10.5" class="pilcrow">¶</a>
</li>
      </ol>
<div id="wamp-idl">
<section id="section-8.1">
        <h3 id="name-wamp-idl">
<a href="#section-8.1" class="section-number selfRef">8.1. </a><a href="#name-wamp-idl" class="section-name selfRef">WAMP IDL</a>
        </h3>
<div id="application-payload-typing">
<section id="section-8.1.1">
          <h4 id="name-application-payload-typing">
<a href="#section-8.1.1" class="section-number selfRef">8.1.1. </a><a href="#name-application-payload-typing" class="section-name selfRef">Application Payload Typing</a>
          </h4>
<p id="section-8.1.1-1">To define the application payload <code>Arguments|list</code> and <code>ArgumentsKw|dict</code>, WAMP IDL reuses the <a href="https://google.github.io/flatbuffers/md__schemas.html">FlatBuffers IDL</a>, specifically, we map a pair of <code>Arguments|list</code> and <code>ArgumentsKw|dict</code> to a FlatBuffers Table with WAMP defined FlatBuffers <em>Attributes</em>.<a href="#section-8.1.1-1" class="pilcrow">¶</a></p>
<p id="section-8.1.1-2">User defined WAMP application payloads are transmitted in <code>Arguments|list</code> and <code>ArgumentsKw|dict</code> elements of the following WAMP messages:<a href="#section-8.1.1-2" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-8.1.1-3.1">
              <code>PUBLISH</code><a href="#section-8.1.1-3.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-8.1.1-3.2">
              <code>EVENT</code><a href="#section-8.1.1-3.2" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-8.1.1-3.3">
              <code>CALL</code><a href="#section-8.1.1-3.3" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-8.1.1-3.4">
              <code>INVOCATION</code><a href="#section-8.1.1-3.4" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-8.1.1-3.5">
              <code>YIELD</code><a href="#section-8.1.1-3.5" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-8.1.1-3.6">
              <code>RESULT</code><a href="#section-8.1.1-3.6" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-8.1.1-3.7">
              <code>ERROR</code><a href="#section-8.1.1-3.7" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-8.1.1-4">A <em>Publisher</em> uses the<a href="#section-8.1.1-4" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-8.1.1-5.1">
              <code>PUBLISH.Arguments|list</code> and <code>PUBLISH.ArgumentsKw|dict</code><a href="#section-8.1.1-5.1" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-8.1.1-6">message elements to send the event payload to be published to the <em>Broker</em> in <code>PUBLISH</code> messages. When the event is accepted by the <em>Broker</em>, it will dispatch an <code>EVENT</code> message with<a href="#section-8.1.1-6" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-8.1.1-7.1">
              <code>EVENT.Arguments|list</code> and <code>EVENT.ArgumentsKw|dict</code><a href="#section-8.1.1-7.1" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-8.1.1-8">message elements to all (eligible, and not excluded) <em>Subscribers</em>.<a href="#section-8.1.1-8" class="pilcrow">¶</a></p>
<p id="section-8.1.1-9">A <em>Caller</em> uses the<a href="#section-8.1.1-9" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-8.1.1-10.1">
              <code>CALL.Arguments|list</code> and <code>CALL.ArgumentsKw|dict</code><a href="#section-8.1.1-10.1" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-8.1.1-11">message elements to send the call arguments to be used to the <em>Dealer</em> in <code>CALL</code> messages. When the call is accepted by the <em>Dealer</em>, it will forward<a href="#section-8.1.1-11" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-8.1.1-12.1">
              <code>INVOCATION.Arguments|list</code> and <code>INVOCATION.ArgumentsKw|dict</code><a href="#section-8.1.1-12.1" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-8.1.1-13">to the (or one of) <em>Callee</em>, and receive <code>YIELD</code> messages with<a href="#section-8.1.1-13" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-8.1.1-14.1">
              <code>YIELD.Arguments|list</code> and <code>YIELD.ArgumentsKw|dict</code><a href="#section-8.1.1-14.1" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-8.1.1-15">message elements, which it will return to the original <em>Caller</em> in <code>RESULT</code> messages with<a href="#section-8.1.1-15" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-8.1.1-16.1">
              <code>RESULT.Arguments|list</code> and <code>RESULT.ArgumentsKw|dict</code><a href="#section-8.1.1-16.1" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-8.1.1-17">In the error case, a <em>Callee</em> MAY return an <code>ERROR</code> message with<a href="#section-8.1.1-17" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-8.1.1-18.1">
              <code>ERROR.Arguments|list</code> and <code>ERROR.ArgumentsKw|dict</code><a href="#section-8.1.1-18.1" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-8.1.1-19">message elements, which again is returned to the original <em>Caller</em>.<a href="#section-8.1.1-19" class="pilcrow">¶</a></p>
<blockquote id="section-8.1.1-20">
            <p id="section-8.1.1-20.1">It is important to note that the above messages and message elements are the only ones free for use with application and user defined payloads. In particular, even though the following WAMP messages and message element carry payloads defined by the specific WAMP authentication method used, they do <em>not</em> carry arbitrary application payloads: <code>HELLO.Details["authextra"]|dict</code>, <code>WELCOME.Details["authextra"]|dict</code>, <code>CHALLENGE.Extra|dict</code>, <code>AUTHENTICATE.Extra|dict</code>.<a href="#section-8.1.1-20.1" class="pilcrow">¶</a></p>
</blockquote>
<p id="section-8.1.1-21">For example, the <a href="{#session-metapi}">Session Meta API</a> includes a procedure to <a href="#name-wampsessionkill_by_authid">kill all sessions by authid</a> with:<a href="#section-8.1.1-21" class="pilcrow">¶</a></p>
<p id="section-8.1.1-22"><strong>Positional arguments</strong> (<code>args|list</code>)<a href="#section-8.1.1-22" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="compact type-1" id="section-8.1.1-23">
<li id="section-8.1.1-23.1">
              <code>authid|string</code> - The authentication ID identifying sessions to close.<a href="#section-8.1.1-23.1" class="pilcrow">¶</a>
</li>
          </ol>
<p id="section-8.1.1-24"><strong>Keyword arguments</strong> (<code>kwargs|dict</code>)<a href="#section-8.1.1-24" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="compact type-1" id="section-8.1.1-25">
<li id="section-8.1.1-25.1">
              <code>reason|uri</code> - reason for closing sessions, sent to clients in <code>GOODBYE.Reason</code><a href="#section-8.1.1-25.1" class="pilcrow">¶</a>
</li>
            <li id="section-8.1.1-25.2">
              <code>message|string</code> - additional information sent to clients in <code>GOODBYE.Details</code> under the key "message".<a href="#section-8.1.1-25.2" class="pilcrow">¶</a>
</li>
          </ol>
<p id="section-8.1.1-26">as arguments. When successful, this procedure will return a call result with:<a href="#section-8.1.1-26" class="pilcrow">¶</a></p>
<p id="section-8.1.1-27"><strong>Positional results</strong> (<code>results|list</code>)<a href="#section-8.1.1-27" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="compact type-1" id="section-8.1.1-28">
<li id="section-8.1.1-28.1">
              <code>sessions|list</code> - The list of WAMP session IDs of session that were killed.<a href="#section-8.1.1-28.1" class="pilcrow">¶</a>
</li>
          </ol>
<p id="section-8.1.1-29"><strong>Keyword results</strong> (<code>kwresults|dict</code>)<a href="#section-8.1.1-29" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="compact type-1" id="section-8.1.1-30">
<li id="section-8.1.1-30.1">
              <code>None</code><a href="#section-8.1.1-30.1" class="pilcrow">¶</a>
</li>
          </ol>
<p id="section-8.1.1-31">To specify the call arguments in FlatBuffers IDL, we can define a FlatBuffers table for both <code>args</code> and <code>kwargs</code>:<a href="#section-8.1.1-31" class="pilcrow">¶</a></p>
<div class="lang-flatbuffers sourcecode" id="section-8.1.1-32">
<pre>/// Call args/kwargs for "wamp.session.kill_by_authid"
table SessionKillByAuthid
{
    /// The WAMP authid of the sessions to kill.
    authid: string (wampuri);

    /// A reason URI provided to the killed session(s).
    reason: string (kwarg, wampuri);

    /// A message provided to the killed session(s).
    message: string (kwarg);
}
</pre><a href="#section-8.1.1-32" class="pilcrow">¶</a>
</div>
<p id="section-8.1.1-33">The table contains the list <code>args</code> as table elements (in order), unless the table element has an <em>Attribute</em> <code>kwarg</code>, in which case the element one in <code>kwarg</code>.<a href="#section-8.1.1-33" class="pilcrow">¶</a></p>
<p id="section-8.1.1-34">The attributes <code>wampid</code> and <code>wampuri</code> are special markers that denote values that follow the respective WAMP identifier rules for WAMP IDs and URIs.<a href="#section-8.1.1-34" class="pilcrow">¶</a></p>
<p id="section-8.1.1-35">When successful, the procedure will return a list of WAMP session IDs of session that were killed. Again, we can map this to FlatBuffers IDL:<a href="#section-8.1.1-35" class="pilcrow">¶</a></p>
<div class="lang-flatbuffers sourcecode" id="section-8.1.1-36">
<pre>table WampIds
{
    /// List of WAMP IDs.
    value: [uint64] (wampid);
}
</pre><a href="#section-8.1.1-36" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="wamp-idl-attributes">
<section id="section-8.1.2">
          <h4 id="name-wamp-idl-attributes">
<a href="#section-8.1.2" class="section-number selfRef">8.1.2. </a><a href="#name-wamp-idl-attributes" class="section-name selfRef">WAMP IDL Attributes</a>
          </h4>
<p id="section-8.1.2-1">WAMP IDL uses <em>custom FlatBuffer attributes</em> to<a href="#section-8.1.2-1" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-8.1.2-2.1">mark <code>kwarg</code> fields which map to WAMP keyword argument vs <code>arg</code> (default)<a href="#section-8.1.2-2.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-8.1.2-2.2">declare fields of a scalar base type to follow (stricter) WAMP rules (for IDs and URIs)<a href="#section-8.1.2-2.2" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-8.1.2-2.3">specify the WAMP action type, that is <em>Procedure</em> vs <em>Topic</em>, on service declarations<a href="#section-8.1.2-2.3" class="pilcrow">¶</a>
</li>
          </ul>
<blockquote id="section-8.1.2-3">
            <p id="section-8.1.2-3.1">"Attributes may be attached to a declaration, behind a field, or after the name of a table/struct/enum/union. These may either have a value or not. Some attributes like deprecated are understood by the compiler; user defined ones need to be declared with the attribute declaration (like priority in the example above), and are available to query if you parse the schema at runtime. This is useful if you write your own code generators/editors etc., and you wish to add additional information specific to your tool (such as a help text)." (from <a href="https://google.github.io/flatbuffers/md__schemas.html">source</a>).<a href="#section-8.1.2-3.1" class="pilcrow">¶</a></p>
</blockquote>
<p id="section-8.1.2-4">The <em>Attributes</em> used in WAMP IDL are defined in <code>&lt;WAMP API Catalog&gt;/src/wamp.fbs</code>, and are described in the following sections:<a href="#section-8.1.2-4" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-8.1.2-5.1">
              <code>arg</code>, <code>kwarg</code><a href="#section-8.1.2-5.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-8.1.2-5.2">
              <code>wampid</code><a href="#section-8.1.2-5.2" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-8.1.2-5.3">
              <code>wampname</code>, <code>wampname_s</code><a href="#section-8.1.2-5.3" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-8.1.2-5.4">
              <code>wampuri</code>, <code>wampuri_s</code>, <code>wampuri_p</code>, <code>wampuri_sp</code>, <code>wampuri_pp</code>, <code>wampuri_spp</code><a href="#section-8.1.2-5.4" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-8.1.2-5.5">
              <code>uuid</code><a href="#section-8.1.2-5.5" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-8.1.2-5.6">
              <code>ethadr</code><a href="#section-8.1.2-5.6" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-8.1.2-5.7">
              <code>type</code><a href="#section-8.1.2-5.7" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-8.1.2-6"><strong>WAMP Positional and Keyword-based Payloads</strong><a href="#section-8.1.2-6" class="pilcrow">¶</a></p>
<p id="section-8.1.2-7">Positional payloads <code>args|list</code> and keyword-based payloads <code>kwargs|dict</code> are table elements that have one of the following <em>Attributes</em>:<a href="#section-8.1.2-7" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-8.1.2-8.1">
              <code>arg</code> (default)<a href="#section-8.1.2-8.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-8.1.2-8.2">
              <code>kwarg</code><a href="#section-8.1.2-8.2" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-8.1.2-9">One pair of <code>args</code> and <code>kwarg</code> types is declared by one FlatBuffer table with optional attributes on table fields, and the following rules apply or must be followed:<a href="#section-8.1.2-9" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="compact type-1" id="section-8.1.2-10">
<li id="section-8.1.2-10.1">If neither <code>arg</code> nor <code>kwarg</code> attribute is provided, <code>arg</code> is assumed.<a href="#section-8.1.2-10.1" class="pilcrow">¶</a>
</li>
            <li id="section-8.1.2-10.2">Only one of either <code>arg</code> or <code>kwarg</code> MUST be specified.<a href="#section-8.1.2-10.2" class="pilcrow">¶</a>
</li>
            <li id="section-8.1.2-10.3">When a field has an attribute <code>kwarg</code>, all subsequent fields in the same table MUST also have attribute <code>kwarg</code>.<a href="#section-8.1.2-10.3" class="pilcrow">¶</a>
</li>
          </ol>
<p id="section-8.1.2-11"><strong>WAMP IDs and URIs</strong><a href="#section-8.1.2-11" class="pilcrow">¶</a></p>
<p id="section-8.1.2-12">Integers which contain WAMP IDs use <em>Attribute</em><a href="#section-8.1.2-12" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="compact type-1" id="section-8.1.2-13">
<li id="section-8.1.2-13.1">
              <code>wampid</code>: WAMP ID, that is an integer <code>[1, 2^53]</code><a href="#section-8.1.2-13.1" class="pilcrow">¶</a>
</li>
          </ol>
<p id="section-8.1.2-14">Strings which contain WAMP names ("URI components"), for e.g. WAMP roles or authids use <em>Attributes</em><a href="#section-8.1.2-14" class="pilcrow">¶</a></p>
<ol start="2" type="1" class="compact type-1" id="section-8.1.2-15">
<li id="section-8.1.2-15.1">
              <code>wampname</code>: WAMP URI component (aka "name"), loose rules (minimum required to combine to dotted URIs), must match regular expression <code>^[^\s\.#]+$</code>.<a href="#section-8.1.2-15.1" class="pilcrow">¶</a>
</li>
            <li id="section-8.1.2-15.2">
              <code>wampname_s</code>: WAMP URI component (aka "name"), strict rules (can be used as identifier in most languages), must match regular expression <code>^[\da-z_]+$</code>.<a href="#section-8.1.2-15.2" class="pilcrow">¶</a>
</li>
          </ol>
<p id="section-8.1.2-16">Strings which contain WAMP URIs or URI patterns use <em>Attribute</em><a href="#section-8.1.2-16" class="pilcrow">¶</a></p>
<ol start="4" type="1" class="compact type-1" id="section-8.1.2-17">
<li id="section-8.1.2-17.1">
              <code>wampuri</code>: WAMP URI, loose rules, no empty URI components (aka "concrete or fully qualified URI"), must match regular expression <code>^([^\s\.#]+\.)*([^\s\.#]+)$</code>.<a href="#section-8.1.2-17.1" class="pilcrow">¶</a>
</li>
            <li id="section-8.1.2-17.2">
              <code>wampuri_s</code>: WAMP URI, strict rules, no empty URI components, must match regular expression <code>^([\da-z_]+\.)*([\da-z_]+)$</code>.<a href="#section-8.1.2-17.2" class="pilcrow">¶</a>
</li>
            <li id="section-8.1.2-17.3">
              <code>wampuri_p</code>: WAMP URI or URI (prefix or wildcard) pattern, loose rules (minimum required to combine to dotted URIs), must match regular expression <code>^(([^\s\.#]+\.)|\.)*([^\s\.#]+)?$</code>.<a href="#section-8.1.2-17.3" class="pilcrow">¶</a>
</li>
            <li id="section-8.1.2-17.4">
              <code>wampuri_sp</code>: WAMP URI or URI (prefix or wildcard) pattern, strict rules (can be used as identifier in most languages), must match regular expression <code>^(([\da-z_]+\.)|\.)*([\da-z_]+)?$</code>.<a href="#section-8.1.2-17.4" class="pilcrow">¶</a>
</li>
            <li id="section-8.1.2-17.5">
              <code>wampuri_pp</code>: WAMP URI or URI prefix pattern, loose rules (minimum required to combine to dotted URIs), must match regular expression <code>^([^\s\.#]+\.)*([^\s\.#]*)$</code>.<a href="#section-8.1.2-17.5" class="pilcrow">¶</a>
</li>
            <li id="section-8.1.2-17.6">
              <code>wampuri_spp</code>: WAMP URI or URI prefix pattern, strict rules (can be used as identifier in most languages), must match regular expression <code>^([\da-z_]+\.)*([\da-z_]*)$</code>.<a href="#section-8.1.2-17.6" class="pilcrow">¶</a>
</li>
          </ol>
<p id="section-8.1.2-18"><strong>Type/Object UUIDs</strong><a href="#section-8.1.2-18" class="pilcrow">¶</a></p>
<p id="section-8.1.2-19">Types and generally any objects can be globally identified using UUIDs <span>[<a href="#RFC4122" class="cite xref">RFC4122</a>]</span>. UUIDs can be used in WAMP IDL using the <code>uuid</code> <em>Attribute</em>.<a href="#section-8.1.2-19" class="pilcrow">¶</a></p>
<div class="lang-flatbuffers sourcecode" id="section-8.1.2-20">
<pre>/// UUID (canonical textual representation).
my_field1: string (uuid);

/// UUID (128 bit binary).
my_field2: uint128_t (uuid);
</pre><a href="#section-8.1.2-20" class="pilcrow">¶</a>
</div>
<p id="section-8.1.2-21">The <code>uint128_t</code> is a struct type defined as<a href="#section-8.1.2-21" class="pilcrow">¶</a></p>
<div class="lang-flatbuffers sourcecode" id="section-8.1.2-22">
<pre>/// An unsigned integer with 128 bits.
struct uint128_t {
    /// Least significand 32 bits.
    w0: uint32;

    /// 2nd significand 32 bits.
    w1: uint32;

    /// 3rd significand 32 bits.
    w2: uint32;

    /// Most significand 32 bits.
    w3: uint32;
}
</pre><a href="#section-8.1.2-22" class="pilcrow">¶</a>
</div>
<p id="section-8.1.2-23"><strong>Ethereum Addresses</strong><a href="#section-8.1.2-23" class="pilcrow">¶</a></p>
<p id="section-8.1.2-24">Ethereum addresses can be used to globally identify types or generally any object where
the global ID also needs to be conflict free, consensually shared and owned by a respective
Ethereum network user. Ethereum addresses can be used in WAMP IDL using the <code>ethadr</code> <em>Attribute</em>:<a href="#section-8.1.2-24" class="pilcrow">¶</a></p>
<div class="lang-flatbuffers sourcecode" id="section-8.1.2-25">
<pre>/// Ethereum address (checksummed HEX encoded address).
my_field1: string (ethadr);

/// Ethereum address (160 bit binary).
my_field2: uint160_t (ethadr);
</pre><a href="#section-8.1.2-25" class="pilcrow">¶</a>
</div>
<p id="section-8.1.2-26">The <code>uint160_t</code> is a struct type defined as<a href="#section-8.1.2-26" class="pilcrow">¶</a></p>
<div class="lang-flatbuffers sourcecode" id="section-8.1.2-27">
<pre>/// An unsigned integer with 160 bits.
struct uint160_t {
    /// Least significand 32 bits.
    w0: uint32;

    /// 2nd significand 32 bits.
    w1: uint32;

    /// 3rd significand 32 bits.
    w2: uint32;

    /// 4th significand 32 bits.
    w3: uint32;

    /// Most significand 32 bits.
    w4: uint32;
}
</pre><a href="#section-8.1.2-27" class="pilcrow">¶</a>
</div>
<p id="section-8.1.2-28"><strong>WAMP Actions or Service Elements</strong><a href="#section-8.1.2-28" class="pilcrow">¶</a></p>
<p id="section-8.1.2-29">The type of WAMP service element <strong>procedure</strong>, <strong>topic</strong> or <strong>interface</strong> is designated
using the <em>Attribute</em><a href="#section-8.1.2-29" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="compact type-1" id="section-8.1.2-30">
<li id="section-8.1.2-30.1">
              <code>type</code>: one of <code>"procedure"</code>, <code>"topic"</code> or <code>"interface"</code><a href="#section-8.1.2-30.1" class="pilcrow">¶</a>
</li>
          </ol>
<p id="section-8.1.2-31">The <code>type</code> <em>Attribute</em> can be used to denote WAMP service interfaces, e.g. continuing with above WAMP Meta API procedure example, the <code>wamp.session.kill_by_authid</code> procedure can be declared like this:<a href="#section-8.1.2-31" class="pilcrow">¶</a></p>
<div class="lang-flatbuffers sourcecode" id="section-8.1.2-32">
<pre>rpc_service IWampMeta(type: "interface",
                      uuid: "88711231-3d95-44bc-9464-58d871dd7fd7",
                      wampuri: "wamp")
{
    session_kill_by_authid (SessionKillByAuthid): WampIds (
        type: "procedure",
        wampuri: "wamp.session.kill_by_authid"
    );
}
</pre><a href="#section-8.1.2-32" class="pilcrow">¶</a>
</div>
<p id="section-8.1.2-33">The value of attribute <code>type</code> specifies a WAMP <em>Procedure</em>, and the call arguments and result types of the procedure are given by:<a href="#section-8.1.2-33" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-8.1.2-34.1">
              <code>SessionKillByAuthid</code>: procedure call arguments <code>args</code> (positional argument) and <code>kwargs</code> (keyword arguments) call argument follow this type<a href="#section-8.1.2-34.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-8.1.2-34.2">
              <code>WampIds</code>: procedure call results <code>args</code> (positional results) and <code>kwargs</code> (keyword results)<a href="#section-8.1.2-34.2" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-8.1.2-35">The procedure will be registered under the WAMP URI <code>wamp.session.kill_by_authid</code> on the respective realm.<a href="#section-8.1.2-35" class="pilcrow">¶</a></p>
</section>
</div>
<div id="wamp-service-declaration">
<section id="section-8.1.3">
          <h4 id="name-wamp-service-declaration">
<a href="#section-8.1.3" class="section-number selfRef">8.1.3. </a><a href="#name-wamp-service-declaration" class="section-name selfRef">WAMP Service Declaration</a>
          </h4>
<p id="section-8.1.3-1">WAMP services include<a href="#section-8.1.3-1" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-8.1.3-2.1">
              <em>Procedures</em> registered by <em>Callees</em>, available for calling from <em>Callers</em><a href="#section-8.1.3-2.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-8.1.3-2.2">
              <em>Topics</em> published to by <em>Publishers</em>, available for subscribing by <em>Subscribers</em><a href="#section-8.1.3-2.2" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-8.1.3-3">We map the two WAMP service types to FlatBuffers IDL using the <em>Attribute</em> <code>type == "procedure" | "topic"</code> as in this example:<a href="#section-8.1.3-3" class="pilcrow">¶</a></p>
<div class="lang-flatbuffers sourcecode" id="section-8.1.3-4">
<pre>rpc_service IWampMeta(type: "interface",
                      uuid: "88711231-3d95-44bc-9464-58d871dd7fd7",
                      wampuri: "wamp")
{
    session_kill_by_authid (SessionKillByAuthid): WampIds (
        type: "procedure",
        wampuri: "wamp.session.kill_by_authid"
    );

    session_on_leave (SessionInfo): Void (
        type: "topic",
        wampuri: "wamp.session.on_leave"
    );
}
</pre><a href="#section-8.1.3-4" class="pilcrow">¶</a>
</div>
<p id="section-8.1.3-5">When the procedure <code>wamp.session.kill_by_authid</code> is called to kill all sessions
with a given <code>authid</code>, the procedure will return a list of WAMP session IDs of
the killed sessions via <code>WampIds</code>.
Independently, meta events on topic <code>wamp.session.on_leave</code> are published with
detailed <code>SessionInfo</code> of the sessions left as event payload.
This follows a common "do-something-and-notify-observers" pattern for a pair of
a procedure and topic working together.<a href="#section-8.1.3-5" class="pilcrow">¶</a></p>
<p id="section-8.1.3-6">The <em>Interface</em> then collects a number of <em>Procedures</em> and <em>Topics</em> under one
named unit of <code>type == "interface"</code> which includes a UUID in an <code>uuid</code> <em>Attribute</em>.<a href="#section-8.1.3-6" class="pilcrow">¶</a></p>
<p id="section-8.1.3-7"><strong>Declaring Services</strong><a href="#section-8.1.3-7" class="pilcrow">¶</a></p>
<p id="section-8.1.3-8">Declaring services involves three element types:<a href="#section-8.1.3-8" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-8.1.3-9.1">
              <em>Topics</em><a href="#section-8.1.3-9.1" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-8.1.3-9.2">
              <em>Procedures</em><a href="#section-8.1.3-9.2" class="pilcrow">¶</a>
</li>
            <li class="compact" id="section-8.1.3-9.3">
              <em>Interfaces</em><a href="#section-8.1.3-9.3" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-8.1.3-10">The general form for declaring <em>Topics</em> is:<a href="#section-8.1.3-10" class="pilcrow">¶</a></p>
<div class="lang-flatbuffers sourcecode" id="section-8.1.3-11">
<pre>&lt;TOPIC-METHOD&gt; (&lt;TOPIC-PAYLOAD-TABLE&gt;): Void (
    type: "topic",
    wampuri: &lt;TOPIC-URI&gt;
);
</pre><a href="#section-8.1.3-11" class="pilcrow">¶</a>
</div>
<p id="section-8.1.3-12">The application payload transmitted in EVENTs is typed via <code>&lt;TOPIC-PAYLOAD-TABLE&gt;</code>. The return type MUST always be <code>Void</code>, which is a dummy marker type declared in <code>wamp.fbs</code>.<a href="#section-8.1.3-12" class="pilcrow">¶</a></p>
<blockquote id="section-8.1.3-13">
            <p id="section-8.1.3-13.1">Note: With <em>Acknowledge Event Delivery</em> (future), when a <em>Subscriber</em> receives an EVENT, the <em>Subscriber</em> will return an <em>Event-Acknowledgement</em> including <code>args</code>/ <code>kwargs</code>. Once we do have this feature in WAMP PubSub, the type of the <em>Event-Acknowledgement</em> can be specified using a non-<code>Void</code> return type.<a href="#section-8.1.3-13.1" class="pilcrow">¶</a></p>
</blockquote>
<p id="section-8.1.3-14">The general form for declaring <em>Procedures</em> is:<a href="#section-8.1.3-14" class="pilcrow">¶</a></p>
<div class="lang-flatbuffers sourcecode" id="section-8.1.3-15">
<pre>&lt;PROCEDURE-METHOD&gt; (&lt;CALL-PAYLOAD-TABLE&gt;): &lt;CALLRESULT-PAYLOAD-TABLE&gt; (
    type: "procedure",
    wampuri: &lt;PROCEDURE-URI&gt;
);
</pre><a href="#section-8.1.3-15" class="pilcrow">¶</a>
</div>
<p id="section-8.1.3-16">The application payload transmitted in CALLs is typed via <code>&lt;CALL-PAYLOAD-TABLE&gt;</code>. The return type of the CALL is typed via <code>&lt;CALLRESULT-PAYLOAD-TABLE&gt;</code>.<a href="#section-8.1.3-16" class="pilcrow">¶</a></p>
<p id="section-8.1.3-17">The general form for declaring <em>Interfaces</em>, which collect <em>Procedures</em> and <em>Topics</em> is:<a href="#section-8.1.3-17" class="pilcrow">¶</a></p>
<div class="lang-flatbuffers sourcecode" id="section-8.1.3-18">
<pre>rpc_service &lt;INTERFACE&gt; (
    type: "interface",
    uuid: &lt;INTERFACE-UUID&gt;,
    wampuri: &lt;INTERFACE-URI-PREFIX&gt;
) {
    /// Method declarations of WAMP Procedures and Topics
}
</pre><a href="#section-8.1.3-18" class="pilcrow">¶</a>
</div>
<blockquote id="section-8.1.3-19">
            <p id="section-8.1.3-19.1">Note: We are reusing FlatBuffers IDL here, specifically the <code>rpc_service</code> service definitions which <a href="https://grpc.io/blog/grpc-flatbuffers/">were designed for gRPC</a>. We reuse this element to declare both WAMP <em>Topics</em> and <em>Procedures</em> by using the <code>type</code> Attribute. Do not get confused with "rpc" in <code>rpc_service</code>.<a href="#section-8.1.3-19.1" class="pilcrow">¶</a></p>
</blockquote>
<p id="section-8.1.3-20"><strong>Declaring Progressive Call Results</strong><a href="#section-8.1.3-20" class="pilcrow">¶</a></p>
<p id="section-8.1.3-21">Write me.<a href="#section-8.1.3-21" class="pilcrow">¶</a></p>
<p id="section-8.1.3-22"><strong>Declaring Call Errors</strong><a href="#section-8.1.3-22" class="pilcrow">¶</a></p>
<p id="section-8.1.3-23">Write me.<a href="#section-8.1.3-23" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="interface-catalogs">
<section id="section-8.2">
        <h3 id="name-interface-catalogs">
<a href="#section-8.2" class="section-number selfRef">8.2. </a><a href="#name-interface-catalogs" class="section-name selfRef">Interface Catalogs</a>
        </h3>
<p id="section-8.2-1">Collections of types defined in FlatBuffers IDL are bundled in <em>Interface Catalogs</em> which are just ZIP files with<a href="#section-8.2-1" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-8.2-2.1">one <a href="catalog.yaml">catalog.yaml</a> file with catalog metadata<a href="#section-8.2-2.1" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-8.2-2.2">one or more <code>*.bfbs</code> compiled FlatBuffer IDL schemas<a href="#section-8.2-2.2" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-8.2-3">and optionally<a href="#section-8.2-3" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-8.2-4.1">schema source files<a href="#section-8.2-4.1" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-8.2-4.2">image and documentation files<a href="#section-8.2-4.2" class="pilcrow">¶</a>
</li>
        </ul>
<div id="catalog-archive-file">
<section id="section-8.2.1">
          <h4 id="name-catalog-archive-file">
<a href="#section-8.2.1" class="section-number selfRef">8.2.1. </a><a href="#name-catalog-archive-file" class="section-name selfRef">Catalog Archive File</a>
          </h4>
<p id="section-8.2.1-1">The contents of an <code>example.zip</code> interface catalog:<a href="#section-8.2.1-1" class="pilcrow">¶</a></p>
<div class="lang-sh sourcecode" id="section-8.2.1-2">
<pre>unzip -l build/example.zip
Archive:  build/example.zip
  Length      Date    Time    Name
---------  ---------- -----   ----
        0  1980-00-00 00:00   schema/
    14992  1980-00-00 00:00   schema/example2.bfbs
    15088  1980-00-00 00:00   schema/example4.bfbs
    13360  1980-00-00 00:00   schema/example3.bfbs
     8932  1980-00-00 00:00   schema/example1.bfbs
     6520  1980-00-00 00:00   schema/wamp.bfbs
     1564  1980-00-00 00:00   README.md
        0  1980-00-00 00:00   img/
    13895  1980-00-00 00:00   img/logo.png
     1070  1980-00-00 00:00   LICENSE.txt
     1288  1980-00-00 00:00   catalog.yaml
---------                     -------
    76709                     11 files
</pre><a href="#section-8.2.1-2" class="pilcrow">¶</a>
</div>
<p id="section-8.2.1-3">The bundled Catalog Interfaces in above are FlatBuffers binary schema files which are compiled using <code>flatc</code><a href="#section-8.2.1-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-8.2.1-4">
<pre>flatc -o ./schema --binary --schema --bfbs-comments --bfbs-builtins ./src
</pre><a href="#section-8.2.1-4" class="pilcrow">¶</a>
</div>
<p id="section-8.2.1-5">from FlatBuffers IDL sources, for example:<a href="#section-8.2.1-5" class="pilcrow">¶</a></p>
<div class="lang-flatbuffers sourcecode" id="section-8.2.1-6">
<pre>rpc_service IExample1 (
    type: "interface", uuid: "bf469db0-efea-425b-8de4-24b5770e6241"
) {
    my_procedure1 (TestRequest1): TestResponse1 (
        type: "procedure", wampuri: "com.example.my_procedure1"
    );

    on_something1 (TestEvent1): Void (
        type: "topic", wampuri: "com.example.on_something1"
    );
}
</pre><a href="#section-8.2.1-6" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="catalog-metadata">
<section id="section-8.2.2">
          <h4 id="name-catalog-metadata">
<a href="#section-8.2.2" class="section-number selfRef">8.2.2. </a><a href="#name-catalog-metadata" class="section-name selfRef">Catalog Metadata</a>
          </h4>
<p id="section-8.2.2-1">The <code>catalog.yaml</code> file contains catalog metadata in <a href="https://yaml.org/">YAML Format</a>:<a href="#section-8.2.2-1" class="pilcrow">¶</a></p>
<table class="left" id="table-16">
            <caption><a href="#table-16" class="selfRef">Table 16</a></caption>
<thead>
              <tr>
                <th class="text-left" rowspan="1" colspan="1">Field</th>
                <th class="text-left" rowspan="1" colspan="1">Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <code>name</code>
</td>
                <td class="text-left" rowspan="1" colspan="1">Catalog name, which must contain only lower-case letter, numbers, hyphen and underscore so the catalog name can be used in HTTP URLs</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <code>version</code>
</td>
                <td class="text-left" rowspan="1" colspan="1">Catalog version (e.g. semver or calendarver version string)</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <code>title</code>
</td>
                <td class="text-left" rowspan="1" colspan="1">Catalog title for display purposes</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <code>description</code>
</td>
                <td class="text-left" rowspan="1" colspan="1">Catalog description, a short text describing the API catalog</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <code>schemas</code>
</td>
                <td class="text-left" rowspan="1" colspan="1">FlatBuffers schemas compiled into binary schema reflection format</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <code>author</code>
</td>
                <td class="text-left" rowspan="1" colspan="1">Catalog author</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <code>publisher</code>
</td>
                <td class="text-left" rowspan="1" colspan="1">Ethereum Mainnet address of publisher</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <code>license</code>
</td>
                <td class="text-left" rowspan="1" colspan="1">SPDX license identifier (see <a href="https://spdx.org/licenses/">https://spdx.org/licenses/</a>) for the catalog</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <code>keywords</code>
</td>
                <td class="text-left" rowspan="1" colspan="1">Catalog keywords to hint at the contents, topic, usage or similar of the catalog</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <code>homepage</code>
</td>
                <td class="text-left" rowspan="1" colspan="1">Catalog home page or project page</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <code>git</code>
</td>
                <td class="text-left" rowspan="1" colspan="1">Git source repository location</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <code>theme</code>
</td>
                <td class="text-left" rowspan="1" colspan="1">Catalog visual theme</td>
              </tr>
            </tbody>
          </table>
<p id="section-8.2.2-3">Here is a complete example:<a href="#section-8.2.2-3" class="pilcrow">¶</a></p>
<div class="lang-yaml sourcecode" id="section-8.2.2-4">
<pre>name: example

version: 22.6.1

title: WAMP Example API Catalog

description: An example of a WAMP API catalog.

schemas:
  - schema/example1.bfbs
  - schema/example2.bfbs
  - schema/example3.bfbs
  - schema/example4.bfbs

author: typedef int GmbH

publisher: "0x60CC48BFC44b48A53e793FE4cB50e2d625BABB27"

license: MIT

keywords:
  - wamp
  - sample

homepage: https://wamp-proto.org/

git: https://github.com/wamp-proto/wamp-proto.git

theme:
  background: "#333333"
  text: "#e0e0e0"
  highlight: "#00ccff"
  logo: img/logo.png
</pre><a href="#section-8.2.2-4" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="catalog-sharing-and-publication">
<section id="section-8.2.3">
          <h4 id="name-catalog-sharing-and-publica">
<a href="#section-8.2.3" class="section-number selfRef">8.2.3. </a><a href="#name-catalog-sharing-and-publica" class="section-name selfRef">Catalog Sharing and Publication</a>
          </h4>
<p id="section-8.2.3-1"><strong>Archive File Preparation</strong><a href="#section-8.2.3-1" class="pilcrow">¶</a></p>
<p id="section-8.2.3-2">The <a href="https://linux.die.net/man/1/zip">ZIP</a> archive format and tools, by default, include filesystem and other metadata from the host producing the archive. That information usually changes, per-archive run, as e.g. the current datetime is included,
which obviously progresses.<a href="#section-8.2.3-2" class="pilcrow">¶</a></p>
<p id="section-8.2.3-3">When sharing and publishing a WAMP Interface Catalog, it is crucial that the archive only depends on the actual contents of the compressed files.<a href="#section-8.2.3-3" class="pilcrow">¶</a></p>
<p id="section-8.2.3-4">Removing all unwanted ZIP archive metadata can be achieved using <a href="https://github.com/KittyHawkCorp/stripzip">stripzip</a>:<a href="#section-8.2.3-4" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-8.2.3-5">
<pre>stripzip example.zip
</pre><a href="#section-8.2.3-5" class="pilcrow">¶</a>
</div>
<p id="section-8.2.3-6">The user build scripts for compiling and bundling an Interface Catalog ZIP file MUST be repeatable, and only depend on the input source files. A build process that fulfills this requirement is called <a href="https://en.wikipedia.org/wiki/Reproducible_builds">Reproducible build</a>.<a href="#section-8.2.3-6" class="pilcrow">¶</a></p>
<p id="section-8.2.3-7">The easiest way to check if your build scripts producing <code>example.zip</code> is reproducible is repeat the build and check that the file fingerprint of the resulting archive stays the same:<a href="#section-8.2.3-7" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-8.2.3-8">
<pre>openssl sha256 example.zip
</pre><a href="#section-8.2.3-8" class="pilcrow">¶</a>
</div>
<p id="section-8.2.3-9"><strong>Catalog Publication on Ethereum and IPFS</strong><a href="#section-8.2.3-9" class="pilcrow">¶</a></p>
<p id="section-8.2.3-10">Write me.<a href="#section-8.2.3-10" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="interface-reflection">
<section id="section-8.3">
        <h3 id="name-interface-reflection">
<a href="#section-8.3" class="section-number selfRef">8.3. </a><a href="#name-interface-reflection" class="section-name selfRef">Interface Reflection</a>
        </h3>
<p id="section-8.3-1">Feature status: <strong>sketch</strong><a href="#section-8.3-1" class="pilcrow">¶</a></p>
<p id="section-8.3-2"><em>Reflection</em> denotes the ability of WAMP peers to examine the procedures, topics and errors provided or used by other peers.<a href="#section-8.3-2" class="pilcrow">¶</a></p>
<p id="section-8.3-3">I.e. a WAMP <em>Caller</em>, <em>Callee</em>, <em>Subscriber</em> or <em>Publisher</em> may be interested in retrieving a machine readable list and description of WAMP procedures and topics it is authorized to access or provide in the context of a WAMP session with a <em>Dealer</em> or <em>Broker</em>.<a href="#section-8.3-3" class="pilcrow">¶</a></p>
<p id="section-8.3-4">Reflection may be useful in the following cases:<a href="#section-8.3-4" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-8.3-5.1">documentation<a href="#section-8.3-5.1" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-8.3-5.2">discoverability<a href="#section-8.3-5.2" class="pilcrow">¶</a>
</li>
          <li class="compact" id="section-8.3-5.3">generating stubs and proxies<a href="#section-8.3-5.3" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-8.3-6">WAMP predefines the following procedures for performing run-time reflection on WAMP peers which act as <em>Brokers</em> and/or <em>Dealers</em>.<a href="#section-8.3-6" class="pilcrow">¶</a></p>
<p id="section-8.3-7">Predefined WAMP reflection procedures to <em>list</em> resources by type:<a href="#section-8.3-7" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-8.3-8">
<pre>    wamp.reflection.topic.list
    wamp.reflection.procedure.list
    wamp.reflection.error.list
</pre><a href="#section-8.3-8" class="pilcrow">¶</a>
</div>
<p id="section-8.3-9">Predefined WAMP reflection procedures to <em>describe</em> resources by type:<a href="#section-8.3-9" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-8.3-10">
<pre>    wamp.reflection.topic.describe
    wamp.reflection.procedure.describe
    wamp.reflection.error.describe
</pre><a href="#section-8.3-10" class="pilcrow">¶</a>
</div>
<p id="section-8.3-11">A peer that acts as a <em>Broker</em> SHOULD announce support for the reflection API by sending<a href="#section-8.3-11" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-8.3-12">
<pre>    HELLO.Details.roles.broker.reflection|bool := true
</pre><a href="#section-8.3-12" class="pilcrow">¶</a>
</div>
<p id="section-8.3-13">A peer that acts as a <em>Dealer</em> SHOULD announce support for the reflection API by sending<a href="#section-8.3-13" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-8.3-14">
<pre>    HELLO.Details.roles.dealer.reflection|bool := true
</pre><a href="#section-8.3-14" class="pilcrow">¶</a>
</div>
<blockquote id="section-8.3-15">
          <p id="section-8.3-15.1">Since <em>Brokers</em> might provide (broker) procedures and <em>Dealers</em> might provide (dealer) topics, both SHOULD implement the complete API above (even if the peer only implements one of <em>Broker</em> or <em>Dealer</em> roles).<a href="#section-8.3-15.1" class="pilcrow">¶</a></p>
</blockquote>
<p id="section-8.3-16"><strong>Reflection Events and Procedures</strong><a href="#section-8.3-16" class="pilcrow">¶</a></p>
<p id="section-8.3-17">A topic or procedure is defined for reflection:<a href="#section-8.3-17" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-8.3-18">
<pre>    wamp.reflect.define
</pre><a href="#section-8.3-18" class="pilcrow">¶</a>
</div>
<p id="section-8.3-19">A topic or procedure is asked to be described (reflected upon):<a href="#section-8.3-19" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-8.3-20">
<pre>    wamp.reflect.describe
</pre><a href="#section-8.3-20" class="pilcrow">¶</a>
</div>
<p id="section-8.3-21">A topic or procedure has been defined for reflection:<a href="#section-8.3-21" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-8.3-22">
<pre>    wamp.reflect.on_define
</pre><a href="#section-8.3-22" class="pilcrow">¶</a>
</div>
<p id="section-8.3-23">A topic or procedure has been undefined from reflection:<a href="#section-8.3-23" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-8.3-24">
<pre>    wamp.reflect.on_undefine
</pre><a href="#section-8.3-24" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="r2r-links">
<section id="section-9">
      <h2 id="name-router-to-router-links">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-router-to-router-links" class="section-name selfRef">Router-to-Router Links</a>
      </h2>
<p id="section-9-1">Write me.<a href="#section-9-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="compact type-1" id="section-9-2">
<li id="section-9-2.1">Resolve global realm name R_name via ENS to the on-chain address R_adr of the realm.<a href="#section-9-2.1" class="pilcrow">¶</a>
</li>
        <li id="section-9-2.2">Retrieve list of Domains R_DR routing realm R_adr.<a href="#section-9-2.2" class="pilcrow">¶</a>
</li>
        <li id="section-9-2.3">Retrieve the node's N1 own domain D_N1 given the node's address N1_adr.<a href="#section-9-2.3" class="pilcrow">¶</a>
</li>
        <li id="section-9-2.4">Check D_N1 is in R_DR.<a href="#section-9-2.4" class="pilcrow">¶</a>
</li>
        <li id="section-9-2.5">Select a domain D (!=D_N1) from R_DR and get endpoint E for D.<a href="#section-9-2.5" class="pilcrow">¶</a>
</li>
        <li id="section-9-2.6">Connect to D and authenticate via WAMP-Cryptosign.<a href="#section-9-2.6" class="pilcrow">¶</a>
</li>
        <li id="section-9-2.7">Verify connected node N2 by checking against D<a href="#section-9-2.7" class="pilcrow">¶</a>
</li>
        <li id="section-9-2.8">Subscribe to <code>wamp.r2r.traffic_payable</code><a href="#section-9-2.8" class="pilcrow">¶</a>
</li>
        <li id="section-9-2.9">When receiving a traffic payable event, buy the respective key by
calling <code>xbr.pool.buy_key</code>, and calling <code>wamp.r2r.submit_traffic_payment</code>, which returns a traffic usage report.<a href="#section-9-2.9" class="pilcrow">¶</a>
</li>
      </ol>
<p id="section-9-3">Data Spaces are end-to-end encrypted routing realms connecting data driven microservices.<a href="#section-9-3" class="pilcrow">¶</a></p>
<p id="section-9-4">The message routing between the microservice endpoints in<a href="#section-9-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="ap-uris">
<section id="section-10">
      <h2 id="name-advanced-profile-uris">
<a href="#section-10" class="section-number selfRef">10. </a><a href="#name-advanced-profile-uris" class="section-name selfRef">Advanced Profile URIs</a>
      </h2>
<p id="section-10-1">WAMP pre-defines the following error URIs for the <strong>Advanced Profile</strong>. WAMP peers SHOULD only use the defined error messages.<a href="#section-10-1" class="pilcrow">¶</a></p>
<div id="session-close">
<section id="section-10.1">
        <h3 id="name-session-close">
<a href="#section-10.1" class="section-number selfRef">10.1. </a><a href="#name-session-close" class="section-name selfRef">Session Close</a>
        </h3>
<p id="section-10.1-1">The <em>Client</em> session has been forcefully terminated by the <em>Router</em> - used as a <code>GOODBYE</code> (or <code>ABORT</code>) reason.<a href="#section-10.1-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-10.1-2">
<pre>    wamp.close.killed
</pre><a href="#section-10.1-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="authentication">
<section id="section-10.2">
        <h3 id="name-authentication">
<a href="#section-10.2" class="section-number selfRef">10.2. </a><a href="#name-authentication" class="section-name selfRef">Authentication</a>
        </h3>
<p id="section-10.2-1">No authentication method the <em>Client</em> offered is accepted.<a href="#section-10.2-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-10.2-2">
<pre>    wamp.error.no_matching_auth_method
</pre><a href="#section-10.2-2" class="pilcrow">¶</a>
</div>
<p id="section-10.2-3">The <em>Client</em> attempted to authenticate for a non-existing <em>Realm</em> (<code>realm|string</code>).<a href="#section-10.2-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-10.2-4">
<pre>    wamp.error.no_such_realm
</pre><a href="#section-10.2-4" class="pilcrow">¶</a>
</div>
<p id="section-10.2-5">The <em>Client</em> attempted to authenticate for a non-existing <em>Role</em> (<code>authrole|string</code>).<a href="#section-10.2-5" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-10.2-6">
<pre>    wamp.error.no_such_role
</pre><a href="#section-10.2-6" class="pilcrow">¶</a>
</div>
<p id="section-10.2-7">The <em>Client</em> authenticated for a non-existing <em>Principal</em> (<code>authid|string</code>).<a href="#section-10.2-7" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-10.2-8">
<pre>    wamp.error.no_such_principal
</pre><a href="#section-10.2-8" class="pilcrow">¶</a>
</div>
<p id="section-10.2-9">The authentication as presented by the <em>Client</em> is denied (e.g. "wrong password").<a href="#section-10.2-9" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-10.2-10">
<pre>    wamp.error.authentication_denied
</pre><a href="#section-10.2-10" class="pilcrow">¶</a>
</div>
<p id="section-10.2-11">The <em>Client</em> authentication was rejected due to a technical runtime failure ("fail secure" operation).<a href="#section-10.2-11" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-10.2-12">
<pre>    wamp.error.authentication_failed
</pre><a href="#section-10.2-12" class="pilcrow">¶</a>
</div>
<p id="section-10.2-13">The <em>Client</em> did not provide the required, non-anonymous, authentication information.<a href="#section-10.2-13" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-10.2-14">
<pre>    wamp.error.authentication_required
</pre><a href="#section-10.2-14" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="authorization-1">
<section id="section-10.3">
        <h3 id="name-authorization-2">
<a href="#section-10.3" class="section-number selfRef">10.3. </a><a href="#name-authorization-2" class="section-name selfRef">Authorization</a>
        </h3>
<p id="section-10.3-1">The <em>Principal</em> is not authorized to perform such <em>Action</em>.<a href="#section-10.3-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-10.3-2">
<pre>    wamp.error.authorization_denied
</pre><a href="#section-10.3-2" class="pilcrow">¶</a>
</div>
<p id="section-10.3-3">Authorization of the <em>Principal</em> to perform the given <em>Action</em> was rejected due to a technical runtime failure ("fail secure" operation).<a href="#section-10.3-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-10.3-4">
<pre>    wamp.error.authorization_failed
</pre><a href="#section-10.3-4" class="pilcrow">¶</a>
</div>
<p id="section-10.3-5">Authorization of the <em>Principal</em> is required to perform the given <em>Action</em>. This can be used for capability-based access control.<a href="#section-10.3-5" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-10.3-6">
<pre>    wamp.error.authorization_required
</pre><a href="#section-10.3-6" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="remote-procedure-calls">
<section id="section-10.4">
        <h3 id="name-remote-procedure-calls">
<a href="#section-10.4" class="section-number selfRef">10.4. </a><a href="#name-remote-procedure-calls" class="section-name selfRef">Remote Procedure Calls</a>
        </h3>
<p id="section-10.4-1">A <em>Dealer</em> or <em>Callee</em> terminated a call that timed out<a href="#section-10.4-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-10.4-2">
<pre>    wamp.error.timeout
</pre><a href="#section-10.4-2" class="pilcrow">¶</a>
</div>
<p id="section-10.4-3">A <em>Peer</em> requested an interaction with an option that was disallowed by the <em>Router</em><a href="#section-10.4-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-10.4-4">
<pre>    wamp.error.option_not_allowed
</pre><a href="#section-10.4-4" class="pilcrow">¶</a>
</div>
<p id="section-10.4-5">A <em>Router</em> rejected client request to disclose its identity<a href="#section-10.4-5" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-10.4-6">
<pre>    wamp.error.option_disallowed.disclose_me
</pre><a href="#section-10.4-6" class="pilcrow">¶</a>
</div>
<p id="section-10.4-7">A <em>Router</em> encountered a network failure<a href="#section-10.4-7" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-10.4-8">
<pre>    wamp.error.network_failure
</pre><a href="#section-10.4-8" class="pilcrow">¶</a>
</div>
<p id="section-10.4-9">A <em>Callee</em> is not able to handle an invocation for a <em>call</em> and intends for the <em>Router</em> to re-route the <em>call</em> to another fitting <em>Callee</em>. For details, refer to <a href="ap_rpc_call_rerouting.md">RPC Call Rerouting</a><a href="#section-10.4-9" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-10.4-10">
<pre>    wamp.error.unavailable
</pre><a href="#section-10.4-10" class="pilcrow">¶</a>
</div>
<p id="section-10.4-11">A <em>Dealer</em> could not perform a call, since a procedure with the given URI is registered, but all available registrations have responded with <code>wamp.error.unavailable</code><a href="#section-10.4-11" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-10.4-12">
<pre>    wamp.error.no_available_callee
</pre><a href="#section-10.4-12" class="pilcrow">¶</a>
</div>
<p id="section-10.4-13">A <em>Dealer</em> received a <code>CALL</code> message with advanced features that cannot be processed by the <em>Callee</em><a href="#section-10.4-13" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-10.4-14">
<pre>    wamp.error.feature_not_supported
</pre><a href="#section-10.4-14" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="terminology">
<section id="section-10.5">
        <h3 id="name-terminology">
<a href="#section-10.5" class="section-number selfRef">10.5. </a><a href="#name-terminology" class="section-name selfRef">Terminology</a>
        </h3>
<p id="section-10.5-1">This chapter contains a list of technical terms used in this specification, along with their respective meanings.<a href="#section-10.5-1" class="pilcrow">¶</a></p>
<p id="section-10.5-2">Implementations SHOULD use terms as defined here in their public interfaces and documentation,
and SHOULD NOT reinvent or reinterpret terms. Users SHOULD be able to transfer their WAMP knowledge
from one implementation to another.
This is to support the overarching goal of WAMP to free application developers from restrictions when
building distributed applications, both at the network level, and when choosing (or switching) the WAMP
implementations used.<a href="#section-10.5-2" class="pilcrow">¶</a></p>
<p id="section-10.5-3">Our goal is to maximize <strong>user choice and experience</strong> when developing WAMP-based applications,
both formally (open protocol and open source) as well as practically (switching costs).<a href="#section-10.5-3" class="pilcrow">¶</a></p>
<div id="fundamental">
<section id="section-10.5.1">
          <h4 id="name-fundamental">
<a href="#section-10.5.1" class="section-number selfRef">10.5.1. </a><a href="#name-fundamental" class="section-name selfRef">Fundamental</a>
          </h4>
<table class="left" id="table-17">
            <caption><a href="#table-17" class="selfRef">Table 17</a></caption>
<thead>
              <tr>
                <th class="text-left" rowspan="1" colspan="1">Term</th>
                <th class="text-left" rowspan="1" colspan="1">Definition</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <em>User</em>
</td>
                <td class="text-left" rowspan="1" colspan="1">A person (or organization) running a WAMP <em>Client</em> or <em>Router</em>
</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <em>Client</em>
</td>
                <td class="text-left" rowspan="1" colspan="1">A program run by a <em>User</em>, with application code using WAMP for application-level communications</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <em>Router</em>
</td>
                <td class="text-left" rowspan="1" colspan="1">A program run by a <em>User</em>, with middleware code using WAMP to provide application routing services</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <em>Peer</em>
</td>
                <td class="text-left" rowspan="1" colspan="1">A WAMP <em>Client</em> or <em>Router</em>. An implementation might embed, provide or use both roles</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <em>Realm</em>
</td>
                <td class="text-left" rowspan="1" colspan="1">Isolated WAMP URI namespace serving as a routing and administrative domain, optionally protected by <strong>AA</strong>
</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <em>Transport</em>
</td>
                <td class="text-left" rowspan="1" colspan="1">A message-based, reliable, ordered, bidirectional (full-duplex) channel over which <em>Peers</em> communicate</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <em>Connection</em>
</td>
                <td class="text-left" rowspan="1" colspan="1">An underlying entity (if any) carrying the <em>Transport</em>, e.g. a network connection, pipe, queue or such</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <em>Session</em>
</td>
                <td class="text-left" rowspan="1" colspan="1">Transient conversation between a <em>Client</em> and a <em>Router</em>, within a <em>Realm</em> and over a <em>Transport</em>
</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <em>Message</em>
</td>
                <td class="text-left" rowspan="1" colspan="1">Indivisible unit of information transmitted between peers</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <em>Serializer</em>
</td>
                <td class="text-left" rowspan="1" colspan="1">Encodes WAMP messages, with application payloads, into byte strings for transport</td>
              </tr>
            </tbody>
          </table>
</section>
</div>
<div id="authentication-and-authorization-aa">
<section id="section-10.5.2">
          <h4 id="name-authentication-and-authoriz">
<a href="#section-10.5.2" class="section-number selfRef">10.5.2. </a><a href="#name-authentication-and-authoriz" class="section-name selfRef">Authentication and Authorization (AA)</a>
          </h4>
<table class="left" id="table-18">
            <caption><a href="#table-18" class="selfRef">Table 18</a></caption>
<thead>
              <tr>
                <th class="text-left" rowspan="1" colspan="1">Term</th>
                <th class="text-left" rowspan="1" colspan="1">Definition</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <em>Authentication</em>
</td>
                <td class="text-left" rowspan="1" colspan="1">Establishes the identity of a <em>Session</em> within a <em>Realm</em>
</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <em>Principal</em>
</td>
                <td class="text-left" rowspan="1" colspan="1">A <em>Principal</em> (<code>authid</code>) is any <em>User</em> that can be authenticated under a <em>Realm</em> (<code>realm</code>) and runs in the security context of a <em>Role</em> (<code>authrole</code>) within that <em>Realm</em>.</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <em>Credentials</em>
</td>
                <td class="text-left" rowspan="1" colspan="1">The authentication information and secrets used during</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <em>Authorization</em>
</td>
                <td class="text-left" rowspan="1" colspan="1">A decision on permitting a <em>Principal</em> to perform a given <em>Action</em> on an <em>URI or URI pattern</em>
</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <em>Access Control</em>
</td>
                <td class="text-left" rowspan="1" colspan="1">Policy for selective restriction of <em>Actions</em> on <em>URIs or URI patterns</em> performed by <em>Principals</em>
</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <em>Role-based Access Control (RBAC)</em>
</td>
                <td class="text-left" rowspan="1" colspan="1">An <em>Access Control</em> policy based on <em>Realm</em> (<code>realm</code>), <em>Principal</em>'s <em>Role</em> (<code>authrole</code>), <em>URI or URI pattern</em>, and <em>Action</em>
</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <em>Discretionary Access Control</em>
</td>
                <td class="text-left" rowspan="1" colspan="1">An <em>Access Control</em> policy controlled by <em>Users</em> and enforced by <em>Routers</em>
</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <em>Mandatory Access Control</em>
</td>
                <td class="text-left" rowspan="1" colspan="1">An <em>Access Control</em> policy controlled by <em>Router Administrators</em> or <em>Realm Owners</em>, and enforced by <em>Routers</em>
</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <em>Capability-based Access Control</em>
</td>
                <td class="text-left" rowspan="1" colspan="1">An <em>Access Control</em> policy where <em>Callers</em>, <em>Callees</em>, <em>Publishers</em>, <em>Subscribers</em> directly share capabilities with each other</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <em>Subject</em>
</td>
                <td class="text-left" rowspan="1" colspan="1">The originating <em>Session</em> of an <em>Action</em> in the context of <em>Authorization</em>
</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <em>Object</em>
</td>
                <td class="text-left" rowspan="1" colspan="1">A (fully qualified) <em>URI or URI pattern</em> representing the target of an <em>Action</em> in the context of <em>Authorization</em>
</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <em>Action</em>
</td>
                <td class="text-left" rowspan="1" colspan="1">One of the four core WAMP operations: <strong>register</strong>, <strong>call</strong>, <strong>subscribe</strong>, and <strong>publish</strong>
</td>
              </tr>
            </tbody>
          </table>
</section>
</div>
<div id="remote-procedure-calls-1">
<section id="section-10.5.3">
          <h4 id="name-remote-procedure-calls-2">
<a href="#section-10.5.3" class="section-number selfRef">10.5.3. </a><a href="#name-remote-procedure-calls-2" class="section-name selfRef">Remote Procedure Calls</a>
          </h4>
<table class="left" id="table-19">
            <caption><a href="#table-19" class="selfRef">Table 19</a></caption>
<thead>
              <tr>
                <th class="text-left" rowspan="1" colspan="1">Term</th>
                <th class="text-left" rowspan="1" colspan="1">Definition</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <em>Caller</em>
</td>
                <td class="text-left" rowspan="1" colspan="1">A <em>Caller</em> is a <em>Session</em> that <strong>calls</strong>, with application payloads, a (fully qualified) <em>Procedure</em> for call routing</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <em>Callee</em>
</td>
                <td class="text-left" rowspan="1" colspan="1">A <em>Callee</em> is a <em>Session</em> that responds to <em>Procedure</em> call invocations by <strong>yielding</strong> back application result payloads</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <em>Procedure</em>
</td>
                <td class="text-left" rowspan="1" colspan="1">A <em>Procedure</em> is an URI or URI pattern that can be registered for call routing by <em>Callees</em>
</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <em>Registration</em>
</td>
                <td class="text-left" rowspan="1" colspan="1">A <em>Router</em> record resulting from a <em>Callee</em> successfully <strong>registering</strong> a <em>Procedure</em> for call routing</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <em>Call</em>
</td>
                <td class="text-left" rowspan="1" colspan="1">A transient <em>Router</em> record resulting from a <em>Caller</em> successfully <strong>calling</strong> a <em>Procedure</em> for call routing</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <em>Invocation</em>
</td>
                <td class="text-left" rowspan="1" colspan="1">A call request and payload that are routed to a <em>Callee</em> having a matching <em>Registration</em> for the called <em>Procedure</em>
</td>
              </tr>
            </tbody>
          </table>
</section>
</div>
<div id="publish-and-subscribe">
<section id="section-10.5.4">
          <h4 id="name-publish-and-subscribe">
<a href="#section-10.5.4" class="section-number selfRef">10.5.4. </a><a href="#name-publish-and-subscribe" class="section-name selfRef">Publish and Subscribe</a>
          </h4>
<table class="left" id="table-20">
            <caption><a href="#table-20" class="selfRef">Table 20</a></caption>
<thead>
              <tr>
                <th class="text-left" rowspan="1" colspan="1">Term</th>
                <th class="text-left" rowspan="1" colspan="1">Definition</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <em>Publisher</em>
</td>
                <td class="text-left" rowspan="1" colspan="1">A <em>Publisher</em> is a <em>Session</em> that <strong>publishes</strong> application payloads to a (fully qualified) <em>Topic</em> for event routing</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <em>Subscriber</em>
</td>
                <td class="text-left" rowspan="1" colspan="1">A <em>Subscriber</em> is a <em>Session</em> that <strong>subscribes</strong> to a <em>Topic</em> to receive application payloads on matching events</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <em>Topic</em>
</td>
                <td class="text-left" rowspan="1" colspan="1">A <em>Topic</em> is an URI or URI pattern that can be subscribed to for event routing by <em>Subscribers</em>
</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <em>Subscription</em>
</td>
                <td class="text-left" rowspan="1" colspan="1">A <em>Router</em> record resulting from a <em>Subscriber</em> successfully <strong>subscribing</strong> to a <em>Topic</em> for event routing</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <em>Publication</em>
</td>
                <td class="text-left" rowspan="1" colspan="1">A transient <em>Router</em> record resulting from a <em>Publisher</em> successfully <strong>publishing</strong> to a <em>Topic</em> for event routing</td>
              </tr>
              <tr>
                <td class="text-left" rowspan="1" colspan="1">
                  <em>Event</em>
</td>
                <td class="text-left" rowspan="1" colspan="1">A publication that is routed to <em>Subscribers</em> having matching <em>Subscriptions</em> to the published <em>Topic</em>.</td>
              </tr>
            </tbody>
          </table>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="iana-considerations">
<section id="section-11">
      <h2 id="name-iana-considerations">
<a href="#section-11" class="section-number selfRef">11. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-11-1">WAMP uses the Subprotocol Identifier <code>wamp</code> registered with the <a href="https://www.iana.org/assignments/websocket/websocket.xhtml">WebSocket Subprotocol Name Registry</a>, operated by the Internet Assigned Numbers Authority (IANA).<a href="#section-11-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="conformance-requirements">
<section id="section-12">
      <h2 id="name-conformance-requirements">
<a href="#section-12" class="section-number selfRef">12. </a><a href="#name-conformance-requirements" class="section-name selfRef">Conformance Requirements</a>
      </h2>
<p id="section-12-1">All diagrams, examples, and notes in this specification are non-normative, as are all sections explicitly marked non-normative. Everything else in this specification is normative.<a href="#section-12-1" class="pilcrow">¶</a></p>
<p id="section-12-2">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
"SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in
this document are to be interpreted as described in RFC 2119 <span>[<a href="#RFC2119" class="cite xref">RFC2119</a>]</span>.<a href="#section-12-2" class="pilcrow">¶</a></p>
<p id="section-12-3">Requirements phrased in the imperative as part of algorithms (such as "strip any leading space characters" or "return false and abort these steps") are to be interpreted with the meaning of the key word ("MUST", "SHOULD", "MAY", etc.) used in introducing the algorithm.<a href="#section-12-3" class="pilcrow">¶</a></p>
<p id="section-12-4">Conformance requirements phrased as algorithms or specific steps MAY  be implemented in any manner, so long as the end result is equivalent.<a href="#section-12-4" class="pilcrow">¶</a></p>
<div id="terminology-and-other-conventions">
<section id="section-12.1">
        <h3 id="name-terminology-and-other-conve">
<a href="#section-12.1" class="section-number selfRef">12.1. </a><a href="#name-terminology-and-other-conve" class="section-name selfRef">Terminology and Other Conventions</a>
        </h3>
<p id="section-12.1-1">Key terms such as named algorithms or definitions are indicated like <em>this</em> when they first occur, and are capitalized throughout the text.<a href="#section-12.1-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="contributors">
<section id="section-13">
      <h2 id="name-contributors">
<a href="#section-13" class="section-number selfRef">13. </a><a href="#name-contributors" class="section-name selfRef">Contributors</a>
      </h2>
<p id="section-13-1">WAMP was developed in an open process from the beginning, and a lot of people have contributed ideas and other feedback. Here we are listing people who have opted in to being mentioned:<a href="#section-13-1" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-13-2.1">Alexander Goedde<a href="#section-13-2.1" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-13-2.2">Amber Brown<a href="#section-13-2.2" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-13-2.3">Andrew Gillis<a href="#section-13-2.3" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-13-2.4">David Chappelle<a href="#section-13-2.4" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-13-2.5">Elvis Stansvik<a href="#section-13-2.5" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-13-2.6">Emile Cormier<a href="#section-13-2.6" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-13-2.7">Felipe Gasper<a href="#section-13-2.7" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-13-2.8">Johan 't Hart<a href="#section-13-2.8" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-13-2.9">Josh Soref<a href="#section-13-2.9" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-13-2.10">Konstantin Burkalev<a href="#section-13-2.10" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-13-2.11">Pahaz Blinov<a href="#section-13-2.11" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-13-2.12">Paolo Angioletti<a href="#section-13-2.12" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-13-2.13">Roberto Requena<a href="#section-13-2.13" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-13-2.14">Roger Erens<a href="#section-13-2.14" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-13-2.15">Christoph Herzog<a href="#section-13-2.15" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-13-2.16">Tobias Oberstein<a href="#section-13-2.16" class="pilcrow">¶</a>
</li>
        <li class="compact" id="section-13-2.17">Zhigang Wang<a href="#section-13-2.17" class="pilcrow">¶</a>
</li>
      </ul>
</section>
</div>
<section id="section-14">
      <h2 id="name-normative-references">
<a href="#section-14" class="section-number selfRef">14. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
      </h2>
<dl class="references">
<dt id="RFC4122">[RFC4122]</dt>
      <dd>
<span class="refAuthor">Leach, P.</span>, <span class="refAuthor">Mealling, M.</span>, and <span class="refAuthor">R. Salz</span>, <span class="refTitle">"A Universally Unique IDentifier (UUID) URN Namespace"</span>, <span class="seriesInfo">RFC 4122</span>, <span class="seriesInfo">DOI 10.17487/RFC4122</span>, <time datetime="2005-07" class="refDate">July 2005</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4122">https://www.rfc-editor.org/info/rfc4122</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4648">[RFC4648]</dt>
      <dd>
<span class="refAuthor">Josefsson, S.</span>, <span class="refTitle">"The Base16, Base32, and Base64 Data Encodings"</span>, <span class="seriesInfo">RFC 4648</span>, <span class="seriesInfo">DOI 10.17487/RFC4648</span>, <time datetime="2006-10" class="refDate">October 2006</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4648">https://www.rfc-editor.org/info/rfc4648</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8032">[RFC8032]</dt>
    <dd>
<span class="refAuthor">Josefsson, S.</span> and <span class="refAuthor">I. Liusvaara</span>, <span class="refTitle">"Edwards-Curve Digital Signature Algorithm (EdDSA)"</span>, <span class="seriesInfo">RFC 8032</span>, <span class="seriesInfo">DOI 10.17487/RFC8032</span>, <time datetime="2017-01" class="refDate">January 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8032">https://www.rfc-editor.org/info/rfc8032</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-15">
      <h2 id="name-informative-references">
<a href="#section-15" class="section-number selfRef">15. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
      </h2>
<dl class="references">
<dt id="RFC2119">[RFC2119]</dt>
    <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<div id="authors-addresses">
<section id="appendix-A">
      <h2 id="name-authors-address">
<a href="#name-authors-address" class="section-name selfRef">Author's Address</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Tobias Oberstein</span></div>
<div dir="auto" class="left"><span class="org">typedef int GmbH</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:tobias.oberstein@typedefint.eu" class="email">tobias.oberstein@typedefint.eu</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
